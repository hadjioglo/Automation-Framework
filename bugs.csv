Summary,Issue key,Issue Type,Status,Priority,Resolution,Created,Resolved,Fix versions,Labels,Labels,Labels,Labels,Description,Environment,Custom field (Severity),Sprint,Sprint,Sprint,Custom field (Story Points)
Cannot delete card group from referrer BP and save changes,OBN1-21654,Bug,To Do,P1 ,,7/23/2025 7:48,,,,,,,"Present on stage. If you try to remove a card group from a referrer BP and try to save the change, 500 error is being thrown.



STEPS TO REPRODUCE:

# Find a referrer with multiple card groups in BP (HadjiogloCardgroup on moneris stage)
# Click edit on BP
# Remove one of the card groups
# Click save on the BP



EXPECTED

# Changes to be successfully saved



ACTUAL:

# 500 error is being thrown

!image-20250723-065211.png|width=41.66666666666667%,alt=""image-20250723-065211.png""!

# Following error is being logged:

An exception occurred while executing a query: SQLSTATE[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails ({{moneris}}.{{payment_referrer_override_fees}}, CONSTRAINT {{FK_AAF7862924DB0683}} FOREIGN KEY ({{config_id}}) REFERENCES {{payment_billing_plan_config}} ({{id}})) >> Trace: #0 Connection.php:1939: Doctrine\DBAL\Driver\API\MySQL\ExceptionConverter->convert(..) #1 Connection.php:1881: Doctrine\DBAL\Connection->handleDriverException(..) #2 Connection.php:1213: Doctrine\DBAL\Connection->convertExceptionDuringQuery(..) #3 Connection.php:698: Doctrine\DBAL\Connection->executeStatement(..) #4 BasicEntityPersister.php:609: Doctrine\DBAL\Connection->delete(..) #5 UnitOfWork.php:1302: Doctrine\ORM\Persisters\Entity\BasicEntityPersister->delete(..) #6 UnitOfWork.php:472: Doctrine\ORM\UnitOfWork->executeDeletions(..) #7 EntityManager.php:403: Doctrine\ORM\UnitOfWork->commit(..) #8 ReferrerChargebackFeesService.php:60: Doctrine\ORM\EntityManager->flush(..) #9 ReferrerBillingPlanService.php:262: App\Service\Payment\ReferrerBillingPlan\ReferrerChargebackFeesService->updateChargebackFees(..) #10 ReferrerBillingPlanService.php:182: App\Service\Payment\ReferrerBillingPlan\ReferrerBillingPlanService->updateBillingPlan(..) [] []",,,148,,,
[Workflow ] Fix edge-case workflow validation rule,OBN1-21506,Bug,Done,P3,Done,7/9/2025 14:18,7/15/2025 10:33,OBN 1.89,,,,,"Workflow creation validation for mandatory step rule condition not works as expected, AxiosError being thrown instead of validation for missing mandatory rule conditions.



STEPS TO REPRODUCE *(video is attached as well)*

# Initiate workflow creation
# Set some steps that involve rule condition
# Get to the “Step configuration” page
# Do not set any step rule condition, just click “Save”

!image-20250709-132453.png|width=876,height=449,alt=""image-20250709-132453.png""!



EXPECTED:

# UI validation to be performed, Step Rule conditions being highlighted



ACTUAL

# Axios error is shown below workflow name

!image-20250709-132637.png|width=722,height=405,alt=""image-20250709-132637.png""!

# Backend validations are still performed

!image-20250709-132658.png|width=734,height=517,alt=""image-20250709-132658.png""!",,,146,,,1
[Email] Document email request for a non-user PSC was not sent,OBN1-21489,Bug,To Do,P2,,7/8/2025 10:59,,,,,,,"Issue description:

{noformat}Handling ""App\Message\Workflow\StepRunner\MerchantOnboardingMessage"" failed: App\Service\Utils\Locale\LocaleService::getLocaleByEntity(): Argument #1 ($entity) must be of type App\Doctrine\Traits\Locale\HasLocaleInterface, null given, called in /var/www/api.prod.obnglobal.com/src/Service/Workflow/NotificatorAbstract.php on line 166
Trace:
#0 NotificatorAbstract.php:166: App\Service\Utils\Locale\LocaleService->getLocaleByEntity(..)
#1 MerchantOnboarding.php:126: App\Service\Workflow\NotificatorAbstract->sendDocumentsUploadRequiredToPSC(..)
#2 StepRunnerAbstract.php:333: App\Service\Workflow\StepRunner\MerchantOnboarding->actionOnOfficerWithoutDocsException(..)
#3 StepRunnerAbstract.php:277: App\Service\Workflow\StepRunnerAbstract->executeStep(..)
#4 MerchantOnboardingHandler.php:16: App\Service\Workflow\StepRunnerAbstract->run(..)
#5 HandleMessageMiddleware.php:152: App\MessageHandler\Workflow\StepRunner\MerchantOnboardingHandler->__invoke(..)
#6 HandleMessageMiddleware.php:91: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->callHandler(..)
#7 SendMessageMiddleware.php:71: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->handle(..)
#8 RetryCountMiddleware.php:25: Symfony\Component\Messenger\Middleware\SendMessageMiddleware->handle(..)
#9 RollbackIfExceptionMiddleware.php:32: App\MessageHandler\Core\RetryCountMiddleware->handle(..)
#10 DoctrinePingConnectionMiddleware.php:34: App\MessageHandler\Core\RollbackIfExceptionMiddleware->handle(..){noformat}

{panel:bgColor=#deebff}
+Dev notes:+

We are trying to identify the user's locale to be able to use it in email templates (translations), but no organization members or users are created yet at the step execution.

This can be reproduced from any steps where officer documents can be uploaded if was not provided before. Might be related to the not expected steps order in the workflow.

Impact of the bug: email described in #7580 was not sent.
The easiest fix: if the user or org member was not found, we can use the operator locale instead.
{panel}

*_Expected result:_* the email implemented through [https://cardstream.atlassian.net/browse/OBN1-7580|https://cardstream.atlassian.net/browse/OBN1-7580|smart-link]  is sent to the intended recipient.

*_Actual result:_* the email was not sent.",,,148,,,
Operator and Referrer Fee calculated with 0.01 cent difference (round issue),OBN1-21483,Bug,Done,P1 ,Done,7/7/2025 14:43,7/10/2025 10:50,OBN 1.89,,,,,"*Steps*: 

dump for testing [^dump-moneris-202507071640.sql] 

# Prepare billing plan 

!image-20250707-135109.png|width=54.91064545998275%,alt=""image-20250707-135109.png""!

# Process payment with amount = $4.04 (just run command to process Sale, if you use dump)
# Check Calculated Referrer Fee and Operator fee 

*Expected*: Referrer fee = 3.01, Operator Fee = 2.19

!image-20250707-135443.png|width=1462,height=757,alt=""image-20250707-135443.png""!

!image-20250707-135805.png|width=1288,height=760,alt=""image-20250707-135805.png""!

*Actual*: Referrer fee = 3.00, Operator Fee = 2.20

!image-20250707-135047.png|width=2129,height=1144,alt=""image-20250707-135047.png""!

to check Refunds",,,146,,,2
"[Statements] Merchant invoice is not generated if only ""Disputed Transactions"" table has data",OBN1-21422,Bug,Done,P2,Done,7/2/2025 7:17,7/16/2025 10:42,OBN 1.89,,,,,"Merchant invoice for which only “*Disputed Transactions / Chargebacks*” table has data will not be generated. Only if some additional info is present in the invoice, only then the invoice will generate and include “*Disputed Transactions / Chargebacks*”



STEPS TO REPRODUCE:

# Add a chargeback for the invoiced month
# Make sure no other fees or transactions were performed for the invoiced month 
# Generate the invoice for the invoiced month - php bin/console obn:invoices:generate-for-merchants --force



EXPECTED:

# Invoice is generated having only the “*Disputed Transactions / Chargebacks*” table



ACTUAL:

# No invoice is generated. Invoice is generated only if another transaction/fee will be added to that month



In the attached DB an invoice for May should be generated for merchant “merchant”",,,146,,,3
[Billing] Refunds cannot be processed due to missing Refund Fee deduction records,OBN1-21403,Bug,Done,P1 ,Done,6/30/2025 8:45,6/30/2025 13:08,OBN 1.88,NoShow,,,,"Issue:

# Merchant Billing Plan has Operator fee → Refund fee % value “0.00”
!image-20250630-074734.png|width=1194,height=763,alt=""image-20250630-074734.png""!
# Payment file is received with a Refund.
Expected result: the Refund is processed successfully.
Actual result: the Refund is not processed and the following error is captured
{noformat}SPLITTING_STORE_ERROR for BamboraTransaction with id = 36700: Error: UnexpectedValueException.
Code: 0
Message: Unexpected deduction type: BPS
Trace: 
#0 FundsSplitter.php:33: App\Service\Payment\FundsSplitter->extractDeduction(..)
#1 RtrFeesCalculator.php:71: App\Service\Payment\FundsSplitter->referrerAmount(..)
#2 RtrFeesCalculator.php:29: App\Service\Payment\RtrFeesCalculator->completeFeeRelatedToReferrer(..)
#3 RtrSplittingInitializer.php:82: App\Service\Payment\RtrFeesCalculator->calculate(..)
#4 RtrSplittingInitializer.php:63: App\Service\Payment\Splitting\RtrSplittingInitializer->storeSplittings(..)
#5 BamboraProcessRefundsCommand.php:192: App\Service\Payment\Splitting\RtrSplittingInitializer->calculate(..)
#6 BamboraProcessRefundsCommand.php:93: App\Command\Payment\Bambora\SettlementReport\BamboraProcessRefundsCommand->calculateSplittings(..)
#7 BamboraProcessRefundsCommand.php:69: App\Command\Payment\Bambora\SettlementReport\BamboraProcessRefundsCommand->executeRefundsDeductionProcess(..)
#8 Command.php:326: App\Command\Payment\Bambora\SettlementReport\BamboraProcessRefundsCommand->execute(..)
#9 Application.php:1096: Symfony\Component\Console\Command\Command->run(..)
#10 Application.php:126: Symfony\Component\Console\Application->doRunCommand(..){noformat}

{panel:bgColor=#deebff}
Dev notes:
There is no deduction for billing plan with id {{7093}}, payment type {{FEE_REFUND}} and deduction {{BPS}}. So it might be that something is misconfigured or we have a defect at the level of the code.
{panel}",,,145,,,1
[Statement] Fix synchronous Merchant statement download issue,OBN1-21368,Bug,Done,P3,Done,6/26/2025 12:50,7/10/2025 9:42,OBN 1.89,,,,,"Current issue:
1. when a Merchant statement is downloaded by 2 users at the same time, the following exception is thrown:

!image-20250626-142321.png|width=1078,height=659,alt=""image-20250626-142321.png""!

*Expected result:* the merchant statement is successfully downloaded.",,,146,,,1
"Workflow step ""Calculate the Operator fee"" fails if merchant had 2 outlets during onboarding",OBN1-21335,Bug,Done,P1 ,Done,6/20/2025 12:48,6/27/2025 12:43,OBN 1.88,NoShow,,,,"If user tries to onboard a merchant with two outlets, step “Calculate the Operator fee” from workflow fails.

STEPS TO REPRODUCE:

# Initiate onboarding of a merchant by having at least 2 outlets
# Make sure workflow gets to “Calculate the Operator fee” step



EXPECTED:

# Step to be completed successfully



ACTUAL:

# Step fails:

!image-20250620-115333.png|width=1767,height=561,alt=""image-20250620-115333.png""!

{noformat}[2025-06-20T11:49:55.279365+00:00] app.ERROR: An exception occurred while executing a query: SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '42-1-2-CAD' for key 'payment_chargeback_merchant_fees.UNIQ_8C3B166F6796D55448B4D2BD1EC08DAAFDA273EC' Trace:  #0 Connection.php:1939: Doctrine\DBAL\Driver\API\MySQL\ExceptionConverter->convert(..) #1 Connection.php:1881: Doctrine\DBAL\Connection->handleDriverException(..) #2 Statement.php:194: Doctrine\DBAL\Connection->convertExceptionDuringQuery(..) #3 Statement.php:249: Doctrine\DBAL\Statement->execute(..) #4 BasicEntityPersister.php:285: Doctrine\DBAL\Statement->executeStatement(..) #5 UnitOfWork.php:1183: Doctrine\ORM\Persisters\Entity\BasicEntityPersister->executeInserts(..) #6 UnitOfWork.php:447: Doctrine\ORM\UnitOfWork->executeInserts(..) #7 EntityManager.php:403: Doctrine\ORM\UnitOfWork->commit(..) #8 EntityManagerDecorator.php:221: Doctrine\ORM\EntityManager->flush(..) #9 TransactionFeesSetter.php:41: Doctrine\ORM\Decorator\EntityManagerDecorator->flush(..) #10 CustomEntityManager.php:43: App\Service\Workflow\Task\TransactionFeesSetter->App\Service\Workflow\Task\{closure}(..) [] []{noformat}

Attached the DB dump where you can retry the step for application 48 (operator login is the default for moneris)",,,145,,,3
[Outlets] Outlet cannot be created for an onboarded merchant,OBN1-21328,Bug,Done,P1 ,Done,6/20/2025 8:52,7/7/2025 10:11,OBN 1.87,NoShow,,,,"+Scenario+:

# The Operator or Referrer users clicks “Create Outlet” for a merchant already onboarded with at least one outlet.
# The user edits the Outlet data and clicks “Save” and “Confirm”

*_Expected result:_* Outlet is successfully created

*_Actual result:_* error appears “The merchant does not have access to one of the payment services that you’ve tried to activate for this outlet.”



_Example:_

!image-20250620-075440.png|width=1565,height=800,alt=""image-20250620-075440.png""!

!image-20250620-075532.png|width=1091,height=772,alt=""image-20250620-075532.png""!

!image-20250620-075550.png|width=1590,height=913,alt=""image-20250620-075550.png""!",,,145,,,2
Moneris - POST /merchant cardHolderName not truncated,OBN1-21275,Bug,To Do,P3,,6/10/2025 13:29,,,,,,,"*Steps*: 

# Run EWD day job for yesterday
# Process RTP, RTR for OBMC for Today date
# Run EWD day job for Today
# Check {{payment_report_parts}} have new_funds_volume
# Navigate to Merchats → Outlets
# Validate Processing for Open Banking (Mastercard)

*Expected*: In “Processing for Open Banking (Mastercard)” is displayed sum of {{(new_funds_volume - refund_volume)}} for last 30 days from payment_report_parts (just OBMC mpa’s)

*Actual*: N/A is displayed

if login as Merchant same issue

Note: “Total Processing” is displaying correct value

dump  ",,,,,,
"[Reconciliation] ""Refund - Referrer fees"" should not be displayed in the Merchant view",OBN1-21243,Bug,Done,P1 ,Done,6/9/2025 8:31,6/23/2025 15:35,OBN 1.88,,,,,"According to [[OBN1-4856] [Reconciliation] Add Scheme and Interchange Fee (Card) - Jira|https://cardstream.atlassian.net/browse/OBN1-4856] the “Refund - Referrer fees” should not be displayed in the Merchant view on the Reconciliation page.

Expected result: The *Refund - Referer fees* should not be displayed.
Current issue: *Refund - Referer fees*{color:#bf2600} {color}{color:#bf2600}are displayed.{color}

Example:
1. the user is logged in as a Merchant
2. the user access the Reconciliation page and selected a reporting period
3. when viewing “Fees deducted since start of period, the “Refund - Referrer fees” should not appear for the Merchant user:

!image-20250609-140538.png|width=1697,height=625,alt=""image-20250609-140538.png""!

!image-20250609-140728.png|width=1352,height=508,alt=""image-20250609-140728.png""!

!image-20250609-144338.png|width=1239,height=273,alt=""image-20250609-144338.png""!

{panel:bgColor=#deebff}
No Referrer fees should be displayed in the Merchant view.
{panel}",,,145,,,1
"[Reconciliation] Correct the ""Last updated"" value",OBN1-21212,Bug,Done,P2,Done,6/5/2025 16:06,6/27/2025 13:48,OBN 1.88,,,,,"Scenarios from the stage and results (for all scenarios below, consider you see them as a user on the _current_ date “23 Jun 2025”):

# “Last update” is displayed correctly
!image-20250623-071840.png|width=2109,height=1149,alt=""image-20250623-071840.png""!


# “Last update” is displayed correctly:
# !image-20250623-071942.png|width=2108,height=1148,alt=""image-20250623-071942.png""!
“Last update” is displayed incorrectly:
!image-20250623-072020.png|width=2132,height=1200,alt=""image-20250623-072020.png""!

*_Required_* *_fix:_* The “Last updated” value should be the datetime when the last EWD job has run and does not change depending on the selected Report “Start date” or “End date”.



{panel:bgColor=#deebff}
Based on the original requirement from [[OBN1-1964] [Dev] Last Updated - Jira|https://cardstream.atlassian.net/browse/OBN1-1964], the “Last updated” field should be a datetime value that only changes when the EWD job has run. It should not change based on the selected “Start date” and “End date” in the UI. 
{panel}",,,145,,,2
[OBMC] Processing values are not displayed for outlets for OBMC,OBN1-21207,Bug,Done,P3,Done,6/4/2025 15:24,7/10/2025 9:10,OBN 1.89,NoShow,,,,"*Steps*: 

# Run EWD day job for yesterday
# Process RTP, RTR for OBMC for Today date
!image-20250604-143258.png|width=1727,height=199,alt=""image-20250604-143258.png""!
# Run EWD day job for Today
# Check {{payment_report_parts}} have new_funds_volume
!image-20250604-143324.png|width=1701,height=230,alt=""image-20250604-143324.png""!
# Navigate to Merchats → Outlets
# Validate Processing for Open Banking (Mastercard)

*Expected*: In “Processing for Open Banking (Mastercard)” is displayed sum of {{(new_funds_volume - refund_volume)}} for last 30 days from payment_report_parts (just OBMC mpa’s)

*Actual*: N/A is displayed

!image-20250604-143436.png|width=2101,height=1129,alt=""image-20250604-143436.png""!

if login as Merchant same issue

!image-20250604-143345.png|width=2074,height=753,alt=""image-20250604-143345.png""!

Note: “Total Processing” is displaying correct value

dump [^dump-obn-202506041707.sql] ",,,146,,,2
Safeguard and RR amounts are not populated in payment_report_parts after EWD executes,OBN1-21114,Bug,To Do,P3,,5/22/2025 16:04,,,,,,,"Need to investigate why we need the fields 
 rr_start_of_day_count
  rr_start_of_day_volume
  safeguard_start_of_day_count
  safeguard_start_of_day_volume

in table payment_report_parts . Cause UI seems to show amount, but not Count

!image-20250522-153640.png|width=2080,height=1134,alt=""image-20250522-153640.png""!

probably from here 

!image-20250522-153755.png|width=1463,height=228,alt=""image-20250522-153755.png""!



*Steps*: 
Dump attached

[^dump-obn-202505221539.sql]

# Change PC date time to 5th May 4pm
# Run test {{Scenario: Bambora Settlement Report with Sales and Refunds and CB is imported and matched}} to match Sale and Refund transactions
# Process refunds, sales 
# Check the {{SELECT * FROM payment_merchants WHERE id = 8;}} safeguard_reserved_minor_units increased by the value of RR for all sales. 
# Change PC date time to 5th May 8pm
# run {{php bin/console obn:working-hour}}
# Records are created in payment_report_parts table

*Expected*: values are populated for this columns below

!image-20250522-152624.png|width=1661,height=307,alt=""image-20250522-152624.png""!

*Actual*: are not populated",,,148,,,
[PROD] Error matching Bambora Sale transactions,OBN1-21092,Bug,Done,P1 ,Done,5/20/2025 16:08,5/22/2025 7:20,OBN 1.85,,,,,"PROD issue:

# Error matching Bambora Sale transactions

!image-20250520-150904.png|width=83.33333333333334%,alt=""image-20250520-150904.png""!",,,142,,,
"""Download signed offer (signed on DD.MM.YYYY)"" is displayed in ""Commercial Offer"" tab even if merchant rejected the offer",OBN1-21025,Bug,Done,P3,Done,5/14/2025 12:45,5/15/2025 12:46,OBN 1.84,,,,,"If the commercial offer was rejected by the merchant, “Download signed offer (signed on 14 May 2025)” is still displayed on the “Commercial Offer” tab of the merchant application



STEPS TO REPRODUCE:

# Start onboarding of a merchant
# Make sure the merchant has a portal user created
# Make the workflow get to step “Present commercial offer to applicant for signing”
# Log in as the merchant that is onboarded
# Reject the offer

!image-20250514-114339.png|width=1596,height=685,alt=""image-20250514-114339.png""!
# Workflow will go to “Commercial offer accepted by applicant” step with Manual status

!image-20250514-114418.png|width=1729,height=734,alt=""image-20250514-114418.png""!



# Check if a “signed” commercial offer is displayed on the “Commercial Offer” page of the application



EXPECTED:

# An unsigned version of the PDF should be available



ACTUAL:

# A signed PDF is available for download
# !image-20250514-114735.png|width=722,height=455,alt=""image-20250514-114735.png""!



DB dump attached

user: [operator.admin@moneris.com|mailto:operator.admin@moneris.com]
pass: [operator.admin@moneris.com|mailto:operator.admin@moneris.com]
Application ID: 172",,,142,,,1
Operator cannot confirm commercial offer after initially rejected by merchant,OBN1-21024,Bug,Done,P3,Done,5/14/2025 12:31,5/15/2025 12:48,OBN 1.84,,,,,"If the commercial offer was rejected by the merchant, workflow steps goes to manual from where the operator has the option to manually confirm it. When selecting “confirm” an error is thrown instead of confirming



STEPS TO REPRODUCE:

# Start onboarding of a merchant
# Make sure the merchant has a portal user created
# Make the workflow get to step “Present commercial offer to applicant for signing”
# Log in as the merchant that is onboarded
# Reject the offer

!image-20250514-114339.png|width=1596,height=685,alt=""image-20250514-114339.png""!
# Workflow will go to “Commercial offer accepted by applicant” step with Manual status

!image-20250514-114418.png|width=1729,height=734,alt=""image-20250514-114418.png""!



# Confirm the offer from the Manual step as operator admin user



EXPECTED:

# Offer is accepted



ACTUAL:

# “Operation is not allowed” error is displayed

!image-20250514-114814.png|width=1369,height=795,alt=""image-20250514-114814.png""!



# Offer is not confirmed





DB dump attached

user: [operator.admin@moneris.com|mailto:operator.admin@moneris.com]
pass: [operator.admin@moneris.com|mailto:operator.admin@moneris.com]
Application ID: 172",found on stage moneris,,142,,,1
Billing plan name minimum length validation not displayed on UI,OBN1-21023,Bug,Done,P3,Done,5/14/2025 12:19,5/14/2025 12:56,OBN 1.84,,,,,"Billing plan name minimum length validation not displayed on UI



STEPS TO REPRODUCE:

# Edit the billing plan of a referrer
# Set a name with less than 3 characters
# Try to save the changes



EXPECTED:

# A validation for minimum length is displayed on UI



ACTUAL:

# No UI validation si shown
# only backend validation error can be seen if checked manually in Network tab",,,142,,,1
[Payment files] Import Moneris SFTP payment files even if the files have no transaction data,OBN1-20806,Bug,Done,P1 ,Done,4/15/2025 10:09,4/15/2025 15:15,OBN 1.82,Moneris,MonerisMVP2,,,"*Required fix:*

# All Moneris SFTP payment files need to be imported successfully even if the files have no transaction data:
a. UNIVERSAL SETTLEMENT FILE - {chainNumber}.NL8CSV34.CSV
b. CHAINS DAILY COPY REQUEST ACTIVITY FILE - {chainNumber}.NL8FTP37.CSV
c. CHAINS DAILY CHARGEBACK ACTIVITY FILE - {chainNumber}.NL8FTP38.CSV
d. PAYMENT ORDER DETAILS REPORT - {chainNumber}.NL8FTP39.CSV
e. DISPUTE FEE DETAILS REPORT -{chainId}.NL8FTP60.CSV


*Errors captured during testing the following payment files:*

# [ERROR] An error occurred when file /tmp//20250415074109_943373/1744702869.4473_                                                                                                             831964_*C600058938.NL8FTP60.CSV.*20250221 was importing: Error: TypeError.
Code: 0
Message: App\Service\Moneris\ReportImportService::handleTransactionDetailsGenera                                                                                                             l(): Argument #1 ($transaction) must be of type App\Service\Moneris\Report\Trans                                                                                                             actionDto, null given, called in /var/www/api.staging.obnglobal.com/src/Service/                                                                                                             Moneris/ReportImportService.php on line 122
Trace:
#0 ReportImportService.php:122: App\Service\Moneris\ReportImportService->handleT                                                                                                             ransactionDetailsGeneral(..)
#1 MonerisImportPaymentsCommand.php:210:
# [ERROR] An error occurred when file /tmp//20250415084256_797954/1744706576.7051_517712_*C600058938.NL8CSV34.CSV*.20250222 was importing: Error: TypeError.
Code: 0
Message: App\Service\Moneris\ReportImportService::handleTransactionDetailsGeneral(): Argument #1 ($transaction) must be of type App\Service\Moneris\Report\TransactionDto, null given, called in /var/www/api.staging.obnglobal.com/src/Service/Moneris/ReportImportService.php on line 122
Trace:
#0 ReportImportService.php:122: App\Service\Moneris\ReportImportService->handleTransactionDetailsGeneral(..)
# [ERROR] An error occurred when file /tmp//20250415084256_797954/1744706576.5178_121257_*C600058938.NL8FTP39.CSV*.20250222 was importing: Error: TypeError.
Code: 0
Message: App\Service\Moneris\ReportImportService::handleTransactionDetailsGeneral(): Argument #1 ($transaction) must be of type App\Service\Moneris\Report\TransactionDto, null given, called in /var/www/api.staging.obnglobal.com/src/Service/Moneris/ReportImportService.php on line 122
Trace:
#0 ReportImportService.php:122: App\Service\Moneris\ReportImportService->handleTransactionDetailsGeneral(..)
#1 MonerisImportPaymentsCommand.php:210: App\Service\Moneris\ReportImportService->importReport(..)
# ubuntu@ip-172-31-41-120:/var/www/api.staging.obnglobal.com$ sudo -u www-data OP_NAME_CLI=moneris php bin/console dispute:report-file:import MONERIS
[ERROR] An error occurred when file /tmp/20250415091843_483960/1744708723.6602_456569_*C600058938.NL8FTP37.CSV*.20220616 was importing: Error: TypeError.
Code: 0
Message: App\Service\AcquirerReport\Dispute\ReportImportService::handleTransactionDetailsGeneral(): Argument #1 ($transaction) must be of type App\Service\AcquirerReport\Dispute\TransactionDto, null given, called in /var/www/api.staging.obnglobal.com/src/Service/AcquirerReport/Dispute/ReportImportService.php on line 117
Trace:
# [ERROR] An error occurred when file /tmp/20250415091843_483960/1744708723.6997_787745_*C600058938.NL8FTP38.CSV*.20220616 was importing: Error: TypeError.
Code: 0
Message: App\Service\AcquirerReport\Dispute\ReportImportService::handleTransactionDetailsGeneral(): Argument #1 ($transaction) must be of type App\Service\AcquirerReport\Dispute\TransactionDto, null given, called in /var/www/api.staging.obnglobal.com/src/Service/AcquirerReport/Dispute/ReportImportService.php on line 117
Trace:
#0 ReportImportService.php:117: App\Service\AcquirerReport\Dispute\ReportImportService->handleTransactionDetailsGeneral(..)",,S2,140,,,2
Diagrams are broken in external docs (Safari),OBN1-20767,Bug,Done,P4,Done,4/10/2025 7:26,4/11/2025 15:31,OBN 1.82,,,,,,"# Open external docs
# Check all pages

Expected: Diagrams are ok

Actual: Diagrams display Syntax error in text",,139,,,1
Dispute search by Case Id does not work (flaky),OBN1-20194,Bug,To Do,P3,,2/19/2025 9:58,,,Q4UI,,,,"*Env*: local, stage

*Steps to reproduce*: 

# Navigate to Disputes → Open Cases (Closed Cases) 
# Type in search id number 1123

*Expected*: dispute with scheme case id = 1123 is displayed

*Actual*: not displayed.",,,148,,,
[Settlement] No retries are performed during Moneris settlement,OBN1-20092,Bug,Done,P2,Done,1/31/2025 9:38,2/10/2025 12:45,OBN 1.78,Moneris,MonerisPhase2.0,,,"No retries are performed after settlement request to Moneris fails (operator confirmed, most probably same issue happens for merchant and referrer).

Functionality was working as in the following test case [[OBN1-15015] Check no more retries are done after number of maximum retries are reached on settlement of Moneris Operator - Jira|https://cardstream.atlassian.net/browse/OBN1-15015]



STEPS TO REPRODUCE:

Background:
Moneris settlement url should have an incorrect value

Given ""MONERIS"" value is set for ""SETTLEMENT_PAYMENT_PROVIDER"" in .env
And ""RESELLER"" organisation exists in ""user_organizations"" table
And id of ""SYNCHRONISED"" status exists in ""moneris_merchants.status_id"" table
And the merchant is linked in ""payment_moneris_operators.moneris_merchant_id"" column to the operator
And Operator has funds that are available for settlement in the Operator Holding account
When user logs in using ""RESELLER"" profile with ""ROLE_ADMIN"" role
And user navigates to ""Organisation"">""Bank Account details"" page
And user clicks on ""Withdraw"" icon
And user enters a value in ""Withdrawal amount"" field
And user clicks on ""Confirm"" button
And a request is sent to Moneris to ""[https://api.ct.moneris.io/tpa/merchants/{merchant-id}/payouts?api_version=2023-08-10|https://api.ct.moneris.io/tpa/merchants/%7Bmerchant-id%7D/payouts?api_version=2023-08-10]"" endpoint



EXPECTED:

# And 20 retries are performed to Moneris endpoint



ACTUAL:

# No retries are performed",,,135,,,3
[PROD] UI issue when saving Billing Plan updates (add new payment service),OBN1-20031,Bug,Done,P2,Done,1/28/2025 12:33,1/30/2025 10:30,OBN 1.77,,,,,"Scenario:

# Take a Referrer with Card Billing Plans only
# Go to edit Billing Plan and add a new Payment Service and any profit type (in this test, I added OBMC, Net Revenue)
# Add all required fees
# Click “Save”

*Expected result:* 

# The Billing Plan update are successfully saved, and confirmative message appears.

*Actual result:*

# The saving process hang, message box appears “This page isn’t responding”.
# It is not possible to reload the page, you need to close the tab, and open a new one, even though no error in the console
# When verifying the Referrer Billing Plan, the updates were successfully saved and now visible in the portal.

+Note+: tested in both Stage and Demo, browser EDGE. 
Also, the +_issue does not reproduce_+ for the scenario: _Referrrer has “OBMC” only_ and _add new payment service “Card”._

!image-20250128-131826.png|width=66.66666666666667%,alt=""image-20250128-131826.png""!

More info:

!image-20250128-134406.png|width=66.66666666666667%,alt=""image-20250128-134406.png""!

!image-20250128-134426.png|width=41.66666666666667%,alt=""image-20250128-134426.png""!",,,134,,,1
Commercial offer is not generated for billing plans with OBMC,OBN1-19952,Bug,Done,P1 ,Done,1/21/2025 13:48,1/22/2025 10:43,OBN 1.76,,,,,"During sanity testing, it was noticed that for merchants that have billing plans with OBMC, the commercial offer fails to generate.



Reproduced on stage



STEPS TO REPRODUCE:

# Make sure referrer has OBMC billing plan activated
# Initiate merchant onboarding and set OBMC as merchant billing plan
# Submit the merchant application



EXPECTED

# Commercial offer PDF to be generated and presented to merchant



ACTUAL:

# Commercial offer fails to generate with error

[2025-01-21T13:13:18.598861+00:00] app.ERROR: Error on generating commercial offer PDF for merchant id = ""1307"".array_map(): Argument #2 ($array) must be of type array, null given Trace: #1 CommercialOfferService.php:198: App\Service\User\MerchantOnboarding\CommercialOfferService->mapCardTypes(..) #2 CommercialOfferService.php:76:



!image-20250121-134316.png|width=1496,height=521,alt=""image-20250121-134316.png""!

most probably because at line 198 card array is expected, but OBMC billing plan has none



!image-20250121-134401.png|width=1083,height=534,alt=""image-20250121-134401.png""!",,,134,,,1
"Referrer support URL is validated only after ""Create Billing Plan"" page",OBN1-19887,Bug,To Do,P4,,1/15/2025 14:59,,,,,,,"URL validation is not performed on same page

STEPS TO REPRODUCE:

# Initiate creation of a referrer
# Set INVALID domain value for Referrer support URL 

!referrer creation invalid support domain-20250115-145508.png|width=1022,height=819,alt=""referrer creation invalid support domain-20250115-145508.png""!

# Click next



EXPECTED

# Validation will be performed on the same page, “Contact Details”



ACTUAL:

# Validation is performed only after clicking “Save” on the “Create Billing Plan Page”



short video can be found in attachments",,S4,150,,,
Cardstream reseller ID issue (error 500),OBN1-19886,Bug,Done,P3,Done,1/15/2025 13:45,5/8/2025 14:07,OBN 1.84,,,,,"Scenario:

# A Referrer doesn’t have a Cardstream Reseller ID.
# An Application is submitted and has reached the step “Create Merchant records in gateway”

Expected result: 

# The step fails and a notification is sent: “Cannot sync customer for merchant id […], because referrer id […] doesn’t have CS reseller id”

Actual result:

# The step fails with a notification: error 500.",,,141,,,1
[OBMC] RTP could not be created for amount 1.000.000,OBN1-19858,Bug,Done,P3,Done,1/3/2025 15:44,5/2/2025 10:13,OBN 1.84,OBMC,Payment,,,"Bug found in regression test {{@OBN1-18667 @OBN1-18801}}

*Steps to reproduce:* 

# Trigger RTP from gateway for 1000000.00 to endpoint /gateway/mpa/{{mpaUuid}}/payments

*Expected*: payment is created successfully

*Actual*: 

{noformat}{
    ""errors"": {
        ""amount"": [
            {
                ""code"": ""04b91c99-a946-4221-afc5-e65ebac401eb"",
                ""detail"": ""This value should be between 0.01 and 100000.""
            }
        ]
    }
}{noformat}",,,141,,,1
Missing Card Types in Moneris fixtures,OBN1-19573,Bug,Done,P3,Done,12/5/2024 11:06,2/28/2025 12:08,OBN 1.79,Moneris,MonerisMVP2,,,"*Steps to reproduce:*

# Run fixtures for Moneris Operator on an empty db. (command: export OP_NAME_CLI=moneris && php bin/console do:fi:lo --group=init --group=operator --group=operator_userdata)
# Check the table ‘payment_card_types'.

*Expected result:*

All the card types (total of 21) should be present for Moneris after running fixtures.

*Actual result:*

There are 3 card types missing from Moneris fixtures. ",,S4,136,,,1
[Report] Settlement Report not generated due to Operator Settlement Service issue,OBN1-19569,Bug,Done,P1 ,Done,12/4/2024 8:29,12/5/2024 7:46,OBN 1.73,HotFix,,,,"+Error:+
*Operator Settlement Service for reports* and *Operator Settlement Service* to display data on UI are mixed up into one and conflicting right now.
Due to the above issue, there won't be generated any settlement reports (recurring / one time).

+Error message:+

{noformat}Error on generating the report for the report generation request id: 19. Error: [Semantical Error] line 0, col 377 near 'pos.created_at': Error: 'pos' is not defined.{noformat}

The line to pay attention to: [https://gitlab.com/obnglobal/api/-/blob/2c0ab33247701d5e05dd85c3f2ccb9fd3bd04720/src/Service/Payment/Settlement/OperatorSettlementService.php#L74|https://gitlab.com/obnglobal/api/-/blob/2c0ab33247701d5e05dd85c3f2ccb9fd3bd04720/src/Service/Payment/Settlement/OperatorSettlementService.php#L74|smart-link] 

Required:
1. to fix the root cause
2. to retry the Settlement Report: in PROD there is one Settlement Report not generated today, this report will not be generated in the next days, unless the issue is fixed.

!image-20241204-085322.png|width=703,height=288,alt=""image-20241204-085322.png""!

!image-20241204-085347.png|width=1158,height=305,alt=""image-20241204-085347.png""!

*S**_ee attachments_*_:_ Operator_Settlement_Fix.patch",,,130,,,2
Logs and alerts not working in production,OBN1-19396,Bug,Done,P1 ,Done,11/20/2024 13:34,11/20/2024 14:40,OBN 1.72,HotFix,Tech-debt,,,"In one of the tasks deployed within {{release-v1.71}}, *monolog* config was changed in a wrong way for production environment by mistake.

We need to restore it to the previous version.",,,129,,,1
Upload of CSV is not working in Firefox,OBN1-19232,Bug,Done,P2,Done,11/6/2024 13:43,11/8/2024 9:35,OBN 1.71,,,,,"During exploratory testing it was noticed that CSV files cannot be uploaded on portal while using Firefox.

*This happens on all pages that have the possibility to upload a CSV file.*



STEPS TO REPRODUCE:

# Login to portal
# Open a page that offers the possibility to upload a CSV (for example [http://local.operator/settings/mccs/compliance-settings|http://local.operator/settings/mccs/compliance-settings])
# Upload a valid CSV file



EXPECTED:

# CSV to be successfully uploaded



ACTUAL

# Error “csv file is expected” is displayed
# CSV is not uploaded





!image-20241106-143604.png|width=1601,height=506,alt=""image-20241106-143604.png""!",,,128,,,1
[Xero] Payments created in Xero have incorrect date,OBN1-19226,Bug,Done,P3,Done,11/5/2024 13:09,11/13/2024 9:50,OBN 1.72,,,,,"Payments that are created in Xero have payment date set as first day of next month. Expected payment date should be the same day as the invoice issue date - last day of month for which invoice is created.



STEPS TO REPRODUCE:

# Perform transactions in OBN
# Generate invoices in OBN for a merchant that is synced with Xero
# Execute the xero-import-merchant-invoices command



EXPECTED:

# Payments created in Xero to have the same date as “issue date” of Xero invoice (example: 31.10.2024)



ACTUAL

# Payment date is set as first day of next month (example: 01.11.2024)",,,129,,,1
 Bambora payment file that was not processed properly,OBN1-19135,Bug,Done,P1 ,Done,10/31/2024 7:03,11/1/2024 13:51,OBN 1.71,,,,,"Hi Ramona,

The Bambora payment file 20241030145754_OBNGLOBAL_GBP.csv was downloaded from the SFTP site by the OBN platform yesterday but it did not process any of the transactions.

# We need this file process ASAP because we owe merchants the money.
# We need to know why it didn’t process so we can make a fix if required.

Background:

* Bambora had a delay in sending the payment file with the Value Date of 29 October.  That is this file identified above.
* The money was received at 6:28am on 29^th^ with the correct amount and payment reference, and it triggered the Starling webhook. The transaction payload was

_""fpid"": ""27280554826096F4SW1020241029826400530     "", ""type"": ""SIP"", ""reference"": ""_*_BAMB241029500448_*_"", ""addressUid"": ""c6ccab7f-e48e-49ca-b4cb-85f1901423eb"", ""paymentUid"": ""022433c4-8c1c-49c0-adec-598e43da3e9c"", ""receivedAt"": ""2024-10-29T06:28:47.000Z"", ""returnDetails"": [], ""sourceAccount"": {""sortCode"": ""404865"", ""accountName"": ""BAMBORA AB"", ""accountNumber"": ""62617023""}, ""instructedAmount"": {""currency"": ""GBP"", ""minorUnits"": 3863325}, ""settlementAmount"": {""currency"": ""GBP"", ""minorUnits"":_ *_3863325_*_}, ""deadlineForReturn"": ""2024-10-30T17:00:00.000Z"", ""fpsSettlementDate"": ""2024-10-28"", ""paymentAccountUid"": ""4cd7d64d-b215-46c4-9b02-23df2afca522"", ""destinationAccount"": {""sortCode"": ""040059"", ""accountName"": ""OBN GLOBAL LIMITED 90019548"", ""accountNumber"": ""84412288""}, ""paymentBusinessUid"": ""c5fc3552-c21b-4ee6-a42b-dc7f49508bec"", ""settlementCycleUid"": ""ce278aa2-92b2-4dce-8db5-b1841b1f61a4"", ""fpsSettlementCycleId"": ""CYCLE_003""}_

* They finally sent the file on 30 October, a day late, and it was received *after* the normal payment file for 30^th^.
** i.e. the files were received out of sequence. The file with the value date of 29^th^ has a date/time later than the file with a value date of the 30^th^… and by the time we received the file from 29^th^ we had probably already processed the file for 30^th^ – see this image of when OBN download the files…



!image-20241031-070456.png|width=657,height=249,alt=""image-20241031-070456.png""!



 

Here is the import and processing records – there is no record that the system even tried to import the file of 29^th^…



!image-20241031-070519.png|width=668,height=196,alt=""image-20241031-070519.png""!



Thoughts:

# Why did devops not get notified that the payment file was not processed? It had been downloaded, we already had received the money, and the reference and value matched. We can never have the case where a payment file is not processed and we are not notified.
# Does the OBN platform not process a file for a historic date that is out of sequence, even if it has not been processed? If this is the case, we need to remove that validation.

___________________________________________________________________________

David investigation:



I don’t believe it will import a file with the same date in the file name which has already been processed due to:

src/Repository/Payment/BamboraPaymentRepository.php

findMaxDateGroupByBamboraMid() returning *2024-10-30*;

 

src/Command/Payment/Bambora/SettlementReport/BamboraImportPaymentsCommand.php

shouldImportReport() checking if *2024-10-30* (the date in the file name) is different to the maxDate *2024-10-30* which it isn’t so it will return false and not Import the file

Thanks,

_______________________________________________________

Thanks Dave.

Ramona – if that is the problem, we need to redo that validation, but more urgently we need to get the file processed. I’m not sure if we have a production command that forces processing overriding any validation below that Dave highlighted if that is what stopped it.

We probably also want some slightly different logic in the processing cronjob that makes the ‘Processed Date’ of the transaction to be set to the later date of ‘Value Date’ or the time the money arrived – and not the date it was actually processed. This will allow us to process files that arrive late, and still settle with the delay they would have had if they had arrived on time. Ie. Tuesday’s file that arrived a day late and was processed on Wednesday, should have the transaction processed date of Tuesday. But this can wait as a follow on change – we need to get the current file processed.",,,128,,,3
debt_to_referrer_units is not covered after processing a bambora positive chargeback,OBN1-19038,Bug,Done,P2,Done,10/22/2024 13:31,10/30/2024 12:37,OBN 1.71,,,,,"When a merchant has debt_to_obn_units and debt_to_referrer_units and a positive chargeback is processed, debt to referrer is not covered by that chargeback



STEPS TO REPRODUCE:

# Set debt_to_obn_units of merchant as 500
# Set debt_to_referrer_units of merchants as 250
# Process a positive chargeback with amount bigger than 500



EXPECTED:

# debt_to_obn_units to be covered
# debt_to_referrer_units to be covered



ACTUAL:

# only debt_to_obn_units is covered by chargeback, referrer debt remains uncovered.",,,128,,,2
"""Reporting period"" in Invoice PDF has incorrect value",OBN1-18977,Bug,Done,P2,Done,10/16/2024 15:04,11/8/2024 9:10,OBN 1.71,,,,,"Reporting Period displayed in PDF has incorrect value, compared to UI



STEPS TO REPRODUCE:

# Make sure the operator timezone in env. file is set to Europe/London
# Generate reports ( you can do it using php bin/console obn:invoices:generate-for-merchants --force)
# Download the PDF



EXPECTED:

# Reporting period to have range firstDayOfMonth - lastDayOfMonth

ACTUAL:

# Reporting date is taken from DB, which has the date adjusted to UTC
!image-20241016-140758.png|width=1186,height=600,alt=""image-20241016-140758.png""!



!image-20241016-140725.png|width=540,height=622,alt=""image-20241016-140725.png""!

In UI the range is displayed correctly:


!image-20241016-140835.png|width=1934,height=280,alt=""image-20241016-140835.png""!",stage,,128,,,1
[Bambora] Records not created in the 'payment_bambora_chargeback_payments' table when a positive chargeback is processed,OBN1-18938,Bug,Done,P2,Done,10/11/2024 9:42,7/15/2025 13:55,OBN 1.89,NoShow,,,,"*Steps to reproduce:*

# A payment file which contains positive disputes exist and is being processed.
# Payment file has id of “REMAINS_DEDUCTED” status in “payment_bambora_payments.status_id” column.
# The php bin/console bambora:process:positive:chargebacks command is run.

*Expected result:*

Records are created in the 'payment_bambora_chargeback_payments' table.

*Actual result:*

Records are not created in the 'payment_bambora_chargeback_payments' table.",,S4,146,,,2
"External login returns 500 internal server error if referrer has subdomain set as ""null""",OBN1-18927,Bug,To Do,P1 ,,10/10/2024 10:02,,,,,,,"If a referrer has payment_referrers.subdomain value set as NULL, a 500 error is being returned on attempt to externally login



{color:#ff5630}*Can be reproduced on stage as well (this means that on prod also)*{color}



STEPS TO REPRODUCE:

# Enable external api for a referrer
# Set the subdomain of the referrer as NULL
# Generate the API secret
# Login via /ext-ref/login endpoint



EXPECTED:
1. Token to be retrieved



ACTUAL:
1. 500 Internal server error is received



!image-20241010-090528.png|width=1034,height=166,alt=""image-20241010-090528.png""!



!image-20241010-090548.png|width=667,height=187,alt=""image-20241010-090548.png""!",,,,,,
"""Company legal name"" dropdown does not display company name if entire name is pasted first time",OBN1-18870,Bug,Done,P3,Done,10/3/2024 16:14,12/3/2024 12:58,OBN 1.73,,,,,"The steps to reproduce are a bit confusing if shown with screenshots, therefore a video was recorded



Short description: If in company legal name you enter the full name of the searched company, it will not show you the result from qed, even if in qed response that company is present. Most probably the dropdown shows only unique values, it thinking that the response from qed is a duplicate.



!bug demo companyh legal name dropdown.mp4|width=1678,height=894,alt=""bug demo companyh legal name dropdown.mp4""!

shorter video demonstrating how the result from QED is not shown when full name entered:





!obn - Google Chrome 2024-10-16 18-04-50.mp4|width=1920,height=1032,alt=""obn - Google Chrome 2024-10-16 18-04-50.mp4""!",,,130,,,1
[Prod][Xero] Invoices for September were not generated,OBN1-18841,Bug,Done,P2,Done,10/1/2024 14:36,10/16/2024 15:12,OBN 1.69,,,,,"Invoices for the month of September were not generated on production.



STEPS TO REPRODUCE:

# Current day - first day of month
# Cron job for invoice generation si executed



EXPECTED:
1. Merchant and Referrer invoices for September are generated



ACTUAL:

# No invoices were generated for September",Prod,,126,127,,2
[UI] [PDF] Mouse Scroll on the Privacy policy pdf does not work ,OBN1-18691,Bug,Done,P2,Done,9/17/2024 15:33,12/13/2024 12:13,OBN 1.74,,,,,"*Precondition*: MacOS, Safari 17.6 browser

*Steps to reproduce*: 

# open [https://portal.stage.obnglobal.com/login|https://portal.stage.obnglobal.com/login]  and [https://portal.stage.obnglobal.com/sign-up|https://portal.stage.obnglobal.com/sign-up]
# Click “Privacy Policy” in the right bottom corner
# Pop-up opened with “OBN Global's Privacy Notice”
# Scroll down with mouse to read all content

*Expected result*: scrolling works and user can view all content, all text, scroll bar is displayed

*Actual result*: scroll does not work, user can’t view all content, all text, no scroll bar is displayed

!Image.png|width=2818,height=1310,alt=""Image.png""!",,,131,,,1
"""Holding Account"" doesn't have the proper name in the fixtures",OBN1-18686,Bug,To Do,P4,,9/17/2024 10:49,,,,,,,"*Steps to reproduce:*

# Run the fixtures for OBN/MONERIS.
# Check the “payment_accounts.name” column for the account with type = “SAFEGUARD”.

*Expected result:*

After this story [https://cardstream.atlassian.net/browse/OBN1-14670|https://cardstream.atlassian.net/browse/OBN1-14670|smart-link]  the name of the account with type = “SAFEGUARD” was changed to “Holding Account” (for Moneris respectively “Moneris Holding Account”.)

*Actual result:*

The account with type = “SAFEGUARD” has name Safeguard/Moneris Safeguard.

Note:

Operator Account with type = OPERATOR_HOLDING also has a mismatch name for Moneris fixtures, the name should be “Moneris Operator Account”, now it is “Moneris Holding Account”.",,S4,149,,,
Fix incorrect lastId assignment in bambora process sales command,OBN1-18563,Bug,Done,P1 ,Done,9/4/2024 9:02,9/4/2024 12:55,OBN 1.66,,,,,"

||Message:|{noformat}Error thrown while running command ""bambora:process:sales --env=prod"". Message: ""App\Repository\Payment\BamboraTransactionRepository::findIdListWithStoredSplittings(): Argument #4 ($lastId) must be of type int, array given, called in /var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php on line 230""{noformat}|
||Time:|{noformat}2024-09-03T14:39:00.704370+00:00{noformat}|
||Channel:|{noformat}console{noformat}|
||Context:|exception:
{noformat}{
    ""class"": ""TypeError"",
    ""message"": ""App\\Repository\\Payment\\BamboraTransactionRepository::findIdListWithStoredSplittings(): Argument #4 ($lastId) must be of type int, array given, called in /var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php on line 230"",
    ""code"": 0,
    ""file"": ""/var/www/api.prod.obnglobal.com/src/Repository/Payment/BamboraTransactionRepository.php:324"",
    ""trace"": [
        ""/var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php:230"",
        ""/var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php:218"",
        ""/var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php:185"",
        ""/var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php:64"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/console/Command/Command.php:326"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/console/Application.php:1096"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/framework-bundle/Console/Application.php:126"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/console/Application.php:324"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/framework-bundle/Console/Application.php:80"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/console/Application.php:175"",
        ""/var/www/api.prod.obnglobal.com/vendor/symfony/runtime/Runner/Symfony/ConsoleApplicationRunner.php:49"",
        ""/var/www/api.prod.obnglobal.com/vendor/autoload_runtime.php:29"",
        ""/var/www/api.prod.obnglobal.com/bin/console:16""
    ]
}{noformat}
command:
{noformat}bambora:process:sales --env=prod{noformat}
message:
{noformat}App\Repository\Payment\BamboraTransactionRepository::findIdListWithStoredSplittings(): Argument #4 ($lastId) must be of type int, array given, called in /var/www/api.prod.obnglobal.com/src/Command/Payment/Bambora/SettlementReport/BamboraProcessSalesCommand.php on line 230{noformat}|

Method {{\App\Repository\Payment\BamboraTransactionRepository::findIdListWithStoredSplittings}} returns {{ array<array{id:int,merchantId:string}>}}

There is a bug in this do while loop on line 253:

instead of

{noformat}            $lastId = $lastItem;{noformat}

should be 

{noformat}            $lastId = $lastItem['id'];{noformat}",,,124,,,1
[API] Merchant/Referrer can download other than their merchant's documents,OBN1-18560,Bug,Done,P2,Done,9/3/2024 14:25,5/13/2025 10:20,OBN 1.85,,,,,"*Scenario 1:*

*Preconditions:* 

* Two merchants admin users NOT linked to the same organization exists.
* Merchants have documents attached to them.

*Steps to reproduce:*

# Login in API with one of the merchants.
# Send a GET request to the /merchant/organisation/billing-plan/download-offer/{docUuid} endpoint using the uuid of the document assigned to the other merchant.

*Expected result:*

Error message received, merchant should have access only to their documents.

*Actual result:*

Success message received, merchant ca download documents that do not belong to them.



*Scenario 2:*

*Preconditions:*

A referrer admin user with a merchant under it exists.

*Steps to reproduce:*

# Login in API as the referrer.
# Send a GET request to /merchants/{merchUuid}/download-offer/{docUuid} endpoint using the merchant Uuid of a merchant that belong to that referrer and the document Uuid of another merchant.

*Expected result:*

Error message received, referrer should not have the possibility to access other than their merchant’s documents.

*Actual result:*

Success message received, referrer can download documents that do not belong to their merchants.

*Note:*

A db dump is attached, for credentials/uuids for endpoints please see the attached txt file.",,S2,142,,,2
[Moneris] [Invoice] Generate invoice cronjob is not executed,OBN1-18558,Bug,Done,P3,Done,9/3/2024 13:48,9/4/2024 8:11,OBN 1.67,,,,,"*Preconditions:*

# Moneris environment
# Have transaction for previous month with “processed_at”= not NULL (august as example) (otherwise invoice won’t be generated)

*Steps to reproduce:*

# For stage run command “sudo -u www-data OP_NAME_CLI=moneris php bin/console obn:invoices:generate-for-merchants --force”
# For local environment {{php /var/www/api/bin/console obn:invoices:generate-for-merchants --force}}
# Select month for which you want to generate invoices. (for example 2024-08) 

*Expected*: Command is executed and invoices are generated in DB

*Actual*: 

{noformat}No invoices generated. Error: Doctrine\DBAL\Exception\ConnectionException.
Code: 1142
Message: An exception occurred while executing a query: SQLSTATE[42000]: Syntax error or access violation: 1142 SELECT command denied to user 'moneris'@'172.31.41.120' for table 'payment_transfer_reasons'
Trace:
#0 Connection.php:1939: Doctrine\DBAL\Driver\API\MySQL\ExceptionConverter->convert(..)
#1 Connection.php:1881: Doctrine\DBAL\Connection->handleDriverException(..)
#2 Connection.php:1213: Doctrine\DBAL\Connection->convertExceptionDuringQuery(..)
#3 InvoiceGenerationCommand.php:232: Doctrine\DBAL\Connection->executeStatement(..)
#4 InvoiceGenerationCommand.php:98: App\Command\Payment\InvoiceGenerationCommand->generateInvoices(..)
#5 Command.php:326: App\Command\Payment\InvoiceGenerationCommand->execute(..)
#6 Application.php:1096: Symfony\Component\Console\Command\Command->run(..)
#7 Application.php:126: Symfony\Component\Console\Application->doRunCommand(..)
#8 Application.php:324: Symfony\Bundle\FrameworkBundle\Console\Application->doRunCommand(..)
#9 Application.php:80: Symfony\Component\Console\Application->doRun(..)
#10 Application.php:175: Symfony\Bundle\FrameworkBundle\Console\Application->doRun(..)

In ExceptionConverter.php line 101:

  An exception occurred while executing a query: SQLSTATE[42000]: Syntax error or access violation: 1142 SELECT command denied to user 'moneris'@'172.31.41.120' for table 'payment_transfer_reasons'

In Exception.php line 28:

  SQLSTATE[42000]: Syntax error or access violation: 1142 SELECT command denied to user 'moneris'@'172.31.41.120' for table 'payment_transfer_reasons'

In Connection.php line 33:

  SQLSTATE[42000]: Syntax error or access violation: 1142 SELECT command denied to user 'moneris'@'172.31.41.120' for table 'payment_transfer_reasons'{noformat}

!image-20240903-130429.png|width=1842,height=729,alt=""image-20240903-130429.png""!",,,124,,,1
PDF files attached to a dispute challenge are not loaded when user checks the dispute challenge details,OBN1-18526,Bug,Done,P3,Done,8/29/2024 15:51,9/3/2024 7:25,OBN 1.67,,,,,"*Preconditions:*

A dispute in “Waiting for Merchant response” status exists for a merchant in the db.

*Steps to reproduce:*

# Login as the merchant for whom the dispute is opened.
# Navigate to “Disputes”>”Open Cases” and expand the dispute.
# Click on “Challenge” button.
# Fill the form with valid data, upload a PDF file.
# Save the changes.
# Click on “See challenge details” link.

*Expected result:*

The PDF file is loaded below the Documents uploaded field.

*Actual result:*

The PDF file is not loaded, the Documents uploaded field is empty, an error present in the network.

!image-20240829-145630.png|width=1139,height=798,alt=""image-20240829-145630.png""!

*Note:* A db is attached, please login with
login: [galinareferrer@test.com|mailto:galinareferrer@test.com]
pass: Amdaris12!
from the list of users select: *BamboraMerch2 (Merchant)*
check the dispute with Case Id = 44449997a (click on See challenge details link as the dispute is already challenged and a PDF file is attached).",STAGE,S2,124,,,1
Error when running fixtures,OBN1-18503,Bug,Done,P3,Done,8/29/2024 10:19,8/29/2024 10:39,OBN 1.66,,,,,"*Steps to reproduce:*

# Run fixtures on a new db.

*Expected result:*

The fixtures are run successfully.

*Actual result:*

Error encountered: 

!image-20240829-092100.png|width=465,height=443,alt=""image-20240829-092100.png""!",,S3,123,,,1
"[PROD] The page is refreshed and values selected are not displayed when user selects start/end date on ""Reports"">""Reconciliation"" page",OBN1-18499,Bug,Done,P1 ,Done,8/28/2024 7:47,9/3/2024 15:45,OBN 1.67,,,,,"*Steps to reproduce:*

# Login as an Operator Admin user.
# Navigate to “Reports”>”Reconciliation” page.
# In the “Start date”/”End date” filter select a date in the date picker.

*Expected result:*

The filter displays the selected date, user can select start date/end date.

*Actual result:*

Once a date is chosen the page is reloaded and the filter doesn’t display the dates selected, user can’t select BOTH start date and end date as after selecting one the page is reloaded. ",STAGE/PROD,S1,124,,,1
[Disputes] Unfrozen funds are not settled for OBMC/PBBA - when Merchant is not found liable (Closed: Sent to Scheme),OBN1-18407,Bug,To Do,P3,,8/20/2024 7:29,,,,,,,"{color:#ff5630}** need to check and if still issue, update for OBMC **{color}

*Preconditions*: 

# Operator OBN
# There is a referrer with billing plan having PBBA (Zapp or 86 in workflow) acquirer (this acquirer does not hold funds, OBN does it in this case). [See documentation link|https://obnglobalcom.sharepoint.com/sites/OBNDevelopmentTeam/SitePages/Disputes%20money%20management.aspx?xsdata=MDV8MDJ8fGNiYjQzN2IyY2MxNzQ5OGI4M2I1MDhkY2MwZDUyMmFmfDU0NGY4YWMzY2U0YzQ3ZDE5YjcyMjg0YWM1NGI4ZDFjfDB8MHw2Mzg1OTcyNjg4MjIyNjI3MDl8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPalV4TWpFMVpESmxMV1ptWVdFdE5Ea3dNaTFoT0dJNUxXWXhOelZpTkRGa05tTXpNRjg1Wm1Rd05XUm1OaTB5TkdGaUxUUXlaRGd0T0RobVpDMWpZemxpTnpJM05qa3haamxBZFc1eExtZGliQzV6Y0dGalpYTXZiV1Z6YzJGblpYTXZNVGN5TkRFek1EQTRNVFF5T1E9PXxiZjI1NGE2MDNmNDU0NDQyODNiNTA4ZGNjMGQ1MjJhZnxhNGEzYzI3OThmN2E0MjZjOWVkOTMxZjNkYjFiODRkZQ%3D%3D&sdata=YTR5OVBnTEdkVUJlVC9oQm9ocXVJNjZjN1hxaWFwUFVYUnlhWEo3N2cwMD0%3D&ovuser=544f8ac3-ce4c-47d1-9b72-284ac54b8d1c%2Calexandr.hadjioglo%40amdaris.com&OR=Teams-HL&CT=1724135031909&clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNDA3MTEyODgyNSIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D]

!image-20240820-063240.png|width=1470,height=724,alt=""image-20240820-063240.png""!
# There is a merchant created under that referrer with payment option = PBBA (86)
# Setup for settlement is made to be today, rolling reserve= 0, merchant settlement enabled, merchant has enough funds in Clearing account. 
# Sale (RTP) exists from yesterday and is already settled. Merchant received money from Clearing to his External account



*Steps to reproduce*: 

# Create a Dispute with half of amount of the existing sale, in stage “Dispute Claim”
# Funds are frozen in Safeguard account (payment is created in {{payment_payments}} table from Merchant Clearing to Safeguard)
# Also in {{payment_merchants}} table the exposure amount is increased for the amount of Dispute created
# Close the dispute in status “Closed: Sent to Scheme”
# Perform Settlement for Merchant (run commands for calculate and remit funds)

*Expected*: Settlement for the unfrozen amount is done. The whole amount that was frozen when dispute was created. Also the exposure amount is decreased by this amount

*Actual*: Settlement for the unfrozen amount is NOT done. Also the exposure amount is NOT decreased by this amount",,,152,,,
[API-Ext] bankProofPath is not sent on set external bank details for a merchant even if present in payload,OBN1-18356,Bug,Done,P3,Done,8/13/2024 7:27,9/4/2024 15:22,OBN 1.67,,,,,"*Preconditions:*

A merchant with “COMPLETED” status of its application AND with no external bank account present in “payment_merchants.bank_account_id” exists in the db.

*Steps to reproduce:*

# Upload a document to merchant’s application using this endpoint /ext-ref/merchant-onboarding/documents/{applicationUuid}. (note that now we are not able to upload documents to COMPLETED applications, that means a database manipulation is needed: update the application status to “IN_PROGRESS” and after upload switch it back, p.s. this should be improved later).
# Send the request to /ext-ref/payment/external-bank-account/{merchantUuid} having the bankProofPath indicated in the payload. 

*Expected result:*

The bankProofPath is successfully displayed in the repsonse.

*Actual result:*

The bankProofPath is saved as null even if provided.",,S2,124,,,1
[API] Unauthenticated user sending POST requests to different endpoints receives validation messages in response instead of unauthenticated error,OBN1-18333,Bug,Done,P3,Done,8/9/2024 12:14,8/16/2024 12:34,OBN 1.65,,,,,"*Steps to reproduce:*

# Prepare an endpoint which allows POST method.
# Make some intentional mistakes in the payload.
# Being unauthenticated (make sure you don’t have any authorization header) send the request.

ENV: Stage & production

*Expected result:*

Unauthorized error is received.

*Actual result:*

400 error is received containing validation messages for mistaken fields.

!image-20240809-112929.png|width=1127,height=510,alt=""image-20240809-112929.png""!

*Note:* A db is attached, endpoint/payload for testing also attached.",,S3,122,,,1
"Error received when request to register a merchant in Bambora is sent with consumerStatementDescriptor: """"",OBN1-18292,Bug,Done,P3,Done,8/6/2024 15:21,8/23/2024 8:26,OBN 1.66,,,,,"*Preconditions:*

An external referrer that has a workflow with “Register merchant with Processor 84” step assigned to it exists in the db.

*Steps to reproduce:*

# Login as an external referrer.
# Initiate an onboarding.
# Send a POST request to the /ext-ref/merchant-onboarding/:applicationUuid endpoint having {{""consumerStatementDescriptor"": """"}}

*Expected result:*

The empty string shouldn’t be accepted.

*Actual result:*

The empty string is accepted and when workflow gets to the “Register Merchant with Processor 84” step an error is received from Bambora: 

app.ERROR: Submerchant field ""dba_name"" is mandatory, but """" is provided. Trace:  #0 Submerchant.php:433: App\Entity\Enrolment\Bambora\Submerchant->checkNotEmptyStringOrNull(..) #1 EnrollmentService.php:100: App\Entity\Enrolment\Bambora\Submerchant->setDbaName(..) #2 CardProcessorConnectorService.php:79: App\Service\Payment\Bambora\Enrollment\EnrollmentService->buildNewSubmerchant(..) #3 CardProcessorConnectorService.php:44: App\Service\Workflow\CardProcessorConnectorService->resolveUnregisteredMpa(..) #4 CardProcessorConnector.php:36: App\Service\Workflow\CardProcessorConnectorService->executeForMpaList(..) #5 StepRunnerAbstract.php:288: App\Service\Workflow\Task\CardProcessorConnector->execute(..) #6 StepRunnerAbstract.php:271: App\Service\Workflow\StepRunnerAbstract->executeStep(..) #7 MerchantOnboardingHandler.php:16: App\Service\Workflow\StepRunnerAbstract->run(..) #8 HandleMessageMiddleware.php:152: App\MessageHandler\Workflow\StepRunner\MerchantOnboardingHandler->__invoke(..) #9 HandleMessageMiddleware.php:91: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->callHandler(..) #10 SendMessageMiddleware.php:71: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->handle(..) [] []",,S2,123,,,1
[Prod] Date of birth added on the onboarding does not coincide with the DOB from Verify controllers screen,OBN1-18284,Bug,Done,P1 ,Done,8/5/2024 10:17,8/5/2024 15:22,OBN 1.64,,,,,"*Preconditions*

Onboard an application on a flow with Know Your Client- Pre-activation step  and Verify controllers sub step.

!image-20240805-092244.png|width=2438,height=501,alt=""image-20240805-092244.png""!



*Steps*

# Start a new onboarding 
# Complete the date of birth for the manager in *about it’s management step*
# Step verify controllers fails
# Go the Match controllers screen

*Actual Results* 

The Date of birth from the Match controllers screen ( Contacts section) does not coincide with the Date of birth added on the onboarding.



*Expected Results* 

The Date of birth from the Match controllers screen ( Contacts section) does not coincide with the Date of birth added on the onboarding.



!image-20240805-093043.png|width=1199,height=727,alt=""image-20240805-093043.png""!

!image-20240805-093107.png|width=1648,height=990,alt=""image-20240805-093107.png""!",,,122,,,1
"[Moneris] 400 Bad request error is thrown when on demand report is generated with ""end date"" set as today",OBN1-18280,Bug,Done,P3,Done,8/1/2024 9:59,8/23/2024 11:29,OBN 1.66,,,,,"On Moneris Stage env, when an On demand request is being generated with “End Date” set as today, 400 bad is received as response



STEPS TO REPRODUCE:

# Login as a user with REPORTS_FULL persmission
# Go to Reports→ Reporting → Generate Report
# Set mandatory fields
# Set End Date as today
# Click on generate



EXPECTED:

# Report to be sent to generation queue

ACTUAL:

# 400 Bad request response is received
# Report is not generated

Response received:

{
    ""errors"": {
        ""[endDate]"": [
            {
                ""code"": ""2c750356-3817-4e9c-bb23-e75604f5fc9b"",
                ""detail"": ""This value should be less than or equal to \u00222024-08-01\u0022.""
            }
        ]
    }
}",Stage Moneris,S1,123,,,1
[Invoice] 500 Internal error thrown when trying to download CSV Invoice with chargeback and processor fee,OBN1-18275,Bug,Done,P3,Done,7/30/2024 14:28,10/17/2024 9:49,OBN 1.70,,,,,"On attempt to download a CSV invoice with “Total Charge” as negative sum (Having a Chargeback or Processor Fee), 500 Internal error is received as response.



{color:#ff5630}*_later edit: this happens for positive values as well_*{color}



STEPS TO REPRODUCE:

# Initiate a transfer with reason “Fee” TO a merchant account
# Generate the merchant Invoices for that month
# Go to Billing → merchant invoices
# Try to download the CSV version of the invoice (invoice should have total charge as negative)



EXPECTED:

# CSV Invoice to be successfully downloaded



ACTUAL:

# Download icon is stuck
# 500 error is received



!image-20240730-133338.png|width=1938,height=589,alt=""image-20240730-133338.png""!


db: [^bug-obn-202407301634.sql] 

user:[operator.admin@obnglobal.com|mailto:operator.admin@obnglobal.com]

pass:[operator.admin@obnglobal.com|mailto:operator.admin@obnglobal.com]",,,127,,,2
Migrations fail for new created Database,OBN1-18269,Bug,Done,P2,Done,7/29/2024 7:33,7/30/2024 8:43,OBN 1.64,,,,,"*Steps to reproduce*: 

# Drop existing database: 
php bin/console --force do:da:dr 
# Create new database (name of the created database is indicated in .env file – line 24): 
php bin/console do:da:cr 
# Run migrations (create tables & alter tables): 
php bin/console --no-interaction d:m:m 

*Expected*: all tables are created, no error received

*Actual*: error received

{noformat}In ExceptionConverter.php line 114:
                                                                                                                          
  An exception occurred while executing a query: SQLSTATE[22004]: Null value not allowed: 1138 Invalid use of NULL value  
                                                                                                                          

In Exception.php line 28:
                                                                           
  SQLSTATE[22004]: Null value not allowed: 1138 Invalid use of NULL value  
                                                                           

In Connection.php line 71:
                                                                           
  SQLSTATE[22004]: Null value not allowed: 1138 Invalid use of NULL value {noformat}",,,121,,,1
[Moneris] Error parsing API response on settlement,OBN1-18159,Bug,Done,P1 ,Done,7/18/2024 7:52,7/23/2024 10:14,OBN 1.64,,,,,"*Preconditions*

* Operator (see table {{payment_operators}}) should be associated with a record in {{moneris_merchants}} which has a valid MID. I've used {{moneris_mid=0030105086830}}
* If reproducing on localhost, make sure to correctly configure the second operator as Moneris
** Spin up separate DB for second operator (I’ve made a copy from stage moneris)
** Add correct values in {{.env.operator2.local}} (below is my example)
*** {{DATABASE_URL=mysql://obn_operator2:obn_operator2@mysql:3306/obn_operator2?serverVersion=8}}
*** {{CORS_ALLOW_ORIGIN=^https?://(.+)?(localhost|127\.0\.0\.1|local.operator2|local.api.operator2)(:[0-9]+)?$}}
*** {{OPERATOR_LOG_DIR='/operator2'}}
*** {{OPERATOR_CACHE_DIR='/operator2'}}
*** {{OPERATOR_UUID='a850ebc4-2d76-4bfa-8c70-b3461a49a880'}}
*** {{SETTLEMENT_PAYMENT_PROVIDER=MONERIS}}
*** + all Moneris credentials (could be copied from stage machine {{/var/www/api.staging.obnglobal.com/.env.moneris.local}})
** Append supervisor configuration for second operator. Add the below to {{docker/api/messenger-worker/dev.conf}} and restart docker 
*** [program:messenger-consume-2]
environment=OP_NAME_CLI=operator2
command=php /var/www/api/bin/console messenger:consume --env=dev --limit=10 -vv async async_sqs async_webhook failed_webhook async_xero failed_xero async_mail failed_mail async_moneris failed_moneris async_without_fail async_reports --time-limit=3600
user=obn
numprocs=2
startsecs=0
autostart=true
autorestart=true
process_name=%(program_name)s_%(process_num)02d
** Make sure supervisor is started and the workers are properly running


*Steps to reproduce*

* Login as operator admin
* Navigate to *Organisation* => *Bank Account Details*
* Perform a Withdrawal
* Check mailhog, you should receive an error as shown in the below screen
!Screenshot from 2024-07-18 11-21-07.png|width=1901,height=850,alt=""Screenshot from 2024-07-18 11-21-07.png""!


*Potential solution*

The fix for this would be to either implement {{\App\Service\Moneris\Dto\ResponseDtoInterface}} in {{\App\Service\Moneris\Dto\MerchantPayoutResponseDto}} or to remove the call of method {{parseResponse()}} in {{\App\Service\Moneris\MonerisClient::payoutMerchant}}

It needs a bit of grasp into the logic to figure out the best approach.",Any for Moneris operator,,121,,,2
Wrong list of transfers is displayed for referrer user,OBN1-18157,Bug,To Do,P3,,7/17/2024 15:57,,,,,,,"*Preconditions:* Transfers from/to referrer/referrer’s merchants exist in “payment_transfers” table.

*Steps to reproduce:*

# Login as a Referrer with ACTIVITY permission.
# Go to “Activity” > “Transfers” page.
# Check the list of transfers.

*Expected result:*

The transfer list contains all the transfers made from/to referrer’s account AND from/to referrer’s merchants accounts.

*Actual result:*

The transfer list contains only transfers from referrer to referrer’s merchants accounts.

*Note:* DB attached, log in with
email: [galinareferrer@test.com|mailto:galinareferrer@test.com]
password: Amdaris12!

[^bug17_07-newstage-202407171419.sql]

",,S2,,,,
Reports generated are displayed multiple times,OBN1-18142,Bug,Done,P2,Done,7/17/2024 6:25,7/30/2024 12:52,OBN 1.64,Analysis,,,,"*Precondition:*
User has recurring reports set



Navigate to:
Reports → Reporting → Generated tab

*Expected:*
Reports generated displayed in a single row for each report scheduled 

*Actual:*
Reports generated displayed in duplicate or on multiple rows with the same report to download

Can be reproduced in both Prod and Stage.",,,121,,,2
"No workflow type validation is applied for endpoint ""/workflow/by-type/""",OBN1-18109,Bug,Done,P4,Done,7/12/2024 14:55,7/22/2024 15:52,OBN 1.64,,,,,"No workflow type validation is applied for endpoint ""/workflow/by-type/{invalid_workflow_type}""



*STEPS TO REPRODUCE:*

# Perform a  get request to the following endpoint using an invalid workflow type {{http://local.api.operator/en-gb/workflow/by-type/INVALID}}

*EXPECTED RESULT:*

400 status code is received. “The value you selected is not a valid choice” message is displayed in the response body

*ACTUAL RESULT:*

200 status code is received",,S4,121,,,1
500 error code is received when user provides a bankProofPath in set external bank details endpoint,OBN1-17994,Bug,Done,P3,Done,7/3/2024 13:13,8/12/2024 15:41,OBN 1.65,,,,,"*Preconditions:*

An active merchant with NULL value in payment_merchant.bank_account_id exists.

*Steps to reproduce:*

# Login as an external referrer.
# Send a POST request to the /ext-ref/payment/external-bank-account/{merchantUuid} endpoint using an invalid/or valid value for bankProofPath field. 

*Expected result:*

400 error with “Invalid document path” message received.

*Actual result:*

500 error received.

!image-20240703-122259.png|width=917,height=663,alt=""image-20240703-122259.png""!

*Note:* DB attached, login with credentials: 

{noformat}""apiKey"": ""53da6f9270a8077b401c6110a9dfe4e8fd55002f4e915b6505953bafcb22535e79aa76641ba19876c8dacf766d8101d08723"",
""apiSecret"": ""dedeb5bd-d7ce-4403-a2d9-9f7af673ea66""{noformat}

use the following merchantUuid: 06a71178-9db2-4fb5-a752-10b15f180337",,S2,122,,,2
"""Title"" dropdown for officer/manager is not populated during onboarding",OBN1-17974,Bug,Done,P1 ,Done,7/3/2024 10:25,7/4/2024 8:34,OBN 1.62,,,,,"""Title"" dropdown for officer/manager is not populated during onboarding via UI. Rest response with dropdown values is successfully received.



STEPS TO REPRODUCE:

# Start onboarding process of a merchant
# Reach the “About its owners/managers” section
# Try to select the “Title” of the owner/manager



EXPECTED:

# “Title” dropdown to have the available titles displayed



ACTUAL:

# “Title” dropdown is constantly loading

!image-20240703-093259.png|width=2022,height=865,alt=""image-20240703-093259.png""!



Note: not reproducible on master branch",,S1,119,,,1
[Prod] Error on saving Referrer BP when total Merchant price % is 0,OBN1-17865,Bug,Done,P1 ,Done,6/19/2024 11:03,6/19/2024 14:28,OBN 1.60.1,Analysis,HotFix,,,"*Preconditions:*

# An existing Referrer with PbBa billing plan

*Steps:*

# Log in as operator admin
# Try to edit Referrer BP
# Put 0 value for Merchant Refund Sale % to be =0

*Expected result:*

The BP should be successfully saved

*Actual result:*

Error is received, because UI is sending negative Refund floor on BE



!image-20240619-100958.png|width=1741,height=688,alt=""image-20240619-100958.png""!



!image-20240619-101015.png|width=864,height=117,alt=""image-20240619-101015.png""!




",,,118,,,1
Unable to edit Company Legal name for  Private Limited companies,OBN1-17813,Bug,Done,P2,Done,6/13/2024 19:10,6/25/2024 9:29,OBN 1.62,,,,,"Steps

# Add an application for an Private Limited company 
# Navigate to Applicant Dashboard and edit the application added at step 1.
# Edit the Company legal name and save the value

*Results*

The system displays an error and the new name si not saved.



!image-20240613-182001.png|width=722,height=268,alt=""image-20240613-182001.png""!



*Expected results*

# The new Company legal name is saved",,,119,,,1
[Timezone] Date-picker selected value is changed  in different timezones,OBN1-17773,Bug,Done,P2,Done,6/12/2024 10:26,6/24/2024 11:18,OBN 1.61,Moneris,Timezone,,,"*Preconditions:*

# Set your local machine time zone to one day ahead/before of UTC

*Steps*

# Make a new application or modify an existing one
# On the About its Owners step, choose a date for the date of birth field

*Result:*

The populated date value is different than the one selected by the user

*Expected result:* 

The selected date remained the same as selected

{panel:bgColor=#deebff}
Note: The issue was found by a Moneris user who is on EST. They can reproduce in all of their instances that they can access (MNRS-SANDBOX, MNRS-STAGE).
{panel}",,,119,,,1
Average delivery period field not populated on edit,OBN1-17747,Bug,Done,P3,Done,6/11/2024 7:19,10/28/2024 16:22,OBN 1.71,,,,,"*Preconditions*

# Merchant onboarded through external API
# Merchant has the Average delivery period added though external API and the value is visible in view mode

*Steps to reproduce*

# Open a merchant application with status manual (Manual risk review)
# Click on Application dashboard → Application data 
# Click on edit
# Click on “About it’s payments“

*Expected:*
Average delivery period should be populated with the details submitted though the API

*Actual result*
Average delivery period field is empty and is throwing an error and the user needs to populate it again",,,128,,,2
applicantGeolocation field value not saved in the database on commercial offer sign,OBN1-17742,Bug,Done,P3,Done,6/7/2024 15:33,9/23/2024 8:19,OBN 1.68,,,,,"*Preconditions:*

A merchant applicant which got to the “Commercial Offer” phase in workflow exists under a referrer which uses external api.

*Steps to reproduce:*

# Log in as referrer with api credentials.
# Send a PUT request to the /ext-ref/merchant-onboarding/commercial-offer/{commercialUuid} endpoint.

*Expected result:*

The information provided in the payload is saved in the database.

*Actual result:*

The value provided for {{applicantGeolocation}} is not saved in the database.

*Note:*

A DB dump attached, please login with following credentials: 

{noformat}{
    ""apiKey"": ""53da6f9270a8077b401c6110a9dfe4e8fd55002f4e915b6505953bafcb22535e79aa76641ba19876c8dacf766d8101d08723"",
    ""apiSecret"": ""8bb565ad-a384-4629-9809-f0aa9e0d46af""
}{noformat}

and send the request to the following endpoint: /ext-ref/merchant-onboarding/commercial-offer/bffe1648-472f-4353-b433-309b062827c5",,S3,125,,,1
[Prod] Wrong value imported in Xero for Referrer invoice - Account transfer fee,OBN1-17699,Bug,Done,P1 ,Done,6/5/2024 7:14,6/14/2024 9:13,OBN 1.61,,,,,"*Preconditions:*

# A Referrer authorised to use AAA  (Authorised Account Adjustment)
# The fee for AAA >0

*Steps:*

# Process some AAA for the Referrer

*Expected result:*

A *_negative_* fee entry is displayed in Referrer invoice and is imported in Xero

*Actual result:*

The fee imported in Xero has positive *_amount_*",,,118,,,2
[Prod] Wrong commercial offer URL generated,OBN1-17662,Bug,Done,P1 ,Done,6/4/2024 12:51,6/7/2024 8:50,OBN 1.60,Analysis,HotFix,,,"*Preconditions:*

# Use stage/sandbox/prod env
# A Referrer using external API

*Steps:*

# Create a new application
# Generate commercial offer

*Expected result:*

Commercial offer webhook should be sent and the commercialOfferUrl should have correct value

*Actual result:*

The commercialOfferUrl contains localhost instead of environment correct path:



!image-20240604-115333.png|width=878,height=285,alt=""image-20240604-115333.png""!",,,117,,,2
User can't add a new billing plan type to the commercial offer of the applicant,OBN1-17615,Bug,Done,P3,Done,5/29/2024 15:51,6/18/2024 12:06,OBN 1.61,,,,,"*Preconditions:*

An applicant under a referrer which has both types of billing plan (net revenue and mark-up) is present in the db.

*Steps to reproduce:*

# Login as an Operator Admin user.
# Go to “Merchants”>”Open Applications” page.
# Expand the applicant for which the workflow got to the “Commercial Offer” phase.
# Click on “Commercial Offer” tab. 
# Click on “Edit” button.
# Select the checkbox for a new billing plan type.
# On the appeared pop-up click on “Confirm” button.

*Expected result:*

The new billing plan type is selected.

*Actual result:*

Nothing changes, the checkbox remains unchecked.

*Note:*

DB dump attached, please login as as operator admin with the following credentials:
email: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
pass: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
and use the applicant with id = 1022.",,S3,118,,,2
[Prod] Attempt to send webhook notifications to Referrers which are not using API,OBN1-17576,Bug,Done,P2,Done,5/24/2024 9:35,9/3/2024 7:45,OBN 1.67,,,,,"*Preconditions:*

# A Referrer *without* using API

*Steps:*

# Onboard a Merchant under this Referrer

*Expected result:*

Notification webhooks should not be sent to Referrers which are not using APIs

*Actual result:*

Attempt of sending webhook throws an error (because Referrer doesn’t have webhook URL configured)



!image-20240524-083947.png|width=1092,height=601,alt=""image-20240524-083947.png""!

{panel:bgColor=#deebff}
Dev comments:

[https://gitlab.com/obnglobal/api/-/blob/develop/src/MessageHandler/Webhook/MerchantSettlementHandler.php#L52|https://gitlab.com/obnglobal/api/-/blob/develop/src/MessageHandler/Webhook/MerchantSettlementHandler.php#L52|smart-link]  - similar check should be implemented for all webhooks

[https://gitlab.com/obnglobal/api/-/blob/develop/src/MessageHandler/Webhook/MerchantApplicationStatusChangeHandler.php#L54|https://gitlab.com/obnglobal/api/-/blob/develop/src/MessageHandler/Webhook/MerchantApplicationStatusChangeHandler.php#L54|smart-link]  - there is no check if Referrer is using PAI

 [https://gitlab.com/obnglobal/api/-/tree/develop/src/MessageHandler/Webhook|https://gitlab.com/obnglobal/api/-/tree/develop/src/MessageHandler/Webhook] - verify other webhooks from this namespace if the check is made
{panel}",,,124,,,2
"[Ext-Api] User can upload documents to merchant application that is in ""Rejected"" status",OBN1-17561,Bug,Done,P4,Done,5/22/2024 12:41,5/29/2024 14:26,OBN 1.60,,,,,"Using the external api, user can upload documents for a merchant application that is in status “REJECTED”



Steps to reproduce:

# Initiate the onboarding of a merchant
# Make the status of the application as “Rejected”
# Upload a document via ext-ref endpoint for that merchant application



Expected:
1. 403 response code should be returned and no document should be uploaded to DB



Actual:

# Operation is allowed and document is uploaded



!image-20240522-114544.png|width=814,height=880,alt=""image-20240522-114544.png""!",,S4,117,,,1
"Error received when user clicks on ""Continue workflow"" button for the last step in workflow",OBN1-17508,Bug,Done,P2,Done,5/20/2024 13:11,7/17/2024 16:21,OBN 1.63,,,,,"*Preconditions:*

There should be an application with a workflow which stopped in “Manual” status at the last step.

*Steps to reproduce:*

# Login as Operator Admin.
# Go to “Merchants”>”Open Applications” page.
# Expand the application from preconditions.
# Click on “Application Status” tab.
# Expand the phase at which the workflow stopped.
# Click on “Continue workflow” button next to the stopped step.

*Expected result:*

The status is completed, the workflow finishes and the application has status COMPLETED in the “payment_merchant_applications.status” column.

*Actual result:*

500 error received.
    ""type"": ""https:\/\/tools.ietf.org\/html\/rfc2616#section-10"",
    ""title"": ""An error occurred"",
    ""status"": 500,
    ""detail"": ""App\\Controller\\User\\MerchantOnboarding\\MerchantApplicationController::nextStep(): Return value must be of type App\\Entity\\Workflow\\Step, null returned"",
    ""class"": ""TypeError"",

*Note:* DB dump attached, please login with
login: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
pass: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]

and use the application id = 1282.",,S3,120,,,1
Disputes Details/Process Flow loading after Challenging dispute,OBN1-17481,Bug,Done,P2,Done,5/17/2024 9:58,7/1/2024 10:49,OBN 1.62,chargeback,Disputes,,,"Precondition: dispute should be created with Waiting for Merchant response status. And Challenged after that. See example in Dump attached

*Steps to reproduce Scenario 1:* 

# use dump[^6e58fd24-aaed-4197-87db-8b31f3db546e] 
# Login with [operator.admin@moneris.com|mailto:operator.admin@moneris.com]
# Navigate to Disputes → Open Cases → Process Flow

*Expected*: Process Flow is loaded and data is displayed

*Actual*: Process Flow constantly loading

!image-20240520-060835.png|width=2094,height=1092,alt=""image-20240520-060835.png""!

*Steps to reproduce Scenario 2:*

# Dispute in “Waiting for Merchant response” status
# Challenge a dispute for Moneris (Case ID should exists in Moneris system)
# Validate on Process Flow the status is changed

*Expected*: latest status equals to status from the Details tab = Challenged: Under review by Processor/Acquirer

*Actual*: latest status remains “Waiting for Merchant response”

!image-20240529-064212.png|width=1084,height=533,alt=""image-20240529-064212.png""!

!image-20240529-064222.png|width=804,height=353,alt=""image-20240529-064222.png""!



*Steps to reproduce Scenario 3:*

# Dispute in “Waiting for Merchant response” status
# Accept a dispute for Moneris from UI
# Validate Closed cases → Details tab 

*Expected*: Details tab is loaded and data is displayed

*Actual*: Details constantly loading

""payment_chargebacks_statuses_applied.registration_date"" = NULL

[https://portal.stage.obnglobal.com/disputes/closed-cases/547b0d82-7bc9-410a-bbaf-19210de6b1d0/details?page=1&per_page=20|https://portal.stage.obnglobal.com/disputes/closed-cases/547b0d82-7bc9-410a-bbaf-19210de6b1d0/details?page=1&per_page=20]",,,119,,,2
[Prod] Empty download of the Referrer BP csv,OBN1-17423,Bug,Done,P1 ,Done,5/7/2024 8:56,5/7/2024 16:04,OBN 1.58,,,,,"*Preconditions:*

# Use production env
# Log in as operator admin user

*Steps:*

# Navigate to Referrers → Active Referrers → Billing Plan
# Click on “Download“ BP button

*Expected result:*

The operator terms should be successfully downloaded in csv format

*Actual result:*

Empty csv is generated



How to reproduce locally:

# Change application mode to {{prod}} by adding in {{.env.local}} {{APP_ENV=prod}}
# Export billing plan terms from {{Referrers => Active Referrers => Billing Plan => Export terms button}}",,,115,,,1
"Error received when operator with ""REFERRERS_FULL"" permissions tries to update referrer's workflows",OBN1-17417,Bug,To Do,P3,,5/3/2024 9:57,,,,,,,"*Steps to reproduce:*

# Login into the portal with an Operator Standard user with ""REFERRERS_FULL"" permissions.
# Go to “Referrers”>”Active Referrers” page.
# Expand a referrer.
# Click on “Business Configuration” subtab.
# Click on “Edit” button.
# Click on “Select” button next to “Assign Workflows” field.

*Expected result:*

The list of workflows is displayed, the user can select workflows and update the referrer.

*Actual result:*

Error 403 forbidden. 

!image (2).png|width=1816,height=797,alt=""image (2).png""!

*Note:*

DB attached, please login with credentials:

login: [reseller.standard@obn.com|mailto:reseller.standard@obn.com]
pass: Amdaris12!ss",,S3,148,,,
[Prod] Error on Internal Notes display,OBN1-17409,Bug,Done,P1 ,Done,5/2/2024 9:41,5/2/2024 12:44,OBN 1.58,HotFix,,,,"h2. Error on getting existing internal notes

*Preconditions:*

# Use an application that has some Internal Notes

*Steps:*

# Log in as operator admin
# Navigate to Merchants → Open Applications → Internal Notes

*Expected result:*

Existing internal notes should be displayed

*Actual result:*

500 error received



h2. New internal notes are not displayed

*Preconditions:*

# An existing application without internal notes

*Steps:*

# Log in as operator admin
# Navigate to Merchants → Open Applications → Internal Notes
# Create a note for the application
# Refresh the page

*Expected result:*

New note should be displayed

*Actual result:*

“No records“ message is displayed",,,115,,,1
"""Referrers"" and ""Merchants"" filters are not correctly applied for Activity -> Settlements page",OBN1-17123,Bug,Done,P3,Done,4/18/2024 12:25,5/21/2024 12:24,OBN 1.59,,,,,"*Steps to reproduce:*

# Login as Operator Admin.
# Navigate to “Activity” -> “Settlements” page.
# Filter the list of settlements by “Merchants”/”Referrers”.

*Expected result:*

Only “Merchants”/”Referrers” results are displayed in the list.

*Actual result:*

There are results in the list which do not meet the filtering condition.",,S3,116,,,2
Information about the previous and current data are not displayed for merchant fees after application data update,OBN1-17068,Bug,Done,P4,Done,4/11/2024 17:10,4/18/2024 7:33,OBN 1.57,,,,,"*Preconditions:*

* The commercial offer for the applicant is not signed yet.
* The workflow stopped in “Manual” status.

*Steps to reproduce:*

# Login as Operator Admin user.
# Go to “Merchants”>”Open Applications”.
# Expand the application and click on “Application data” link.
# Click on “Edit” button.
# Do some changes on “Merchant fees” section.
# Check the “audit_merchant_lifecyle_audit.data” table for the created record.
# In the json search for the merchantFees object.

*Expected result:*

The information about the current and previous merchant fees data is displayed.

*Actual result:*

For the merchant fees object an empty array is displayed.",,S4,114,,,1
Bank details are mandatory when editing the application data,OBN1-17067,Bug,Done,P3,Done,4/11/2024 17:05,4/15/2024 14:33,OBN 1.57,,,,,"*Preconditions:*

Application didn’t provide the banking details during onboarding.

*Steps to reproduce:*

# Login as Operator Admin.
# Go to “Merchants”>”Open Applications”.
# Expand the application.
# Click on “Application data” link.
# Click on “Edit” button.
# Do some changes without providing banking details.

*Expected result:*

The banking details are optional, the changes are saved without it.

*Actual result:*

The banking details are mandatory, application data changes are not saved.

*Note:* db attached, application id = 1277

credentials: login [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
pass [reseller.admin@obn.com|mailto:reseller.admin@obn.com]",,S3,114,,,1
"500 error when user accesses ""Merchants"">""Review"">""History"" page",OBN1-17062,Bug,Done,P3,Done,4/11/2024 13:32,4/16/2024 8:04,OBN 1.57,,,,,"*Preconditions:*

User has an “Update commercial offer” action in history tab.

*Steps to reproduce:*

# Login as Operator Admin.
# Go to ""Merchants"">""Review"">""History"" page.

*Expected result:*

The list of actions from history are displayed.

*Actual result:* 

500 error.

*Note:* DB attached, merchant id= 841

credentials:

login: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
pass: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]",,S3,114,,,1
existingProcessingByTerritory field from external documentation is not marked as optional after the latest changes,OBN1-17022,Bug,Done,P3,Done,4/8/2024 7:35,4/18/2024 9:30,OBN 1.57,,,,,"*Steps to reproduce:*

# Access the external documentation.
# Navigate to “Endpoints”>”Merchant Onboarding”>”Submit Merchant application”.
# Expand the “payments”>”outlets”>”existingProcessingByTerritory”.

*Expected result:*

The “existingProcessingByTerritory” field is marked as optional.

*Actual result:*

The “existingProcessingByTerritory” field is marked as mandatory.

!image-20240408-063953.png|width=882,height=640,alt=""image-20240408-063953.png""!",,S3,114,,,1
[Timezone] total_charge is calculated wrong when run invoices generation command,OBN1-16980,Bug,Done,P1 ,Done,4/3/2024 10:59,4/4/2024 7:51,OBN 1.55,HotFix,,,,"There are sales transactions for march in DB payments_request_to_pay (transaction should have processed_at, processed = true, transaction state is 2 or 5)

*Steps to reproduce:* 

# Set “Operator Timezone” = different then UTC time (London UTC+1h) in .env file
# Run command is to generate invoices for March {{""php /var/www/api/bin/console obn:invoices:generate-for-merchants --force"" }}with parameter{{ ""2024-03""}}
# Validate the total_charge from payment_merchant_invoices

*Expected*: total_charge calculated accordingly (different than -1)

*Actual*: total_charge = -1



*Additional info:* 

This was spotted when London switched to “Daylight saving time” on 31st of March and now has difference with UTC time. (UTC+1h) 

For February invoices are generated ok and total_charge is calculated ok.

Generate invoices is set to run on 1st day of each month at 00:00 

Condition to generate invoice checks time 01:00 because of Operator Time zone. ",,S2,113,,,2
[Timezone] Invoices are not generated because of wrong condition (time) of invoices generation command ,OBN1-16959,Bug,Done,P1 ,Done,4/3/2024 7:28,8/22/2024 8:26,OBN 1.66,,,,,"There are sales transactions for march in DB payments_request_to_pay (transaction should have processed_at, processed = true, transaction state is 2 or 5)

*Steps to reproduce:* 

# Set {{OPERATOR_TIMEZONE='Europe/London'}}in .env file
# Check that cronjob is uncommented (on local environment inside docker container in terminal run command: *crontab -u obn -e*)
# Uncomment the corn job  {{0 0 1 * * php /var/www/api/bin/console obn:invoices:generate-for-merchants --env=dev 2>&1 | sed ""s/^/[$(date +'\%Y-\%m-\%dT\%H:\%M:\%S\%z')] /"" >> /var/www/api/var/log/crontab/merchant-invoice.gen.log}}
!image-20240822-071526.png|width=1460,height=120,alt=""image-20240822-071526.png""!
# restart workers
# start the cron executor: *service cron start*
# For cronjob to start you need to create folder with name “crontab” inside /var/log/
!image-20240822-071505.png|width=448,height=110,alt=""image-20240822-071505.png""!
# Change timezone on you windows machine to UTC+0 London timezone
# Enable “adjust for daylight saving time”
# Disable “set time automatically”
!image-20240822-071903.png|width=681,height=600,alt=""image-20240822-071903.png""!

# Change time on windows to ""04/01/2024 00:59:30"" (I did it in POWER shell under administrator  Set-Date -Date ""04/01/2024 00:59:30"")
# Check the date/time is changed on Windows to 1 April 1 am.
# Check the date/time is changed on local environment server to 31 March 11:59:30 in UTC
!image-20240822-072112.png|width=306,height=44,alt=""image-20240822-072112.png""!

# Wait for cronjob to start at 12:00:00 UTC (equals to 01:00:00 London time) and generate invoices for March (this job {{""php /var/www/api/bin/console obn:invoices:generate-for-merchants"" }} should be started by the server automatically)
# Validate the cronjob is executed in log file that appears in crontab folder 
!image-20240822-072520.png|width=638,height=98,alt=""image-20240822-072520.png""!
# If there are transactions for that month, the invoices are generated on Billing → Merchant Invoices, Referrer invoices tabs

*Expected*: Invoices cronjob runs, new log appears and invoices are generated for March

*Actual*: cronjob is not started, nothing appeared in log and no invoices are generated for March



*Additional info:* 

This was spotted when London switched to “Daylight saving time” on 31st of March and now has difference with UTC time. (UTC+1h) ",,S2,123,,,2
[Prod] User can't update the application data for applicant if the application was submitted by external referrer via UI,OBN1-16900,Bug,Done,P3,Done,3/28/2024 15:07,4/23/2024 14:40,OBN 1.57,,,,,"*Preconditions:*

* An application submitted by external referrer via UI exists.
* The workflow for the application stopped in “Merchant Screening” phase.

*Steps to reproduce:*

# Login as Operator Admin user.
# Go to “Merchants”>”Open Applications” page
# Expand the application from preconditions.
# Do some modifications and click on “Save” button.

*Expected result:*

The modifications are successfully saved.

*Actual result:*

400 error response. 

!MicrosoftTeams-image (52).png|width=1837,height=734,alt=""MicrosoftTeams-image (52).png""!

*Note:*

A db dump attached, please login with the following credentials:
login: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
pass: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
and use the merchant application with id = 1240.",,S2,114,,,2
Internal server error when submitting an application through external API for Moneris stage,OBN1-16742,Bug,Done,P2,Done,3/20/2024 12:45,3/20/2024 16:07,OBN 1.54,API,Moneris,,,"*Pre-req:* Referrer with external API credentials



*Steps to reproduce:*

# Log in with the referrer mentioned above
# Make an onboarding request using valid data to 
[https://api-moneris.stage.obnglobal.com/en-ca|https://api-moneris.stage.obnglobal.com/en-ca]/ext-ref/ca/merchant-onboarding/{{ExtApplicUuid}}

*Expected result:* 200 OK response is received

*Actual result:* 500 Internal Server Error

!image-20240320-124435.png|width=1238,height=231!

NOTE: example request added",,,112,,,1
[Transfer] Error on Authorised Account Adjustment when Merchant has safeguarded funds only,OBN1-16651,Bug,Done,P1 ,Done,3/19/2024 7:27,3/25/2024 12:31,OBN 1.55,,,,,"*Preconditions:*

# A Merchant with funds available as safeguarded, but no funds in Merchant Clearing
# Referrer with AAA (Authorised Account Adjustment) enabled

*Steps:*

# Log in external API as Referrer
# Create a transfer, with:
## source account Merchant;
## destination account Referrer;
## amount <= Merchant safeguarded funds;

*Expected:*

# Merchant Clearing should be supplied from safeguarded 
# Funds should be successfully moved from Merchant Clearing to Referrer Holding account;

*Actual result:*

Transfer is processed with error

[2024-03-18T18:32:24.463490+00:00] app.ERROR: PaymentService error: 844-826 --> Merchant: Could not find a merchant with holding account id = ""844"". Trace:  #0 BaseRepository.php:81: App\Repository\Core\BaseRepository->checkEntity(..) #1 DefaultSupplier.php:149: App\Repository\Core\BaseRepository->findOneByOrFail(..) #2 DefaultSupplier.php:123: App\Service\Transfer\Supply\DefaultSupplier->getMerchant(..) #3 AbstractPaymentService.php:156: App\Service\Transfer\Supply\DefaultSupplier->App\Service\Transfer\Supply\{closure}(..) #4 VirtualPaymentService.php:80: App\Service\Payment\AbstractPaymentService->transferMoney(..) #7 VirtualPaymentService.php:32: App\Doctrine\EntityManager\CustomEntityManager->retryableTransaction(..) #8 PaymentProcessor.php:56: App\Service\Payment\VirtualPaymentService->transfer(..) #9 DefaultSupplier.php:130: App\Service\Payment\PaymentProcessor->process(..) #10 DefaultSupplier.php:49: App\Service\Transfer\Supply\DefaultSupplier->supplyFromSafeguard(..) [] []
[2024-03-18T18:32:24.474290+00:00] app.ERROR: Handling ""App\Message\Payment\Transfer\Executor\AccountAdjustmentMessage"" failed: Merchant: Could not find a merchant with holding account id = ""844"" Trace: #0 BaseRepository.php:81: App\Repository\Core\BaseRepository->checkEntity(..) #1 DefaultSupplier.php:149: App\Repository\Core\BaseRepository->findOneByOrFail(..) #2 DefaultSupplier.php:123: App\Service\Transfer\Supply\DefaultSupplier->getMerchant(..) #3 AbstractPaymentService.php:156: App\Service\Transfer\Supply\DefaultSupplier->App\Service\Transfer\Supply\{closure}(..) #4 VirtualPaymentService.php:80: App\Service\Payment\AbstractPaymentService->transferMoney(..) #7 VirtualPaymentService.php:32: App\Doctrine\EntityManager\CustomEntityManager->retryableTransaction(..) #8 PaymentProcessor.php:56: App\Service\Payment\VirtualPaymentService->transfer(..) #9 DefaultSupplier.php:130: App\Service\Payment\PaymentProcessor->process(..) #10 DefaultSupplier.php:49: App\Service\Transfer\Supply\DefaultSupplier->supplyFromSafeguard(..) [] []
[2024-03-18T18:32:24.475024+00:00] messenger.WARNING: Error thrown while handling message App\Message\Payment\Transfer\Executor\AccountAdjustmentMessage. Sending for retry #9 using 5000 ms delay. Error: ""Handling ""App\Message\Payment\Transfer\Executor\AccountAdjustmentMessage"" failed: Merchant: Could not find a merchant with holding account id = ""844"""" {""class"":""App\\Message\\Payment\\Transfer\\Executor\\AccountAdjustmentMessage"",""retryCount"":9,""delay"":5000,""error"":""Handling \""App\\Message\\Payment\\Transfer\\Executor\\AccountAdjustmentMessage\"" failed: Merchant: Could not find a merchant with holding account id = \""844\"""",""exception"":""[object] (Symfony\\Component\\Messenger\\Exception\\HandlerFailedException(code: 0): Handling \""App\\Message\\Payment\\Transfer\\Executor\\AccountAdjustmentMessage\"" failed: Merchant: Could not find a merchant with holding account id = \""844\"" at /var/www/api.stage.obnglobal.com/vendor/symfony/messenger/Middleware/HandleMessageMiddleware.php:129)\n[previous exception] [object] (App\\Exception\\Core\\EntityNotFoundException(code: 0): Merchant: Could not find a merchant with holding account id = \""844\"" at /var/www/api.stage.obnglobal.com/src/Repository/Core/BaseRepository.php:115)""} []

!image-20240319-073444.png|width=1645,height=187!",,,112,,,2
Payment service that is not supported by operator is displayed on UI,OBN1-16649,Bug,Done,P1 ,Done,3/18/2024 15:50,4/18/2024 14:56,OBN 1.57,Moneris,UI,,,"# Use a Moneris environment and go to the following pages:
## “Merchants → Merchants → Outlets“ tab, “Create Outlet“ form, “Select payment service for the outlet“ field
## Onboarding form, “About its Payments“ tab, “Please select all of the payment services you’re applying for“ field
## Onboarding form, “About its Payments“ tab, “Please select the payment service for the outlet“ field



*Expected result*: Pay by Bank App option is *not* displayed in UI



*Actual result*:  Pay by Bank App option is displayed in UI

!image-20231027-140345.png|width=1288,height=726!

!image-20231027-140403.png|width=858,height=429!",,,114,,,1
Outlet category remains empty for Merchants onboarded via global external API,OBN1-16527,Bug,Done,P1 ,Done,3/12/2024 9:24,3/12/2024 13:12,OBN 1.54,API,External,HotFix,Onboarding,"*Precondition:*

# Use Referrers credentials for external API

*Steps:*

# Onboard a Merchant via externla API (global endpoint {{/ext-ref/merchant-onboarding/{applicationUuid}}})

*Expected result:*

Outlet category should be automatically populated with ECOM value

*Actual result:*

Outlet category remains empty",,S2,111,,,2
 Call to a member function getWebhookErrorCode() on null,OBN1-16521,Bug,Done,P3,Done,3/11/2024 14:30,3/19/2024 13:12,OBN 1.55,Tech-debt,TimeSensitive,,,"We started receiving this error on prod after *release-v1.53* deployment. 

!prod_error.png|width=1196,height=556!

To investigate the cause and fix.

*For Testing:*
To reproduce this bug, you need to switch to master *branch* and be sure that messenger consumer is NOT running. e.g. command “*php bin/console messenger:consume*“ is NOT running. Then you need to change status of Merchant Application twice. 
1 - First, change status to “IN_REVIEW“.
2 - Second, change status to “REJECT“.
3 - Then, you can run  *php bin/console messenger:consume* with all parameters, and then you should get that error.

You need to execute the same scenario, but on develop branch. And you need to check that described issue is fixed. 
",production,,112,,,3
Incorrect country code is transmitted in the integrationData field from the request send to Cardstream during Create records in gateway WF step execution,OBN1-16444,Bug,Done,P2,Done,3/5/2024 15:31,3/21/2024 9:10,OBN 1.55,cardstream,Merchants,,,"*Prerequisites*: Have the VPN for Cardstream requests turned ON (usually is Amdaris VPN)

*Steps to reproduce*:

# Log in as Operator admin
# Go to *Merchants* > *Open applications* 
# Expand the application with *ID 1206*
# Go to *Application Status* tab > *Account Creation and Registration* and click *Continue Workflow*

*Expected result:*

In the the *integrationData* field from the request send to Cardstream the value for {{merchantCountryCode}} is *826* (ISO 3166-1 numeric)

*Actual result:* 

In the the *integrationData* field from the request send to Cardstream the value for {{merchantCountryCode}} is *GBR*

!image-20240305-160753.png|width=925,height=235!

NOTES:  

* dump from stage attached
* user: [operator.admin@obnglobal.com|mailto:operator.admin@obnglobal.com] , pass: [operator.admin@obnglobal.com|mailto:operator.admin@obnglobal.com]","Local, stage",S3,112,,,1
Minimum settlement units and settlement fee units should not be taken from referrer when merchant has 0 value for them,OBN1-16369,Bug,Done,P1 ,Done,3/4/2024 8:07,3/5/2024 8:31,OBN 1.53,,,,,"*Preconditions:*

* Merchant exists in “payment_merchants” table
* Merchant has following values for columns

!image-20240304-081805.png|width=715,height=463!
* Merchant’s referrer has following values for columns:

!image-20240304-081849.png|width=704,height=298!
* Merchant has available for settlement funds

*Steps to reproduce:*

# The “php bin/console obn:settlement:merchant” command is run

*Expected result:*

Settlement is done based on +merchant’s+ settlement settings (stlmt_min_units = 0 & stlmt_fee_units = 0) 

*Actual result:*

Settlement is done based on +referrer’s+ settlement settings (stlmt_min_units = 0 & stlmt_fee_units = 0)

*Note:*

stlmt_min_units &  stlmt_fee_units are taken from referrer when they are NULL, but 0 should not be considered as NULL",,S3,111,,,2
User can't save the merchant settlement details when updates the values to 0,OBN1-16359,Bug,Done,P3,Done,3/1/2024 15:33,3/5/2024 8:31,OBN 1.53,,,,,"*Steps to reproduce:*

# Login as an Operator Admin user.
# Navigate to “Merchants”>”Merchants” page.
# Expand a merchant and click on “Billing Plan” tab.
# Click on “Settlement” tab.
# Click on “Edit” button.
# Update the values to 0.

*Expected result:*

The updates are saved successfully.

*Actual result:*

The updates are not saved, error is received from backend and not displayed in UI.

!MicrosoftTeams-image (47).png|width=1822,height=702!",,S3,111,,,1
[Transfers] Limit for a transfer to require approval should be operator configurable ,OBN1-16355,Bug,Done,P2,Done,3/1/2024 9:08,4/30/2024 14:28,OBN 1.58,,,,,"*Preconditions:*

# Operator admin user

*Steps:*

# Navigate to Activity → Transfers
# Create a new transfer

*Expected result:*

The transfer amount that triggers the need for approval should be configurable on a per-operator basis.

*Actual result:*

The transfer amount that triggers the need for approval is hardcoded to 1000.00 for all operators

{panel:bgColor=#deebff}
The value should be updatable from UI in the future
{panel}",,,115,,,2
"[Prod] Fix ""An open transaction is required for this operation""",OBN1-16340,Bug,Done,P1 ,Done,2/29/2024 13:27,3/6/2024 8:14,OBN 1.54,Risk,Tech-debt,,,"Due to the latest upgrades in doctrine we’re now receiving the below error whenever the cron job {{obn:organization-members:deactivate-inactive}} is running in prod.

!prod-transaction-err.png|width=1250,height=736!

In order to fix that we need to change the 3-rd argument {{$lockMode}}of the method {{\App\Repository\User\OrganizationMemberRepository::findOneInactive}}

* make it nullable 
* set default value null

Also, run a check against similar cases in other places and address accordingly.",,,111,,,1
[Stage] Industry licence state/province field does not change after editing the merchant details on Merchants > Applicant Dashboard page,OBN1-16215,Bug,Done,P3,Done,2/23/2024 13:32,2/23/2024 14:52,OBN 1.53,Merchants,UI,,,"*Preconditions:*

# User has ""MERCHANTS_FULL"" permissions

 

*Steps to reproduce:*

# Log in as operator admin
# Go to Merchants > Merchants > open the application with ID 847 > Applicant Dashboard
# Click Edit
# Go to Industry licence state/province field and change it
# Click Save

 

*Expected result:*

# The confirmation message is displayed: “Your changes have been saved.“
# The Industry licence state/province field of the application has been changed to the new value

*Actual result:*

# The confirmation message is displayed: “Your changes have been saved.“
# The Industry licence state/province field of the application remained unchanged","*Preconditions:*

# User has ""MERCHANTS_FULL"" permissions

 

*Steps to reproduce:*

# Log in as operator admin
# Go to Merchants > Merchants > open the application with ID 847 > Applicant Dashboard
# Click Edit
# Go to Industry licence state/province field and change it
# Click Save

 

*Expected result:*

# The confirmation message is displayed: “Your changes have been saved.“
# The Industry licence state/province field of the application has been changed to the new value

*Actual result:*

# The confirmation message is displayed: “Your changes have been saved.“
# The Industry licence state/province field of the application remained unchanged",S3,110,,,1
"403 error received when merchant admin accesses the ""Process flow"" tab on Disputes page",OBN1-16185,Bug,Done,P3,Done,2/21/2024 14:51,4/29/2024 15:49,OBN 1.58,,,,,"*Steps to reproduce:*

# Login as merchant admin.
# Navigate to “Disputes”>”Open Cases” page.
# Expand the dispute and click on “Process Flow” tab.

*Expected result:*

The page is loaded.

*Actual result:*

!image-20240221-145522.png|width=1370,height=714!

*Note:* db attached, login with credentials:

[aliaana@test.com|mailto:aliaana@test.com]
Amdaris12!",,S2,115,,,2
Referrer URL should be accessible,OBN1-16148,Bug,Done,P3,Done,2/20/2024 14:38,2/23/2024 10:22,OBN 1.52,HotFix,,,,"To be tested on all environments (e.g. for *cardstream*)

* Referrer’s URL is valid - the UI page properly loads (e.g. for stage [https://portal-cardstream.stage.obnglobal.com/|https://portal-cardstream.stage.obnglobal.com/])
* Back-end doesn't crush when a record in {{payment_referrers}} table exists with field {{subdomain}} matching the value from the URL e.g. *cardstream*


+ apply Hotfix to production environment",,,110,,,2
Inconsistent validation for amount of some fields when inserted value exceeds 99999 units,OBN1-16107,Bug,Done,P4,Done,2/15/2024 15:02,3/25/2024 16:06,OBN 1.55,,,,,"*Old max value:* max = 99999 units
*New max value:* max=100000000 units

*Validation to be changed for fields:*

* {{stlmtFeeUnits}}
* {{stlmtMinUnits}}
* {{refundFeePence}}
* {{transactionFeePence}}
* {{floorFeeUnits}}
* Chargeback fees : {{referrerFeeAmount}}
* Chargeback fees: {{totalFeeAmount}}

*Places:*

* Create Referrer (billing plan)
* Update Referrer Billing plan
* Update commercial offer for applicant
* Update merchant Billing plan",,S4,111,112,,2
Incorrect behaviour on updating different fields for referrer,OBN1-15904,Bug,Done,P3,Done,2/2/2024 12:05,2/8/2024 9:54,OBN 1.52,,,,,"*Scenario 1:*

*Preconditions:*

A referrer with “All industries permitted” exists in the db.

*Steps to reproduce:*

# Login as Operator Admin user.
# Navigate to “Referrers” > “Active Referrers”.
# Expand a referrer.
# Click on “Business Configuration” sub-tab.
# Click on “Edit” button.
# Click on “Industries” field .
# Deselect some of the industries.
# Click on “Save” button.
# Check the industries in the view mode.

*Expected result:* 

The industries are updated, when an industry is deselected the “All” value should be deselected automatically.

*Actual result:*

“All” value is not deselected automatically and no update is made.

!scenario1.gif|width=1826,height=802!



*Scenario 2:*

*Preconditions:*

A referrer that uses api exists in the db.

*Steps to reproduce:*

# Login as Operator Admin user.
# Navigate to “Referrers” > “Active Referrers”.
# Expand a referrer.
# Click on “Technical Configuration” sub-tab.
# Click on “Edit” button.
# Deselect the checkbox for “Enable external api access.”
# Click on “Save” button.

*Expected result:*

The field “Webhook url” is not displayed in the view mode.

*Actual result:*

The “Webhook url” field is present in the view mode.

!scenario2.mp4|width=1920,height=1032!

*Notes:* db attached, for tests use the referrer with id=9.

login: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
pass: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]",,S3,109,,,1
Fields that should not be displayed for referrer and merchant user are displayed for Sales and refunds,OBN1-15882,Bug,Done,P4,Done,2/1/2024 15:05,4/10/2024 10:06,OBN 1.56,,,,,"*Preconditions:* 

* Sales exist in “payment_requests_to_pay” table
* Refunds exist in “paymeny_requests_to_refund” table

*Steps to reproduce:*

# Log in as:
- Merchant user:
{{settlmerch@merchuser.com}}
{{Flood15?Voice1}}
- Referrer user:
{{referrer@onetest.com}}
{{Flood15?Voice}}
# Navigate to “Activity”> “Sales”/”Refunds” 
# Click on a Sale/Refund
# Check the information on opened pop-up

*Expected result:*

Following information is not displayed for Referrer user:
- Referrer ID
- Referrer Name
- Operator Fee

Following information is not displayed for Merchant user:
- Referrer ID
- Referrer Name
- Merchant ID
- Merchant Name
- Operator Fee

*Actual result:*

Referrer/Merchant user:

!image-20240201-152243.png|width=1904,height=923!",,S4,113,,,2
500 error received when an application is automatically rejected,OBN1-15824,Bug,Done,P2,Done,1/31/2024 9:38,2/8/2024 8:00,OBN 1.52,,,,,"*Preconditions:*

* A referrer that uses API exists in the DB.
* The referrer has assigned a workflow which has rule condition “Reject” for the first step.

*Steps to reproduce:*

# Do an onboarding under the referrer mentioned in the preconditions.
# Check the response.

*Expected result:* 

Success 200 message received, applicant is created and only after that is rejected.

*Actual result:*

Error 500 is received. 

!MicrosoftTeams-image (42).png|width=750,height=655!

!MicrosoftTeams-image (43).png|width=1825,height=871!

*Note:* Db dump attached, credentials for referrer login are also attached.",,S2,109,,,2
'Activate' Outlet in OBN 'Deactivates' it in Cardstream and vice versa,OBN1-15806,Bug,Done,P2,Done,1/30/2024 9:49,2/16/2024 15:53,OBN 1.52,,,,,"*Steps to reproduce:*

# Log in as OBN Operator admin user
# Navigate on “Merchants“ > “Merchants“ page and expand a merchant “Hadjioglo“
# Navigate to “EcomInternal” and click Deactivate outlet (Merchant in Cardstream)
# Open Cardstream [https://sandbox3.cardstream.com/cms/?minimised=1|https://sandbox3.cardstream.com/cms/?minimised=1|smart-link] Database → Merchants
# Find and validate status of the Merchant name= “EcomInternal” 

*Expected result:*

status = inactive

*Actual result:*

status = active

!image-20240130-095801.png|width=881,height=430!

!image-20240130-095821.png|width=1813,height=761!

To also consider:

# If any error is received during synchronization (with CS or Hexobox), send a devops email
# If Hexobox sync successfully passes, update outlet/mpa status in OBN
# If Hexobox  sync fails, *don’t* update outlet/mpa status in OBN",,S3,109,,,2
"Error received on accessing ""Activity"">""Settlement"" page when there are In progress settlements",OBN1-15780,Bug,Done,P2,Done,1/26/2024 15:34,2/6/2024 6:56,OBN 1.51,,,,,"*Preconditions:*

* Following settlement exists in DB:

!image-20240126-153542.png|width=686,height=515!

*Steps to reproduce:*

#  Log in as Operator Admin
# Navigate to “Activity” > “Settlements” page

*Expected result:*

The list with settlements is displayed

*Actual result:*

500 status code is received. The list is loading

*Note:* Also the Settlement details pop-up is broken

*Fix:*

!image-20240126-153832.png|width=803,height=899!",,S2,109,,,1
AddressParser cannot handle country value sent by QED,OBN1-15768,Bug,Done,P2,,1/26/2024 5:50,,OBN 1.51,,,,,"QED response that is handled by OBN contains country value “United Kingdom”, that is currently not handled by AddressParser.php

!image-20240126-060254.png|width=774,height=616!



*Steps to reproduce*

# Configure workflow to include KYC steps
# Perform merchant onboarding that has business type incorporated



*Expected:*

# Response from QED containing addresses (including country) to be saved in DB 



*Actual:*

# AddressParser.php fails to parse “United Kingdom” from the address received
# Address in DB is saved without country:

!image-20240126-060020.png|width=856,height=296!



3. Point 2 leads to “_getCountryNameForTwoPlusTwo() must be of the type string, null given_” error 







Logs:
[2024-01-24T14:53:11.676456+00:00] app.ERROR: Argument 1 passed to App\Service\Workflow\CaseManager::getCountryNameForTwoPlusTwo() must be of the type string, null given, called in /var/www/api/src/Service/Workflow/CaseManager.php on line 1120 Trace:  #0 CaseManager.php:1120: App\Service\Workflow\CaseManager->getCountryNameForTwoPlusTwo(..) #1 CaseManager.php:1094: App\Service\Workflow\CaseManager->buildAddressData(..) #2 CaseManager.php:1050: App\Service\Workflow\CaseManager->buildRequest(..) #3 CaseManager.php:497: App\Service\Workflow\CaseManager->formatOfficersCorporateCase(..) #4 CaseManager.php:391: App\Service\Workflow\CaseManager->createCorporateCase(..) #5 CaseManager.php:255: App\Service\Workflow\CaseManager->createCase(..) #6 CaseManager.php:189: App\Service\Workflow\CaseManager->findOrCreateCasesForOfficers(..) #7 WorkflowChecker.php:85: App\Service\Workflow\CaseManager->findOrCreateCases(..) #8 WorkflowChecker.php:31: App\Service\Workflow\Task\Kompli\WorkflowChecker->findOrCreateCases(..) #9 StepRunnerAbstract.php:420: App\Service\Workflow\Task\Kompli\WorkflowChecker->execute(..) #10 StepRunnerAbstract.php:403: App\Service\Workflow\StepRunnerAbstract->executeStep(..) [] []
",,,108,,,1
"""Enable API"" checkbox state is saved from previously created referrer",OBN1-15723,Bug,Done,P2,Done,1/24/2024 14:00,2/5/2024 12:55,OBN 1.52,,,,,"After the creation of a referrer with “Enable API” as “on”, when you create a new one afterwards, the “Enable API” checkbox is ticked by default on the screen, and if you don't touch it and go until the end, in the request payload the flag is “false” for enable API. 



*It saves the state of the checkbox from the previous referrer creation process, but the payload value is not affected*



*Steps to reproduce:*

# Create a referrer and make sure to set “Enable API” checkbox as checked
# After creation, create once again a referrer
# Get to “Account configraution” screen

*Expected:*

# “Enable API” to be unchecked by default



*Actual:*

# “Enable API” checkbox displays the state from the previous referrer creation (in this case CHECKED)

!image-20240124-135616.png|width=1050,height=738!



2. After finishing the referrer creation process, in the payload, “useApi” is FALSE, even in UI it was shown as “checked” 

!image-20240124-135629.png|width=773,height=702!



 ",stage,S2,109,,,1
[PROD] Rejecting an application created by referrer returns an unknown error,OBN1-15629,Bug,Done,P2,Done,1/22/2024 9:37,2/15/2024 14:54,OBN 1.52,,,,,"*Preconditions:*

An application with  value = “1” in “payment_merchant_applications.is_signed_up_by_referrer” exists in the db.
For application exists a soft deleted user in “user_organization_members”.

*Steps to reproduce:*

# Login as Operator Admin user.
# Go to “Merchants”>”Open Applications” page.
# Expand the application from the preconditions.
# Click on “Application Status” tab.
# Click on “Reject Application” button.
# Select any option for the drop-down from “Confirmations” pop-up.

*Expected result:*

The application is successfully rejected.

*Actual result:*

!MicrosoftTeams-image (38).png|width=1278,height=614!

Notes: Db attached please login with credentials: Login: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]; password: [reseller.admin@obn.com|mailto:reseller.admin@obn.com], and do the mentioned steps for application with id=325.",,S3,109,,,2
[Moneris] transferred_at value isn't set after successful match settlement,OBN1-15575,Bug,Done,P2,Done,1/15/2024 15:22,2/19/2024 8:34,OBN 1.52,Moneris,Processing_Settlement,,,"*Precondition:* 

# settlement for operator/referrer/merchant (moneris merchant) exists
# moneris report is imported successfully

*Steps to reproduce:*

# run p{{hp bin/console moneris:match:transactions}} to match the transactions
# Check paymets_paymets table transferred_at value

*Expected result:*

transferred_at value is populated

*Actual result:*

transferred_at value is NULL",,S3,109,,,1
Commercial offer is generated for both merchant's outlets,OBN1-15571,Bug,Done,P2,,1/15/2024 13:49,,OBN 1.51,,,,,"*Precondition:* 

# The merchant indicates two outlets during onboarding
# “Present commercial offer to applicant for signing“ step is executed

*Steps to reproduce:*

# Log in as admin user
# Navigate on “Merchants“ → “Open applications“ and expand the application
# Click on “Commercial offer“ tab
# Click on “edit“ button

*Expected result:*

Displays only one commercial offer for both outlets

*Actual result:*

For both outlets commercial offer is displayed

!image-20240115-135421.png|width=1914,height=874!

For test use attached DB - open application with ID =992 (dump from stage OBN operator)",,S2,108,,,1
Country column from the core_addresses table contain invalid data in fixtures,OBN1-15507,Bug,Done,P2,,1/11/2024 14:46,,OBN 1.51,,,,,"*Steps to reproduce:*

# Run the fixtures for Moneris or OBN.
# Check the “core_addresses.column” column.

*Expected result:*

The country column should contain proper data.

*Actual result:* 

The country column contains invalid data (ex. CA-ENG)",,S3,108,,,1
Merchant and Referrer IDs are mismatched in log message,OBN1-15483,Bug,Done,P3,Done,1/9/2024 13:37,8/6/2024 14:38,OBN 1.65,,,,,"Error log message has the Merchant ID displayed as Referrer ID, and Referrer ID displayed as Merchant ID.

*Steps to reproduce:*

# Onboard a merchant for a referrer that has no CS reseller ID set.
# Make sure onboarding gets to the step “Create Merchant records in gateway” and it fails
# Open the “main-dev” log



*Expected:*

# Error displayed:  “Cannot sync customer for merchant id=""*8*"", because referrer id=""*1*"" doesn't have CS reseller id.""

!image-20240109-133228.png|width=830,height=370!



*Actual:*

# Error displayed:  “Cannot sync customer for merchant id=""{color:#ff5630}*1*{color}"", because referrer id=""{color:#bf2600}*8*{color}"" doesn't have CS reseller id.”



*Possible root cause:* string format with mismatched values:

!image-20240109-133153.png|width=974,height=328!",,S4,122,,,1
Error during match Moneris settlement ,OBN1-15478,Bug,Done,P1 ,,1/9/2024 8:19,,OBN 1.49,,,,,"*Precondition:*

# Settlement for moneris merchant exists

*Steps to reproduce:*

# Import moneris reports (Sales and settlement)
# run {{php bin/console moneris:match:transactions}} command

*Expected result:*

Settlement transaction successfully matched 

*Actual result:*

Error 

!image-20240109-082532.png|width=1423,height=584!",,S3,107,,,1
"No ""Verify controllers"" step in audit workflow [OBN operator]",OBN1-15409,Bug,Done,P2,,1/3/2024 10:55,,OBN 1.51,,,,,"*Steps to reproduce:*

# Log in as OBN Operator admin user
# Navigate on “Merchants“ > “Merchants“ page and expand a merchant
# Click on “Review“ tab
# Enable toggle button for “Audit“
# Click on “Compliance checks“ tab

*Expected result:*

Steps that are displayed:

# Verify controllers
# Verify Entity
# Verify Reputation
# Verify Identity

*Actual result:*

Steps that are displayed:

# Verify Entity
# Verify Reputation
# Verify Identity

This step should be added only in the *OBN related operator* fixtures only",,S2,108,,,1
The title of the email that user receive after sign-up is not the correct one,OBN1-15253,Bug,Done,P3,,12/27/2023 11:24,,OBN 1.50,,,,,"*Steps to reproduce:*

# Do a sign-up in the portal.
# Check the email received.

*Expected result:*

The subject of the email is: Account Notification – Action Required. ([https://cardstream.atlassian.net/browse/OBN1-14576|https://cardstream.atlassian.net/browse/OBN1-14576|smart-link] )

*Actual result:* 

The subject of the email is: 

!MicrosoftTeams-image (34).png|width=1497,height=611!


",,S3,107,,,1
"On updating application during ""Merchant screening"" phase - override fees section is added",OBN1-15241,Bug,Done,P1 ,,12/27/2023 10:27,,OBN 1.50,,,,,"*Precondition:* wf with “Merchant screening“ phase exists and assigned to a referrer that uses API

*Steps to reproduce:*

# Get token for referrer that uses API 
# In body for submitting merchant details - do not indicate {{""transactionFees""}} object
# Submit details
# Check WF was stopped on “Merchant screening“ phase
# Check form data for application in {{""payment_merchant_applications.form_data""}} column ( the {{""transactionFees""}} field doesn't exists)
# Log in as admin user
# Navigate on “Merchants“ → “Open applications“ page and expand application
# Click “application data“ link in “Application dashboard“
# In “Application data“ pop up click “edit“ button
# Do not do changes and click “Save“ button
# _a) 1 case:_ Check form data for application in {{""payment_merchant_applications.form_data""}} column
# Continue wf - so that the offer is generated
# _b) 2 case: c_heck the values that were generated for the merchant fees

*Expected result:*

# _a) 1 case:_ the {{""transactionFees""}} field +doesn't+ exists in form_data
# _b) 2 case:_ commercial offer and fees are generated based on the default Referrer’s billing plan

*Actual result:*

# _a) 1 case:_ the {{""transactionFees""}} field exists in form_data. new record is created for application in {{payment_referrer_override_fees}} table
# billing plan is created all times with “NET_REVENUE“ type 

!image-20231227-134621.png|width=1487,height=812!



3_. b) 2 case:_ commercial offer and fees are generated based on the overriden merchant fees from {{payment_referrer_override_fees}} table",,,107,,,3
Updating the merchant billing plan returns an error,OBN1-15192,Bug,Done,P1 ,,12/27/2023 9:30,,OBN 1.50,,,,,,"*Steps to reproduce:*

# Login as an Operator admin.
# Go to “Merchants”>”Merchants” page.
# Expand a merchant.
# Click on “Billing plan” tab.
# On “Sale/Refund” sub-tab click on “Edit” button.
# Update some values and click on “Save” button.

*Expected result:*

The changes are successfully saved.

*Actual result:*

500 error.

!Screenshot_12.png|width=797,height=245!",S2,107,,,2
"""REFUND"" splitting for Bambora RTR is not set as ""is_read"" when all splittings are successfully paid ",OBN1-15191,Bug,Done,P3,,12/27/2023 9:09,,OBN 1.49,,,,,"!image-20231227-091028.png|width=1074,height=522!",,S3,106,,,1
Ownership values are deleted on officer update,OBN1-15190,Bug,Done,P2,,12/27/2023 8:50,,OBN 1.50,,,,,"*Precondition:* use dump for test

*Steps to reproduce:*

# Log in as admin user
# Navigate to “Merchants“ → “Open applications“ page and expand application (ID 1059)
# Click on “Application status“ tab and expand “Know your client - pre-activation“ phase
# Click “Upload documents“ button
# In “Request for information” pop up expand information for Vlad Nanu and add documents, click “Save“ button
# Expand next one officer - Andrew John and add documents, click “Save“ button

*Expected result:*

officer successful updated and saved.

*Actual result:*

error

!image-20231227-085753.png|width=1906,height=506!

this is due to the fact that when the first officer was updated (Vlad Nanu), the values for the {{""ownership""}} and {{""is_beneficial_owner""}} columns in {{""payment_merchant_officers""}} were set to NULL",,S2,107,,,2
[PROD] Application user is not able to log in when onboarding is done by referrer,OBN1-15004,Bug,Done,P1 ,,12/13/2023 10:51,,OBN 1.47,,,,,"*Preconditions:*

# Application with status “IN_REVIEW” exists in “payment_merchant_application” table _[ID = 993]_
# Application is signed up by referrer → has “1” in “payment_merchant_application.is_signed_up_by_referrer” column
# A user profile exists for Application’s organisation in “user_organization_members” table _[ID = 688]_

*Steps to reproduce:*

# Open OBN Log in form
# User user’s credentials to log in 
[_test2fa@2fauser.com_|mailto:test2fa@2fauser.com]
_Flood15?Voice_
# Select “Application” user profile

*Expected result:*

User is successfully logged in

*Actual result:*

User is redirected to Log in form



{color:#bf2600}*_Note: Disable 2FA in core settings to be easier to reproduce using attached DB dump_*{color}

 ",,S1,105,,,1
"Error 403 displayed for a merchant user on ""My Outlets"" page when an outlet creation workflow is not finished",OBN1-14940,Bug,Done,P3,,12/6/2023 7:30,,OBN 1.47,,,,,"*Preconditions:* Merchant has an outlet for which the workflow isn’t finished.

*Steps to reproduce:*

# Login as a merchant user.
# Navigate to “Organisation”>”My Outlets” page.
# Expand the outlet from preconditions.

*Expected result:*

The workflow is not displayed for merchant user.

*Actual result:*

The 403 error received, the section for workflow is continuously loading.

!MicrosoftTeams-image (31).png|width=1889,height=984!

!MicrosoftTeams-image (32).png|width=1525,height=766!

*Note:* DB attached, login with the following credentials:

login: [test@Machete.com|mailto:test@Machete.com]
password: Amdaris12!",,S3,104,,,1
[API] 500 error on attempt to create a workflow with too long name,OBN1-14939,Bug,Done,P5,Done,12/6/2023 7:16,9/3/2024 15:31,OBN 1.67,,,,,"*Steps to reproduce:*

# In body for create new WF for {{""name""}} filed use a value greater than 100 characters
# Send a POST request to{{ /workflow}} endpoint

*Expected result:*

Validation error message returns in response body

{{This value is too long. It should have 100 characters or less.}}

*Actual result:*

500 error returns

!image-20231206-072138.png|width=1395,height=864!

!image-20231206-072214.png|width=1404,height=683!

*Note:* for test you can use attached DB and body",,S4,124,,,1
Incorrect calculation of Adjustments total amount from a Moneris report with negative and positive adjustments ,OBN1-14911,Bug,Done,P2,,12/5/2023 9:38,,OBN 1.47,Moneris,Payments,Reports,,"*Precondition:* Use attached database

*Steps to reproduce:*

# Import Order Details Moneris report with 1 negative and 1 positive adjustment (attached)
# Check information stored in “summary_data” column in “payment_acquirer_payment_report_files” table

*Expected result:*

Two Adjustment transaction types are stored in “summary_data” column:

# 52.29 with type = credit
# (-16.00) with type = debit

*Actual result:*

!image-20231205-095618.png|width=1321,height=821!",,S3,105,,,1
"[Prod] Error on display ""application data"" of an in progress application",OBN1-14860,Bug,Done,P2,,11/29/2023 12:53,,OBN 1.48,,,,,"*Preconditions:*

# An application with only “About the Business“ completed

*Steps:*

# Log in as operator with MERCHANTS_FULL permission
# Navigate to Merchants > Open applications
# Expand the application
# Click on “Application data“

*Expected result:*

Existing application data should be displayed

*Actual result:*

A 500 error is returned

!image-20231129-130229.png|width=1145,height=635!

{panel:bgColor=#deebff}
Production application: id = 1068
{panel}",,,105,,,1
"Error during ""Activate merchant"" step execution",OBN1-14840,Bug,Done,P2,,11/28/2023 13:19,,OBN 1.48,,,,,"*Preconditions:* WF with “Activate merchant“ step exists

*Steps to reproduce:*

# Initiate onboarding
# Trigger the workflow
# Check all steps up to “Activate merchant“ steps are executed successfully 
# On “Activate merchant“ step, a “401“ error is received from the gateway (Cardstream)

*Expected result:*

Step result is created for “Activate merchant“ step. Step has error status and “reattempt“ button is available

*Actual result:*

Step result *is not* created for “Activate merchant“ step.  Step remains in “To do“ status

!image-20231128-132621.png|width=1397,height=457!",,S2,105,,,5
[Prod] Error on settlement processing,OBN1-14806,Bug,Done,P1 ,,11/28/2023 7:16,,OBN 1.46,HotFix,,,,"*Preconditions:*

# Use production env
# Operator settlement fee of this Merchant is 0

*Steps:*

# Trigger the Settlement for a Merchant using Starling payment processor

*Expected result:*

Settlement is successfully performed

*Actual result:*

An error is received

!image-20231128-071803.png|width=1152,height=501!

{panel:bgColor=#deebff}
Dev note: [~accountid:5dca6baa99e7ea0c60b08a9e] , after the release of the fix, please run the retry command: {{maintenance:settlement:merchant 5250}}
{panel}",,S1,104,,,2
Error when Referrer tries to access its billing plan,OBN1-14779,Bug,Done,P2,,11/24/2023 13:57,,OBN 1.46,Billing_plan,Referrers,,,"*Preconditions:* 

# An active referrer with admin rights



*Steps to reproduce:*

# As a referrer go to Organization>My Billing Plan



*Expected result:* the information about the billing plan is displayed



*Actual result:* the information about the billing plan is not displayed

!image-20231124-135616.png|width=618,height=486!",,,104,,,1
Error 400 when updating merchant application data with optional bank details null,OBN1-14724,Bug,Done,P3,,11/22/2023 17:42,,OBN 1.47,,,,,"*Steps to reproduce:*

# Go to “Merchant” > “Open Applications”.
# Go to the merchant with bankAccountDetails = null
# Click on “Application data”.
# Update some information on other pages than “Bank account details”. (do not even click on this section)
# Click on “Save” button.

*Expected result:*

The changes are saved.

*Actual result:*

The changes are not saved, validation message is thrown.|

!image-20231122-174742.png|width=438,height=88!

*Note:* DB attached, update the application data for the application with id = 296.",,,104,,,1
Error 500 thrown when address parser is unavailable ,OBN1-14723,Bug,Done,P2,,11/22/2023 17:22,,OBN 1.49,,,,,"*Preconditions:* User is on {{epic-OBN1-13909-multi-country-fields-address-form}}

*Steps to reproduce:*

# Update application data for an application during “Merchant Screening” phase.
# Click on “Save”.

*Expected result:*

The data is saved properly. 

*Actual result:*

500 error message.

!image-20231122-172514.png|width=1254,height=586!

*Note:* Try to update application data for application with id = 295.",,S3,104,,,1
[Prod] Wrong invoice payable amount ,OBN1-14698,Bug,Done,P1 ,,11/21/2023 15:20,,OBN 1.46,,,,,"*Preconditions:*

# Use production env

*Steps:*

# Re-run generate invoice settlement which has:
## total_charge = 0;
## has invoice parts with fees deducted;

*Expected result:*

Amount payable is successfully calculated

*Actual result:*

Amount payable is not correctly calculated (because payment_merchant_invoices.total_charge remained 0)

!image-20231121-155055.png|width=837,height=561!",,,104,,,3
"Incorrect information is stored for ""Refund"" transaction type on importing Moneris Settlement report",OBN1-14649,Bug,Done,P1 ,,11/20/2023 9:37,,OBN 1.47,Moneris,Payments,,,"*Steps to reproduce:*

# Use DB dump attached
# Run “php bin/console moneris:import-payments” using attached Moneris report
# Check the “summary_data” column value from “{{payment_acquirer_payment_report_files}}“ table for created record

*Expected result:*

“type” : “Refund”

“transactionType” : “debit”

*Actual result:*

!image-20231120-093718.png|width=1883,height=938!",,S3,104,,,1
Errors during running the migrations,OBN1-14637,Bug,Done,P1 ,,11/17/2023 9:35,,OBN 1.47,,,,,"*Steps to reproduce:*

# Rebuild containers
# Create new DB
# Run migrations

*Expected result:*

All migrations are executed successfully

*Actual result:*

Errors during running the migrations



*Note:* *_migrations that need to be fixed_*

Version20211228073524.php

Version20220110073524.php

Version20230608125739.php

Version20230831131540.php",,S4,104,,,1
[Sandbox]Error on generation of the commercial offer for application that have BP for 2 processors but overridden fees only for one,OBN1-14571,Bug,Done,P1 ,,11/9/2023 13:44,,OBN 1.46,,,,,"*Preconditions:*

# Referrer that uses API exists in “payment_referrers” table
# User is authenticated using referrer’s API credentials
# “IN_PROGRESS” application exists in “payment_merchant_applications” table

*Steps to reproduce:*

# Sent POST request to “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}“ endpoint with overriden fees only for one BP:
!image-20231109-135113.png|width=608,height=281!

# Workflow started for the application

*Expected result:*

Offer is successfully generated for the application’s merchant

*Actual result:*

An error occurred during generation of the offer for the application’s merchant



*Note:*

Caused by missing of the merchant’s chargeback fees in “{{payment_merchant_chargeback_fees}}“ for BP for which override fees were not sent",,S2,103,,,2
No translations for the 'sendOnAuthError' mail sender,OBN1-14506,Bug,Done,P2,,11/6/2023 9:09,,OBN 1.47,,,,,"*Precondition:*

translations for Xero MailSernder exists

*Steps to reproduce:*

trigger the {{sendOnAuthError}} mail (auth fails when refresh token is updated)

*Expected result:*

email notification is with existing transaltion

*Actual result:*

the email notification has not been translated",,S3,104,,,1
"Error on update application during onboarding from ""Application dashboard""",OBN1-14471,Bug,Done,P2,,11/3/2023 11:57,,OBN 1.50,,,,,"*Precondition:*

# The applicator/referrer is doing onboarding and has not filled out “About its payments“ step
# Merchant is not created for application

Steps to reproduce:

# Log in as Operator user
# Navigate to “Merchants“ → “Open applications“ and expand application
# Click “edit“ button in “Application dashboard“ 
# Change some data and click “Save“ button

*Expected result:*

Application is updated successfully

*Actual result:*

Error:

!image-20231103-120244.png|width=1570,height=714!

Note: for test use the last application in “open applications“ list from attached DB

!image-20231103-120440.png|width=1874,height=710!",,S3,107,,,1
[Prod] QR code is not displayed when user re-follows the reset password link,OBN1-14430,Bug,Done,P1 ,,11/2/2023 6:19,,OBN 1.46,TimeSensitive,,,,"*Precondition:* 

# Operator creates an user
# Operator resets the user
# 2FA is enabled on the portal

*Steps to reproduce:*

# As user follow the “reset-password“ link 
# Set the password and click on the “change password“ button
# On the “Reset password“ page do not scan the QA code and close the page
# Go to the email and re-follow the “reset-password“ link one more time
# Set the password and click on the “change password“ button
# Check the “Reset password“ page

*Expected result:*

QR code displays

*Actual result:*

QR code doesn’t displays

!image-20231102-063147.png|width=1727,height=934!

see the attach file",,S2,103,105,,3
[Prod] Wrong invoice generated on production,OBN1-14408,Bug,Done,P1 ,,11/1/2023 9:49,,OBN 1.45,TimeSensitive,,,,"*Preconditions:*

# Use prod environment
# Merchant has processed RTPs and fees deducted during last month (Merchants with ids=2 and 924)

*Steps:*

# Run {{bn:invoices:generate-for-merchants}} command on first day of current month

*Expected result:*

The invoice should be generated including the fees

*Actual result:*

The merchant invoice is generated containing the settlement fee.

The invoice parts are not generated.",,S1,102,,,3
"[UI] On select in filter ""Today"" date on the Activity page, the field shifts",OBN1-14360,Bug,Done,P4,,10/31/2023 12:17,,OBN 1.48,,,,,"# Log in as user with “ACTIVITY“ permission
# Navigate on the “Activity“ → “Sale“/”Refund”/”Transfers”/”Settlements” tab
# Select “Today“ filter in the “Date“ field - date filed shifts to right
# Select “Custom“ value for “Date field“ 

*Expected result:*

Date field remains in place

*Actual result:*

See attached file",,,105,,,1
Error 404 received when operator doesn't have a Zapp account,OBN1-14330,Bug,Done,P2,,10/27/2023 8:09,,OBN 1.46,Bank_Details,Moneris,,,"*Preconditions:* DB with Moneris fixtures

*Steps to reproduce:*

# Login as operator admin.
# Go to “Organisation” > “Bank account Details” page.
# Notice the bank account details continuously loading.

*Expected result:*

Bank account details are loaded for the existing bank accounts.

*Actual result:*

The request can’t find Zapp account details (which are deleted in Moneris fixtures) and returns 404 error.",,S2,103,,,2
"[Bambora] The ""ACQUIRER_VARIABLE_MARGIN"" & ""ACQUIRER_FIXED_MARGIN"" fees should be negative or 0 in generated Bambora report",OBN1-14329,Bug,Done,P3,,10/27/2023 7:49,,OBN 1.49,,,,,"*Steps to reproduce:*

# Run {{php bin/console bambora:reports:create-reports --count-tx=1 --count-cb=0 --sale-amount-min=1000 --sale-amount-max=1000 --refunds-percent=0 --refunds-amount-percent=50 --fixed-fee-only --report-datetime='2023-10-01 15:00:00' --currency='GBP'}} command
# Bambora report is generated

*Expected result:*

""ACQUIRER_VARIABLE_MARGIN"" & ""ACQUIRER_FIXED_MARGIN"" fees have negative value or 0

*Actual Result:*

""ACQUIRER_VARIABLE_MARGIN"" & ""ACQUIRER_FIXED_MARGIN"" fees have positive values",,,106,,,1
[Bambora Adjustments] Error on processing Bambora Adjustments,OBN1-14270,Bug,Done,P1 ,,10/24/2023 10:32,,OBN 1.44,bambora,Payments,,,"*Steps to reproduce:*

# *Import reports:*

[^20230902150000_OBNGLOBAL_GBP.csv]
[^20230901150000_OBNGLOBAL_GBP.csv]

*2. Run commands:*
php bin/console bambora:match:transactions
php bin/console bambora:process:refunds
php bin/console bambora:process:negative:chargebacks
php bin/console bambora:process:remains

*Expected result:*

Remains are successfully processed. Payment for remains/adjustments is created.

*Actual result;*
Errors are received in logs

{noformat}[2023-10-24T09:14:53.142011+00:00] app.ERROR: PaymentService error: 40-38 --> Insufficient transferring funds(account: 5f60e6ce-b4ae-4f8f-9a78-c8b873b341f8, minor units: 10010, already in transfer: 0, transferring: -1). Trace:  #0 AbstractPaymentService.php:138: App\Entity\Payment\Account->increaseTransferringMinorUnits(..) #1 VirtualPaymentService.php:77: App\Service\Payment\AbstractPaymentService->transferMoney(..) #4 VirtualPaymentService.php:87: App\Doctrine\EntityManager\CustomEntityManager->retryableTransaction(..) #5 PaymentProcessor.php:54: App\Service\Payment\VirtualPaymentService->transfer(..) #6 BamboraRemainsService.php:338: App\Service\Payment\PaymentProcessor->process(..) #7 BamboraRemainsService.php:71: App\Service\Payment\Bambora\BamboraRemainsService->transferAdjustments(..) #8 BamboraRemainsHandler.php:68: App\Service\Payment\Bambora\BamboraRemainsService->process(..) #9 HandleMessageMiddleware.php:63: App\MessageHandler\Payment\BamboraRemainsHandler->__invoke(..) #10 SendMessageMiddleware.php:74: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->handle(..) [] []
[2023-10-24T09:14:53.142495+00:00] app.ERROR: Bambora remaining processing failed. Error: App\Exception\Core\DomainException. Code: 0 Message: Insufficient transferring funds(account: 5f60e6ce-b4ae-4f8f-9a78-c8b873b341f8, minor units: 10010, already in transfer: 0, transferring: -1) Trace:  #0 AbstractPaymentService.php:138: App\Entity\Payment\Account->increaseTransferringMinorUnits(..) #1 VirtualPaymentService.php:77: App\Service\Payment\AbstractPaymentService->transferMoney(..) #4 VirtualPaymentService.php:87: App\Doctrine\EntityManager\CustomEntityManager->retryableTransaction(..) #5 PaymentProcessor.php:54: App\Service\Payment\VirtualPaymentService->transfer(..) #6 BamboraRemainsService.php:338: App\Service\Payment\PaymentProcessor->process(..) #7 BamboraRemainsService.php:71: App\Service\Payment\Bambora\BamboraRemainsService->transferAdjustments(..) #8 BamboraRemainsHandler.php:68: App\Service\Payment\Bambora\BamboraRemainsService->process(..) #9 HandleMessageMiddleware.php:63: App\MessageHandler\Payment\BamboraRemainsHandler->__invoke(..) #10 SendMessageMiddleware.php:74: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->handle(..) [] []
{noformat}

Payment for remains/adjustments is not created. Remains record has “FAILED” status in “{{payment_bambora_remains_adjustments}}“ table ",,S1,102,,,5
"[Prod] Error received on attempt to create ""repaymentRR"" payment",OBN1-14204,Bug,Done,P1 ,,10/19/2023 15:55,,OBN 1.43.1,HotFix,,,,"!image-20231019-145632.png|width=1193,height=765!",,S1,101,,,1
[Prod] Referrer fee not paid for Bambora Refunds,OBN1-14195,Bug,Done,P1 ,,10/18/2023 12:33,,OBN 1.43.1,HotFix,,,,"*Steps:*

# A Refund is received in Bambora report
# Run the “{{bambora:process:refunds}}“ step

*Expected result:*

The Refund should be successfully processed.

All splittings should be processed and have “is_read = 1“

*Actual result:*

Referrer fee for Bambora Refund payment is not created.

There are splitting that remain with  “is_read = 0“, even if payment was successfully created.",,,101,,,2
[Internal API] Success response is received when a request to create referrer with not all configs is sent,OBN1-14134,Bug,To Do,P4,,10/13/2023 13:57,,,,,,,"*Steps to reproduce:*

# Authenticate with Operator Admin credentials
# Send “POST” request to “{{Domain}}/user/referrer“ endpoint using attached body (2 configs missing in body)

*Expected result:*

400 status code is received. Validation message is received in response body

*Actual result:*

200 status code is received. Referrer is created with missing configs:

!image-20231013-130047.png|width=970,height=878!",,S3,150,,,
"[Sandbox] Error on execution of ""Create users"" step",OBN1-14133,Bug,Done,P1 ,,10/13/2023 13:37,,OBN 1.43,,,,,"+Preconditions:+

# Use Sandbox

+Steps:+

# Include “Create users“ step in the workflow
# Execute the workflow

+Expected result:+

Step is successfully executed

+Actual result:+

Step error is received",,,101,,,3
"[Ext-API] ""bankDetails"" should not be mandatory on Submitting application data",OBN1-14095,Bug,Done,P1 ,,10/11/2023 8:25,,OBN 1.43,,,,,"*Preconditions:*

# Referrer that uses API existis in “payment_referrers” table
# Application is created for the Referrer

*Steps to reproduce:*

# Authenticate using Referrer API credentials
# Send “POST“ request to “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}“ endpoint without ““bankDetails” section
(for CA endpoint also - /ext-ref/ca/merchant-onboarding/{{ExtApplicUuid}} )

*Expected result:*

200 response code is received. Application details are submitted

*Actual result:*

400 response code is received. Application data is not submitted

!image-20231011-072945.png|width=1536,height=924!

*NOTE:* This bug also affects [https://cardstream.atlassian.net/browse/OBN1-13752|https://cardstream.atlassian.net/browse/OBN1-13752|smart-link] AC 3 and AC 6. Those ACs need to be retested once the bug is fixed.",,S3,101,,,3
"[External] Referrer can submit merchant details without value for ""existingGatewayCustomerId"" field",OBN1-14076,Bug,Done,P3,,10/10/2023 15:51,,OBN 1.49,,,,,"*Steps to reproduce:*

# Send POST request to endpoint {{/ext-ref/merchant-onboarding/:applicationUuid}} using body from attachment
# In body for {{existingGateway}} indicate the {{Carstream Limited}} value and do not provided the value for {{existingGatewayCustomerId}} field

!image-20231010-145636.png|width=974,height=498!

*Expected result:*

Validation error is displayed in response body. Merchant details are not submitted

*Actual result:*

Merchant details are submitted successfully ",,S4,106,,,1
Inactive Referrer user has possibility to reset his password ,OBN1-14026,Bug,Done,P2,,10/6/2023 15:24,,OBN 1.45,,,,,"*Preconditions:* create a Referrer

# User doesn’t receive email notification
# User profile is created and is not active

*Steps to reproduce:*

# Enter email in forgot password field and send request

*Expected result:*

Error on login form - user can’t sent request

*Actual result:*

Reset password is sent to user",,,102,,,1
"[External Onboarding] 500 status code received on submitting Application details using string for ""ownership""",OBN1-14015,Bug,Done,P1 ,,10/6/2023 8:00,,OBN 1.43,,,,,"*Steps to reproduce:*

# Authenticate using Referrer API credentials
# Send “POST” request to “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}“ using string values for “ownership”

*Expected result:*

400 status code received. “{{This value should be of type integer.}}“ message is returned in response body

*Actual result:*

!image-20231006-071132.png|width=1490,height=866!",,,100,,,2
[UI] Incorrect link redirection,OBN1-13988,Bug,Done,P4,,10/4/2023 8:30,,OBN 1.48,,,,,"*Steps to reproduce:*

# Login as admin user
# Navigate on the {{Merchants -> Merchants}}
# Sort merchants by desc order
#  Expand a merchant and copy the link from URL (example from the stage: [https://portal.stage.obnglobal.com/merchants/merchants/e6d77488-5cb5-4f79-b2d8-9a72a70bc8e9/billing-plan/sale-refund?page=2&per_page=20|https://portal.stage.obnglobal.com/merchants/merchants/e6d77488-5cb5-4f79-b2d8-9a72a70bc8e9/billing-plan/sale-refund?page=2&per_page=20|smart-link] )
# Navigate on the another menu (for example to “Referrers“)
# Paste the copied link in URL and follow it

*Expected result:*

User is redirected to the previous expanded merchant

*Actual result:*

User is redirected to the merchant’s list

+*Note*+: this works for other pages also",,S4,105,,,3
[PROD] Locale missing from authentication request on External documentation,OBN1-13938,Bug,Done,P1 ,,10/2/2023 15:35,,OBN 1.43.1,,,,,"*Steps to reproduce:*

# Navigate to '[http://localhost:444/login|http://localhost:444/login]' 
# Clicks on “Log in” button
# Fill “API Secret” & “API Key“ fields
# Click on “Log in” button

*Expected result:*

User is successfully authenticated

*Actual result:*

!image-20231002-143527.png|width=1909,height=994!",,S1,101,,,1
"After updating the referrer's billing plan, commercial offer for the merchant under referrer is not generated correctly",OBN1-13937,Bug,Done,P1 ,,10/2/2023 14:29,,OBN 1.43,,,,,"*Preconditions:*

Both versions of commercial offer documents are present in the db, “core_documents” table.

!image-20231002-133107.png|width=1095,height=110!

*Steps to reproduce:*

# Navigate to “Merchants”>”Open Applications” page.
# Extend any merchant which has generated but unsigned commercial offer.
# Download the offer.
# Go to merchant’s referrer.
# Modify referrer’s billing plan.
# Save modifications.
# Go back to the merchant and refresh the page.
# Download the offer again.
# Compare the two downloaded documents.

*Expected result:* 

Both documents contain valid information about the merchant.

*Actual result:*

The merchant’s information is different in the updated commercial offer.
The pages of the offer are multiplied for every merchant updated.

*Notes:*

DB dump attached.
Application ID = 151, Referrer ID = 9.",,,100,,,2
[API-doc] Missing parameters and fields description in external documentation,OBN1-13754,Bug,Done,P2,,9/25/2023 7:21,,OBN 1.42,External,,,,"!image-20230925-062449.png|width=1909,height=989!",,S2,99,,,1
[Billing Plan] RR% not updated on update Merchant risk controls,OBN1-13743,Bug,Done,P1 ,,9/21/2023 9:56,,OBN 1.42,Analysis,Commercial_Offer,Merchant_Onboarding,,"*Preconditions:*

# Active merchant exists
# Merchant has 0.00 % for “*Rolling reserve (%)*” field

*Steps to reproduce:*

# Log in as Operator Admin
# Navigate to “Merchants”>”Merchants”>”Billing Plan”>”Risk Controls” tab
# Click on “Edit” icon
# Change the “Rolling Reserve (%)” to a value greater than 0
# Click “Save” button

*Expected result:*

The “Rolling Reserve (%)” value is saved. New value is displayed on ”Risk Controls” tab

*Actual result:*

The value is not save

*Dump:*

Merchant id 227



+Note for QAs:+

To be tested:

* Update RR for an active merchant when initial RR value = 0
* Update RR in commercial offer for an open application when initial RR value = 0
* Apply RR for merchant’s RTPs when initial RR value = 0",,,99,,,5
"[Fixtures] ""Know your client"" phases are missing from WFs in UI",OBN1-13651,Bug,Done,P3,,9/18/2023 7:48,,OBN 1.42,Fixtures,,,,"*WF phases in DB:*

!image-20230918-064904.png|width=1117,height=350!

*Steps to reproduce:*

# Log in as Operator Admin
# Navigate to “Settings”>”Workflows” 
# Create a WF
# Check phases displayed on “Steps selection” page

*Expected result:*

“Know Your Client” phases are present

*Actual Result:*

“Know Your Client” phases are missing

!image-20230918-065049.png|width=1263,height=476!",,S4,99,,,2
[Kompli] documents for new created contacts are not uploaded,OBN1-13638,Bug,Done,P2,,9/14/2023 15:10,,OBN 1.42,,,,,"Precondition:

Steps to reproduce:

# Log in as Operator admin user
# Navigate on “Merchants“ → “open applications“ and expand application
# Click on “Application status“ tab and expand “Know-your client-pre-activation“ phase
# Click on “Upload documents“ button
# Expand the officer and upload documents for identity/address
# Click “Save“ button

*Expected result:*

officer doesn’t displays anymore in the pop-up. after all documents are uploaded for all officers - request to Kompli is sent. Documets are stored in DB

*Actual result:*

document are not stored in DB - request is not sent to Kompli after all documents are uploaded for all officers. 

!image-20230914-141659.png|width=1456,height=433!

!image-20230914-141836.png|width=1887,height=706!",,S2,99,,,1
"[API] Users with ""REFERRERS_FULL"" permission can get all available workflows",OBN1-13608,Bug,Done,P3,,9/13/2023 11:44,,OBN 1.42,,,,,"*Precondition*: 

1. user (not admin) has “REFERRERS_FULL“ permissions

2. WF exists in the “workflow_workflow“ table

*Steps to reproduce:*

# Using as auth token for user sent GET request to {{workflow/by-type/ONBOARDING?offset=0&limit=20}} endpoint
# Check the response body

*Expected result:*

“Operation not allowed“ message displays in the response body. Only Operator can user has access to WF

*Actual result:*

user has access to all available WF. On UI works fine

!image-20230913-104343.png|width=1898,height=659!

!image-20230913-104411.png|width=1373,height=796!",,S2,99,,,1
Invalid error on activate/deativate an outlet/mpa if server response with error,OBN1-13552,Bug,Done,P1 ,,9/11/2023 13:23,,OBN 1.42,,,,,"*Precondition*: active merchant with outlet and mpa exists. Hexobox server is down

*Steps to reproduce:*

# Log in as Operator admin user
# Navigate on “merchants“ > “merchants“ page and expand a merchant
# Click on “outlets“ tab
# Click on tooggle button to deactivate an mpa

*Expected result:*

AN error is displayed on UI, mpa is not deactivated

*Actual result:*

{{""Token authentication required""}} error message is returned

!image-20230911-122218.png|width=1906,height=749!",,S2,99,,,1
"New organization business types are not added in fixtures for ""Audit"" WF",OBN1-13542,Bug,Done,P2,,9/11/2023 12:43,,OBN 1.42,,,,,"*Steps to reproduce:*

# Create new DB
# Run fixtures
# Check the “workflow_workflows“ table “business_types“ values for the MERCHANT_AUDIT WF

*Expected result:*

Merchant audit workflow for incorporated/corporates organizations contains also new business types

*Actual result:*

Merchant audit workflow for incorporated/corporates organizations contains only old business types

!image-20230911-114255.png|width=1445,height=708!",,,99,,,1
"""covering_debt_to_obn_units"" value is increased after EWD runs",OBN1-13539,Bug,Done,P2,,9/11/2023 11:58,,OBN 1.42,,,,,"*Precondition*: 

# an active merchant exists
# {{debt to obn}} and {{safeguard_minor units}} exists for merchant
# !image-20230912-085854.png|width=616,height=634!

3. {{covering_debt_to_obn_units}} = 0 for merchant

!image-20230912-085952.png|width=764,height=643!

4. run the {{php bin/console obn:working-hour}}  command to simulate EWD

*Expected result:*

{{covering_debt_to_obn_units}} = 0 for merchant

*Actual result:*

!image-20230913-084802.png|width=682,height=711!",,,99,,,3
Validation error is not displayed when user enters value greater than 999.99 ,OBN1-13528,Bug,Done,P3,,9/11/2023 6:19,,OBN 1.43,,,,,"*Precondition:* an active merchant exists. Scheme fee for dispute status = 0

*Steps to reproduce:*

# Log in as Operator 
# Navigate on the “Merchants“ > “Merchants“ page and expand the merchant
# Click on the “Billing plan“ tab and click on the “Disputes“ tab
# Click on “edit“ button
# Enter “0“ value for the “Referrer fee“ column and for the “Total fee” enter value = 1000000
# Click “Save“ button

*Expected result:* 

User should not be allowed to enter a value greater than 999.99

*Actual result:*

Error in console. 

!image-20230911-052728.png|width=1904,height=836!",,,100,,,1
[Prod] Applications are not rejected on sign-up ,OBN1-13458,Bug,Done,P4,,9/1/2023 11:22,,OBN 1.41,,,,,"*Steps to reproduce:*

# Navigate to /sign-up page
# Use information that will cause application reject (Company name from black list, not accepted country)
# Submit application

*Expected result:*

Application is Rejected

*Actual result*

Application is not rejected.",,S4,98,,,1
"[API] 500 status code received on attempt to create referrer with null value for ""processorTypes.billingPlan.configs.processorType"" key",OBN1-13452,Bug,Done,P4,Done,8/31/2023 18:52,2/20/2024 9:52,OBN 1.53,,,,,"*Steps to reproduce:*

# Authenticate as “RESELLER” with “ROLE_ADMIN” profile
# Send POST request to '/user/referrer' endpoint with null value for  “{{processorTypes.billingPlan.configs.processorType}}“ key

*Expected result:*

400 status code is received. ‘This value should not be blank’ message is returned for 

*Actual result:*

500 status code received

# processorType

!image-20230831-175411.png|width=1618,height=938!

2. name

!image-20230831-175924.png|width=1602,height=930!",,S4,110,,,1
Error on migration execution,OBN1-13398,Bug,Done,P4,,8/28/2023 9:29,,OBN 1.40,,,,,"For now, on executing every command in console the next issue is showed

!image-20230828-082811.png|width=1611,height=230!",,S1,97,,,1
"Incorrect parameter name for ""bankAccount.bankProofPath"" parameter in request body for external onboarding of canadian merchant",OBN1-13397,Bug,Done,P4,,8/27/2023 12:39,,OBN 1.40,,,,,"*Expected result:*

The “bankProofPath” parameter exists in “bankAccount” section

*Actual result:*

Name of the parameter is “{{residentialAddressProofPath}}"" 

!image-20230827-114345.png|width=2109,height=1259!

Note:

“bankProofPath” is not saved in “payment_accounts” when account is created",,S4,97,,,1
"""DEFAULT"" referrer billing plan is updated when Operator user updated the Billing Plan of a merchant with ""DEFAULT"" billing plan",OBN1-13341,Bug,Done,P4,,8/25/2023 7:03,,OBN 1.40,,,,,"*Preconditions:*

# Referrer exists in “payment_referrer” table
# “ACTIVE” merchant exists for referrer in “payment_merchants” table
# Merchant uses “DEFAULT” referrer billing plan (no “CUSTOM” referrer billing plan is created for the merchant in “payment_referrer_billing_plan” table)

*Steps to reproduce:*

# Log in as “RESELLER” with “ROLE_ADMIN” profile
# Navigate to “Merchants” > “Merchants” > “Billing Plan” > “Sales/Refunds” tab
# Click on “Edit” button
# Change some values in Merchant Billing Plan edit form
# Click “Save” button

*Expected result:*

“Your changes have been saved.” message is displayed. “CUSTOM” referrer billing plan is created for merchant in “payment_referrer_billing_plan” table.
Deductions with updated values for “CUSTOM” referrer billing plan are created in “payment_referrer_deductions” table.
”DEFAULT” referrer billing plan is not affected.

*Actual result:*

“DEFAULT” referrer billing plan is affected which affect all merchants that use “DEFAULT” referrer billing plan.
”CUSTOM” billing plan is not created.",,,96,97,,1
Moneris configs not added to fixtures,OBN1-13340,Bug,Done,P2,,8/25/2023 6:46,,OBN 1.41,,,,,"After the execution of fixtures, there is no data for Moneris config in:

# {{core_settings }}table
# {{payment_currencies}} table",,S4,98,,,1
"""Calculate the Rolling Reserve terms"" WF step has error status for internal application submitted under external referrer",OBN1-13323,Bug,Done,P1 ,,8/24/2023 11:51,,OBN 1.41,Merchants,Onboarding,Workflow,,"*Preconditions:*

* User is logged in UI as a referrer which has API credentials.
* User has created a new merchant application.

*Steps to reproduce:*

# Start an onboarding on behalf of the merchant application.
# Fill all the mandatory fields on all the pages 
# Click On  “Submit” button
# WF started

*Expected result:*

All wf steps are  successfully executed. Commercial offer is generated

*Actual result:*

!image-20230824-110137.png|width=1804,height=1037!



{noformat}[2023-08-24T11:00:29.058702+00:00] app.ERROR: No profit type found for merchant of referrer. Merchant ID = 13, processorType = CARD Trace:  #0 RollingReserveSetter.php:35: App\Service\Workflow\Task\BillingPlanHelper->paramsListIndex(..) #1 RollingReserveSetter.php:24: App\Service\Workflow\Task\RollingReserveSetter->setDateInterval(..) #2 StepRunnerAbstract.php:357: App\Service\Workflow\Task\RollingReserveSetter->execute(..) #3 StepRunnerAbstract.php:347: App\Service\Workflow\StepRunnerAbstract->executeStep(..) #4 MerchantOnboardingHandler.php:16: App\Service\Workflow\StepRunnerAbstract->run(..) #5 HandleMessageMiddleware.php:63: App\MessageHandler\Workflow\StepRunner\MerchantOnboardingHandler->__invoke(..) #6 SendMessageMiddleware.php:74: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->handle(..) #7 RollbackIfExceptionMiddleware.php:33: Symfony\Component\Messenger\Middleware\SendMessageMiddleware->handle(..) #8 DoctrinePingConnectionMiddleware.php:34: App\MessageHandler\Core\RollbackIfExceptionMiddleware->handle(..) #9 AbstractDoctrineMiddleware.php:45: Symfony\Bridge\Doctrine\Messenger\DoctrinePingConnectionMiddleware->handleForManager(..) #10 FailedMessageProcessingMiddleware.php:34: Symfony\Bridge\Doctrine\Messenger\AbstractDoctrineMiddleware->handle(..) [] []
{noformat}",,S1,98,,,2
Wrong type of officer is set when updating data during internal onboarding,OBN1-13220,Bug,Done,P2,,8/18/2023 11:22,,OBN 1.40,,,,,"*Precondition*: application user exists and begin onboarding process (applicant is on “About its Management“ step). 

*Steps to reproduce:*

# Fill in all mandatory data for both managers (for each manager provide unique emails) and click “Next“ button - user is redirected on the “About its Owners“ page
# Two officers are created in the “payment_merchant_officers“ table, both managers have “MANAGER“ type, emails are set from managers
# Fill in all mandatory data for both owners (for each owner provide unique emails) and click “Next“ button - user is redirected on the “About its Payments“ page
# Due to the fact that the First name, Last name and partially DOB for managers and owners are the same, the “1“ is created in the “is_beneficial_owner“ column and value is created for “ownership“ column, the type remain MANAGER
# From “About its Payments“ page click “Previous“ button - user is redirected on the ""About its Owners"" page 
# From “About its Owners"" page click “Previous“ button - user is redirected on the ""About its managers"" page
# Update email for both managers which has not yet been provided on the ""About its managers"" page, click “Next“ button
# Update email for owners which has not yet been provided on the ""About its Owners"" page, click “Next“ button

*Expected result:*

the “1“ is created in the “is_beneficial_owner“ column and value is created for “ownership“ column, the type remain MANAGER

*Actual result:*",,S3,97,,,2
"""Outlet creation workflow section"" is displayed for outlet that was created during ONBOARDING execution",OBN1-13184,Bug,Done,P4,,8/16/2023 11:34,,OBN 1.40,,,,,"*Precondition*: a merchant with “Active“ status exists

*Steps to reproduce:*

# Log in as user with MERCHANT_FULL permissions
# Navigate on “Merchants“ → “Merchants“ and expands the merchant
# Click on “Outlets“ tab
# Expand the outlet

*Expected result:*

""Outlet creation workflow section"" is not displayed

*Actual result:*

""Outlet creation workflow section"" is displayed for outlet

!image-20230816-103949.png|width=1707,height=860!

!image-20230816-104028.png|width=1517,height=447!",,,97,,,1
Error received on offer generation,OBN1-13154,Bug,Done,P2,,8/15/2023 16:14,,OBN 1.39,,,,,[2023-08-15T14:32:09.478182+00:00] app.ERROR: Call to a member function getName() on null Trace:  #0 StepRunnerAbstract.php:369: App\Service\Workflow\StepResultProcessor->processOnFail(..) #1 StepRunnerAbstract.php:342: App\Service\Workflow\StepRunnerAbstract->executeStep(..) #2 MerchantOnboardingHandler.php:16: App\Service\Workflow\StepRunnerAbstract->run(..) #3 HandleMessageMiddleware.php:63: App\MessageHandler\Workflow\StepRunner\MerchantOnboardingHandler->__invoke(..) #4 SendMessageMiddleware.php:74: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware->handle(..) #5 RollbackIfExceptionMiddleware.php:33: Symfony\Component\Messenger\Middleware\SendMessageMiddleware->handle(..) #6 DoctrinePingConnectionMiddleware.php:34: App\MessageHandler\Core\RollbackIfExceptionMiddleware->handle(..) #7 AbstractDoctrineMiddleware.php:45: Symfony\Bridge\Doctrine\Messenger\DoctrinePingConnectionMiddleware->handleForManager(..) #8 FailedMessageProcessingMiddleware.php:34: Symfony\Bridge\Doctrine\Messenger\AbstractDoctrineMiddleware->handle(..) #9 DispatchAfterCurrentBusMiddleware.php:68: Symfony\Component\Messenger\Middleware\FailedMessageProcessingMiddleware->handle(..) #10 RejectRedeliveredMessageMiddleware.php:48: Symfony\Component\Messenger\Middleware\DispatchAfterCurrentBusMiddleware->handle(..) [] [],,S4,96,,,1
"[API-Ext] Only one owner should be saved to database when more than one owner is sent during submitting application details for ""Sole trader"" organization",OBN1-13114,Bug,Done,P4,Done,8/14/2023 14:16,2/20/2024 11:08,OBN 1.53,,,,,"*Steps to reproduce:*

# In request body for “Sole trader“ organization with more than one owner
# Use valid data for all mandatory fields in the body
# Send a “POST” request to “/ext-ref/+*ca*+/merchant-onboarding/{{ExtApplicUuid}}” *or* “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}“  endpoint

*Expected result:*

Only first owner is sent in DB (in “payment_merchant_applications.form_data” column and “payment_merchant_officres” table)

*Actual result:*

All owners are saved in DB",,S4,110,,,2
Operator is logged out if he does not make any actions for more than 15 minutes when creating a referrer,OBN1-13110,Bug,Done,P3,,8/14/2023 10:48,,OBN 1.43,,,,,"*Steps to reproduce:*

# Log in as Operator admin user
# Navigate on “Referrers“ → “Active Referrers“
# Click on the “Create Referrer“ button
# Fill in “Contact details“ and “Account configuration“ steps
# Stay on the “Create billing plan“ page (for example fill in date) 
# Do not send any request for more than 15 minutes

*Expected result:*

User in not log out without notification

*Actual result:*

User is log out without notification. see attached file",,S3,100,,,1
Error on Tasks filtering  page if task doesn't exist,OBN1-13105,Bug,Done,P3,,8/11/2023 14:34,,OBN 1.41,,,,,"*Precondition:* tasks created not today exist

*Steps to reproduce:*

# Log in as Operator user
# Navigate on “Tasks“ page
# In filter section select: “Type=Transfer“, “Requester=a“, “Date=Today“
# Click “Apply“ button

*Expected result:*

“No records“ message displays

*Actual result:*

500 error and infinite loader displays on page

!image-20230811-133427.png|width=1488,height=531!

!image-20230811-133437.png|width=1917,height=897!",,S4,98,,,1
Expired encrypt key value for Bambora ack file,OBN1-13077,Bug,Done,P1 ,,8/10/2023 8:32,,OBN 1.40,,,,,"*Precondition:* active Merchant with payment CARD type exists

*Steps to reproduce:*

# Log in as Operator admin
# Navigate on Merchants → Merchants and expand a merchant
# Select “Outlets“ tab
# Click on “Create outlet“ button
# Fill in all mandatory fields and select “Merchant account for card processing“ checkbox
# Click on “Save“ button

*Expected result:*

Submerchant is created. An enrolment file with data about submerchant was created. Data is encrypted and send to Bambora server. 

*Actual result:*

Submerchant is created. An enrolment file with data about submerchant was created. Data *is not encrypted* and send to Bambora server. 

+The key for the encrypt file is expired -+ +*stage env*+",,S2,97,,,1
Identical merchant ID is returned for Referrer,OBN1-13069,Bug,Done,P2,,8/10/2023 7:22,,OBN 1.43,,,,,"*Precondition:* Referrer has Merchant who passed the “Active merchants“ step 

*Step to reproduce:*

# Log in as Operator user
# Navigate on “Referrers“ and expand a referrer
# Click on “Merchants“ tab
# Check response that is returned in console

*Expected result:*

Each merchant has his own unique ID

*Actual result:*

Every merchant has the same id

!image-20230810-062205.png|width=1893,height=882!",,S4,100,,,1
Merchant's mpa with PENDING status is not synchronized in Cardstream during onboarding,OBN1-13059,Bug,Done,P2,,8/9/2023 7:40,,OBN 1.39,,,,,"*Preconditions:*

# a WF with “Create Merchant records in gateway“ step exists

*Steps to reproduce:*

# Submit merchant details
# WF is triggered and comes to “Create Merchant records in gateway” step  
# “Create Merchant records in gateway” step has completed status
# Merchant has “ONBOARDING“ state and “PENDING“ status
# Request in Cardstream was sent 

*Expected result:*

Merchant and mpa are synchronized in Cardstream.

*Actual result:*

Only merchant is synchronized in Cardstream, mpa has “TO_SYNCHRONIZED“ status

!image-20230809-064000.png|width=1388,height=391!",,S2,96,,,1
Operator can't save new contact on match controllers without editing DOB,OBN1-12993,Bug,Done,P3,,8/2/2023 8:53,,OBN 1.39,,,,,"*Precondition*: an application with unmatched controllers exists

Steps to reproduce:

# Log in as Operator admin user
# Navigate on “Merchants“ > “Open applications“
# Expand the application (with ID 792) and click on the “Manage users“ tab
# In “Controllers“ section click on the “match“ red icon for controller
# In “Match controller“ pop-up click on “create contact“ button
# Do not change the DOB and fill al mandatory fields
# Click “Save“ button

*Expected result:*

Controller is matched, new contact is created 

*Actual result:*

The “This value is not a valid date.“ validation message displays. Contact can’t be created

!image-20230802-075100.png|width=1897,height=881!

For test DB is attached ",,S3,96,,,1
New outlet for active merchant is created without data,OBN1-12991,Bug,Done,P1 ,,8/2/2023 7:47,,OBN 1.38,,,,,"*Precondition*: active merchant exists

*Steps to reproduce:*

# Log in as Operator admin user
# Navigate on “Merchants“ > “Merchants“ page and expand a merchant
# Click on the “Outlets“ tab
# Click on the “Create outlet” button
# Fill all mandatory fields and click “Save“ button

*Expected result:*

# ""Outlet creation"" workflow is triggered
# new outlet is created for merchant in the ""payment_merchant_outlets"" table
# the status is ""ACTIVE"" for the outlet in the ""payment_merchant_outlets.status"" column
# new mpa is created for merchant in the ""payment_merchant_processor_accounts"" table
# the status is ""UNREGISTERED"" for the mpa in the ""payment_merchant_processor_accounts.status"" column
# values for the “referrer_billing_plan_id”, “safeguard_reserve_date_interval”, “stlmt_date_interval“ are taken from the existing mpa for the merchant

*Actual result:*

# ""Outlet creation"" workflow is triggered
# new outlet is created for merchant in the ""payment_merchant_outlets"" table
# the status is ""ACTIVE"" for the outlet in the ""payment_merchant_outlets.status"" column
# new mpa is created for merchant in the ""payment_merchant_processor_accounts"" table
# the status is ""UNREGISTERED"" for the mpa in the ""payment_merchant_processor_accounts.status"" column
# *values for the “referrer_billing_plan_id”, “safeguard_reserve_date_interval”, “stlmt_date_interval“* +*are not taken*+ *from the existing mpa for the merchant and the columns are empty*

then user clicks on the active merchant dashboard tab - error displays in the console

!image-20230802-065936.png|width=1903,height=895!

for tests you ca use attached DB

When an outlet is created and any mpa with BP can’t be identified for selected payment type: 

* “_The merchant does not have access to one of the payment services that you’ve tried to activate for this outlet._” error message is returned
* outlet and mpa’s are not created",,S2,95,,,2
[External API doc] Invalid link redirection to API documentation,OBN1-12902,Bug,Done,P2,,7/28/2023 7:41,,OBN 1.38,,,,,"# Follow the link: [https://docs.stage.obnglobal.com/endpoints/merchant-onboarding/#submit-merchant-application|https://docs.stage.obnglobal.com/endpoints/merchant-onboarding/#submit-merchant-application]

*Expected result:*

user is successfully redirected to ‘submit application’ section in Api documentation

*Actual result:*

Displays black page without any information

!image-20230728-063916.png|width=1208,height=974!",,S3,95,,,1
New records are created in DB for updated from Review & Submit Merchant fees ,OBN1-12900,Bug,Done,P4,,7/28/2023 6:48,,OBN 1.38,,,,,"# New records are created in DB for updated from Review & Submit Merchant fees
# No changes are applied in “Merchant Fees” when user changes Payment Services on “About its Payments” page (through Review and submit links) but doesn’t override fees for Payment Service",,S3,95,,,3
"[UI] the incorrect parsing of ""createUser"" field for Applicants",OBN1-12797,Bug,Done,P2,,7/20/2023 13:09,,OBN 1.38,,,,,"User is not able to view in UI or create Applicants due error of parsing response from backend.

*Steps to reproduce*:

# sign-up new application
# log in as applicant
# complete first step
# click on “Next” button
# complete second step
# click on “Next” button

*Expected Result*:

* the third step is displayed

*Actual Result*:

* the user cannot switch to next step",,,95,,,3
[stage] Invalid Commercial offer template for the 1.0 version ,OBN1-12785,Bug,Done,P3,,7/20/2023 7:18,,,,,,,"*Precondition:* a merchant with Active status exists

*Steps to reproduce:*

# Log in as Operator user
# Navigate on “Merchants“ → “Merchants“ page
# Expand a merchant and click on the “Billing plan“ tab 
# Click on the “Agreement“ tab
# Click to download the Commercial offer
# Check the check the downloaded document

*Expected result:*

The first 4 pages in the document are the generated data for the merchant. Pages that contain billing plans are dynamic (it can be one, two or more pages). From page 5 displays the OBN Global Limited Merchant Services Agreement. Terms and conditions file with empty footer, so on the generation of the whole document it will be filled. The same with the header - it should be empty in terms and conditions file, so on the generation it will be added

*Actual result:*

The first 4 pages in the document are the generated data for the merchant. + 4 more pages which do not belong to the merchant and only after that from the 8th page displays the Agreements.

This is due to the fact that version 1.0 template already contains 4 extra pages in AWS. *this is only for dev and stage env!*",,S2,95,,,1
Outlet for an active merchant is created without a category,OBN1-12757,Bug,Done,P3,,7/19/2023 9:15,,OBN 1.38,,,,,"*Precondition:* active merchant exists

*Steps to reproduce:*

# Log in as Operator user
# Navigate on “Merchants“ → “Merchants“ page
#  Expand the merchant
# Click on “Outlets“ tab
# Click “create outlet“ button
# Fill in all mandatory fields
# Click on “Save“ button and “Confirm“ button in the pop-pup
# Check the value in the “{{payment_merchant_outlets.category_id}}"" column

*Expected result:*

the *ECOM/CNP* (id 1) is set for the {{category_id}}"" column

*Actual result:*

NULL value is set for the  {{category_id}}"" column

!image-20230719-081601.png|width=904,height=636!



!image-20230719-081033.png|width=1919,height=529!

!image-20230719-081114.png|width=1911,height=615!

on UI this field and value are hardcoded

!image-20230719-081141.png|width=1592,height=626!

!image-20230719-081156.png|width=1624,height=796!

User can successfully create an outlet via API without category_id

!image-20230719-082234.png|width=1421,height=696!

 

 ",,S3,95,,,1
[PROD] Duplicated transactions are displayed on Activity pages when user has more than 1 profile,OBN1-12737,Bug,Done,P1 ,,7/18/2023 15:50,,OBN 1.38,,,,,"*Preconditions:*

# user exists in “user_users” table
# 2 profiles exists in “user_organization_members” table
1 profile → RESELLER ROLE_ADMIN
# 2 RTP exists in “payment_requests_to_pay” table

*Steps to reproduce:*

# log in with reseller admin profile
username: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
password: [reseller.admin@obn.com|mailto:reseller.admin@obn.com]
# Naviagte to “Activity” > “Sales” page
# Select some options from “Available fields” section

*Expacted result:*

2 Sales are displayed on the page

*Actual result:*

8 Sales are displayed on the page:


!image-20230718-145318.png|width=2046,height=846!",,S3,95,,,2
"CUSTOM BP is created for second referrer's BP when Referrer selects the second referrer BP for ""Billing Plan Type"" drop-down on ""Merchant Fees"" page during onboarding",OBN1-12674,Bug,Done,P4,,7/14/2023 15:04,,,,,,,"*Preconditions:*

# Referrer with 2 PBs for same processor type (CARD/PBBA) exists in “payment_referrers” table
# Referrer create an application
# Referrer completed first 4 steps from onboarding
# User is on “Bank Account for Settlement” page

*Steps to reproduce:*

# User clicks on “Next” button on “Bank Account for Settlement” page
# User selects the second referrer BP  type (second in DB)
# Userd doesn’t change any value
# User submit the application

*Expected result:*

“DEFAULT” BP for select in “Billing Plan Type” drop-down BP type is considered for Commercial offer generation. No “CUSTOM” billing plans are created for referrer

*Actual result:*

“CUSTOM” billing plan is created for referrer",,,93,96,,1
500 status code received on attempt to create a Chargeback for a RTP for deleted MPA,OBN1-12657,Bug,Done,P4,,7/13/2023 10:23,,OBN 1.38,Disputes,,,,"*Preconditions:*

# Processed RTP for an MPA exists in “payment_requests_to_pay” table
# The MPA has “DEACTIVATED” status and a date in “deleted_at” column in “payment_merchant_processor_accounts” table

*Steps to reproduce:*

# Log in as Operator Admin user
# Send a POST request to “/payment/chargeback/transaction/{{RTPuuid}}

*Expected result:*

404 status code is received:

!image-20230713-092713.png|width=677,height=352!

*Actual result:*

500 status code received

!image-20230713-092427.png|width=1509,height=830!",,S4,95,,,2
"Sales/Refunds for not all referrers are returned when user selects ""All"" option after selecting some of referrers in ""Referrer"" drop-down",OBN1-12628,Bug,Done,P4,,7/11/2023 9:42,,OBN 1.37,Activity,UI,,,"*Steps to reproduce:*

# Log in as a user with “ACTIVITY” permissions
# Navigate to “Activity” > “Sales”/”Refunds” page
# Select some referrers from “Referrers” drop-down from “Filters” section
# Select “All” option from “Referrers” drop-down from “Filters” section
# Click “Apply” button

*Expaected result:*

Sales/Refunds for all referrers are returned

*Actual result:*

Only previously selected referrers are sent in request

!image-20230711-084316.png|width=2043,height=955!

!image-20230711-084804.png|width=2047,height=966!",,S4,94,,,1
[Sandbox] Error on Referrer update,OBN1-12624,Bug,Done,P3,,7/10/2023 12:16,,OBN 1.38,,,,,"*Preconditions:*

# Use Sandbox env

*Steps:*

# Log in as operator admin
# Try to update an existing Referrer

*Expected result:*

Referrer is successfully updated

*Actual result:*

Error received

[2023-07-10T10:41:37.843686+00:00] app.ERROR: Invalid URL: scheme is missing in ""/resellers/149"". Did you forget to add ""http(s)://""? >> Trace: #0 HttpClientTrait.php:157: Symfony\Component\HttpClient\CurlHttpClient::resolveUrl(..) #1 CurlHttpClient.php:112: Symfony\Component\HttpClient\CurlHttpClient::prepareRequest(..) #2 CardstreamHttpClient.php:83: Symfony\Component\HttpClient\CurlHttpClient->request(..) #3 CardstreamResellerIdValidator.php:45: App\Service\Payment\Cardstream\CardstreamHttpClient->request(..) #4 CardstreamResellerIdValidator.php:33: App\Validator\Constraints\Payment\Referrer\CardstreamResellerIdValidator->isViolation(..) #5 RecursiveContextualValidator.php:759: App\Validator\Constraints\Payment\Referrer\CardstreamResellerIdValidator->validate(..) #6 RecursiveContextualValidator.php:602: Symfony\Component\Validator\Validator\RecursiveContextualValidator->validateInGroup(..) #7 RecursiveContextualValidator.php:516: Symfony\Component\Validator\Validator\RecursiveContextualValidator->validateGenericNode(..) #8 RecursiveContextualValidator.php:695: Symfony\Component\Validator\Validator\RecursiveContextualValidator->validateClassNode(..) #9 RecursiveContextualValidator.php:470: Symfony\Component\Validator\Validator\RecursiveContextualValidator->stepThroughGroupSequence(..) #10 RecursiveContextualValidator.php:313: Symfony\Component\Validator\Validator\RecursiveContextualValidator->validateClassNode(..) [] []",,,95,,,1
"[UI] No validation error ""Referrer fee"" field in dispute section in edit Commercial offer",OBN1-12614,Bug,Done,P4,,7/10/2023 7:13,,OBN 1.38,,,,,"*Precondition:* 

# application with “IN REVIEW“ status exist
# WF stopped at the “Commercial offer“ phase

Steps to reproduce:

# Log in as Operator admin user
# Navigate to “Merchants“ → “Open applications“ and expand the application
# Click on the “Commercial offer“ tab 
# Click “Edit“ button
# In “Dispute“ section change the value for the the *Referrer fee* > then the value in Total fee field
# Click “Save“ button

*Expected result:* 

Displays validation error (example for the Total fee field: _Invalid value. The Total Fee must be equal to or greater than Scheme Fee + Referrer Fee._

*Actual result:*

Error is not displayed. If user clicks “Cancel“ button and after that he clicks one more time on “edit“ button, error displays

!image-20230710-054811.png|width=1887,height=878!

!image-20230710-060455.png|width=1519,height=645!

PS, same issue on create Referrer

!image-20230710-060618.png|width=1883,height=730!",,,95,,,1
"A merchant applicant, for whom referrer did the onboarding, can't login without commercial offer being signed",OBN1-12612,Bug,Done,P2,,7/7/2023 16:33,,OBN 1.40,,,,,"*Preconditions:*

* There should be a new merchant applicant, for whom the referrer completed the onboarding.

*Steps to reproduce:*

# Log in as an Operator with “MERCHANTS_FULL” permission.
# Go to “Merchants” > “Open Applications”.
# Expand the merchant application from preconditions.
# Click on “Manage Users” tab.
# Click on “Add user” button.
# Complete all the mandatory fields and click on “Save” button.
# Log out.
# Reset the password for merchant application by accessing the link from the received email.
# Try to login as the merchant application.

*Expected result:*

Merchant applicant has the possibility to login and sign the commercial offer.

*Actual result:*

Merchant applicant can’t login.

*Note:* 
Database dump attached, merchant applicant id = 93
_credentials for login:_ 
E-mail: [test@beyonce.com|mailto:test@beyonce.com]
Password: Amdaris12!

-Note 2: User created for the application won’t be able to login until the onboarding is submitted. (Application status becomes “IN REVIEW”).-  An improvement will be raised for this scenario after confirmation from client.",,S2,96,97,,2
mpa MID is sent instead CS merchant eid on Merchant creation in CS,OBN1-12593,Bug,Done,P1 ,,7/6/2023 12:27,,OBN 1.37,,,,,"*Precondition*: alias exists for the Referrer. WF with “Create merchant in Cardstream” step is assigned to the Referrer

*Steps to reproduce:*

# Make onboarding under Referrer
# Submit details
# Check that the “Create merchant in Cardstream” step was successfully triggered and completed
# Check the {{/rest/merchants/{Cardstream Merchant ID}/aliases}} was sent to CS
# Check the request body

*Expected result:*

For the {{{Cardstream Merchant ID}}} the mpa eid is sent 

!image-20230706-114141.png|width=1076,height=586!

*Actual result:*

the mpa MID is send for the {{{Cardstream Merchant ID}}}

!image-20230706-114352.png|width=1079,height=557!

PS also need to check the {{maintenance:cardstream:enrol-mpa}} command",,S3,94,,,1
"[Onboarding] Referrer should not receive error message on ""About its Payments"" page when onboarding merchants from UI",OBN1-12564,Bug,Done,P2,,7/6/2023 9:09,,OBN 1.37,,,,,"*Preconditions:* 

* User is logged in UI as a referrer which has API credentials.
* User has created a new merchant application.

*Steps to reproduce:*

# Start an onboarding on behalf of the merchant application.
# Fill all the mandatory fields on all the pages including “About its Payments” page.
# On the “About its Payments” page, click on “Next” button.
# Notice the error message “No billing plan config with profit type found for merchant of referrer.”

*Expected result:*

The validation should not be applied when calling “/about-its-payments” endpoint, it should be applied only when calling “/ext-ref/merchant-onboarding” endpoint.

*Actual result:*

The validation is applied to the “/about-its-payments” endpoint, referrer can’t go on with onboarding.",,S2,94,,,2
"[UI] The tooltip on ""Merchants"" page does not fit in the page",OBN1-12561,Bug,Done,P4,,7/5/2023 16:11,,OBN 1.37,UI,,,,"*Steps to reproduce:*

# Go to “Merchants” page.
# Expand a merchant.
# Click on “Outlets” tab.
# Click on “Create outlet” button.
# Hover on “Consumer statement descriptor” field.
# Notice the tooltip. 

*Expected result:* 

The tooltip fits properly in the page.

*Actual result:*

The tooltip is cut.

!Screenshot_58.png|width=1141,height=527!",,S4,94,,,1
"The users onboarded before ""Create Users"" implementation cannot be edited in ""merchant underwriting"" phase",OBN1-12556,Bug,Done,P3,,7/5/2023 9:15,,OBN 1.38,,,,,"*Prerequisites:*

* the onboarded application should exist
* the application should not have “createUser” or “withUser” field under Owners(or Managers) fields
* the application should be paused on any “Merchant Underwriting” phase 

*Steps to Reproduce:*

# user log in as Operator (or linked to application Referrer)
# user navigates to “My Merchants > Open Applications” page
# user searches for application from prereq.
# user clicks on “Application data” from “Application Dashboard” tab
# user clicks on “Edit” icon
# user perform some changes (except selecting “Create portal user” checkbox)
# user clicks on “Save” Button

*Expected Result:*

* the changes are saved

The change will be done on backend. Existing applicants are updated to have the missing (new) field.

*Actual Result:*

* the 400 error code appears

!image-20230705-081915.png|width=1515,height=824!",,,91,94,95,3
The users onboarded UI and API have different keys for same value,OBN1-12555,Bug,Done,P3,,7/5/2023 9:05,,OBN 1.38,,,,,"*Prerequisites:*

* the external onboarded application should exist

*Steps to Reproduce:*

# user log in as Operator (or linked to application Referrer)
# user navigates to “My Merchants > Open Applications” page
# user searches for application from prereq.
# user clicks on “Application data” from “Application Dashboard” tab
# user expands “About its Owners” dropdown

*Expected Result:*

* the Owners field is expanded with “Create portal user” field, and right value in it

*Actual Result:*

* the Owners field is expanded with “Create portal user” field, and N/A value in it



!image-20230705-081238.png|width=1442,height=709!",,,91,94,95,1
Application user onboarded using UI logs out after submitting the details,OBN1-12554,Bug,Done,P2,,7/5/2023 7:13,,OBN 1.37,,,,,"# Sig up as application using UI
# Complete all steps in onboarding
# On “Review and Submit“ page click on the “Submit“ button
# Stay on the page and wait until the request to check the status of the applicant is sent

*Expected result:*

{{merchant-onboarding/check-application-status}} is successfully received

*Actual result:*

Applicant is logged out. User token is deleted from the “user_token“ table. User receives a reset password token.

!image-20230705-061209.png|width=1919,height=458!

Attached DB - 

[email@momo.com|mailto:email@momo.com]

Mihailovna_2010",,S2,94,,,1
[Invoices] Issue on invoices generation,OBN1-12482,Bug,Done,P1 ,,7/3/2023 6:57,,OBN 1.37,,,,,"Issue received on production (03.07.2023):

!image-20230703-055822.png|width=1292,height=849!",,,94,,,3
Error received on freeze funds for chargeback from Safeguard account,OBN1-12479,Bug,Done,P1 ,,6/30/2023 15:15,,OBN 1.37,,,,,"*Preconditions:*

# Merchant has a processed RTP
# Merchant has 1000 units in Merchant Clearing account
# Merchant has 15000  safeguarded units in Safeguard account

*Steps to reproduce:*

# Create a Chargeback for merchant’s RTP with total chargeback amount 2000 units (with Stage: Status → Incontestable dispute: Closed: Found against merchant)

*Expected result:*

Chargeback is created. The total of chargeback reserved amount are freezed in Safeguard account. 

*Actual result:* 

Money are not frozen for created Chargeback

[2023-06-30T09:39:08.456268+00:00] app.ERROR: Handling ""App\Message\Payment\ChargebackProcessingMessage"" failed: Insufficient transferring funds(account: 932fd30d-5c69-4f4f-98bb-92a1b0d800af, minor units: 2130850, already in transfer: 0, transferring: -200) Trace: #0 ChargebackSplittingService.php:511: App\Entity\Payment\Account->increaseTransferringMinorUnits(..) #1 PhysicalPaymentService.php:264: App\Service\Payment\Chargeback\ChargebackSplittingService::App\Service\Payment\Chargeback\{closure}(..) #4 PhysicalPaymentService.php:292: App\Doctrine\EntityManager\CustomEntityManager->retryableTransaction(..) #5 PhysicalPaymentService.php:80: App\Service\Payment\PhysicalPaymentService->createPayment(..) #6 PaymentProcessor.php:54: App\Service\Payment\PhysicalPaymentService->transfer(..) #7 ChargebackSplittingService.php:348: App\Service\Payment\PaymentProcessor->process(..) #8 ChargebackSplittingService.php:296: App\Service\Payment\Chargeback\ChargebackSplittingService->sendPaymentWithCustomRef(..) #9 ChargebackSplittingService.php:133: App\Service\Payment\Chargeback\ChargebackSplittingService->sendPayment(..) #10 ChargebackSplittingService.php:79: App\Service\Payment\Chargeback\ChargebackSplittingService->moveAllFees(..) [] []",,S2,94,,,3
[Prod] 2FA exception on production,OBN1-12464,Bug,Done,P1 ,,6/29/2023 13:20,,OBN 1.37,,,,,"Fix the class import:

!image-20230629-122155.png|width=1351,height=545!

To be tested: Any action which requires 2FA confirmation



In {{\App\EventListener\Core\ExceptionListener}} we have to take into the consideration {{use Symfony\Component\Security\Core\Exception\AccessDeniedException;}}.",,,94,,,2
"[Prod] Settlement ""not enough"" funds issue",OBN1-12463,Bug,Done,P1 ,,6/29/2023 13:07,,OBN 1.38,,,,,"*Preconditions:*

# Use production env

*Steps:*

# Run settlement for “*815fee0b-4651-4450-95fa-4f2679ae07ba*“ Merchant

*Actual result:*

!image-20230629-120832.png|width=1263,height=132!

!image-20230703-055609.png|width=1284,height=166!



Investigate why Merchant doesn’t have supposed funds",,,94,95,96,3
"Erorrs received when user approves/declines an ""Update Bank Account"" task",OBN1-12404,Bug,Done,P5,,6/27/2023 9:51,,OBN 1.36,,,,,"!image-20230627-085208.png|width=1180,height=569!",,S4,93,,,1
[UI] The incorrect displaying of Merchant's Float on Referrer page,OBN1-12393,Bug,Done,P4,,6/26/2023 15:33,,OBN 1.36,,,,,"*Steps to Reproduce:*

# log in as Referrer
# navigate to My Organisation > My Billing Plan page
# scroll to Settlement block

*Expected Result*:

* The float field is populated with Merchant’s Float from DB

Actual Result:

* The float field have “N/A” value instead of value from DB





!image-20230626-143312.png|width=393,height=181!",,,93,,,1
[API] User is able to create a referrer with 'csResellerId' populated and 'csUserName' empty,OBN1-12368,Bug,Done,P5,,6/23/2023 7:04,,OBN 1.37,,,,,"*Steps to reproduce:*

# Authenticate as Operator Admin user
# Send a POST request to ‘/user/referrer’ endpoint with following Cardstream information:

!image-20230623-061340.png|width=341,height=93!

*Expected result:* 

errors.csUserName[0].details: “No Cardstream reseller credentials provided for reseller ID.” message is received in response

*Actual result:*

Referrer is successfully created:

!image-20230623-061139.png|width=1489,height=900!",,S4,94,,,1
Invalid response when Referrer sends wrong json body on Merchant onboarding,OBN1-12363,Bug,Done,P4,,6/22/2023 13:04,,OBN 1.36,,,,,"Precondition: external Referrer exists

Steps to reproduce:

# Send a {{/ext-ref/login}} request using Referrer api key and api secret values to get a Referrer token
# Send a {{/ext-ref/merchant-onboarding}} request to initiate a Merchant onboarding and create an application
# Send {{/ext-ref/merchant-onboarding/:applicationUuid}} request with body that is attached (invalid array for the acquirer section)

*Expected result:*

400 Bad request is returned and “Invalid JSON body“ message is returned in response message

*Actual result:*

500 Internal server error is returned

!image-20230622-120256.png|width=1418,height=870!",,S4,93,,,1
"[API] User without ""ACCOUNTS"" permissions has access to ""Manage users"" page",OBN1-12327,Bug,Done,P3,,6/20/2023 15:18,,OBN 1.36,Permissions,Users,,,"*Preconditions:*

# <Type> User profile _without_ “ACCOUNTS” permissions exists in “user_organization_members” table
| Type |
| RESELLER ROLE_STANDARD |
| REFERRER ROLE_STANDARD |
# User logs in 
# User navigates to page:
| RESELLER → My Referrers > Active Referrer |
| RESELLER → My Merchants > Active Merchants > Manage users |
| RESELLER → My Merchants > Open Applications > Manage users |
| REFERRER → My Merchants > Active Merchants > Manage users |
| REFERRER → My Merchants > Open Applications > Manage users |

*Expected result:* 

“Manage users” tab is not displayed for users without “ACCOUNTS” permissions

*Actual result:* 

The “Manage users” tab is displayed for users without “ACCOUNTS” permissions. And user is able to navigate to the page",,S4,93,,,1
Error received on API credentials generation when a user from Referrer's organisation didn't finish authentication process,OBN1-12305,Bug,Done,P4,,6/20/2023 9:56,,OBN 1.35,API,Users,,,"*Steps to reproduce:*

# Log in as Referrer that uses API with credentials:
Email: [reftwo@test2.com|mailto:reftwo@test2.com]
Pass:  Flood15?Voice
# Navigate to “Account Settings” page
# Click on “Generate API secret” button

*Exapected result:* 

API key & API secret is successfully generated. 

*Actual result:*

Error received on generating Api secter because a user form Referrer’s organisation didn’t finish the authentication process:


!image-20230620-090415.png|width=1574,height=244!",,S4,92,,,1
"[UI] User without ""ACCOUNTS"" permissions has access to ""Manage users"" page",OBN1-12303,Bug,Done,P3,,6/20/2023 9:05,,OBN 1.36,Permissions,Users,,,"*Preconditions:*

# <Type> User profile _without_ “ACCOUNTS” permissions exists in “user_organization_members” table
| Type |
| RESELLER ROLE_STANDARD |
| REFERRER ROLE_STANDARD |
# User logs in 
# User navigates to page:
| RESELLER → My Referrers > Active Referrer |
| RESELLER → My Merchants > Active Merchants > Manage users |
| RESELLER → My Merchants > Open Applications > Manage users |
| REFERRER → My Merchants > Active Merchants > Manage users |
| REFERRER → My Merchants > Open Applications > Manage users |

*Expected result:* 

“Manage users” tab is not displayed for users without “ACCOUNTS” permissions

*Actual result:* 

The “Manage users” tab is displayed for users without “ACCOUNTS” permissions. And user is able to navigate to the page",,S4,93,,,1
Duplicated merchant invoices parts are created when the invoice generation command is re-executed,OBN1-12200,Bug,Done,P1 ,,6/15/2023 8:56,,OBN 1.35,,,,,"*Precondition:*

# Merchant invoice exists for the Merchant (as example for the May)
# Merchant invoice part exists for the Merchant (also for the May)

*Steps to reproduce:*

# Run the {{obn:invoices:generate-for-merchants --force}}
# Enter the month of existing invoices (May)

*Expected result:*

Invoices and invoices parts are generated only for those merchants who do not have them

*Actual result:*

Invoices parts are generated again for the Merchant",,S2,92,,,3
Operator can't reject the application ,OBN1-12165,Bug,Done,P1 ,,6/13/2023 13:58,,OBN 1.36,,,,,"*Precondition:* an application with “PENDING“ status exists. a user and profile exists for the application. a token DOESN’T exists for the user.

*Steps to reproduce:*

# Log in as Operator user
# Navigate to “My Merchants“ → “Open applications“
# Expand an application with “IN REVIEW“/ ”IN PROGRESS” status
# Click on “Application status“ tab
# Click “reject application“ button
# Select “Temporary (allow retry after 30 days)“ in drop-down
# Click “Confirm“ button

*Expected result:*

The ""Application rejected by workflow step"" emails to all Operator Admin users' email addresses are sent. Applicant receives a ""Your OBN Global merchant onboarding application"" notification email
And applicant does not displays on the ""Open application"" page anymore
And merchant is deleted from the ""payment_merchants"" table

*Actual result:*

“Unknown error“ error message displays, error in console:

!image-20230613-125701.png|width=1919,height=877!

!image-20230613-125719.png|width=1176,height=817!",,S2,93,,,2
[Prod] Referrer invoice not generated on production,OBN1-12030,Bug,Done,P1 ,,6/2/2023 14:57,,OBN 1.35,,,,,"*Preconditions:*

# Use attached database backup 

*Steps:*

# Generate invoice for May

*Expected result:*

Merchant and Referrer invoice should be generated

*Actual result:*

Merchant invoice is generated.

Referrer invoice ISN’T generated.

[^dump.sql]

",,,92,,,3
[Onboarding] No possibility to select only offer services for merchant details,OBN1-11951,Bug,Done,P4,,6/1/2023 8:55,,OBN 1.35,,,,,"*Steps to reproduce:*

# Initiate an onboarding.
# Complete all the steps with mandatory data.
# On “About its Payments” step, Merchant details section, select “Yes” for “Do you offer services?” and “No” for “Do you offer products/goods?”
# Notice the validation message “Please select either product and/or services”.

*Expected result:*

User is able to select services AND/OR products.

*Actual result:*

User is able to select services AND products or just products.",,S4,92,,,1
Errors received on freezing money for a chargeback when available Safeguard funds (minor units - transferring minor units) < than amount needed for chargeback,OBN1-11886,Bug,Done,P2,,5/29/2023 12:10,,OBN 1.34,Payments,,,,"*Preconditions:*

# payment_merchants.safeguarded_minor_units = 18500 units
# Max dispute fee for the merchant = 18200 units
# Available funds in Safeguard = 18000 units (payment_accounts.minor_units - payment_accounts.transferring_minor_units)

*Steps to reproduce:*

# Log in as Operator
# Navigate to “Activity” tab
# Select a RTP 
# Click on “Create dispute case” button
# Fill witn 1.00 following fields: Dispute amount & Additional compensation amount
# Fill all needed information and create the chargeback

*Expected result:*

The CB is created. Money for CB are freezed.

*Actual result:*

Freezing process is not finished

!image-20230529-111051.png|width=1518,height=772!





Note: 

Changes for Zapp Refunds should be also done (change the error received when not enough money available in Safeguard)",,S2,91,,,2
Wrong entity name for pending approval task (update bank account details),OBN1-11885,Bug,Done,P3,,5/29/2023 10:46,,OBN 1.33,,,,,"*Precondition:* a task with “UPDATE_ACCOUNT“ type exists in the DB

*Steps to reproduce:*

# Log in as Operator 
# Navigate on the “Tasks“ → “Approval page“
# Expand a task

*Expected result:*

Entity name displays as:

# for Merchant:
## business trading name of unincorporated companies;
## company legal name for incorporated companies;
# for Referrer: Referrer name

*Actual result:*

Displays the entity type

!image-20230530-054703.png|width=1896,height=825!

!image-20230530-054839.png|width=1903,height=809!",,S4,91,,,1
"""Create portal user"" checkbox is not present for Owners in Limited liability partnership companies",OBN1-11864,Bug,Done,P4,,5/25/2023 12:33,,OBN 1.35,,,,,"*Preconditions:*

* Sign-up new LLP company
* Confirm creation by email

*Steps to Reproduce:*

# log in as new created applicant
# populate all mandatory fields
# click on “Next” button
# expand any owner from “About its Owners” step

*Expected Result:*

* at the left bottom  corner of opened field is displayed and enabled “Create portal user“ checkbox

*Actual Result:*

* the “Create portal user” field is not presented at the field, each user is automatic not created ",,S4,92,,,1
Invalid user token on submit applicant details on onboarding,OBN1-11856,Bug,Done,P1 ,,5/24/2023 14:38,,OBN 1.34,,,,,"

# Sign up as applicant using UI
# Create a password
# Log in as applicant (new user token is created for the user)
# Fill in all steps on onboarding
# Click “Submit“ button
# Wait some seconds 

*Expected result:*

WF successfully started. {{merchant-onboarding/check-application-status}} is successfully  received

*Actual result:*

Applicant is logged out. User token is deleted from the “user_token“ table

!image-20230524-133700 (4431acf1-682d-4a4f-8a19-8798583f150e).png|width=1830,height=406!

for attached DB credentials for applicant

email: [Borea@Borea.com|mailto:Borea@Borea.com]

password: Mihailovna_2010",,S2,91,,,1
"[External] ""registeredOfficeAddress"" is sent in the request for personal organizations",OBN1-11809,Bug,Done,P5,,5/22/2023 14:00,,OBN 1.34,,,,,"*Preconditions:* External Referrer exists

*Steps to reproduce:*

# Send request to create a merchant entity (initiate merchant onboarding){{ /ext-ref/merchant-onboarding}}
# Sent final request to create a merchant (personal organisation){{ /ext-ref/merchant-onboarding/:applicationUuid}}
# Include in body ""registeredOfficeAddress"" in request for the organisation

*Expected result:*

Error, not allowed to sent ""registeredOfficeAddress"" for personal organisations.

*Actual result:*

Request was successfully sent

!image-20230522-130231.png|width=1511,height=911!",,S4,91,,,1
UI issues during onboarding,OBN1-11798,Bug,Done,P5,,5/22/2023 6:31,,OBN 1.33,,,,,,"*1 case - national insurance number*

# Make sig up as corporate organisation
# Fill in all the required fields at “About the Business“ step
# Click “Next“ button
# On “About its Management” step enter value for the “National insurance number“ for the officer
# Enter values for other mandatory fields on this step
# Click “Next“ button
# Check the value for “National insurance number“ field on “About its Owners“ step (value is present)
# Click “Previous“ button
# Delete value on “About its Management” step for the “National insurance number“ field for the officer
# Click “Next button“
# Check the “National insurance“ value

*Expected result:*

The empty value on “About its Management” step is displayed for the “National insurance number“ field on for officer

*Actual result:*

Displays the value entered previously on “About its Owners“ step



*2 case: Merchant industry*

 1. on “About its Payments” step select industry 

!image-20230522-112324.png|width=25%!

2. Select MCC

!image-20230522-112405.png|width=25%!

3. Enter all mandatory values on step and click “Next“ button

4. Check values on the “Review and Submit“ step - “About its payments“ section

!image-20230522-112612.png|width=1584,height=863!

5. Click on “Previous“ button

6. Change industry

7. Click “Next“ button

8. Check values on the “Review and Submit“ step - “About its payments“ section

*Expected result:*

When user changes the industry and do not selects the MCC - it does not allow him to go to another step. 

*Actual result:*

Displays old selected industry on Review and Submit

*3 case: Company legal name*

# Sign up as an incorporated company.
# Complete the “About the Business” step.
# Click on “Next” button.
# Refresh the page.
# Click on “Previous” button.
# Check the “Company legal name” field.

*Expected result:*

The “Company legal name” field should be filled with the previously inserted data.

*Actual result:*

The data from “Company legal name” field disappears. 



*4 case: Address*

# Sign up as an incorporated company.
# On “About the Business” step fill in the “*Registered office address*“
# Tick checkbox for the “*Trading address*“ - same as registered address
# Click “Next“ button
# Click “Previous“ button
# Change “country“ for the “*Registered office address*“
# Check the “country“ value for the “*Trading address*“

*Expected result:*

“*Trading address*“ value is the same as for the “*Registered office address*“

*Actual result:*

“*Trading address*“ value is not updated",S4,90,,,1
[Validation report] Not all Clearing accounts are included in the Validation report,OBN1-11730,Bug,Done,P3,,5/17/2023 10:14,,OBN 1.34,,,,,"*Preconditions:*

# Have multiple addresses for same account in Starling

*Steps:*

# Generate [validation report|https://cardstream.atlassian.net/browse/OBN1-8409] 

*Expected result:*

ALL the account addresses should be included in the report

*Actual result:*

Only one address is included in the validation report.

On production we see only new Clearing Account, not the old one",,,91,,,1
"No value is displayed for ""Billing Plan"" when transaction is not processed yet",OBN1-11609,Bug,Done,P4,,5/8/2023 10:27,,OBN 1.33,,,,,"*Preconditions:*

# RTP with “PENDING” status exists in “payment_requests_to_pay” table

*Steps to reproduce:*

# Log in as Admin user
# Navigate to “Activity”>”Sales”
# Filter Sales list by “PENDING” status
# Click on a sale transaction
# Check the information displayed in “Transaction details” pop-up

*Expected result:*

“N/A” value is displayed for “Billing plan” field

*Actual result:*

!image-20230508-092904.png|width=794,height=903!",,S4,90,,,1
"Operator admin can't get the ""Bambora application rejection"" pop-up on ""Application status"" - ERROR button",OBN1-11581,Bug,Done,P4,,5/5/2023 9:50,,OBN 1.33,,,,,"*Precondition:* 

# {{Register Merchant with PbBa}} step - was run
# mpa was rejected on Bambora side
# step has “ERROR“ status

*Steps to reproduce:*

# Log in as Operator admin user
# Navigate on the “My merchants“ → “Open application“ → “Application status“ tab
# Expand {{Register Merchant with PbBa}} step
# Click on the “ERROR“ button

*Expected result:*

Request to {{GET /bambora/enrolment/{applicationUuid}}} endpoint is sent. For user displays the ""Bambora application rejection"" pop-up with rejected reason and data

*Actual result:*

The ""Bambora application rejection"" pop-up is not displayed

!image-20230505-084943 (667e150c-c0b3-4201-8393-954cda03969c).png|width=1909,height=926!

Operator admin can successfully get all data not on UI:

!image-20230505-085244.png|width=1387,height=770!

applicant ID - 453

bambora submerchant ID - 7

merchant ID 374",,S4,90,,,2
[Prod] Invoices not generated on production,OBN1-11534,Bug,Done,P1 ,,5/3/2023 13:53,,OBN 1.33,,,,,"*Preconditions:*

# Production env
# An authorised and processed transaction on 2023-04-13 13:19:06

*Steps:*

# First day of 2023-05 month comes
# Invoices generation cronjobs run

*Expected result:*

Referrer and Merchant invoices should have been generated

*Actual result:*

Invoices are not generated

{panel:bgColor=#fffae6}
Warning! Generate missing invoices for April
{panel}",,,90,,,1
"Incorrect redirection to the applicant when Operator clicks on the ""view application"" button on ""Active referrers"" tab",OBN1-11503,Bug,Done,P4,,5/2/2023 14:26,,OBN 1.33,,,,,"*Precondition*: applicant/active merchant exists

# Log in as Operator admin
# Navigate on the “My Referrers“ > “Active referrers“ tab and expand the referrer
# Click the “Open applications“/”Active Merchants” tab
# Click on the “view application“/”view profile” link

*Expected result:*

Operator is redirected to the “My merchants“ > “Open application“/”Active Merchants” tab to the selected user and the applicant/merchant is expanded

*Actual result:*

Operator is redirected to the “Active merchants“ list

[^2023-05-02 16-23-14.mkv]",,S4,90,,,1
"Check-box should not be displayed for ""Load more..."" in ""Filters"" section's fields",OBN1-11452,Bug,Done,P5,,4/27/2023 9:53,,OBN 1.33,,,,,"*Steps to reproduce:*

# Log in
# Navigate to “Activity” > “Sales”/”Refunds” tab
# Select some fields in “Available fields” section
# Clicks on following filed:
Referrer
Merchant
Outlet

*Expected result:*

No Check-box is displayed near “Load more…”

*Actual result:*

!image-20230427-085347.png|width=2037,height=972!",,,87,90,,1
"Selected options are missing in ""Filters"" fields on ""Sales"" & ""Refunds"" tab when selected option is not on first page in the list",OBN1-11451,Bug,Done,P4,,4/27/2023 9:40,,OBN 1.33,,,,,"*Steps to reproduce:*

# Log in
# Navigate to “Activity” > “Sales”/”Refunds” tab
# Select some fields in “Available fields” section
# Enter +<value>+ in +<field>+  from “Filters” section 
# Select +<option>+ from the displayed list
# Delete the entered +<value>+ in +<field>+

*Expected result:*

The selected option is displayed in the field

*Actual result:*

The option dissappears when user erases the entered +<value>+

+Examples:+

+| value | field | option |+
| la       | Referrer | LaFee |
| co      | Merchant | coffeeLatte |
| co      | Outlet | coffeeLatte |",,S4,87,90,,1
"Emails are not sent to users when ""obn:deactivate-inactive-users"" command is run",OBN1-11409,Bug,Done,P4,,4/25/2023 13:58,,OBN 1.31,,,,,,"*Steps to reproduce:*

# User exists in “user_users” table
# ‘user_users.last_login_at’ = today - 120 days
# ‘php bin/console obn:deactivate-inactive-users’ command runs

*Expacted result:*

Email is sent to automatically deactivated user

*Actual result:*

Email is not sent to automatically deactivated user (because there is a check on sending email that doesn’t allow to sent emails to deactivated users)",S4,88,,,1
Emails should not be sent to users when 'obn:notify-inactive-users' runs,OBN1-11407,Bug,Done,P4,,4/25/2023 13:19,,OBN 1.31,,,,,"*Steps to reproduce:*

# {{DEACTIVATE_MERCHANT_EMAILS=1}} in .env
# User exists in “user_users” table
# “user_users.last_login_at” = today - 90 days
# Run “php bin/console obn:notify-inactive-users” command

*Expacted result:*

Any email is NOT sent to users that are inactive for 90 days

*Actual result:*

Email is sent to users that are not active for 90 days",,S4,88,,,1
Errors are not displayed on saving the WF if user do not specify rule/step action ,OBN1-11346,Bug,Done,P4,,4/21/2023 8:41,,OBN 1.33,,,,,"# Log in as Operator admin user
# Navigate on the “My organisation“ → “My workflows“
# Click “Create Workflow“ button and select “from scratch“
#  Fill in all mandatory fields on “Workflow creation“ page
# Click “Next“ button
# Add some phase and steps for phase
# Click “Next“ button
# On “Steps Configuration” step click “Save“ button

*Expected result:*

Phases and steps for which no rule/step action is specified are expanded, validation errors are displayed for fields.

*Actual result:*

User is redirected on “Workflow creating“ page, no errors are displayed on the “Step configuration“ step

!image-20230421-073901.png|width=1911,height=881!",,S4,90,,,1
Error recieved on getting Sales/Refunds,OBN1-11341,Bug,Done,P4,,4/20/2023 20:22,,OBN 1.32,,,,,"*Steps to reproduce:*

# log in 
# navigate to “Activity” > “Sales”/”Refund” page

*Expacted result:*

The “Sale”/”Refund” page is loaded. The list of transactions is displayed

*Actual result:*

{{[2023-04-20T19:26:23.572602+00:00] request.CRITICAL: Uncaught PHP Exception Doctrine\DBAL\Exception\InvalidFieldNameException: ""An exception occurred while executing '    SELECT COUNT(*) AS totalItems FROM (    SELECT          t.uuid,         t.created_at AS createdAt,         pruo.business_trading_name AS referrerOrganizationName,         pmuo.business_trading_name AS merchantOrganizationName,         pt.name as processorType,         pmo.name AS outletName,         t.state_id AS paymentStatus     FROM payment_requests_to_refund AS t         INNER JOIN payment_merchant_processor_accounts AS pmpa ON t.merchant_processor_account_id = pmpa.id AND pmpa.deleted_at IS NULL     INNER JOIN payment_merchants AS pm ON pmpa.merchant_id = pm.id     INNER JOIN user_organizations AS pmuo ON pm.organization_id = pmuo.id     LEFT JOIN payment_referrers AS pr ON pm.referrer_id = pr.id     LEFT JOIN user_organizations AS pruo ON pr.organization_id = pruo.id     INNER JOIN payment_acquirers AS acq ON pmpa.acquirer_id = acq.id     INNER JOIN payment_processor_types AS pt ON acq.processor_type_id = pt.id     INNER JOIN payment_merchant_outlets AS pmo ON pmpa.merchant_outlet_id = pmo.id AND pmo.deleted_at IS NULL     INNER JOIN payment_requests_to_pay AS prtp ON t.request_to_pay_id = prtp.id    ,     (         SELECT             uu.id AS current_user_id,             uorg.organization_type_name AS current_user_organization_type         FROM user_users uu         INNER JOIN user_organizations uorg ON uu.organization_id = uorg.id         WHERE uu.id = ?     ) AS userWithOrganisationTypeName     WHERE         1 = 1 UNION ALL     SELECT          t.uuid,         t.created_at AS createdAt,         pruo.business_trading_name AS referrerOrganizationName,         pmuo.business_trading_name AS merchantOrganizationName,         pt.name as processorType,         pmo.name AS outletName,         t.state_id AS paymentStatus     FROM (         SELECT             pcb.uuid,             dispute_refund_created_at AS created_at,             dispute_refund_updated_at AS updated_at,             merchant_processor_account_id,             payment_reference,             acquirer_reference,             total_fee_deducted_amount,             scheme_fee_deducted_amount,             referrer_fee_deducted_amount,             settled_amount,             settled_additional_compensation,             dispute_refund_status_id AS state_id,             processed_at,             unsettled_units,             dispute_refund_settled_at AS settled_at,             request_to_pay_id         FROM             payment_chargebacks AS pcb         WHERE             dispute_refund_status_id IS NOT NULL     ) AS t         INNER JOIN payment_merchant_processor_accounts AS pmpa ON t.merchant_processor_account_id = pmpa.id AND pmpa.deleted_at IS NULL     INNER JOIN payment_merchants AS pm ON pmpa.merchant_id = pm.id     INNER JOIN user_organizations AS pmuo ON pm.organization_id = pmuo.id     LEFT JOIN payment_referrers AS pr ON pm.referrer_id = pr.id     LEFT JOIN user_organizations AS pruo ON pr.organization_id = pruo.id     INNER JOIN payment_acquirers AS acq ON pmpa.acquirer_id = acq.id     INNER JOIN payment_processor_types AS pt ON acq.processor_type_id = pt.id     INNER JOIN payment_merchant_outlets AS pmo ON pmpa.merchant_outlet_id = pmo.id AND pmo.deleted_at IS NULL     INNER JOIN payment_requests_to_pay AS prtp ON t.request_to_pay_id = prtp.id    ,     (         SELECT             uu.id AS current_user_id,             uorg.organization_type_name AS current_user_organization_type         FROM user_users uu         INNER JOIN user_organizations uorg ON uu.organization_id = uorg.id         WHERE uu.id = ?     ) AS userWithOrganisationTypeName     WHERE         1 = 1) as t' with params [30, 30]:  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uu.organization_id' in 'on clause'"" at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/AbstractMySQLDriver.php line 79 {""exception"":""[object] (Doctrine\\DBAL\\Exception\\InvalidFieldNameException(code: 0): An exception occurred while executing '    SELECT COUNT(*) AS totalItems FROM (    SELECT \n        t.uuid,\n        t.created_at AS createdAt,\n        pruo.business_trading_name AS referrerOrganizationName,\n        pmuo.business_trading_name AS merchantOrganizationName,\n        pt.name as processorType,\n        pmo.name AS outletName,\n        t.state_id AS paymentStatus\n    FROM payment_requests_to_refund AS t\n        INNER JOIN payment_merchant_processor_accounts AS pmpa ON t.merchant_processor_account_id = pmpa.id AND pmpa.deleted_at IS NULL\n    INNER JOIN payment_merchants AS pm ON pmpa.merchant_id = pm.id\n    INNER JOIN user_organizations AS pmuo ON pm.organization_id = pmuo.id\n    LEFT JOIN payment_referrers AS pr ON pm.referrer_id = pr.id\n    LEFT JOIN user_organizations AS pruo ON pr.organization_id = pruo.id\n    INNER JOIN payment_acquirers AS acq ON pmpa.acquirer_id = acq.id\n    INNER JOIN payment_processor_types AS pt ON acq.processor_type_id = pt.id\n    INNER JOIN payment_merchant_outlets AS pmo ON pmpa.merchant_outlet_id = pmo.id AND pmo.deleted_at IS NULL\n    INNER JOIN payment_requests_to_pay AS prtp ON t.request_to_pay_id = prtp.id    ,     (\n        SELECT\n            uu.id AS current_user_id,\n            uorg.organization_type_name AS current_user_organization_type\n        FROM user_users uu\n        INNER JOIN user_organizations uorg ON uu.organization_id = uorg.id\n        WHERE uu.id = ?\n    ) AS userWithOrganisationTypeName\n    WHERE\n        1 = 1\nUNION ALL\n    SELECT \n        t.uuid,\n        t.created_at AS createdAt,\n        pruo.business_trading_name AS referrerOrganizationName,\n        pmuo.business_trading_name AS merchantOrganizationName,\n        pt.name as processorType,\n        pmo.name AS outletName,\n        t.state_id AS paymentStatus\n    FROM (\n        SELECT\n            pcb.uuid,\n            dispute_refund_created_at AS created_at,\n            dispute_refund_updated_at AS updated_at,\n            merchant_processor_account_id,\n            payment_reference,\n            acquirer_reference,\n            total_fee_deducted_amount,\n            scheme_fee_deducted_amount,\n            referrer_fee_deducted_amount,\n            settled_amount,\n            settled_additional_compensation,\n            dispute_refund_status_id AS state_id,\n            processed_at,\n            unsettled_units,\n            dispute_refund_settled_at AS settled_at,\n            request_to_pay_id\n        FROM\n            payment_chargebacks AS pcb\n        WHERE\n            dispute_refund_status_id IS NOT NULL\n    ) AS t\n        INNER JOIN payment_merchant_processor_accounts AS pmpa ON t.merchant_processor_account_id = pmpa.id AND pmpa.deleted_at IS NULL\n    INNER JOIN payment_merchants AS pm ON pmpa.merchant_id = pm.id\n    INNER JOIN user_organizations AS pmuo ON pm.organization_id = pmuo.id\n    LEFT JOIN payment_referrers AS pr ON pm.referrer_id = pr.id\n    LEFT JOIN user_organizations AS pruo ON pr.organization_id = pruo.id\n    INNER JOIN payment_acquirers AS acq ON pmpa.acquirer_id = acq.id\n    INNER JOIN payment_processor_types AS pt ON acq.processor_type_id = pt.id\n    INNER JOIN payment_merchant_outlets AS pmo ON pmpa.merchant_outlet_id = pmo.id AND pmo.deleted_at IS NULL\n    INNER JOIN payment_requests_to_pay AS prtp ON t.request_to_pay_id = prtp.id    ,     (\n        SELECT\n            uu.id AS current_user_id,\n            uorg.organization_type_name AS current_user_organization_type\n        FROM user_users uu\n        INNER JOIN user_organizations uorg ON uu.organization_id = uorg.id\n        WHERE uu.id = ?\n    ) AS userWithOrganisationTypeName\n    WHERE\n        1 = 1) as t' with params [30, 30]:\n\nSQLSTATE[42S22]: Column not found: 1054 Unknown column 'uu.organization_id' in 'on clause' at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/AbstractMySQLDriver.php:79)\n[previous exception] [object] (Doctrine\\DBAL\\Driver\\PDO\\Exception(code: 42S22): SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uu.organization_id' in 'on clause' at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDO/Exception.php:18)\n[previous exception] [object] (PDOException(code: 42S22): SQLSTATE[42S22]: Column not found: 1054 Unknown column 'uu.organization_id' in 'on clause' at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php:112)""} []}}

!image-20230420-192723.png|width=2039,height=1009!

*Note: the bug appeared because* [https://cardstream.atlassian.net/browse/OBN1-10503|https://cardstream.atlassian.net/browse/OBN1-10503|smart-link] *was deployed on ‘develop’.* 
*”organisation_id” column is not in “user_users” table now. it is “user_organization_members” table*",,,87,88,89,2
500 error when applicant signs an commercial offer before it's ready,OBN1-11286,Bug,Done,P4,,4/18/2023 13:05,,OBN 1.32,,,,,"*Precondition:* 

# An external Referrer exists
# A WF with “Commercial offer“ phase exists for the Referrer

!image-20230419-105332.png|width=897,height=457!

# Send request to initiate Merchant onboarding
# Send request to submit Merchant’s details
# Check that “Commercial offer“ phase has not runs yet

!image-20230419-105628.png|width=1661,height=654!

4. Send request for offer response

*Expected result:*

403Forbidden {{""You are not allowed to access this endpoint.""}} (_need to clarify with BA the response_)

!image-20230419-110730.png|width=712,height=227!



*Actual result:*

500 server error is returned

!image-20230419-110143.png|width=1501,height=885!

!image-20230419-110216.png|width=1438,height=380!",,,89,,,1
Already resumed application WF is saved in audit for user who tries to resume it after,OBN1-11266,Bug,Done,P4,,4/14/2023 13:40,,OBN 1.32,Workflow,,,,"*Preconditions:*

# WF exists in “workflow_workflows” table
# The WF is paused
# Paused applications by the WF exists in “payment_merchant_applications” table

*Steps to reproduce:*

# Operator Admin A user logs in
# User A navigates to “My Organisation”>”My Workflows” page
# User A clicks on “Resume” toggle for paused WF
# User A selects “Resume selected” option
# User A selects  an paused application
# User B (in the meantime) resumes the selected by User A paused applications
# Resumed Applications WF stoped on a step (with status “MANUAL” or “IN PROGRESS”)
# User A clicks on “Continue” button
# Application workflows are rrsumed

*Expected result:*

For user B in user_audit is recorded the uuid of the resumed application workflow

For user A in user_audit is recorded the uuids of the applications workflow, except the one already resumed by user B.

*Actual result:*

For user B in user_audit is recorded the uuid of the resumed application workflow

For user A in user_audit is recorded the uuids of the applications workflow, including the one already resumed by user B.",,S4,89,,,1
Transfer is displayed duplicated for the Referrer,OBN1-11261,Bug,Done,P3,,4/14/2023 7:44,,OBN 1.31,,,,,"*Precondition*:

There is a transfer for the Referrer in the {{payment_transfers}} table

# Log in as a Referrer
# Navigate on the “Activate“ → “Transfers“ tab
# Check the result

!image-20230414-064306.png|width=1162,height=770!



*Expected result:*

Displays only one transfer

*Actual result:*

Displays 19 transfers duplicated

!image-20230414-064413.png|width=1477,height=699!",,,88,,,1
[Prod] Generate referrer invoice when there are no merchant invoices,OBN1-11185,Bug,Done,P1 ,,4/7/2023 15:18,,OBN 1.31,Invoices,Prod,Referrers,Settlement,"*Rreconditions:*

# Referrer(id=1) has a settlement in the past month
# No payments (sale, refund, chargebacks, adjustments…) were processed in the past month for any merchant

*Steps to reproduce:*

# Generate invoices {{obn:invoices:generate-for-merchants --force}}

*Expected result:*

An invoice should be generated for referrer (id=1), no invoices should be generated for any merchant

!image-20230407-143108.png|width=1033,height=189!

*Actual result*

Invoice is not generated neither for referrer nor merchant.

!image-20230407-143305.png|width=767,height=160!

+DB dump is attached+",,,88,,,3
[Prod] Error on update Risk Controls,OBN1-11181,Bug,Done,P1 ,,4/7/2023 8:02,,OBN 1.31,,,,,"*Preconditions:*

# Production environment
# Merchant with id=2 , which has a BP without name (payment_billing_plan)

*Steps:*

# Try to update Merchant’s Risk Controls

*Expected results:*

Risk controls are successfully update.

The validation for BP name should be removed.

Generate and store name for BP with missing name.

*Actual results:*

400 error received

!image-20230407-070833.png|width=608,height=169!",,S2,88,,,1
[Prod] Fix amount issue of remaining/adjustments processing,OBN1-11171,Bug,Done,P2,,4/5/2023 12:26,,OBN 1.30,,,,,"+To do:+

# Fix wrong amounts from {{payment_bambora_remains_adjustments}}, records with ID 1 and 2 
# Re-run the logic using the correct amount

Note: to write a command to adjust values",,,87,,,2
[Prod] Not enough funds to process remaining,OBN1-11170,Bug,Done,P1 ,,4/5/2023 10:03,,OBN 1.29,,,,,"*Steps:*

# New adjustment received in Bambora report

*Expected result:*

The adjustments conversion amount should be correctly performed

*Actual result:*

The conversion amount is wrong. Instead of 14 pence, the logic considers 14 pounds",,,87,,,1
"Officers of the organisation should not be displayed in ""Users"" section on ""Open Applications"" > ""Manage Users"" tab",OBN1-11067,Bug,Done,P4,,3/31/2023 15:26,,OBN 1.32,Users,,,,"*Preconditions:*

# Application exists in “payment_merchant_applications” table
# An user for applicant’s organisation exists in “user_users” table
# Officer of the application exists in “payment_merchant_officers” table
# Officer has null for “payment_merchant_officers.user_id” column and an email in “payment_merchant_officers.email” column

*Steps:*

# Log in as Admin user
# Navigate to “My Merchants” > “ Open Applications” > “Manage users”
# Check the “Users” section

*Expected result:*

Only applicant user(s) (1 applicant user) in displayed in “Users” section

*Actual result:*

The user and the officer of the applicant are displayed in “Users” section

!image-20230331-143933.png|width=1246,height=746!",,S4,89,,,1
Update Xero tenantID command doesn't run automatically ,OBN1-11059,Bug,Done,P5,,3/30/2023 14:40,,OBN 1.32,,,,,"*Preconditions:* this is only reproducible on the stage/local

# Command is added in crontab ({{maintenance:xero:update-tenant-id}})
#  The day when new TenantID was generated comes
# Command was run 

*Expected result:*

new tenantID is generated and set in the “core_settings“ table

*Actual result:*

command was not run ",,,89,,,1
Progress bar is not displayed when upload documents for managers/owners,OBN1-10919,Bug,Done,P5,,3/28/2023 13:41,,OBN 1.33,,,,,"# The user on the page where he needs to download the documents for owner/manager (onboarding, edit controllers, create contact etc.)
# User uploads the document and presses the action button (“Save”, “Next“ button etc.)

*Expected result:*

“Upload is in progress“ message displays under section. User can’t send request or go to the next page.

*Actual result:*

Progress bar is not displayed and validation error displays.

!image-20230328-123753.png|width=1379,height=804!",,,90,,,2
Wrong tab item after row change on pages,OBN1-10846,Bug,Done,P4,,3/23/2023 8:57,,OBN 1.33,,,,,"!bug-merchants.mp4|width=2560,height=1080!",,,90,,,1
No details should be displayed when user unselects all criteria in a Reconciliation section,OBN1-10676,Bug,Done,P5,,3/13/2023 8:42,,OBN 1.30,Reports,UI,,,"*Rreconditions:*

# Merchant exist in “payment_merchants” table
# Reports for the merchant exist in “payment_reports” and “payment_report_parts” tables

*Steps to reproduce:*

# Log in as Admin user
# Navigate to “Reports” page
# Clicks on “See details” link for a section
# Drag all selected grouping criteria from “Selected Rows” to “Unselected Rows” 

*Expected result:*

Any details are not displayed in the section

*Actual result:*

!image-20230313-085001.png|width=1874,height=695!",,S4,87,,,1
Incorrect CB remaining sent to merchant when CB remaining > 0 after reseller debt covering,OBN1-10643,Bug,Done,P2,,3/6/2023 14:09,,OBN 1.28,bambora,chargeback,,,"*Preconditions:*

# debt to OBN = 200
# Debt to referrer = 10

*Steps to reproduce:*

# Positive CB exits in Bambora report. Amount 500
# Run commands: 
php bin/console bambora:import-payments --import-dummy=yes --file={file_path} &&
php bin/console bambora:match:transactions &&
php bin/console bambora:process:refunds &&
php bin/console bambora:process:negative:chargebacks &&
php bin/console bambora:process:remains && 
# Run command: php bin/console bambora:process:positive:chargebacks

*Expected result:*

200 units are sent from OBN Clearing Account to OBN Holding Account

10 units are sent from OBN Clearing Account to OBN Holding Account

+300 units+ are sent from OBN Clearing Account to Merchant Clearing Account

*Actual result:*

200 units are sent from OBN Clearing Account to OBN Holding Account

10 units are sent from OBN Clearing Account to OBN Holding Account

+290 units+ are sent from OBN Clearing Account to Merchant Clearing Account",,S2,85,,,1
"Invalid Merchant ID in ""Notification - Risk Controls update"" email that is sent to operator admin users",OBN1-10608,Bug,Done,P4,,3/2/2023 16:40,,OBN 1.28,,,,,"# Log in as Operator Admin user
# Navigate on ""My Merchants"" > ""Active Merchants"" > ""Billing Plan"" > ""Risk Controls"" sub-tab
# Click on ""Edit"" icon
# Update the ""Risk Control"" information
# Click on ""Save"" button
# Click ""Confirm"" button in confirmation pop-up
# Check the ""Notification - Risk Controls update"" email that is sent to operator admin users

*Expected result:*

For Merchant ID is indicated Merchant UUID

Actual result:

For Merchant ID is indicated Merchant ID

!image-20230302-163937.png|width=1305,height=616!",,S4,85,,,1
"Consider ""transferringMinorUnits"" for Safeguard account",OBN1-10558,Bug,Done,P2,,2/24/2023 13:57,,OBN 1.33,Tech-debt,,,,"Find all places where the following methods are being called

* {{\App\Entity\Payment\Merchant::availableInSafeguard}}
* {{\App\Entity\Payment\Merchant::availableInRollingReserve}}

and make sure their usages are taking into account the field {{payment_accounts.transferring_minor_units}} for the *Safeguard* account.

To specify the scenarios that should be retested by QAs",,,90,,,3
Funds from RR are not used properly for Refund coverage,OBN1-10522,Bug,Done,P1 ,,2/23/2023 7:14,,OBN 1.29,Phase_1b,TimeSensitive,,,"*Preconditions:*

# Active merchant exists in “payment_merchants” table
# Merchant has “100” units in “payment_merchants.safeguard_reserved_minor_units” column
# Merchant has “400” units in Merchant Clearing Account
# A Bambora refund for “500” units comes for the merchant

*Steps to reproduce:*

# Refund is processed (php bin/console bambora:process:refunds)

*Expected result:*

“50” units from Safegusrd are used for the refund →  “payment_merchants.safeguard_reserved_minor_units” column = 50 units

“400” units are taked from Merchant Clearing Account → “payment_accounts.minor_units” column = 0 units

“+50” units are taken from RR → “payment_merchants.debt_to_safeguard_units” column = 50 units+

Refund is processed successfully.

*Actual result:*

“50” units from Safegusrd are used for the refund →  “payment_merchants.safeguard_reserved_minor_units” column = 50 units

“400” units are taked from Merchant Clearing Account → “payment_accounts.minor_units” column = 0 units

+“50” units are taken from OBN → “payment_merchants.debt_to_obn_units” column = 50 units+",,S3,85,86,,5
Settled dispute amount is not considered on settlement for closed dispute,OBN1-10495,Bug,Done,P1 ,,2/21/2023 12:17,,OBN 1.30,Disputes,PBBA,Settlement,,"*Preconditions:*

# RTP exists in “payment_requests_to_pay” table
*unsettled units: 31235* 
# Cargeback created for the RTP in “payment_chargebacks” table:
*dispute total amount: 31655* = 13255 (dispute amount) + 100 (additional compensation) + 18300 (maximum dispute fee)
*available merchant funds: 31555* = 31235 (Merchant Holding) + 320 (Roling Reserve)
*merchant debts: 420* = 320 (debt to RR) + 100 (debt to OBN)
# Chergeback is closed:
*Settled total dispute amount: 16855* = 13255 (settled amount) + 100 (settled additional compensation amount) + 3500 (total dispute fee)
*Unsettled units: 14380* = 14800 (total remaining) - 320 (debts)

*Steps to reproduce:*

# Run “php bin/console obn:settlement:merchant” command

*Expected result:*

Settlement is performed for the merchant. 
*Settlement amount: 14380 units* = 31235 (RTP unsettled units) - (31655 (dispute total amount) - 420 (debt amount)) + 14380 (dispute unsetlled units) 

*Actual result:*

{{[2023-02-21T12:14:23.239234+00:00] app.INFO: 067d5682-3511-4f18-bca1-651c35fcf720 :: Settlement for merchant ""2a32bf56-4f7c-4fc7-8064-82b2632d524b"" was stopped: Available for settlement amount (45615) exceeds available merchant funds (14380). [] []}}

*Settlement amount: 45615 units* = 31235 (RTP unsettled) + 14380 (dispute unsettled)



!image-20230221-125908.png|width=1331,height=560!",,S2,87,,,5
[Prod] Invoices are imported twice in Xero,OBN1-10426,Bug,Done,P2,,2/15/2023 16:23,,OBN 1.27,,,,,"Invoices are imported twice in Xero:


!image-20230215-162513.png|width=1221,height=378!

In the database, invoice still looks like not imported:

!image-20230215-162548.png|width=994,height=67!",,,84,,,3
Incorrect minor units conversion for RTP,OBN1-10422,Bug,Done,P1 ,,2/14/2023 15:05,,OBN 1.26,Phase_1b,TimeSensitive,,,"Recently we had an RTP in production that generated positive value into the field {{payment_requests_to_pay.difference_between_payment}}.

The value posted by *CS* is *""2.01""* (field {{immediateAmount}} from the payload)

The value received from *Starling* and saved into {{payment_payments.minor_units}} is *201*

The value saved into {{payment_requests_to_pay.minor_units}} is *200*

The value saved into {{payment_requests_to_pay.difference_between_payment}} is *1*



We need to:

* Fix the way minor units are converted from _float_ into _int_ (see {{\App\Service\Payment\Zapp\ZappRequestToPayService::buildRtp}})
* Check with client if needed and adjust the DB to reflect the correct amounts (perhaps one off command). Since this is a test transaction I think it’s enough to adjust the balance in OBN clearing account (but still need to confirm with client)
* Not directly related to the above described situation, however it seems like there’s a similar conversion problem on *CS* side that generated the error shown in the attached screen *webhook_postman_err.png*. We need to find a way to treat such errors on webhooks sending.
!webhook_postman_err.png|width=1423,height=817!

+For consistency:+

# Use received units (not minor units) in settlement webhook
# Use received units (not minor units) in the invoices",,,83,84,,3
[Prod] Step repeat issue on production,OBN1-10403,Bug,Done,P2,,2/9/2023 16:01,,OBN 1.25.1,Phase_1b,TimeSensitive,,,"!image-20230209-160505.png|width=1311,height=833!",,,83,,,3
On creating a Referrer without CS ID - the cs_password value is set,OBN1-10379,Bug,Done,P5,,2/9/2023 12:04,,OBN 1.29,,,,,"# Log in as Operator admin user
# Navigate on My referrers → create Referrer
# Fill in all the fields on “Contact Details” step
# On the ""Account Configuration"" do not add a 'Cardstream reseller ID' and fill in all the fields
# Fill in all the fields on “Create billing plan” step
# Click “Save”
# Check the “payments_referrers.cs_password“ column

*Expected result:*

NULL displays for the ‘cs_password’ column

*Actual result:*

‘cs_password’ column is filled with an encrypted value (which means an empty string)

!image-20230209-120343.png|width=1249,height=576!",,,86,,,1
Operator can't update a Merchant with the same existing gateway customer ID,OBN1-10327,Bug,Done,P3,,2/7/2023 13:20,,OBN 1.27,,,,,"*Precondition:* 

# Workflow with “Merchant Underwriting“ phase is on “MANUAL“ status 
# Value for {{payment_merchants.existing_gateway_customer_id}} is set for Merchant

*Steps to reproduce:*

# send a request on {{/merchant/application/{{uuid}}}} endpoint to update Merchant on Underwriting phase 
# in body use the same value for {{""existingGatewayCustomerId""}}
# check the response

*Expected result:*

If the value passes validation - return 200 response and the value doesn't changes

*Actual result:*

Error: {{""Customer ID provided does not match Merchant’s Gateway record.""}}

!image-20230207-131611.png|width=1898,height=905!

*Merchant ID 45*",,,84,,,2
Error on Register Merchant in Zapp,OBN1-10255,Bug,Done,P3,,2/3/2023 8:58,,OBN 1.26,,,,,"*Precondition:* 

# Referrer has assigned the workflow with “Register Merchant with PbBa“ step

*Steps to reproduce:*

# Make onboarding as applicant sub Referrer
# Enter a 20 character *post code* for address
# Submit details
# Workflow triggers and came to “Register Merchant with PbBa“ step

*Expected result:*

Post code truncated to 15 characters and the Merchant is successfully registered in the Zapp 

*Actual result:*

Error on ""Register Merchant with PbBa"" step 

!image-20230203-085550.png|width=1791,height=543!",,,83,,,1
Same Bambora transactions are linked to different Bambora payments,OBN1-10201,Bug,Done,P3,,1/30/2023 7:29,,OBN 1.24.1,bambora,Payments,,,"*Steps:*

# Bambora report is uploaded
# Transactions are matched
# Check “payment_bambora_transactions” table

*Expected result:*

A bambora transaction is linked to one bambora payments

*Actual result:*

A bambora transaction is linked to more bambora payments

!image-20230130-073233.png|width=509,height=171!",,S3,82,,,1
More than one webhook is sent to referrer when AAA is created,OBN1-10197,Bug,Done,P4,,1/26/2023 14:37,,OBN 1.25,,,,,"*Preconditions:*

# Referrer that uses API and accepts AAA exists in “payment_referrers” table
# An active merchant under the referrer exists in “payment_merchants” table

*Steps to reproduce:*

# Create an AAA 
# AAA is processed
# Check the webhooks sent to referrer

*Expected result:*

A webhook is sent to referrer

*Actual result:*

More that one webhook is sent to referrer (8 “{{TRANSFER_STATUS}}"" webhooks are sent)",,S4,82,,,1
[Onboarding] Controllers are not returned in Match controller pop-up,OBN1-10193,Bug,Done,P3,,1/26/2023 12:13,,OBN 1.26,Phase_3,,,,"*Precondition*: 

# “Verify controllers” step failed
# for “payment_merchant_officer_persona“ DOB is NULL

*Steps to reproduce:*

# Log in as Operator admin user
# Navigate on {{My Merchants}} -> {{Open application}} and select Merchant with ID=256
# Click on {{Manage users}}
# Click on “Match” icon in Controllers section

*Expected result:*

Displays Match controllers pop-up with all controllers

*Actual result:*

In pop-up doesn’t displays any information. Error in console and logs. Reproduced on stage

!image-20230126-121413.png|width=1902,height=942!

!image-20230126-121440.png|width=1721,height=707!

!image-20230126-121455.png|width=1768,height=693!

!image-20230126-121520.png|width=944,height=641!",,,83,,,2
Only one card BP with the same billing plan is displayed when Referrer has multiple card BPs,OBN1-10100,Bug,Done,P2,,1/19/2023 10:42,,OBN 1.25,,,,,"*Precondition:*

Referrer has multiple card BPs. For some card the data is identical. (for test user Referrer ID=33)

!image-20230119-103531.png|width=1897,height=780!

!image-20230119-103749.png|width=1667,height=908!

!image-20230119-103811.png|width=1567,height=863!



*Steps to reproduce:*

# Log in as Operator
# Navigate on My Merchants → Active Merchants → Billig plan → Risk controls (for test user ID=345)
# Check Card section

*Expected result:*

All available card BPs displays

*Actual result:*

Only one card with the same billing plan is displayed

!image-20230119-104017.png|width=1889,height=893!

for test use attached DB

PS. Also need to check pages:

* My Referrers → Active referrers → Billing tab (as Operator)
* My Merchants → Active Merchants → Billing plan tab → Risk controls tab (as Referrer)
* My organisation → My billing plan (as Referrer)
* My organisation → My billing plan (as Merchant)",,,82,,,3
"[Prod/EOD] Display ""Bambora pending"" under ""Refunds paid since start of period"" only once",OBN1-10086,Bug,Done,P2,,1/18/2023 13:20,,OBN 1.25,Phase_1b,TimeSensitive,,,"*Preconditions:*

# A pending Bambora report received 2 days ago
# “Bambora pending“ appeared 
# Funds transferred to safeguard account

*Steps:*

# Log in as operator user with “Reports“ permission
# Navigate to Reports page
# Click on see details of “Refunds paid since start of period“

*Expected result:*

“Bambora pending“ SHOULDN’T be displayed under “Refunds paid since start of period“, because it appeared 2 days ago.

It should appear only under “Funds held at start/end of period“

*Actual result:*

“Bambora pending“ repeats under “Refunds paid since start of period“ until settlement report received.",,,82,,,3
Error recieved by user on creating promo pricing with 0 for BPS/fixed Sale/Refund fees,OBN1-10078,Bug,Done,P2,,1/18/2023 8:20,,OBN 1.25,Promotional_pricing,,,,"*Preconditions:*

# Merchant exists in “payment_merchants” table
# Merchant is active
# Sale/Refund fees of the merchant:

!image-20230118-092401.png|width=882,height=304!
!image-20230118-092445.png|width=916,height=292!



*Steps to reproduce:*

# Log in as Operator/Referrer
# Navigate to “My Merchants” > “ Active Merchants” > “Billing Plan” > “Promotional Pricing” tab
# Click on “Create promotion” button
# Change the values > 0 with valid valued
# Click on “Save” button

*Expected result:*

The Promotional pricing is created and displayed in the list

*Actual result:*

Error message is displayed on the page. User is not able to create Promotional pricing plan:

!image-20230118-082010.png|width=1699,height=785!

*Merchant ID - 10, 13*",,S2,82,,,2
[Prod] Not expandable report section,OBN1-10060,Bug,Done,P3,,1/17/2023 7:07,,OBN 1.24,Phase_1b,TimeSensitive,,,"*Preconditions:*

# Merchant with ""Bambora pending""

*Steps:*

# Log in as user with “REPORTS“ permission
# Navigate to “Reports“ page
# Click on “See details“ of “Refunds paid since start of day“

*Expected result:*

Details about “Bambora pending“ should be displayed

*Actual result:*

Request is sent and successful response received.

Details not displayed on UI

!image-20230117-071629.png|width=1849,height=820!",,,81,,,2
Operator can create a discount for Merchant with a processor that does not exist (using API),OBN1-9983,Bug,Done,P4,,1/11/2023 15:12,,OBN 1.25,,,,,"*Precondition:*

Merchant has only {{processor_type = PBBA}} and for Merchant was created a promotional pricing 

*Steps to reproduce:*

# Send a POST request to {{my-merchants/active-merchants/5e6b01ec-ad65-4fb7-9d77-36cddf68ab78/promo-prices}} endpoint to create a new promo
# In request body use {{""processorType"": ""CARD""}}
# Check the response

*Expected result:*

Displays error.

!image-20230111-151231.png|width=707,height=405!



*Actual result:*

new promotional pricing with CARD type was created for Merchant

!image-20230111-151321.png|width=1616,height=612!

!image-20230111-151332.png|width=1322,height=663!

!image-20230111-151615.png|width=1600,height=556!",,,82,,,1
Don't accept/update officers younger than 16 years old,OBN1-9968,Bug,Done,P4,,1/10/2023 10:12,,OBN 1.28,,,,,"Identify all pages where officer can be created/updated with age under 16

+_First case: external onboarding_+

# Initiate onboarding as External Referrer
# Indicate the age for the {{""birthDate""}} of the officer/manager - under 16 years
# Submit details

*Expected result:*

Displays validation error in the response: {{Contact must be at least 16 years of age}}

*Actual result:*

 Details has been successfully sent and saved



+_Second case: Match controllers pop up → Create contact_+

*Precondition*: WF with “Verify controllers“ exists

# Submit applicant details
# Log in as Operator
# Navigate on My Merchants → Open applications → Manage users
# Click on “Match“ icon
# Click on “Create contact “
# Enter DOB < 16 years
# Click “Save“

*Expected result:*

Displays validation error: {{Contact must be at least 16 years of age}}

*Actual result:*

Error in console

!image-20230220-140255.png|width=1460,height=669!",,,85,,,2
"[Prod] Doubled value for ""Funds settled since start of day""",OBN1-9920,Bug,Done,P1 ,,1/4/2023 9:41,,OBN 1.23,Phase_1b,TimeSensitive,,,"*Preconditions:*

# Merchant with multiple mpas
# Merchant with settlement 
# Use database


[^dump.sql]



*Steps:*

# Log in as operator with Reports permission
# Navigate to Reports page
# Select 02/01/2023 - 03/01/23 period
# Click on “*_Funds settled since start of period_*“ o
# Choose “Weimenn Group“ Merchant

*Expected result:*

Based on database information, amount should be 13.83

*Actual result:*

Value is doubled (27.66)



{color:#ff5630}*Warning!*{color} Also values are duplicated for one-off and settlement fee:

!image-20230106-133759.png|width=1592,height=821!",,,81,,,3
[Disputes] Error on Process flow navigation,OBN1-9913,Bug,Done,P3,,1/2/2023 16:20,,,,,,,"*Preconditions:*

# There is an open case
# And Merchant uploaded documents for the dispute

*Steps:*

# Log in as Operator admin ([reseller.admin@obn.com|mailto:reseller.admin@obn.com])
# Go to Dispute Management > Open cases
# Expand the case
# Navigate to Process Flow tab

*Expected result:*

Case process flow should be successfully displayed

*Actual result:*

500 error received {{GET /payment/dispute/{case uuid}/process-flow}}

!image-20230103-081924.png|width=1163,height=322!

[^dump (b4434555-8c42-4fec-bb6b-de837c943596).sql]

",,,83,,,1
[Prod] Error on sending webhook,OBN1-9903,Bug,Done,P2,,1/2/2023 10:51,,OBN 1.23,,,,,"Error received on email:

An Error Occurred! Handling ""App\Message\Webhook\MerchantApplicationStatusChangeMessage"" failed: Argument 2 passed to App\Service\ExternalReferrer\Webhook\Auditor::log() must be of the type array, null given, called in /var/www/api/src/MessageHandler/W...

!image-20230102-121815.png|width=1335,height=868!",,,81,,,1
[Prod] Referrer webhook not accepted,OBN1-9902,Bug,Done,P2,,1/2/2023 10:38,,,Phase_1,TimeSensitive,,,"Error received on email:

!image-20230102-105004.png|width=1313,height=457!

!image-20230102-105042.png|width=1300,height=706!",,,80,81,,1
"No ""processed_at"" column for the payment_transfers table",OBN1-9826,Bug,Done,P4,,12/21/2022 10:08,,OBN 1.23,,,,,,"# Make an adjustment transfer
# Check payment_transfer table

*Expected result:*

""processed_at"" column for the payment_transfer table is presenting

*Actual result:*

No ""processed_at"" column for the payment_transfer table

!image-20221221-100628.png|width=688,height=793!",,80,,,1
"Address parser service detects country, but it isn't stored in DB",OBN1-9819,Bug,Done,P4,,12/20/2022 12:50,,OBN 1.27,,,,,"*Precondition:* for UI referrer WF is assigned with “Know your client - Pre/post activation “ phase with case creation steps

# Sig-up as LC company
# In onboarding select a company (use as example: *NEWMAN PROPERTY SERVICE'S LTD*)
# Submit details
# Wait when Kompli step runs
# Check business officer_persona address

*Expected result:*

for country is set country code

*Actual result:*

country isn’t stored in DB

!image-20221220-131407.png|width=1242,height=249!

!image-20221220-131608.png|width=1609,height=575!

PS - also need to fix the same behavior for street field

!image-20221221-120923.png|width=1106,height=184!",,,80,,,2
Incorrect display of data related to permissions,OBN1-9805,Bug,Done,P4,,12/19/2022 7:08,,OBN 1.23,,,,,"+*Case 1:*+

# Log in as Operator with following permissions :
 | Referrer_RO, BILLING_FULL |
 | Referrer_FULL, BILLING_RO |
 | Referrer_FULL, BILLING_FULL |
# Navigate to My Referrers > Active Referrers 
# Expand Referrers details
# Validate ""Configuration"" section 

*Expected result*: Bank Account name should be reflected within portal under ""Bank details:"" field.

*Actual result:* Bank Account name is not reflected within portal under ""Bank details:"" field.

From backend details are returned, but on UI they are not displayed. 

!image-20221219-063646.png|width=1622,height=701!

+*Case 2:*+

# Log in as Operator with following permissions
 | MERCHANTS_RO, BILLING_RO |
 | MERCHANTS_FULL, BILLING_RO|
 | MERCHANTS_FULL, BILLING_FULL |
# Navigate to My Referrers > Active Referrers 
# Expand Referrers details
# Validate ""Configuration"" section 

*Expected result:*

Bank Account should be displayed

*Actual result:*

From backend details are returned, but on UI they are not displayed. 

!image-20221219-070833.png|width=1840,height=698!



+*Case 3:*+

# Log in as Operator with MERCHANTS_RO, BILLING_RO permissions
# Navigate to My merchants > Open applications > Manage users

*Expected result:*

Operator with Merchant_ro permissions shouldn't be able to activate/deactivate/delete users

*Actual result:*

!image-20221219-070847.png|width=1623,height=693!



+*Case 4:*+

# Log in as Operator with MERCHANTS_RO, BILLING_RO (Referrer with MERCHANTS_RO, BILLING_RO) permissions
# Navigate on Billing > Referrer Invoices

*Expected result:*

!image-20221219-132231.png|width=562,height=229!

*Actual result:*

Operator user with permissions BILLING_RO can download CSV invoices",,,80,,,1
Operator can save a PSC with DOB under 16 years old,OBN1-9789,Bug,Done,P4,,12/16/2022 12:25,,OBN 1.24,,,,,"*Precondition:* WF has stopped at the Upload documents step/ Edit controllers step

# Log as Operator
# Navigate on {{My Merchants}} -> {{Open application}}
# Expand applicant and click on {{Application status}} tab
# Click {{Upload documents/Edit controllers}} button
# Enter a DOB of a PSC under 16 years old
# Click {{Save}}

*P.S.* - also for edit of the DOB during Merchant Underwriting of external application

*Expected result:*

Displays validation error: {{Contact must be at least 16 years of age}}

*Actual result:*

The PSC and DOB are successfully saved 

!image-20221216-121836.png|width=1901,height=330!

!image-20221216-121851.png|width=1895,height=342!

!image-20221216-122027.png|width=1352,height=434!

For test use DB:

* edit controllers - ID 379
* upload documents - ID 377",,,80,81,,1
Login form placeholders overlap with saved credentials,OBN1-9754,Bug,Done,P3,,12/14/2022 7:38,,OBN 1.23,Login,UI,,,"# Authenticate to the portal with <username> and <password>
# Save credentials within browser
# Close browser instance.
# Open same browser instance and navigate to portal

*Expected result:* Login form is populated with saved credentials and these are clearly visible

*Actual result:* Placeholders overlap with credentials within login form, see attached screenshot.",,,80,,,1
Commercial offer tab displays for Referrer user without BILLING_FULL permissions,OBN1-9736,Bug,Done,P4,,12/12/2022 8:42,,OBN 1.22,,,,,"*Precondition:* REFERRER has ROLE_STANDARD and permissions [""MERCHANTS_RO"", ""MERCHANTS_FULL"", ""OUTLETS_RO"", ""OUTLETS_FULL""]

# Log in as Referrer 
# Navigate on {{My Merchants}} -> {{Open applications}}
# Check {{Commercial offer}} tab

*Expected result:*

{{Commercial offer}} tab isn’t displayed for Referrer

*Actual result:*

{{Commercial offer}} tab displays for Referrer 

!image-20221212-084024.png|width=1913,height=809!

For test use DB. Referrer data: [referrer@gmail.com|mailto:referrer@gmail.com]/Mihailovna_2010",,,79,,,1
"""Unknow error"" on updating Referrer (referrer display name)",OBN1-9645,Bug,Done,P1 ,,12/6/2022 8:22,,OBN 1.21,,,,,"# Log in as Operator
# Navigate on My Referrers 
# Select a Referrer
# Click to edit 
# click on checkbox “Enable referrer to make debit/credit adjustments to Merchant accounts“
# enter “Referrer display name“
# Click “Save and close“

*Expected result:*

name is saved in “payment_referrer.display_name“. no errors. 

*Actual result:*

Unknown error.

you can check this on stage env with Referrer ID=10

!image-20221206-081757.png|width=1913,height=972!",,,78,,,1
“Edit Controllers“ button is displayed for operator admin when “Verify identity - document check“ step is on “COMPLETED“,OBN1-9622,Bug,Done,P2,,12/2/2022 13:47,,OBN 1.21,,,,,"# PSC doesn’t uploaded documents during onboarding
# WF with “Verify identity - document check (Corporate)“ exists and is assigned to Referrer
# Applicant submitted onboarding
# “Verify identity - document check (Corporate)“ passed successfully
# Log in as Operator to check the application status and “edit controllers“ button

*Expected result:*

“Edit Controllers“ button is displayed for operator admin when “Verify identity - document check“ step is on “Manual“. For “COMPLETED“ status - button isn’t displayed

*Actual result:*

“Edit controllers button“ displays for step with status “COMPLETED“

For test use DB - application ID=32

!image-20221202-134704.png|width=1893,height=817!",,,78,,,1
Wrong link in the email that is sent to Referrer for PSC upload documents,OBN1-9620,Bug,Done,P3,,12/2/2022 12:21,,OBN 1.21,,,,,"# Workflow with ""Know Your Client"" phase exists
# Verify identity - document check step for phase exists
# Referrer that uses API initiates onboarding
# Referrer submits applicant details
# Only one PSCs doesn't have documents uploaded
# Referrer receives email for PSC upload documents
# Check link in the email

*Expected result:*

link structure is: 

and link redirects to the portal page to upload documents for applicant

[+local.obn/my-merchants/open-applications/{{uuid}}/application-status+|http://local.obn/my-merchants/open-applications/e3a3cc41-4ed5-4fa7-a493-bbd2ca16f560/application-status]

*Actual result:*

simple link that redirects to portal

!image-20221202-121817.png|width=1209,height=698!

_PS: for DB check application ID=41 or 42. Need only to confirm offer as Operator._",,,78,,,1
Terms and Conditions in the generated offer look inapropriate,OBN1-9554,Bug,Done,P3,,11/25/2022 9:41,,,,,,,"!image-20221125-094226.png|width=1197,height=735!",,S3,77,,,1
Business persona is not created if there is no DOB from Kompli,OBN1-9496,Bug,Done,P3,,11/18/2022 8:05,,OBN 1.20,,,,,"*Precondition:* officer in Kompli does not have a date of birth

!image-20221118-080546.png|width=1100,height=902!



Use internal/external onboarding

# WF contains “Verify controllers“ step and is assigned to a Referrer
# on onboarding indicate DOB for officer
# submit application
# check {{payment_merchant_officers_personas}} table

*Expected result:*

officer who does not have a DOB in Kompli is created in DB with data - DOB=null (business_type)

*Actual result:*

Business personas are not created if there is no DOB from Kompli",,,77,,,1
Wrong email structure on Start Merchant Audit,OBN1-9371,Bug,Done,P5,,11/11/2022 12:43,,OBN 1.28,,,,,"# Log in as Operator (email:[reseller.admin@obn.com|mailto:reseller.admin@obn.com], password: [reseller.admin@obn.com|mailto:reseller.admin@obn.com])
# Navigate on “My Merchants” → “Active Merchants” page
# Expand a Merchant
# Click on “Review” tab
# Click “Open audit“ to start Merchant audit
# Check email (mailhog)

*Expected result:*

Displays simple text as follow:

Merchant id: {*Merchant uuid}*
Business trading name: *{business name}*

Visit Merchant Audit → link to audit of the Merchant

!image-20230307-064037.png|width=713,height=220!



*Actual result:*

Displays bullet point and bold text, the link is not displayed correctly.

!image-20221111-124309.png|width=1561,height=776!",,,85,,,1
Operator can't add another partner on edit Merchant Underwriting phase,OBN1-9285,Bug,Done,P4,,11/4/2022 10:33,,OBN 1.18,,,,,"*Precondition*: external Referrer exists and initiated onboarding for applicant. WF with Merchant Underwriting step assigned to Referrer.

# Use dump DB
# Log in as Operator
# Go on My Merchants → Open application
# Search applicant ID=332
# Click application data in dashboard
# Click edit sign
# Expand Owners and click + sign to add new partner
# Fill all field with valid data
# Click “Save and close“

*Expected result:*

New partner added

*Actual result:*

displays error message: ""Operation not allowed""

!image-20221104-103535.png|width=1893,height=873!",,,76,,,1
Two identical Owners are displayed on edit Merchant Underwriting phase,OBN1-9284,Bug,Done,P2,,11/4/2022 10:30,,OBN 1.18,,,,,"*Precondition:* external referrer exists. Merchant underwriting phase assigned to Referrer. Referrer initiated onboarding for applicant

# Use dump DB
# Log in as Operator
# Go to My Merchants → Open application
# Search applicant ID=331
# Expand applicant and select “application data“
# Click edit sign
# Expand Owners

*Expected result:*

Two owners are displayed indicated during onboarding

*Actual result:*

The same owner twice displays and all related to him data.

!image-20221104-102709.png|width=1913,height=889!",,,76,,,1
"'N/A' displayed for all 'Country' fields on ""Application Data"" pop-up & ""Application Dashboard/Merchant Dashboard"" pages",OBN1-9257,Bug,Done,P4,,11/3/2022 13:23,,OBN 1.18,,,,,"*Preconditions:*

# A merchant onboarded via external api exists in “payment_merchants” table
# An application onboarded via external api  in “payment_merchant_applications” table
# User is logged as Operator Admin user

+*Case 1:*+ *Steps to reproduce:*

# Navigate to “My Merchants” > “Active Merchants” page
# Expand the merchant (ID 11)
# Check the “Contry” information on:
- Merchant Dahboard page - Trading address
- Merchant Dahboard page - Registered office address
- Aplication Data pop-up - About the Business
- Aplication Data pop-up - About its Management
- Aplication Data pop-up - About itsOwners Business
- Aplication Data pop-up - About its Payments

+*Case 2:*+ *Steps to reproduce:*

# Navigate to “My Merchants” > “Open Aplications” page
# Expand the application (ID 16)
# Check the “Contry” information on:
- Application Dahboard page - Trading address
- Application Dahboard page - Registered office address
- Aplication Data pop-up - About the Business
- Aplication Data pop-up - About its Management
- Aplication Data pop-up - About itsOwners Business
- Aplication Data pop-up - About its Payments

*Expected result:*

The country is correclty displayed

“United Kingdom” should be displayed when “GB” was provided as “Country” on external onboarding.

*Actual result:*

“N/A” is displayed for “Country” field

!image-20221103-133625.png|width=1903,height=886!

!image-20221103-133754.png|width=1720,height=900!",,S3,76,,,1
Error received on rejecting application on 2+2 step,OBN1-9239,Bug,Done,P4,,11/3/2022 6:29,,OBN 1.19,,,,,"*Steps:*

# Application exists
# Contacts for the applicant exist in “payment_merchant_officers” table
# Logs releated to 2+2 cases are created in “workflow_merchant_officer_verification_logs” table
# Business personas are matched with contacts
# Reject Apllication

*Expected result:*

The application is rejected. All application officers, business personas, organisations etc are hard deleted from DB.

*Actual result:*

Error received on deleting the application contacts from “payment_merchant_officers” table:

{{[2022-11-03T05:44:53.315231+00:00] request.CRITICAL: Uncaught PHP Exception Doctrine\DBAL\Exception\ForeignKeyConstraintViolationException: ""An exception occurred while executing 'DELETE FROM payment_merchant_officers WHERE organisation_id = 26':  SQLSTATE[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails (obn.workflow_merchant_officer_verification_logs, CONSTRAINT FK_3E88618363319E53 FOREIGN KEY (officer_id) REFERENCES payment_merchant_officers (id))"" at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/AbstractMySQLDriver.php line 68 {""exception"":""[object] (Doctrine\DBAL\Exception\ForeignKeyConstraintViolationException(code: 0): An exception occurred while executing 'DELETE FROM payment_merchant_officers WHERE organisation_id = 26':\n\nSQLSTATE[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails (obn.workflow_merchant_officer_verification_logs, CONSTRAINT FK_3E88618363319E53 FOREIGN KEY (officer_id) REFERENCES payment_merchant_officers (id)) at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/AbstractMySQLDriver.php:68)\n[previous exception] [object] (Doctrine\DBAL\Driver\PDO\Exception(code: 23000): SQLSTATE[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails (obn.workflow_merchant_officer_verification_logs, CONSTRAINT FK_3E88618363319E53 FOREIGN KEY (officer_id) REFERENCES payment_merchant_officers (id)) at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDO/Exception.php:18)\n[previous exception] [object] (PDOException(code: 23000): SQLSTATE[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails (obn.workflow_merchant_officer_verification_logs, CONSTRAINT FK_3E88618363319E53 FOREIGN KEY (officer_id) REFERENCES payment_merchant_officers (id)) at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php:112)""} []}}",,S3,75,76,,1
"The ""Paused application"" counter is not updated when user rejects paused application from ""My Workflow"" page",OBN1-9189,Bug,Done,P4,,10/28/2022 13:52,,OBN 1.22,UI,,,,"*Preconditions:*

# WF exists and it’s paused
# 3 paused applications exists for this WF

*Steps to reproduce:*

# Log in as Operator Admin user
# Navigate to “My Organisation” > “ My Workflows” page
# Clicks on “Resume” toggle button for paused WF
# Select “Reject all” option from pop-up
# Select any Reject option from drop-down
# Click “Confirm” button

*Expected result:*

Pop-up is closed. All 3 paused application of the WF are rejected. the counter for “Paused Applications” for the WF becomes 0.

*Actual result:*

Pop-up is closed. All paused application of the WF are rejected. the counter for “Paused Applications” for the WF  remains 3.

+_Note 1:_+

The counter is updated when user refreshes the page

+_Note 2:_+

The “Resume next” field keeps the value used on last “Resume next___” process until user refreshes the page:


!image-20221028-130224.png|width=442,height=371!",,S4,79,,,1
"500 error received when user sends a request to ""/ext-ref/merchant-onboarding/{{ExtApplicUuid}}' using a uuid of a application with ""REJECTED_TEMPORARY"" status",OBN1-9186,Bug,Done,P3,,10/28/2022 13:35,,OBN 1.19,External,,,,"*Preconditions:*

# Referrer that uses API exists
# Application for the referrer was rejected temporary allowing imediate retry:
- payment_merchant_applications.status: REJECTED_TEMPORARY
- payment_merchant_applications.rejected_until: NULL

*Steps:*

# Sent POST request to “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}” endpoint using uuid of the temporary rejected application

*Expected result:*

200 status code received. Application recond in “payemnt_merchant_applications” is updated. The “payemnt_merchant_applications.status” becomes “IN_REVIEW”

*Actual result:*

500 status code received

!image-20221028-124944.png|width=1639,height=711!",,S3,76,,,1
Error received on reject application when webhook should be sent to the Referrer that uses api,OBN1-9172,Bug,Done,P4,,10/27/2022 15:45,,OBN 1.19,,,,,"*Preconditions:*

# Referrer that uses API exists in “payment_referrers” tabel
# Application is created for the referrer

*Steps:*

# WF is trigerred for the application
# The application is rejected by a Step action

*Expected result:* 

Application is rejected. Webhook is sent to the referrer

*Actual result:*

!image-20221027-144544.png|width=1389,height=725!

{color:#403294}*_Note:_*{color}

{color:#403294}*_For QA, regression to be done for:_*{color}

* {color:#403294}*Manual reject*{color}
* {color:#403294}*Reject webhook*{color}
* {color:#403294}*Automatic reject*{color}",,,75,76,,2
Non-informative error is received when onboarding workflow step is executed for merchant without application,OBN1-9132,Bug,Done,P3,,10/25/2022 15:20,,OBN 1.18,,,,,"!image-20221025-142202.png|width=1436,height=732!

!image-20221025-142227.png|width=1407,height=720!


*Note for QA:*
Webhook is not sent to Referrer that uses API",,S3,75,,,1
"The ""Enable Referrer to make debit/credit adjustments to Merchant accounts"" information for referrer is not updated until user refreshes the page",OBN1-9121,Bug,Done,P5,,10/25/2022 9:14,,OBN 1.33,UI,,,,"*Preconditions:*

# Referrer exists in “payment_referrers” table

*Steps:*

# Log in as Operator Admin user
# Navigate to “My Referrers” > “Active Referrers” page
# Expand a referrer
# Clicks on “Edit” icon for the referrer
# “Enable Referrer to make debit/credit adjustments to Merchant accounts” check-box is unchecked
# Change “Enable Referrer to make debit/credit adjustments to Merchant accounts” and enter a value in “Referrer display name” field
# Click on “Save and Close” button → request with changed information is successfully sent
# Clicks on “Edit” icon again
# Check the “Enable Referrer to make debit/credit adjustments to Merchant accounts” is checked and correct value is displayed in “Referrer display name” field 

*Expected result:*

The “Enable Referrer to make debit/credit adjustments to Merchant accounts” is checked and correct value is displayed in “Referrer display name” field 

*Actual result:*

The “Enable Referrer to make debit/credit adjustments to Merchant accounts” check-box is unchecked until user refreshes the page.",,S4,90,,,1
[Prod] OBN fee is not displayed correctly in Commercial offer ,OBN1-9107,Bug,Done,P1 ,,10/21/2022 16:18,,OBN 1.17.1,,,,,"[^dump.sql]

*Preconditions:*

# Use the attached db dump

*Steps:*

# Navigate to My Merchants > Open applications > Commercial offer

*Expected result:* 

All the details should be displayed correctly

*Actual result:*

OBN fee is displayed with N/A , but its value is 0.35

!image-20221021-151956.png|width=1597,height=585!",,,75,,,0.5
dob_partial column the business persona saves fully DOB,OBN1-9056,Bug,Done,P3,,10/20/2022 7:29,,OBN 1.18,Kompli,,,,"# Workflow with ""Verify Controllers"" step for phase exists
# Workflow is assigned to a Referrer
# Merchant is onboarded under the Referrer
# Workflow is triggered
# Workflow comes to ""Verify Controllers"" step
# A request is sent to Kompli

*Expected result:*

dob_partial column the business persona saves only partial DOB

*Actual result:*

dob_partial column the business persona saves fully DOB

!image-20221020-062914.png|width=1435,height=560!",,,75,,,0.5
Onboarding WF continues even though task OfferDocumentsSetter has an error,OBN1-9040,Bug,Done,P4,,10/19/2022 13:44,,OBN 1.19,Tech-debt,,,,"During the execution of the WF step that runs *OfferDocumentsSetter* task, the Service *\App\Service\User\MerchantOnboarding\CommercialOfferService::generateCommercialOffer*
is catching and logging the exception but not re-throwing it up, hence it makes the WF execute the next step.",,,75,,,0.5
"[PROD] Commercial offer is not shown when user navigates to ""My Merchants"" > ""Open Applications"" > ""Commercial Offer"" page",OBN1-8989,Bug,Done,P1 ,,10/17/2022 6:40,,OBN 1.17,,,,,"*Preconditions:*

# Open Applications exist
# The offer is not generated yet

*Steps to reproduce:*

# Navigate to “My Merchants” > “Open Applications” > “Commercial Offer” page

*Expected result:*

The commerchial offer is displayed

*Actual result:*

Commercial offer is not displayed. Error in browser console received.

!image-20221017-054312.png|width=1918,height=918!



*Note:* 2 endpoints have empty response:


!image-20221017-073513.png|width=1913,height=706!",,S3,75,,,1
"Incorrect Application progress for ""Know Your Client"" phase when ""Verify identity - 2+2"" step is finished but ""Verify identity - document check"" sub step is not finished yet",OBN1-8943,Bug,Done,P5,,10/11/2022 10:05,,OBN 1.18,Onboarding,UI,Workflow,,"*Steps to reproduce:*

# WF with “Know Your Client” phase exists
# “Know Your Client” phase contains “Verify identity - 2+2” step with “Verify identity - document check” sub-step
# The WF is assigned to a Referrer
# An application is created for the Referrer
# The “Verify identity - 2+2” step was fishished with FAIL result
# The “Verify identity - document check” sub step is not finished yet (ERROR/IN PROGRESS status)
# Check the Application progress on “My Merchants” > “Open Applications” > “Application Status” page

*Expected result:*

The “Verify identity - 2+2” step is not considerred as finished until “Verify identity - document check” sub-step is not finished

*Actual result:*

The “Verifi identity - 2+2” step is considerred finished even if “Verify identity - document check” sub-step is not finished yet:


!image-20221011-091613.png|width=1120,height=525!

*Dump:*
*Application ID: 10*",,,75,,,1
Wrong customer and merchant gateway ID value,OBN1-8931,Bug,Done,P3,,10/10/2022 13:12,,OBN 1.17,External,,,,"*Precondition:* external Referrer exists and uses webhook. Referrer initiated onboarding. 

# Applicant signed commercial offer
# Referrer received webhook.

*Expected result:*

{{gatewayCustomerAccountID }} ->  {{payment_merchant_gateway_connections.eid}}

!image-20221010-120800.png|width=1422,height=168!

{{gatewayMerchantAccountID}} → {{payment_mpa_gateway_connections.eid}}

!image-20221010-120940.png|width=1393,height=417!



!image-20221010-120129.png|width=1219,height=691!



*Actual result:*

Wrong {{gatewayMerchantAccountID}} and {{gatewayCustomerAccountID}}

Please, check story [https://cardstream.atlassian.net/browse/OBN1-4816|https://cardstream.atlassian.net/browse/OBN1-4816|smart-link]

{noformat}{
    ""name"": ""MID_REFERENCES"",
    ""data"": {
        ""applicationUuid"": ""c6701080-cddc-4f2d-977f-26c541abb5ba"",
        ""merchantUuid"": ""12a704de-f079-4fec-90cb-a1f969116896"",
        ""gatewayMerchantAccountID"": ""21876"",
        ""gatewayCustomerAccountID"": ""167"",
        ""merchantTradingName"": ""Ploiyure"",
        ""postCode"": ""DA2 8EB"",
        ""city"": ""city""
    }
}{noformat}",,,74,,,3
Applicant can submit details with a status that doesn't accept it,OBN1-8926,Bug,Done,P4,,10/10/2022 11:11,,OBN 1.18,Onboarding,,,,"# Applicant uses UI and is on {{Review and Submit}} step.
# Applicant has {{IN_PROGRESS}} status
# Click {{Submit}}
# Applicant is {{IN_REVIEW}} status
# Click {{replay XHR}} in DevTools to resend submit request (or make one more request using Postman)

!image-20221010-100506.png|width=50%!

!image-20221010-101125.png|width=1380,height=318!

*Expected result:*

Operation not allowed displays. Applicant can’t re-submit his details.

*Actual result:*

Applicant can submit details with a status that doesn't accept it: IN_REVIEW, COMPLETED, REJECTED",,,75,,,1
[Prod] Amount payable field in the Merchant's invoice is not displayed,OBN1-8910,Bug,Done,P3,,10/10/2022 8:54,,OBN 1.17.1,Invoices,,,,"# Merchant exists
# Payments for the Merchant exists in “payment_payment“ table
# Transactions made in previous month exist
# First day of the month comes 
# Invoices are generated

*Expected result:*

displays Amount payable field

!image-20221010-075448.png|width=887,height=739!



*Actual result:*

Amount payable field in the Merchant's invoice is not displayed",,,75,,,1
[Prod] Invoices not imported in Xero,OBN1-8858,Bug,Done,P1 ,,10/3/2022 12:50,,OBN 1.16,Added,R.1.1,,,Investigate why invoices for September weren’t uploaded in Xero,,,74,,,1
"[HOT FIX] ""[OBN Global/RESELLER]"" souldn't be displayed in email subject received emails ",OBN1-8835,Bug,Done,P1 ,,9/30/2022 14:38,,OBN 1.17,,,,,"*Preconditions:*

# User exists
# User is active

*Steps:*

# User accesses the OBN
# User clicks on “Forgot your password?” link
# User enters correct email
# User clicks “Send” button

*Expected result:*

Email with  “Account Notification – Action Required” subject is received by user received

*Actual result:*

!image-20220930-134249.png|width=1109,height=104!





*_Note:  Which emails are affected and should be fixed:_* 
Emails where it appears:

# Account Notification – Reactivated User in your Organisation'
`mail/user/activate-to-admin.html.twig`

# Account Notification – Action Required'
`mail/user/activate-to-user.html.twig`

# API update (A new API secret on reset secret)
`mail/user/referrer-reset-api-secret.html.twig`

# API update (A new API secret)
`mail/user/referrer-generate-api-secret.html.twig`

# Account Warning – Action Required'
`mail/user/inactivity-notification-to-user.html.twig`

# Account Notification – Action Required'
`mail/user/password-retry-limit-exceed-to-user.html.twig`

# Account Notification – Action Required'
`mail/user/reset-init.html.twig`

# Account Notification – Action Required'
`mail/user/forgot-password-to-user.html.twig`",,S4,74,,,0.5
Incorrect value for OBN accounts balance is displayed in Accounts report,OBN1-8816,Bug,Done,P1 ,,9/30/2022 11:32,,OBN 1.16,,,,,"Expected result: 

“payment_accounts.minot_units” is displayed in report for OBN account balance

Actual result: 

“payment_accounts.minor_units” - “payment_accounts.transferring_minor_units” is displayed in report for OBN account balance",,S3,73,,,0.5
"[Prod] Rolling Reserved amount included twice in Reconciliation (also included in ""Merchant Account"" amount)",OBN1-8746,Bug,Done,P1 ,,9/23/2022 11:14,,OBN 1.15,,,,,"!image-20220923-101519.png|width=1177,height=561!

“Rolling Recerve” Amount is included in “Merchant Account” amount",,S3,73,,,1
"Errors received when ""obn:delete-users:expired-pwd-token"" command is run when user with expired token has relations with other tables in DB ",OBN1-8698,Bug,Done,P3,,9/19/2022 12:57,,OBN 1.17.1,,,,,"*Stage logs:*

\[2022-09-19T00:00:04.484423+00:00] console.CRITICAL: Error thrown while running command ""obn:delete-users:expired-pwd-token --env=stage"". Message: ""An exception occurred while executing 'DELETE FROM payment_merchant_applications WHERE id = ?' with params \[94]:  SQLSTATE\[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails ({{obn}}.{{workflow_kompli_cases}}, CONSTRAINT {{FK_485272BE3E030ACD}} FOREIGN KEY ({{application_id}}) REFERENCES {{payment_merchant_applications}} ({{id}}))"" {""exception"":""\[object] (Doctrine\DBAL\Exception\ForeignKeyConstraintViolationException(code: 0): An exception occurred while executing 'DELETE FROM payment_merchant_applications WHERE id = ?' with params \[94]:\n\nSQLSTATE\[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails ({{obn}}.{{workflow_kompli_cases}}, CONSTRAINT {{FK_485272BE3E030ACD}} FOREIGN KEY ({{application_id}}) REFERENCES {{payment_merchant_applications}} ({{id}})) at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/AbstractMySQLDriver.php:68)\n\[previous exception] \[object] (Doctrine\DBAL\Driver\PDO\Exception(code: 23000): SQLSTATE\[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails ({{obn}}.{{workflow_kompli_cases}}, CONSTRAINT {{FK_485272BE3E030ACD}} FOREIGN KEY ({{application_id}}) REFERENCES {{payment_merchant_applications}} ({{id}})) at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDO/Exception.php:18)\n\[previous exception] \[object] (PDOException(code: 23000): SQLSTATE\[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails ({{obn}}.{{workflow_kompli_cases}}, CONSTRAINT {{FK_485272BE3E030ACD}} FOREIGN KEY ({{application_id}}) REFERENCES {{payment_merchant_applications}} ({{id}})) at /var/www/api/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php:112)"",""command"":""obn:delete-users:expired-pwd-token --env=stage"",""message"":""An exception occurred while executing 'DELETE FROM payment_merchant_applications WHERE id = ?' with params \[94]:\n\nSQLSTATE\[23000]: Integrity constraint violation: 1451 Cannot delete or update a parent row: a foreign key constraint fails ({{obn}}.{{workflow_kompli_cases}}, CONSTRAINT {{FK_485272BE3E030ACD}} FOREIGN KEY ({{application_id}}) REFERENCES {{payment_merchant_applications}} ({{id}}))""} \[]



*Expected result:*

if the applicant has some data filled in *payment_merchant_applications.form_data* table during the onboarding - do not delete



+*Note:*+ 

Now, the command tries to delete also referrer users who didn’t finish sign-up process. 


*Expected result:*

Referrer users should not be deleted runnung “obn:delete-users:expired-pwd-token”",,S3,75,,,2
"Information about Application progress is not displayed appropriate for ""Know Your Client"" phase",OBN1-8683,Bug,Done,P4,,9/16/2022 8:09,,OBN 1.17,UI,,,,"# -If the “Document Check” sub-step is trigerred the sub-step should be counted to in progress bar-
# When “Verify identity - document check” has “ERROR” status → “Reattempt” button should be dislayed next to “Verify identity - document check” sub-step

!image-20220916-070957.png|width=1241,height=737!",,S4,74,,,1
"500 error is received when user tries to sent a request to ""/ext-ref/merchant-onboarding/{{ExtApplicUuid}}"" endpoint with 2 officers that have diffrent insurance number, but the same email",OBN1-8674,Bug,Done,P4,,9/14/2022 12:08,,OBN 1.15,,,,,"Org type: LIMITED_COMPANY

*Steps:*

# Use request in attached file (2officers with the same email & different national insurance number)

*Expected result:*

Validation error is displayed.

*Actual result:*

!image-20220914-111215.png|width=1830,height=879!",,,73,,,3
[PROD] The Starling accounts which have 0 balance are not reflected in Daily report (warning errors received in cron),OBN1-8654,Bug,Done,P1 ,,9/12/2022 13:58,,OBN 1.14,,,,,"*Preconditions:*

# Accounts with 0 balance exists in Starling

*Steps:*

# The daily reports are generated

*Expected result:*

All accounts are displayed in the report

*Actual result:*

Accounts with 0 balance in Starling are not present in the report.",,S4,72,,,1
If step 2+2 step is executed - the next step isn't running ,OBN1-8602,Bug,Done,P3,,9/8/2022 13:10,,OBN 1.14,Kompli,,,,"*Precondition:* Applicant has workflow conditions as on Screenshot (for _Know Your Client - Pre-activation -_ one of  step rule actions: {{MANUAL}}/{{WARNING}}/{{REJECT}} )

!image-20220908-120525.png|width=519,height=603!

# Applicant submits his data.
# On Kompli side user FAIL case.

*Expected result:*

Next step is running

*Actual result:*

No step running",,,72,,,0.5
Fix sandbox pipeline,OBN1-8600,Bug,Done,P4,,9/8/2022 10:55,,OBN 1.14,Added,R.1.2,,,Remove DB name alias from migration *\DoctrineMigrations\Version20220816070705*,,,72,,,0.5
500 error received when user does an external onboarding with an mg/owner that has 'national_insurance_number' & 'organisation_id' already used by a mg/owner from DB and the 'email' is already existing in 'payment_merchant_officers' table,OBN1-8595,Bug,Done,P4,,9/8/2022 7:25,,OBN 1.14,API,External,,,"*Steps:*

# officer with “oranisation_id“ & “national_insurance_number” used in request to “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}” already exixts
# use email for mg/owners that is already used by an existing officer in DB in request to “/ext-ref/merchant-onboarding/{{ExtApplicUuid}}”

*Expected result:*

“This email is already in use” is displayed

*Actual result:*

500 error received:

\[2022-09-07T14:44:08.215521+00:00] app.ERROR: An exception occurred while executing 'UPDATE payment_merchant_officers SET is_beneficial_owner = ?, email = ?, ownership = ?, updated_at = ? WHERE id = ?' with params \[1, [""user1@sdfrdgyh.com|mailto:""user1@sdfrdgyh.com]"", 80, ""2022-09-07 14:44:08"", 101]:  SQLSTATE\[23000]: Integrity constraint violation: 1062 Duplicate entry 'user1@sdfrdgyh.com' for key 'payment_merchant_officers.UNIQ_3618B546E7927C74' >> Trace: #0 DBALException.php 182: Doctrine\DBAL\Driver\AbstractMySQLDriver->convertException(..) #1 DBALException.php 159: Doctrine\DBAL\DBALException::wrapException(..) #2 Connection.php 2212: Doctrine\DBAL\DBALException::driverExceptionDuringQuery(..) #3 Connection.php 1524: Doctrine\DBAL\Connection->handleExceptionDuringQuery(..) #4 Connection.php 1473: Doctrine\DBAL\Connection->executeStatement(..) #5 BasicEntityPersister.php 512: Doctrine\DBAL\Connection->executeUpdate(..) #6 BasicEntityPersister.php 399: Doctrine\ORM\Persisters\Entity\BasicEntityPersister->updateTable(..) #7 UnitOfWork.php 1209: Doctrine\ORM\Persisters\Entity\BasicEntityPersister->update(..) #8 UnitOfWork.php 429: Doctrine\ORM\UnitOfWork->executeUpdates(..) #9 EntityManager.php 378: Doctrine\ORM\UnitOfWork->commit(..) #10 EntityManager_9a5be93.php 129: Doctrine\ORM\EntityManager->flush(..) \[] \[]",,,72,,,1
"500 status code received when user tries to do an external onboarding without ""existingMonthlyProcessingVolume"" in the request body",OBN1-8593,Bug,Done,P4,,9/7/2022 16:20,,OBN 1.14,API,External,,,"*Steps:*

# Referrer that uses external api exists
# Sent a post request to ‘/ext-ref/merchant-onboarding/{{ExtApplicUuid}}’ endpoint without “existingMonthlyProcessingVolume"" in request body

*Expected result:*

“existingMonthlyProcessingVolume"": “This value should not be blank” should be present in the respons body

*Actual result:*

!image-20220907-152743.png|width=1824,height=821!",,S3,72,,,1
"""This value should not be blank' error is displayed for wrong phase during Workflow creation process",OBN1-8583,Bug,Done,P4,,9/7/2022 10:44,,OBN 1.14,UI,Workflow,,,"*Steps:*

# Log in
# Navigate to “Create Workflow” page
# Select optional phases that doesn’t have any required steps (Know Your Client (post/pre), Pre-settlement assessment)
# Don’t select any steps for the selected phases
# Complete step configuration 
# Save workflow

*Expected result:*

User is redirected to “Step selections” page. “This value should not be blank” is displayed for the phase that doesn’t have selected steps.

*Actual result:*

The error is displayed for the wrong phase:

!image-20220907-094934.png|width=1300,height=847!



+Note:+ If user won’t regresh the page (click “Cancel” for workflow creation process) and try to create a new WF from scratch → then the phase order won’t be the default one. And the steps will be highlighted with red if any error were displayed during canceled WF creation process.",,S4,72,,,1
Mandatory fields are shown as optional in external documentation,OBN1-8577,Bug,Done,P4,,9/6/2022 15:47,,OBN 1.14,,,,,"+To be tested:+ External documentation



*PUT /ext-ref/payment/dispute/{caseUuid}/challenge:*
merchantChallengeResponseReasonCode
challengeDisputedAmount

*PUT /ext-ref/merchant-onboarding/commercial-offer/{applicationUuid}:*
approvalDate

*submit application:*
managers
owners
outlets
billingPlan",,,72,,,3
'payment_merchants.safeguard_reserved_minor_units' should not decrease when funds from RR are taken on freezing funds for created dispute,OBN1-8549,Bug,Done,P4,,9/5/2022 12:39,,OBN 1.14,,,,,"*Preconditions:*

# A merchant exists in 'payment_merchants' table
# The merchant has 500 units in ‘payment_merchants.safeguarded_minor_units’ column
# The merchnt has 500 units in 'payment_accounts' table
# The merchant has 1500 RR units in ‘payment_merchants.safeguard_reserved_minor_units’ column

*Steps:*

# Create a dispute for a Sale transaction of the merchant with total dispute exposure amount 2500 units (Dispute amount + Additional compensation Amount +Max dispute fee)

*Expected result:*

1500 RR units are registerd as debt to Safeguard in ‘payment_merchants.debt_to_safeguard_units’ column. 'payment_merchants.safeguard_reserved_minor_units' +is not decreased+.

*Actual result:*

1500 RR units are registerd as debt to Safeguard in ‘payment_merchants.debt_to_safeguard_units’ column. 'payment_merchants.safeguard_reserved_minor_units' +is decreased+ with the value used for freeze. 

+Note:+ On closing the dispute, when the debt to Safeguard is covered, in ‘payment_merchants.safeguarded_minor_units’ is registered the remainder minus covered debts (obn+RR).",,S2,72,,,1
'Rolling Reserve' freezed for Dispute are still displayed for Merchant in 'Rolling Reserve' account in 'Funds held at start/end of period' on Reconciliation page',OBN1-8518,Bug,Done,P4,,9/2/2022 8:23,,OBN 1.16,,,,,"*Preconditions:*

# A merchant exists in 'payment_merchants' table
# The merchant has 500 units in ‘payment_merchants.safeguarded_minor_units’ column
# The merchnt has 500 units in 'payment_accounts' table
# The merchant has 1500 RR units in ‘payment_merchants.safeguard_reserved_minor_units’ column

*Steps:*

# Create a dispute for a Sale transaction of the merchant with total dispute exposure amount 2500 units (Dispute amount + Additional compensation Amount +Max dispute fee)
# 1500 RR units are registerd as debt to Safeguard in ‘payment_merchants.debt_to_safeguard_units’ column
# ‘payment_merchants.chargeback_reserved_exposure’ column has 2500 units (Dispute exposure amount)
# The EWD runs. Reports are created 
# Check the ‘Funds held at start/end of period’ for the merchant on Reconciliation page

*Expected result:*

‘Rolling Reserve’ is not displayed because were used for freezing amount for dispute. Dispute exposure includes RR used on freezing.

*Actual result:*

RR units (1500) are present in ‘Rolling Reserve' account and in 'Dispute Reserved’ account for the merchant.

+Note:+ Rolling Reserve for reconciliation is calculated as SUM of ‘payment_requests_to_pay.current_rr_units’ which is not decreased on freezing units for dispute. ",,,73,,,3
NotCompromisedPasswordValidator,OBN1-8495,Bug,Done,P2,,8/26/2022 14:52,,OBN 1.14,,,,,"bug in NotCompromisedPasswordValidator which is fixed in symfony 5.4 

 [https://github.com/symfony/symfony/pull/46948|https://github.com/symfony/symfony/pull/46948|smart-link] 



When user resets password - displays error

!image-20220826-135002.png|width=1599,height=512!





P.S.

One possible solution is to copy {{NotCompromisedPasswordValidator}} into the project and make the fix. Write in the comments that when symfony is updated to 5.4, this validatior should be dropped and used validator from vendor.",,,71,,,1
User is not able to perform a refund for a Settled Request to pay,OBN1-8451,Bug,Done,P1 ,,8/24/2022 9:12,,OBN 1.13,Payments,,,,"*Preconditions:*

# A RTP is created and authorised
# RTP is settled and has 'SETTLED' status

*Steps:*

# Perform a Refund for the settled RTP

*Expected result:* 

The RTP was successfully created

*Actual result:*

Error that RTP does not exist is received",,S1,71,,,0.5
The reserve for dispute process is repeated on receiving error,OBN1-8418,Bug,Done,P1 ,,8/19/2022 10:13,,OBN 1.13,,,,,"*Preconditions:*

# Merchant exists
# A sale transaction for the merchant exists and it is processed

*Steps:* 

# Operator user logs in
# User creates a dispute for existing Sale
# An error occurs during the reservation of funds

*Expected result:*

The correct amount is reserved. If debts - the debt is correctly recorded in ‘payment_merchants’ table

*Actual result:*

The debt is increased after every retry to do the supply",,S2,71,,,1
Wrong 'created_at' filter on 'Activity' page fot dispute refunds,OBN1-8383,Bug,Done,P4,,8/17/2022 11:48,,OBN 1.13,,,,,"*Preconditions:*

# A dispute with created_at date = today - 1 day

*Steps:*

# Close the dispute in any state (except: Closed: Found against Consumer)
# Dispute refund has today date (date when it was closed)
# Navigate to ‘Activity’ page
# Select the dispute refund date for ‘Date’ filter

*Expected result:*

The dispure refund for created a day ago dispute is displayed

*Actual result:*

The dispute refund is not displayed, because 'Date' filter checks for Dispute created date, not for Dispute Refund created date",,,70,,,1
500 status code received when user sends a request to '/users/change-password' endpoint without token,OBN1-8331,Bug,Done,P4,,8/15/2022 13:56,,OBN 1.13,,,,,"*Steps:*

# Send POST request to ‘/users/change-password’ endpoint without using any Token

*Expected result:*

400 status code received. '{{Token authentication required}}' message is displayed

*Actual result:*

500 status code received:


!image-20220815-125830.png|width=1415,height=901!",,S4,70,,,1
Incorrect sorting on 'Activity' page for several columns,OBN1-8310,Bug,Done,P4,,8/12/2022 8:05,,OBN 1.13,,,,,"*column:* 
- {{Processing fees}}
- {{Interchange fees}}
- {{Scheme fees}}
- {{Rolling reserve deducted}}
- {{Settlement amount}}

*Steps:*

# Log in as Admin user 
# Navigate to 'Activity' page
# Sort the records by <column> column

*Expected result:*

The records on ‘Activity’ page are sorted by <column> column

*Actual result:*

Sorting is not working properly:

!image-20220812-073626.png|width=1021,height=726!",,,70,,,5
Refund state is not set to 'FAILED' after all retries,OBN1-8268,Bug,Done,P4,,8/10/2022 13:17,,OBN 1.13,,,,,"*Preconditions:*

# Merchant exists
# An RTP is created for the merchant

*Steps:*

# Create a Refund for the existing RTP
# Refund stucked in 'PENDING' state when:
## error received from Zapp
## error on supply for Refund
# 20 retries are done

*Expected result:*

Refund passes in ‘FAILED’ status (payment_requests_to_refund.state_id)

*Actual result:*

Refund remains in 'PENDING' status",,,71,,,1
Notification is not sent to Cardstream when refund passes in FAILED status,OBN1-8267,Bug,Done,P4,,8/10/2022 12:44,,OBN 1.13,,,,,"*Preconditions:*

# Cardstream Merchant exists and it is active
# An RTP is processed for the merchant
# The RTP is displayed on MMS > Transactions page

*Steps:*

# Create a Rrefund from MMS UI
# The refund passes in FAILED status

*Expected result:*

Notification is sent to Cardstream. The status of the refund is updated in MMS 

*Actual result:*

The notification is not sent to CS. The status of the refund is not updated in MMS ",,S2,71,,,3
Unselected drop-down options disappear when user moves the Row in 'unselect rows' section,OBN1-8256,Bug,Done,P4,,8/9/2022 14:13,,OBN 1.13,,,,,"*Steps:*

# Log in as Admin user
# Navigate to “Reports” page
# Expand a section
# Unselect any option from any drop-down:

!image-20220809-131538.png|width=798,height=264!

# Move a category to “Unselected Rows' section:

!image-20220809-131649.png|width=1517,height=489!

# Move the categoty back to “Selected Rows” section
# Check the options in the drop-down

*Expected result:*

Are checked and unchecked options are present

*Actual result:*

Options that were unchecked before moving category to “Unselcted rows” are missing:


!image-20220809-131951.png|width=780,height=223!",,S4,70,,,1
Wrong Organisation Type displayed when user creates 2 workflows for different OrgTypes without updating the page,OBN1-8215,Bug,Done,P3,,8/4/2022 8:15,,OBN 1.12,,,,,"*Steps:*

# Create a WF for ‘Corporate' organisation types with 'Know your client’ phase
# Start creation process of a WF for 'Persoanl' organisation types
# Check Steps available for ‘Know your client' phases on 'Steps Selection’ page

*Expected result:*

!image-20220804-073137.png|width=546,height=240!

*Actual result:*

!image-20220804-073847.png|width=891,height=248!",,S3,69,,,0.5
Incorrect amount is registerd in 'payment_accounts.transferring_minor_units' column when not enough money for freez on dispute creation in Safeguard account,OBN1-8198,Bug,Done,P4,,8/2/2022 7:42,,OBN 1.13,,,,,"*Preconditions:* 

# Safeguarded Minor Units - 200
# Merchant Clearing - 100
# OBN Holding - 1000
# Dispute Exposure Amount when dispute is created - 500
# Freezed for Dispute - 500

*Expected result:*

'500' minor units are blocked in in 'payment_accounts.transferring_minor_units' column

*Actual result:*

'200' minor units are blocked in in 'payment_accounts.transferring_minor_units' column

*Possible Solution:*

!image-20220802-064248.png|width=1580,height=665!

!image-20220802-064606.png|width=926,height=483!",,,70,,,1
Splitting is not triggered when dispute is created direclty with 'Incontestable Dispute' > 'Closed: Found agains Merchant' status or Accepted by merchant,OBN1-8196,Bug,Done,P2,,8/1/2022 18:05,,OBN 1.13,,,,,"*Related endpoints:*

# Accept a dispute by Merchant (internal):

{{@Route(""/payment/dispute/{caseUuid}/accept"", methods={""PUT""}, name=""payment.dispute.accept"")}}

2. Accept a dispute by Merchant (external):

{{@Route(""/ext-ref/payment/dispute/{caseUuid}/accept"", methods={""PUT""}, name=""ext-ref.payment.dispute.accept"")}}

3. Created a dispute in ‘Incontestable Dispute’ > 'Closed: Found against Merchant':

{{@Route(""/payment/chargeback/transaction/{transactionUuid}"", methods={""POST""}, name=""payment.chargeback.createForTransaction"")}}",,S2,69,,,1
[stage] Not all dispute codes (reject codes) are displayed in dispute,OBN1-8195,Bug,Done,P2,,8/1/2022 14:31,,OBN 1.12,Disputes,,,,"# Log in as Operator
# Go to Activity and select a transaction
# Click to create a dispute
# On second step {{Dispute Case Details}} click on {{Dispute reason }}field

*Expected result:*

in drop down displays all available Dispute reasons.

*Actual result:*

The drop down for Reason Code only has one option. 

PS. Also when Merchant Challenge a dispute - also displays only one dispute reason.

There is no record in the database

!image-20220801-132536.png|width=766,height=223!

!image-20220801-132558.png|width=895,height=771!

!image-20220801-133035.png|width=1178,height=732!",,,69,,,1
The 'Next page' icon is mispositioned in 'Select Workflow' pop-up after leaving 1st page,OBN1-8193,Bug,Done,P5,,7/29/2022 13:30,,OBN 1.12,,,,,"*Precondition:*

# More that 10 WFs exist

*Steps:*

# Log in as Operator Admin user
# Navigate to “My Organisation” > “My Workflows” page
# Click ‘Create' > 'from existing’ button
# Navigate to next page in 'Select Workflow' pop-up
# Check the pop-up elements

*Expected result:*

All elements are correclty positioned in the pop-up

*Actual result:*

The ‘Next page’ icon is mispositioned:

!image-20220729-123605.png|width=729,height=866!",,,69,,,0.5
The order of phases in WF created from existing WF is not prefilled ,OBN1-8184,Bug,Done,P4,,7/29/2022 13:16,,OBN 1.12,,,,,"*Preconditions:*

# A WF with phases in not standard order exists:

!image-20220729-121821.png|width=655,height=437!

*Steps:*

# Log in as Operator admin
# Navigate to ‘My Organisation' > 'My workflows’
# Create WF using WF with phases in not standard order
# Add a WF name
# Click ‘Net’ button
# Check the order of phases

*Expected result:*

The order of phases should be the same of the cloned WF

*Actual result:*

The order of phases is standard:

!image-20220729-122419.png|width=985,height=746!",,,69,,,1
[Prod] Applicant is not expanded on 'My Merchants' > 'Open Applications' when user clicks on 'View applications' for an applicant not from 1st page,OBN1-8092,Bug,Done,P2,,7/25/2022 8:02,,OBN 1.12,,,,,"*Preconditions:*

# Theare are more than 10 Open Applicants on 'Open Applicants' list

*Steps:*

# Log in as Operator
# Navigate to ‘My Referrers' >  'Active Referrers’ page
# Expand the Referrer with an open applicant that is not on the 1st page on ‘My Merchants' > 'Open Applications’ list
# Navigate to ‘Open Applications’ tab for expanded referrer
# Click on ‘View applicant’ link for applicant that is not on the first page on ‘My Merchants' > 'Open Applicants’ list

*Expected result:*

The user is redirected on ‘My Merchants' > 'Open Applicants’ on the right page and the applicant is expanded

*Actual result:*

The user is redirected to first page where the applicant is not present and can’t be expanded.",,,69,,,1
Invalid validation 'challenge reason description' field ,OBN1-8056,Bug,Done,P4,,7/18/2022 14:23,,OBN 1.9.2,Disputes,,,,"# A dispute exist
# As Merchant go to {{Dispute management}}
# Expand a dispute and click {{Challange}}
# In challenge reason description add more then 255 characters

*Expected result:*

No error displays. Validation error displays when user enters more then 500 characters.

*Actual result:*

Validation error on 255 characters

!image-20220718-132012.png|width=1334,height=812!",,,68,,,0.5
Bambora acquirer name used in SynchronizeZappAccountsCommand.php,OBN1-7992,Bug,Done,P4,,7/14/2022 7:48,,OBN 1.11,,,,,,,,68,,,1
The name is not updated when the last character is added on 'About its payments' page,OBN1-7919,Bug,Done,P5,,7/11/2022 12:36,,OBN 1.10,,,,,"!image-20220711-113723.png|width=472,height=209!",,,67,,,0.5
No error displayed when adding an image in Internal Notes,OBN1-7905,Bug,Done,P4,,7/8/2022 8:11,,OBN 1.10,,,,,"# As Operator go to{{ Internal notes}}
# Click add {{Note}}
# Enter text and add image with big size
# Click {{Save}}

*Expected result:*

Displays validation error for user

*Actual result:* 

Error displays only in console

PS. Please, check this logic for Internal notes in all places. 

h5. _Also, when user paste text from clipboard and character number is greater than 1000 → texts isn’t pasted_

!image-20220708-070945.png|width=1350,height=956!",,,67,,,0.5
No sorting by Processing value (Active merchants),OBN1-7901,Bug,Done,P4,,7/7/2022 8:39,,OBN 1.10,,,,,"*Precondition:* Referrer has Active Merchants

# Log in as Operator
# Go to My referrers → Active referrers → Active Merchants
# Click to sort by {{Processing value}}

*Expected results:*

Processing value is sorted by DESC/ASC amount

*Actual result:*

error {{'processingValue' is not defined.}}

!image-20220707-072701.png|width=1897,height=886!

!image-20220707-072738.png|width=1237,height=926!",,,67,,,0.5
Confirmation pop up freezes on Referrer creation,OBN1-7876,Bug,Done,P3,,7/6/2022 6:51,,OBN 1.11,Disputes,,,,"# Log in as Operator
# Go to My Referrers → Create Referrer → Account configuration step
# Click {{Generate API}}
# In pop up click {{Confirm}}

*Expected result:*

Pop up closes

*Actual results:*

Confirmation pop up freezes

!image-20220706-054600.png|width=1569,height=815!",,,67,,,0.5
[Activity ]Error when filtering by Payment scheme ,OBN1-7875,Bug,Done,P3,,7/5/2022 12:54,,OBN 1.9.1,,,,,"# Log in as Operator
# Go on {{Activity page}}
# In filter section select Payment scheme - {{PBBA/CARD}}
# Click {{Apply}}

*Expected result:*

All transactions are filtering by selected Payment scheme

*Actual result:*

Error 

!image-20220705-115344.png|width=1530,height=687!",,,67,,,0.5
Return value of App\\Repository\\User\\UserRepository::findOneInactive() must be an instance of App\\Entity\\User\\User,OBN1-7844,Bug,Done,P4,,7/4/2022 10:30,,OBN 1.9.1,,,,,"{{{ ""message"": ""Handling \""App\\Message\\User\\DeactivateInactiveUserMessage\"" failed: Return value of App\\Repository\\User\\UserRepository::findOneInactive() must be an instance of App\\Entity\\User\\User, null returned\nTrace:\n#0 DeactivateInactiveUserHandler.php 43: App\\Repository\\User\\UserRepository->findOneInactive(..)\n#1 HandleMessageMiddleware.php 63: App\\MessageHandler\\User\\DeactivateInactiveUserHandler->__invoke(..)\n#2 SendMessageMiddleware.php 74: Symfony\\Component\\Messenger\\Middleware\\HandleMessageMiddleware->handle(..)\n#3 RollbackIfExceptionMiddleware.php 33: Symfony\\Component\\Messenger\\Middleware\\SendMessageMiddleware->handle(..)\n#4 DoctrinePingConnectionMiddleware.php 34: App\\MessageHandler\\Core\\RollbackIfExceptionMiddleware->handle(..)\n#5 AbstractDoctrineMiddleware.php 45: Symfony\\Bridge\\Doctrine\\Messenger\\DoctrinePingConnectionMiddleware->handleForManager(..)\n#6 FailedMessageProcessingMiddleware.php 34: Symfony\\Bridge\\Doctrine\\Messenger\\AbstractDoctrineMiddleware->handle(..)\n#7 DispatchAfterCurrentBusMiddleware.php 68: Symfony\\Component\\Messenger\\Middleware\\FailedMessageProcessingMiddleware->handle(..)\n#8 RejectRedeliveredMessageMiddleware.php 48: Symfony\\Component\\Messenger\\Middleware\\DispatchAfterCurrentBusMiddleware->handle(..)\n#9 AddBusNameStampMiddleware.php 37: Symfony\\Component\\Messenger\\Middleware\\RejectRedeliveredMessageMiddleware->handle(..)\n#10 MessageBus.php 80: Symfony\\Component\\Messenger\\Middleware\\AddBusNameStampMiddleware->handle(..)"", ""context"": {}, ""level"": 400, ""level_name"": ""ERROR"", ""channel"": ""app"", ""datetime"": ""2022-07-04T09:29:23.957112+00:00"", ""extra"": {} }}}",,,67,,,1
"500 status code ""Unknown error"" error received when user is sending a request for Starling notification leaving 'paymentUid' empty",OBN1-7832,Bug,Done,P4,,7/1/2022 8:14,,OBN 1.10,,,,,"*Steps:*

# Sent a RTP request
# Receive Notification from Zapp
# Send request to Notification from Starling leaving 'paymentUid' empty:

!image-20220701-071658.png|width=611,height=542!

*Expected result:*

“paymentUid”: ‘This value should not be blank’/'This value should not be empty' is displyed in response body

*Actual result:*

!image-20220701-071854.png|width=1120,height=576!

!image-20220701-071924.png|width=989,height=562!",,,67,,,1
[Disputes]'Active' outcome is displayed for Closed cases in 'Disputes' pop-up,OBN1-7820,Bug,Done,P4,,6/29/2022 11:48,,OBN 1.11,Disputes,,,,"*Preconditions:*

# Dispute is created for a Sale transaction
# The dispute has a closed status: 
Closed: Found against Consumer
Closed: Found partially against Merchant
Closed: Found against Merchant
Closed: Accepted by Merchant

*Steps:*

# Log in
# Navigate to 'Activity' page
# Clicks on 'Associated dispute case' link for a transaction
# Check the Dispute Outcome information

*Expected result:*

The “Closed \[Stage - Status] is displayed for ‘Outcome’

*Actual result:*

!image-20220629-105113.png|width=1380,height=705!",,,67,,,1
Operator can't create WF with 'Transactions Count Greater Or Equal To' step rule,OBN1-7728,Bug,Done,P3,,6/22/2022 14:13,,OBN 1.9,Workflow,,,,"# Login as Operator and go to create workflow page
# Go to step selection
# Select {{Pre-settlement Assessment}} phase and add available step
# Go to next step, select for {{Pre-settlement Assessment}} phase → step rule={{Transactions Count Greater Or Equal To}} and add values for step rule
# Click {{Save}}

*Expected results:*

New workflow saved and user is redirected on workflow list.

*Actual result:*

User is redirected on Workflow creation page and returns 500 error -{{ Notice: Undefined index: ALL_VALUES}}

!image-20220622-130931.png|width=1582,height=802!



!image-20220622-125726.png|width=1105,height=759!

!image-20220622-125913.png|width=1579,height=841!",,,66,,,1
500 status code received when user sends an RTP using an amount >=100000000.00,OBN1-7705,Bug,Done,P4,,6/20/2022 15:20,,OBN 1.9,,,,,"*Expected result:*

Maximum amount allowed for RTP should be 1mln GBP (1 000 000,00)

*Actual result:*

!image-20220620-142816.png|width=975,height=570!",,,66,,,0.5
External Merchant can't sign Commercial offer on onboarding,OBN1-7692,Bug,Done,P3,,6/17/2022 14:10,,OBN 1.16,External,Offer,,,,"# Merchant onboarding sub external Referrer
# And is on {{Offer sign}} step
# Then Merchant sends request{{ ext-ref/merchant-onboarding/commercial-offer/{{uuid}}}}

*Expected result:*

{{offer_sign_at}} date can't be signed before {{offer_submitted_at}}

*Actual result:*

500 server error response. {{Call to a member function getTimestamp() on null}}

!image-20220617-130550.png|width=1539,height=805!

!image-20220617-125812.png|width=1482,height=829!",,66,,,1
User is not able to navigate to next Manage Users list on 'My Merchants' > 'Active Merchants',OBN1-7655,Bug,Done,P4,,6/14/2022 13:18,,OBN 1.9,,,,,"*Preconditions:*

# An active merchant exists
# The merchant has more than 5 users

*Steps:*

# Log in as a user with 'MERCHANT' permissions
# Navigate to ‘My Merchants' > 'Active Merchants’ page
# Expand the merchant
# Navigate to 'Manage Users' tab
# Select to be displayed 5 users per page to be displayed
# Navigate to the next page

*Expacted result:*

Next 5 users are displayed. 6-n is displayed below the users list

*Actual result:*

Still first page is displayed (1-5 is displayed below the list):

!image-20220614-122348.png|width=1366,height=569!",,,66,,,0.5
'Active Merchants' are not displayed in 'My Referrers' > 'Acrive Referrers' > 'Active Merchants' page,OBN1-7653,Bug,Done,P4,,6/14/2022 11:59,,OBN 1.9,,,,,"*Preconditions:*

# Create a referrer
# Create active merchants for the referrer

*Steps:*

# Log in as operator
# Navigate to ‘My Referrers' > 'Active Referrers’ page
# Expand the referrer
# Navigate to Active Merchants tab

*Expected result:*

All active merchants of the referrer are displayed

*Actual result:*

'No data available' message is displayed:

!image-20220614-110330.png|width=1360,height=506!

_Note: can’t be reproduced for Referrers&Active merchants created by fixtures_",,,66,,,1
Workflow list contains duplicates ,OBN1-7579,Bug,Done,P3,,6/8/2022 7:51,,OBN 1.9,,,,,"# As Operator go to {{My Organization}} → {{My Workflows}}
# Check Workflow list

*Expected result:*

No duplicates in workflow list

*Actual result:*

Workflow list contains duplicates

!image-20220608-065624.png|width=1650,height=915!",,,66,,,2
Error received when user tries to perform an RTR transaction,OBN1-7577,Bug,Done,P4,,6/8/2022 7:25,,OBN 1.9,Refund,,,,"*Precondition:*

# A RTP is created and processed

*Step:* 

# Perform a RTR with a valid amount

*Exepected result:*

The RTR is created and processed

*Actual result:*

!image-20220608-062512.png|width=1277,height=618!",,,66,,,1
500 response received when user performs a refund using an already existing 'gatewayTransactionId' in request body,OBN1-7516,Bug,Done,P4,,6/3/2022 13:53,,OBN 1.12,,,,,"*Preconditions:*

# Perform a sale transaction

*Steps:*

# Perform a RTR (refund) for existing rtp
# User in request body an already existing ‘gatewayTransactionId’

*Expected result:*

400 response received. ‘gatewayTransactionId’ : 'This value should be unique' (Marina to confirm) message is displayed in response body

*Actual result:*

500 response received:

!image-20220603-125810.png|width=954,height=570!",,,65,,,0.5
The transactions created for a merchant in the same day when the merchant was created are not counted on EOD,OBN1-7498,Bug,Done,P2,,6/2/2022 13:55,,OBN 1.29,Phase_2b,,,,"*Steps:*

# Create & activate a merchant
# Create transactions for the merchant
# Run the obn:working-hour command

*Expected result:*

Processing value is calculated.

*Actual result:*

Processing value for the merchant is 0

(Because merchant has no report_parts created from the previous day)",,,85,86,,3
500 status code received when user sends an authentication request using an email with more than 255 characters,OBN1-7452,Bug,Done,P4,,5/30/2022 16:48,,OBN 1.8,API,Users,,,"*Steps:* 

# Use an email with more than 255 characters for ‘email’
# Use a valid pass for 'password'
# Use an existing in DB client uuid for 'clientUuid'
# Send a POST request to '/login'

*Expected result:*

‘{{Email must not exceed 255 characters.}}' message is present for 'email’ in resonse body

*Actual result:*

500 status cod received

!image-20220530-154813.png|width=1106,height=565!",,,65,,,0.5
[Workflow] Selected condition is not displayed in the step rule field,OBN1-7427,Bug,Done,P2,,5/24/2022 6:34,,OBN 1.7,Workflow,,,,"# As Operator go to {{My Organisation-->My Worflows-->Create workflow}}
# Enter valid data and go to next step
# On {{Step selection}} add steps where need to add condition
# Go to {{Steps configuration}}
# On second step {{Commercial offer-->Commercial offer accepted by applicant}} click on {{step rule condition}} and select condition

*Expected result:*

Step rule condition is selected and displays in field

*Actual result:*

Selected condition is not displayed in the step rule field. 

This reproduced also in Merchant Underwriting phase

!phase_bug.mp4|width=1536,height=824!",,,64,,,0.5
Fix monolog config,OBN1-7409,Bug,Done,P1 ,,5/19/2022 10:02,,OBN 1.6,,,,,*event* channel and all related stuff should be removed from monolog configs for stage and prod.,,,64,,,0.5
Option appears for step on workflow cloning ,OBN1-7391,Bug,Done,P4,,5/18/2022 12:39,,OBN 1.7,,,,,"*Preconditions:*

# Use database
# Use “Sole“ workflow

[^clone-workflow.sql]

*Steps:*

# Log in as Reseller Admin
# Clone “Sole“ workflow 
# Add a new stage

*Actual result:*

Option appears for step which shouldn’t have one. Error on save

!CPT2205181447-1907x856.gif|width=1907,height=856!",,,64,,,1
Validation message for Billing plan isn't displayed,OBN1-7234,Bug,Done,P4,,4/29/2022 8:47,,OBN 1.6,,,,,"# Log in as reseller admin
# Go to {{My referrers--> Create referrer}}
# Enter *valid* data on first and second steps
# On third step, select all billing plans and fill in with *valid data*
# For {{card(NetRevenue)}} enter card name with 2 symbols
# Click {{save and close}}

*Expected result:*

Under card name field displays validation error message

*Actual result:*

No error for user on UI. Error displays only in console

!image-20220429-074555.png|width=1489,height=622!",,,62,,,0.5
500 error when accessing Dispute Management page,OBN1-7179,Bug,Done,P1 ,,4/27/2022 7:40,,OBN 1.6,,,,,"*Preconditions:*

Disputes exist

*Steps:*

# Log in as Merchant/Referrer admin with CHARGEBACK permission
# Go to “Dispute Management“ page

*Expected result:*

Disputes are displayed

*Actual result:*

!Screenshot_2403.png|width=1153,height=485!

*P.S. Logged as Referrer*

!Screenshot_2404.png|width=1145,height=387!",,,62,,,0.5
Payment services not supported by Referrer are available for applicant,OBN1-7164,Bug,Done,P4,,4/22/2022 10:44,,OBN 1.6,,,,,"*Preconditions:*

# Referrer A - has BP config just for PBBA
# Applicant B - under Referrer A
# Applicant C - under Operator

*Steps:*

# Log in as user of Applicant C
# Navigate to “About its Payments“
# Log Out
# Log in as user of Applicant B
# Navigate to “About its Payments“

*Expected result:*

Just “PbBa“ service should be available for applicant B after log in

*Actual result:*

Both options are available for applicant B after log in, because some information is cached after log in of user C",,,62,,,0.5
"Rename ""Active Payment Schemes"" to ""Payment Schemes"" ",OBN1-7160,Bug,Done,P4,,4/21/2022 10:13,,OBN 1.6,,,,,"*Steps:*

# Log in as Reseller Admin
# Navigate to “Active Referrers“ → “Active Merchants” 

*Expected result:*

Rename “Active Payment Schemes“ to “Payment schemes“

!image-20220421-091746.png|width=1399,height=521!",,,62,,,0.5
[Stage] Error on update Reseller BP config,OBN1-7064,Bug,Done,P1 ,,4/13/2022 7:11,,OBN 1.5,,,,,"*Steps:*

# Log in as Reseller Admin
# Navigate to “My Organisation“ → “Merchant Billing Plan“ page
# Try to update the values

*Actual result:*

Because floor fee units misses, BP config can’t be updated

*Expected result:*

Create a command which will populate “payment_deduction_floor_fees“ on prod - PBBA and Bambora net_revenue",,,61,,,1
Error on getting disputes from external without Authentication token,OBN1-7029,Bug,Done,P2,,4/11/2022 8:14,,OBN 1.5,,,,,"*Steps:*

# Send a GET request to “/ext-ref/payment/disputes” without any authentication
# Send a GET request to /payment/chargeback/open-cases/list or 
“/payment/chargeback/closed-cases/list” or 
“/payment/chargeback/\{chargebackUuid}/details” with external authentication 

*Expected result:*

The 401 error should be thrown

*Actual result:*

!image-20220411-071541.png|width=1475,height=807!",,,61,,,0.5
"Dispute case reporting - error on sending ""createdDate"" as null on query params in external endpoints",OBN1-7009,Bug,Done,P4,,4/8/2022 8:07,,OBN 1.6,,,,,"*Steps:*

# Log in as Referrer in external API
# Send a request to “/ext-ref/payment/disputes?createdDate=“
# Send a request to “/ext-ref/payment/disputes?paymentSchemeCreatedDate=”

*Expected result:*

A validation error should be thrown, because “createdDate“ is not provided. In transaction endpoint error looks like:


!image-20220408-071530.png|width=1428,height=356!

*Actual result:*

!image-20220408-070814.png|width=1466,height=719!",,,62,,,0.5
Create referrer - Validation that share amount cannot be greater than fixed one is not displayed in UI,OBN1-7006,Bug,Done,P4,,4/7/2022 15:12,,OBN 1.6,,,,,"*Steps:*

# Login as Reseller admin
# Go to “My Referrers->Create referrer“ page
# Complete the fields
# Add total fixed amount 4 and share amount 5
# Click “Save and close“ button

*Expected result:*

Validation is displayed

*Actual result:*

!Screenshot_2297.png|width=1127,height=535!",,,62,,,0.5
"Repeated ""Active Payment Schemes"" are displayed under ""My Referrers"" -> ""Active Merchants""",OBN1-7004,Bug,Done,P4,,4/7/2022 14:48,,OBN 1.6,,,,,"*Preconditions:*

# Merchant A has 2 outlets
# Merchant belongs to Referrer B
# Each outlet has both payment services: PBBA and Bambora

*Steps:*

# Log in as Reseller Admin
# Navigate to “Active Referrers” → “Active Merchants“
# Expand Merchant B
# Analyze the “Active Payment Schemes“

*Expected result:*

Just one symbol per processor type should be displayed

*Actual result:*


!image-20220407-134737.png|width=910,height=406!",,,62,,,1
"[Billing] Settlement amount is not considered on ""Total Charge""",OBN1-6999,Bug,Done,P2,,4/6/2022 14:58,,OBN 1.6,,,,,"*Preconditions:*

# Merchant A has ONLY a settlement during previous month with fee = 10 pence
# Merchant DOESN’T have sales or refunds

*Steps:*

# Generate the invoice

*Expected result*
”Total charge” value displayed on “Merchant invoices“ page should be equal to invoice fee (10 pence)

*Actual result:*

Total charge displayed is 0


!image-20220406-140054.png|width=1211,height=212!

When I download the invoice

!image-20220406-140115.png|width=755,height=447!",,,61,,,2
Create referrer API - Maxim value validation for deductions is not applied ,OBN1-6983,Bug,Done,P4,,4/4/2022 14:58,,OBN 1.6,,,,,"*Steps:*

# POST [http://local.api.obn/user/referrer|http://local.api.obn/user/referrer]
# Set markUpAmount 10000 pence

*Expected result:*

Maxim value is 999.99

Validation message is displayed

*Actual result:*

!Screenshot_2259.png|width=832,height=503!

*P.S.  Maxim value for floor is also 999.99*",,,62,,,2
[Prod] Wrong EWD displayed in Reconciliation ,OBN1-6965,Bug,Done,P2,,3/31/2022 16:50,,OBN 1.6,,,,,"*Steps:*

# Select Report dates between day X and X+1
# Choose other dates: X-1 and X+1
# Analyze the funds held at end of period in both intervals

*Expected result:*

The values should be identical in both situations

*Actual result:*

!image-20220331-155801.png|width=641,height=352!

!image-20220331-155820.png|width=635,height=335!",,,62,,,1
"Not all tooltips from ""Manage Users"" page are displayed at the same distance",OBN1-6952,Bug,Done,P5,,3/30/2022 14:16,,OBN 1.6,,,,,"*Steps:*

# Log in as Reseller admin
# Go to “My Merchants->Open Applications->Manage Users“ page
# Check tooltip for “Lead Applicant“ and “Activate” fields

*Expected result:*

!Screenshot_2226.png|width=344,height=124!

*Actual result:*

!Screenshot_2227.png|width=284,height=145!

*P.S. Disable checkbox can be clicked*

!Screenshot_2387.png|width=697,height=403!",,,62,,,1
Existing processing values should not be mandatory if there are no existing acquirer connections,OBN1-6932,Bug,Done,P2,,3/29/2022 13:51,,OBN 1.5,,,,,"*Steps:*

# Onboard a merchant
# Complete the fields
# Select N/A value for “Please select all of your existing acquirer connections used for card processing“ field
# Click “Next“ button

*Expected result:*

“Review and Submit“ step is displayed

*Actual result:*

!Screenshot_2197.png|width=1147,height=538!",,,60,,,0.5
"Make ""Euro"" input identical to ""GBP""",OBN1-6929,Bug,Done,P5,,3/29/2022 7:32,,OBN 1.5,,,,,"*Steps:*

# Navigate to “About its Payments“
# Try to complete “Processing volume per month“

*Actual result:*
For some reasons, EUR has (,) sign, but GBP and USD has (.)

!image-20220329-063402.png|width=382,height=207!",,,60,,,0.5
Dispute fee names are wrong,OBN1-6908,Bug,Done,P4,,3/25/2022 12:27,,OBN 1.5,,,,,"*Steps:*

# Log in as Reseller admin
# Go to “My Organisations->Merchant Billing Plan“ page
# Click “Edit“ button
# Select a Card BP

*Expected result:*

 Disputes section is displayed

!Screenshot_2179.png|width=954,height=531!

*Actual result:*

!Screenshot_2180.png|width=694,height=535!",,,60,,,0.5
RR used for partial refund is not properly rounded,OBN1-6906,Bug,Done,P1 ,,3/25/2022 10:17,,OBN 1.5,,,,,"*Preconditions:*

# A sale transaction (873 pence) exists
# Current total RR for sale is 17 pence

!Screenshot_2176.png|width=331,height=99!

*Steps:*

# Submit a request to refund 250 pence
# Check the splitting

*Expected result:*

RR is moved from Safeguard to Merchant clearing account

RR for partial refund is 4.86 pence, 5 pence should be transferred

*Actual result:*

Only 4 pence are transferred

!Screenshot_2177.png|width=482,height=229!",,,60,,,3
Error on getting transactions from external API,OBN1-6904,Bug,Done,P1 ,,3/25/2022 9:06,,OBN 1.5,External,,,,"*Preconditions:*

Log in as Referrer in external API

*Steps:*

# Send a GET request to “_/ext-ref/payment/transactions_“ endpoint

*Actual result:*

500 error received

[^error.txt]

",,,60,,,0.5
Add 2 decimals for dispute amount,OBN1-6850,Bug,Done,P4,,3/18/2022 16:17,,OBN 1.5,R.1,,,,"*Steps:*

# Log in as Reseller Admin
# Navigate to “Activity“ page
# Choose a Sale which has round decimals under dot (like this)
# !image-20220318-162047.png|width=1209,height=359!
Open its detials
# Start to create a dispute

*Expected result:*

The amount prepopulated in “Disputed amount“ should be displayed with 2 digits after dot

*Actual result:*

!image-20220318-161849.png|width=1116,height=668!",,,60,,,2
Wrong values displayed in Merchant invoice for card transactions,OBN1-6805,Bug,Done,P2,,3/16/2022 14:43,,OBN 1.5,,,,,"*Preconditions:*

# Use the database

[^db (11).sql]

*Steps:*

# Generate the invoices for Merchant

*Actual result:*

The values for card are wrong. It sums the PBBA and Card and displayed under card.\\

!image-20220316-144728.png|width=789,height=444!

!image-20220316-144828.png|width=1143,height=150!



*Expected result:*

The values should be corrected",,,59,,,1
'Log in' in external documentation is not possible when token is not valid,OBN1-6804,Bug,Done,P4,,3/16/2022 13:35,,OBN 1.5,,,,,"*Steps:*

# Go to external documentation
# Successfully authenticate
# Go to Postman and authenticate using the same credentials
# Try to do a request in external documentation

*Expected result:*

A validation error that token is not valid anymore is displayed. Log in button is available, so that user can generate a valid one

*Actual result:*

Because a new token is generated, the one from external documentation is not valid anymore. The error is displayed:

!image-20220316-133845.png|width=410,height=147!

However, I can’t log in anymore. Button misses.",,,59,,,1
Cannot add a new owner,OBN1-6802,Bug,Done,P4,,3/16/2022 9:07,,OBN 1.5,,,,,"*Preconditions:*

# The applicant submitted data
#  Workflow stopped to one of ""Merchant Underwriting"" phase's steps

*Steps:*

# Log in as Reseller admin
# Go to “My Merchants->Open Applications->Application Data“ page
# Click “Edit” button
# Add an owner
# Click “Save and close“ button

*Expected result:*

New owner is added

*Actual result:*

!Screenshot_2110.png|width=1146,height=533!",,,59,,,0.5
Referrer is not created when 2FA cardstream secret is not provided,OBN1-6796,Bug,Done,P4,,3/15/2022 9:46,,OBN 1.5,,,,,"*Preconditions:* 

# A reseller with id 1 exists in CS
# He has a user with credentials: {{marina.reseller}} and {{Flood15?Voice}}
# User has 2FA disabled

*Steps:* 

# Try to create a Referrer: POST “*_/user/referrer_*“ using the body attached 

*Expected result:* 

Referrer should be created, even the “{{csTwoFaSecret” }} is not provided (because 2FA is disabled in CS).

*Actual result:*

The error is returned that credentials provided are nor valid",,,59,,,1
500 error when trying to see application data of an applicant In Progress,OBN1-6745,Bug,Done,P4,,3/9/2022 15:58,,OBN 1.4.1,,,,,"*Preconditions:*

An application with “About its Business“ step completed exists

*Steps:*

# Log in as Reseller admin
# Go to “My Merchants->Open Applications“ page
# Click “Application data“ hyperlink

*Actual result:*

!Screenshot_2044.png|width=1142,height=532!",,,59,,,0.5
"[Prod] Misspelling ""Speciality Retail"" industry",OBN1-6724,Bug,Done,P4,,3/9/2022 8:37,,OBN 1.4.1,,,,,"*Steps:*

Check the name of industry “Specialty Retail“

*Expected result:*

Name is “Specialty Retail“

*Actual result:*

!Screenshot_2039 (c113073e-9bff-492e-9717-1f2bcaaf286b).png|width=1001,height=389!

!photo_2022-03-09_08-40-13.jpg|width=607,height=221!",,,59,,,0.5
"[External API] Company legal name should not be provided if business type is not LC, LLP or Charity",OBN1-6720,Bug,Done,P4,,3/4/2022 13:32,,OBN 1.4.1,,,,,"*Steps:*

# Onboard a merchant with business type Sole Trader through API 
# Add company legal name
# Send POST request <ext-ref/merchant-onboarding/\{\{uuid}}>
# Log in as Reseller admin
# Go to “My Merchants->Open Applications->Application Dashboard“ page
# Check merchant details

*Actual result:*

!Screenshot_2032.png|width=1136,height=557!

*Expected result:*

For “Sole trader“, “Partnership“ DON’T save legal name if it sent in “Submit merchant application“ through external API.",,,59,,,1
Wrong request is performed when updating documents,OBN1-6719,Bug,Done,P4,,3/4/2022 9:15,,OBN 1.4.1,,,,,"*Steps:*

# Log in as Reseller admin
# Go to “My Merchants->Open Applications->Application data” page
# Click “Edit“ button
# Upload documents
# Click “Save“ button
# Log out
# Log in as applicant
# Go to “About its Owners“ page
# Upload documents

*Actual result:*

!MicrosoftTeams-image (5).png|width=1865,height=784!

*P.S. Same error when uploading as applicant then as Reseller*

!MicrosoftTeams-image (6).png|width=1837,height=860!",,,,,,0.5
[Prod] Reseller cannot access Application data for active merchants,OBN1-6718,Bug,Done,P2,,3/4/2022 7:34,,OBN 1.4.1,,,,,"*Steps:*

# Loggin as Reseller admin
# Go to “Active Merchants->Application data” page

*Actual result:*

!Screenshot_2028.png|width=1149,height=526!",,,59,,,0.5
"Processing values are not displayed properly on ""Application data"" pop-up",OBN1-6717,Bug,Done,P4,,3/4/2022 7:18,,OBN 1.4.1,,,,,"*Steps:*

# Loggin as Reseller admin
# Go to “Open Applications->Application data->About its Payments” page
# Check Processing values

*Actual result:*

!Screenshot_2027.png|width=944,height=528!",,,58,,,0.5
[Prod]Processing value of active merchants is not displayed properly,OBN1-6709,Bug,Done,P4,,3/3/2022 12:40,,OBN 1.4.1,,,,,"*Steps:*

# Loggin as Reseller admin
# Go to “My referrers->Active Merchants“ page
# Check Processing Value

*Actual result:*

Minor units are displayed as funds

!Screenshot_2024.png|width=1144,height=521!",,,,,,0.5
Error on running migrations ,OBN1-6673,Bug,Done,P4,,2/28/2022 11:29,,OBN 1.4,,,,,"*Preconditions:*

# Use develop branch
# Run the migrations

*Actual result:*

!image-20220228-113036.png|width=846,height=492!",,,58,,,0.5
Refund interchange fee should be deduced from total in the invoices ,OBN1-6475,Bug,Done,P3,,2/8/2022 8:04,,OBN 1.5,,,,,"*Preconditions:*

# A card Refund transaction exists
# The BP type is mark-up

*Steps:*

# Generate the invoice
# Analyze the data

*Expected result:*

From total fees, the interchange value should be deducted

!image-20220208-080933.png|width=1248,height=323!

*Actual result:*

The interchange is not deducted",,,59,,,2
[Prod] Processing live transaction  ,OBN1-6315,Bug,Done,P1 ,,1/27/2022 8:18,,OBN 1.3.7,,,,,"# Reference for Refund >> ""RFND61a7a8a0c7fab"" (RFND+initial sale transaction id)
# Expected Settlement Date >> remove hours; replace authorised_at with processed_at in the calculation formula 
# PbBa transaction Status is still Pending and Expected Settlement Date is N/A 
# Report (reconciliation) was not generated 
# Settlement was not done",,,57,,,3
Validation is not applied when bps amount is 100%,OBN1-6292,Bug,Done,P4,,1/26/2022 9:03,,OBN 1.3.7,,,,,"*Steps:*

# POST user/referrer
# Add all required fields
# Add 100% value for bps total amount 

*Expected result:*

Submitted value cannot set if bps is 100%.

*Actual result:*

!Screenshot_1810.png|width=856,height=440!",,,56,,,1
As Referrer Bambora status shouldn't be retrieved on Application Status,OBN1-6236,Bug,Done,P4,,1/25/2022 9:54,,OBN 1.4.1,,,,,"*Preconditions:*

# An open application exists under Referrer

*Steps:*

# Log in as Referrer Admin
# Navigate to “Open Applications“ → “Application status“

*Actual result:*

Request is sent to “{{bambora/enrolment/{uuid}}}“ each time I expand a phase. 403 response received

!image-20220125-095642.png|width=1762,height=744!



*Expected result:*

As Referrer Admin, this request shouldn’t be sent to backend because it doesn’t have access to such details",,,58,,,0.5
[Prod] Remains should be transfering from OBN Clearing to Safeguard and viceversa,OBN1-6217,Bug,Done,P1 ,,1/20/2022 14:52,,OBN 1.3.4,,,,,"*Steps:*

There is a pending report and PENDING_AMOUNT is a negative value

*Expected result:*

Funds are moved from OBN Clearing to Safeguard

*Actual result:*

Funds are moved from OBN Holding to Safeguard",,,55,,,0.5
Gateway synchronization error when user name longer than 50 characters,OBN1-6207,Bug,Done,P1 ,,1/19/2022 12:11,,OBN 1.3.4,,,,,\[2022-01-19T11:17:16.537102+00:00] app.ERROR: Invalid data supplied.  userName: Value must be up to 50 printable characters in length. It must not contain colon characters and must not start or end with a space. fullName: Value must not be blank and no more than 50 characters long. Trace: #0 GatewayConnector.php 28: App\\Service\\Payment\\Cardstream\\Synchronizer->createCustomerUserAccount(..) #1 StepRunner.php 245: App\\Service\\Workflow\\Task\\GatewayConnector->execute(..) #2 StepRunnerHandler.php 34: App\\Service\\Workflow\\StepRunner->run(..) #3 HandleMessageMiddleware.php 63: App\\MessageHandler\\Workflow\\StepRunnerHandler->__invoke(..) #4 SendMessageMiddleware.php 74: Symfony\\Component\\Messenger\\Middleware\\HandleMessageMiddleware->handle(..) #5 RollbackIfExceptionMiddleware.php 33: Symfony\\Component\\Messenger\\Middleware\\SendMessageMiddleware->handle(..) #6 DoctrinePingConnectionMiddleware.php 34: App\\MessageHandler\\Core\\RollbackIfExceptionMiddleware->handle(..) #7 AbstractDoctrineMiddleware.php 45: Symfony\\Bridge\\Doctrine\\Messenger\\DoctrinePingConnectionMiddleware->handleForManager(..) #8 FailedMessageProcessingMiddleware.php 34: Symfony\\Bridge\\Doctrine\\Messenger\\AbstractDoctrineMiddleware->handle(..) #9 DispatchAfterCurrentBusMiddleware.php 68: Symfony\\Component\\Messenger\\Middleware\\FailedMessageProcessingMiddleware->handle(..) #10 RejectRedeliveredMessageMiddleware.php 48: Symfony\\Component\\Messenger\\Middleware\\DispatchAfterCurrentBusMiddleware->handle(..) \[] \[,,,55,,,0.5
Unexpected error on Gateway synchronization,OBN1-6204,Bug,Done,P4,,1/19/2022 7:31,,OBN 1.3.3,,,,,"!Screenshot_1781.png|width=281,height=231!",,,55,,,0.5
[Prod] Gateway synchronization error when Customer name longer than 50 characters,OBN1-6202,Bug,Done,P1 ,,1/19/2022 7:24,,OBN 1.3.3,,,,,"!Screenshot_1784.png|width=892,height=448!

Keep entire name on our side, trim the value that is sent to CS",,,55,,,0.5
[Prod] Error on EOD for mpa added through command on prod,OBN1-6188,Bug,Done,P2,,1/17/2022 7:29,,OBN 1.3.3,,,,,"*Error on prod:*

!image-20220117-072939.png|width=1284,height=537!",,,55,,,1
[Prod] WF runs when a step is on manual,OBN1-6187,Bug,Done,P1 ,,1/14/2022 16:49,,OBN 1.6,,,,,"To investigate why workflow for applications with ID 209 and 449 continue to run even “Ensure applicant MCC is permitted under Referrer” step was on manual 

!image-20220322-081251.png|width=914,height=402!

!image-20220322-081317.png|width=1152,height=537!



 ",,,62,,,5
Wrong validation message for BP fixed total amount,OBN1-6184,Bug,Done,P4,,1/14/2022 15:46,,OBN 1.3.7,,,,,"*Steps:*

# Login as Reseller admin
# Go to “My Referrers->Create referrer“ page
# Complete all required fields
# Add a value for fixed total amount less than share amount

*Expected result:*

Submitted value cannot be less than shared amount

*Actual result:*

!photo_2022-01-14_17-27-21.jpg|width=1222,height=741!",,,55,,,0.5
Error on external onboarding because of email length,OBN1-6183,Bug,Done,P3,,1/14/2022 13:08,,OBN 1.3.7,,,,,"*Preconditions:*

# Referrer with external API

*Steps:*

# Use owner or manager email 256 length

*Expected result:*

Owner/manager should be successfully saved 

*Actual result:*

Error received, because in Db max length is 255, but in DTO is 256

!image-20220114-132454.png|width=839,height=547!",,,55,,,0.5
"When Referrer has CS id, but not credentials, onboarding tries to be done under Referrer",OBN1-6181,Bug,Done,P2,,1/14/2022 7:11,,OBN 1.4.1,,,,,"*Preconditions:]*

# Referrer - has CS id, but not credentials

!image-20220114-071457.png|width=585,height=148!

*Steps:*

# Run gateway synchronization step

*Expected result:*

Merchant should be created under OBN Reseller

*Actual result:*

Merchant tries to be created under Referrer id (1), but with OBN’s user

+Acceptance Criteria:+

# Referrer credentials are mandatory if CS reseller ID is provided at referrer creation
# Referrer credentials fields are displayed only if the Cardstream Reseller ID is entered",,,59,,,2
Error is displayed on config when non-numeric key is pressed,OBN1-6169,Bug,Done,P4,,1/12/2022 9:18,,OBN 1.3.3,,,,,"*Steps:*

# Log in as Reseller Admin
# Navigate to Create Referrer
# Choose a processor
# Introduce 0 to Sale BPS
# Introduce then 1 and press a char button

*Actual result:*

!image-20220112-091840.png|width=1345,height=602!

*Expected result:*

Error message shouldn’t be displayed",,,55,,,0.5
Highest sales transaction value field shouldn't have maxim value 1000,OBN1-6157,Bug,Done,P4,,1/11/2022 9:35,,OBN 1.3.2,,,,,"*Preconditions:*

# Sign-up an applicant

*Steps:*

# Login as applicant
# Complete the required fields
# Try to add 1001 for ”Highest sales transaction value” field

*Actual result:*

Cannot add a value greater than 1000",,,55,,,0.5
Pdf commercial offer is not generated,OBN1-6145,Bug,Done,P4,,1/6/2022 14:15,,OBN 1.3.2,,,,,"*Preconditions:*

# Sign-up an applicant

*Steps:*

# Login as applicant
# Complete all the required fields
# Click “Submit“ button
# Check the offer

*Expected result:*

Commercial offer is generated

*Actual result:*

!Screenshot_1737.png|width=1142,height=521!

*P.S. It can be reproduced on dev and test environment*",,,54,,,1
"Address is not displayed on ""My details"" page for merchant",OBN1-6143,Bug,Done,P4,,1/6/2022 12:13,,OBN 1.3.2,,,,,"*Steps:*

# Login as Merchant admin
# Go to “My Organisations->My Details“ page

*Actual result:*

!Screenshot_1734.png|width=1139,height=533!",,,55,,,1
Error message displayed on 2 different panels,OBN1-6142,Bug,Done,P4,,1/6/2022 9:20,,OBN 1.3.1,,,,,"*Steps:*

# Log in as Reseller Admin
# Navigate to “Referrers“ page
# Create new Referrer
# Select card and pbba Net Revenue
# Try to create configs
# Leave 0 for refunds
!image-20220106-095159.png|width=714,height=229!
7. Expand then collapse the “OBn Terms” section

*Actual result:*

Error message repeats on “OBN Terms“ panel

!image-20220106-095150.png|width=990,height=740!",,,54,,,0.5
Application data is displayed for merchant user,OBN1-6141,Bug,Done,P4,,1/6/2022 8:55,,OBN 1.3.1,,,,,"*Steps:*

# Login as Merchant admin
# Go to “My Organisations->My Details“ page

*Actual result:*

!Screenshot_1726.png|width=910,height=529!",,,54,,,0.5
Total sale/refund fee values are overridden when Referrer has multiple BP configs ,OBN1-6140,Bug,Done,P2,,1/6/2022 8:54,,OBN 1.3.1,,,,,"*Steps:*

# Log in as Reseller Admin
# Navigate to My Referrers page
# Create new Referrer
# Select to create 2 BP configs
# Complete total for one BP
# Analyze the totals of second BP

*Expected result:*

Changing totals for one BP config shouldn't affect another one

*Actual result:*

Changing totals for one BP config affect other ones

!CPT2201061057-1529x903.gif|width=1529,height=903!",,,54,,,0.5
"Outlet is not deleted after update on ""About its Payments"" page",OBN1-6138,Bug,Done,P3,,1/5/2022 15:40,,OBN 1.4,,,,,"*Steps:*

# Navigate to 'About its Payments'
# Create 2 outlets
# navigate to “Review and Submit“
# Go back to “About its Payments“ and delete one outlet

*Expected result:*

The deleted outlet should be deleted also in “payment_merchant_outlets“ table

*Actual result:*

Outlet is deleted just in form data of the applicant. If I navigate to “Active Merchants“ → “Open Applications“ ->”Outlets” I’m still able to see deleted outlet",,,55,,,0.5
Error received on transaction synchronization with CS on prod,OBN1-6086,Bug,Done,P2,,12/28/2021 14:15,,,,,,,"*Steps:*

# Run {{cardstream:sync-payments}} cron

*Actual result:*

Timeout error received on production

!image-20211228-141826.png|width=1475,height=577!",,,54,,,3
"Fix validation for ""Existing Gateways"" field (external API)",OBN1-6066,Bug,Done,P3,,12/24/2021 14:24,,OBN 1.3.1,,,,,"Remove 

@Assert\Choice(callback={""App\Entity\Payment\Merchant"", ""gateways""}, multiple=true)

from property

\App\Dto\Payment\Merchant\MerchantExternalRequestDto::$existingGateways",,,54,,,0
[Prod] Unsaved changes pop-up appears in Production ,OBN1-6058,Bug,Done,P3,,12/23/2021 14:11,,OBN 1.3.1,,,,,"+Steps to reproduce:+

# Log into production 
# Navigate to My Organisation >  Settlement Bank Account
# Navigate to Manage Users screen

+Actual Results:+
Unsaved changes pop-up appears

+Expected Results:+
User can navigate through the portal without any issues ",,,53,,,0.5
BP config details not displayed on production ,OBN1-6057,Bug,Done,P2,,12/23/2021 13:58,,OBN 1.3.1,,,,,"*Preconditions:*

# Log in as Reseller
# Log in production

*Steps:*

# Navigate to “My Referrers“
# Expand Referrer with id=2
# Navigate to “Billing Plan“

*Expected result:*

Referrer BP config and Referrer BP should have Net Revenue profit type

*Actual result:*

Referrer BP config - has Mark up type

Referrer BP - has Net revenue type",,,54,,,1
Disputes alignment on production is broken,OBN1-6054,Bug,Done,P4,,12/23/2021 10:18,,OBN 1.3.1,,,,,"*Preconditions:*

# Use production environment

*Steps:*

# Log in as Reseller Admin
# Open the BP of the Referrer

*Actual result:*

The disputes alignment is broken

!image-20211223-101917.png|width=1310,height=396!",,,53,,,0.5
Error on update Reseller BP config,OBN1-6028,Bug,Done,P3,,12/21/2021 14:17,,OBN 1.3.1,,,,,"*Steps:*

# Log in as Reseller
# Navigate to “My Organisations” → “Merchant BP“
# Try to update the config values

*Expected result:*

Values should be successfully updated

*Actual result:*

500 error received

!image-20211221-142057.png|width=1266,height=944!",,,53,,,1
Referrer address is displayed as null,OBN1-6019,Bug,Done,P4,,12/21/2021 7:54,,OBN 1.3,,,,,"*Steps:*

# Log in as Reseller admin
# Go to “Active Referrers-> Referrer Dashboard“ page
# Check the address

*Actual result:*

!Screenshot_1612.png|width=1141,height=526!",,,53,,,0.5
Report is not updated when all the Sales are processed,OBN1-6018,Bug,Done,P2,,12/20/2021 15:56,,OBN 1.3,,,,,"*Steps:*

# A report comes from Bambora
# All sales are successfully processed

*Expected result:*

The report should be successfully processed

*Actual result:*

Step result doesn’t change",,,53,,,0.5
Report is not processed when report from previous day misses,OBN1-6009,Bug,Done,P3,,12/16/2021 13:49,,OBN 1.3,,,,,"*Preconditions:*

# There a pending report processed on date X-2 days

*Steps:*

# Another pending report comes on date X
# Try to process refunds 

*Expected result:*

Report should be successfully processed

*Actual result:*

!image-20211216-141625.png|width=574,height=23!",,,53,,,0.5
Duplicate entry exception on running fixtures,OBN1-6008,Bug,Done,P4,,12/16/2021 13:23,,OBN 1.3,,,,,"> loading App\\DataFixtures\\Payment\\ReferrerSettlementFixtures


In AbstractMySQLDriver.php line 74:

An exception occurred while executing 'INSERT INTO payment_referrer_settlements (uuid, fee_units, settled_units,
created_at, referrer_id, stlmt_payment_uuid) VALUES (?, ?, ?, ?, ?, ?)' with params \[""0becbf3a-07fd-4f92-8fae-1
b04e1cf3600"", 944, 72427, ""2021-12-06 22:24:52"", 1, ""6983eb55-ca95-4fa7-aa3b-cb5c79ce39f2""]:



SQLSTATE\[23000]: Integrity constraint violation: 1062 Duplicate entry '1-2021-12-06 22:24:52' for key 'payment_r
eferrer_settlements.UNIQ_3C7739FE798C22DB8B8E8428'

In Exception.php line 18:


SQLSTATE\[23000]: Integrity constraint violation: 1062 Duplicate entry '1-2021-12-06 22:24:52' for key 'payment_r
eferrer_settlements.UNIQ_3C7739FE798C22DB8B8E8428'


In PDOStatement.php line 112


SQLSTATE\[23000]: Integrity constraint violation: 1062 Duplicate entry '1-2021-12-06 22:24:52' for key 'payment_r
eferrer_settlements.UNIQ_3C7739FE798C22DB8B8E8428'


doctrine:fixtures:load \[--append] \[--group GROUP] \[--em EM] \[--purger PURGER] \[--purge-exclusions PURGE-EXCLUSIONS] \[--shard SHARD] \[--purge-with-truncate]",,,53,,,0.5
Wrong scheme value for PBBA transactions,OBN1-5984,Bug,Done,P3,,12/13/2021 14:27,,OBN 1.3,,,,,"*Preconditions:*

# Scheme fee = 5
# Referrer share = 10

*Steps:*

# Create a sale transaction for PBBA

*Expected result:*

payment_requests_to_pay.sale_scheme_fee_units = 5

*Actual result:*

payment_requests_to_pay.sale_scheme_fee_units = 15 (it includes sale_referrer_share_units, but it shouldn’t)

*P.S. -* for Bambora, payment_requests_to_pay.sale_scheme_fee_units should be NULL, because this value is saved in *payment_rtp_processor_fee*",,,53,,,1
In commercial offer  total floor should be displayed not diference,OBN1-5982,Bug,Done,P1 ,,12/13/2021 14:06,,OBN 1.3,,,,,"*Steps:*

# Onboard a merchant
# Check the floor from commercial offer

*Expected result:*

!Screenshot_1548.png|width=874,height=413!

*Actual result:*

!Screenshot_1547.png|width=859,height=263!",,,53,,,2
Error on Bambora file reading when empty line ,OBN1-5803,Bug,Done,P5,,11/24/2021 16:01,,OBN 1.3,,,,,"*Preconditions:*

# Bambora file contains an empty line

!image-20211124-161450.png|width=955,height=132!

*Steps:*

# Import file from Bambora

*Actual:*

!image-20211124-161533.png|width=968,height=20!",,,52,,,0.5
Error on sign-up when user exists,OBN1-5719,Bug,Done,P1 ,,11/16/2021 12:23,,OBN 1.3,,,,,"*Preconditions:*

# User with email 'user@test.com' exists

*Step:*

# Navigate to sign-up
# Use email  'user@test.com' to sign-up for another organisation

*Expected result:*

A validation error should be thrown that email exists

*Actual result:*

The application is created.

Any email isn’t sent to anyone.",,,53,,,0.5
"Add a proper error message in ""About its Payments"" when CS connection error",OBN1-5584,Bug,Done,P4,,10/28/2021 14:16,,OBN Portal Release 1.2.9,,,,,"*Preconditions:* 

Issue on connection with CS (500 error code)

*Steps:* 

# Sign up a merchant
# Complete all the onboarding steps
# Choose “Cardstream“ gateway on “About its Payments“
# Introduce gateway customer id

*Expected:* 

The “We're unable to verify the customer ID provided, please try again.“ error should be displayed

*Actual*

The error message displayed is “500“

!image-20211028-132322.png|width=499,height=244!",,,49,,,1
Error on creating Referrer,OBN1-5553,Bug,Done,P1 ,,10/26/2021 18:09,,,,,,,"*Steps:*

# Navigate to “Create Referrer“ page
# Complete all the fields
# Submit the details

*Expected result:*

Referrer should be created

*Actual result:*

!image-20211026-171044.png|width=612,height=527!",,,49,,,0.5
API doc - When executing a request all status codes are updated,OBN1-5552,Bug,Done,P2,,10/26/2021 15:06,,OBN Portal Release 1.2.9,,,,,"*Steps:*

# Access API doc
# Login as referrer admin
# Go to any page
# Click “Try it out“ button
# Click “Execute“ button

*Expected result:*

Response is displayed according to description

*Actual result:*

!Screenshot_1159.png|width=1139,height=528!",,,50,,,2
Error message is not displayed on UI when email/password is wrong,OBN1-5539,Bug,Done,P4,,10/25/2021 12:41,,,,,,,"*Steps:*

# Access login page
# Introduce wrong credentials
# Click “Log in“ button
# Check the display

*Expected result:*

Error message is displayed

*Actual result:*

!Screenshot_1121.png|width=1146,height=531!",,,49,,,0.5
[Prod] WF step order display in UI ,OBN1-5517,Bug,Done,P1 ,,10/21/2021 13:15,,OBN Portal Release 1.2.9,,,,,"!image-2021-10-21-15-15-16-465.png|width=200,height=183!

 
[https://portal.obnglobal.com/my-organisation/my-workflows/2285f7e5-080e-44fe-ad34-6175dd101a6c|https://portal.obnglobal.com/my-organisation/my-workflows/2285f7e5-080e-44fe-ad34-6175dd101a6c]

+Steps:+

# Update in DB workflow step order 

+Expected:+

Logged as an Referrer in “My Organisation > My Workflows” and in “My Merchant > Open Application > Application Status“ I want to see the new order

+Actual:+

Old order is displayed ",,,49,,,0.5
Validation required that CS customer id doesn't exist already in our system,OBN1-5501,Bug,Done,P4,,10/20/2021 15:08,,OBN Portal Release 1.2.9,,,,,"*Preconditions:*

# In “payment_merchant_gateway_connections“ exists a record with “411“ eid

*Steps:*

# Sign-up with another merhcant
# On “About its Payments“ select:
## Cardstream gateway
## Introduce “411“ as customer id

*Expected result:*

A validation error should be thrown saying that this customer had already an account in our system

*Actual result:*

The id is accepted if it exists in CS and during the workflow this issue is received:
{{app.ERROR: An exception occurred while executing 'INSERT INTO payment_merchant_gateway_connections (eid, status, error_message, user_eid, user_status, user_error_message, details, created_at, updated_at, merchant_id, gateway_name) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' with params [""4911"", ""SYNCHRONISED"", null, null, ""CREATED"", null, null, ""2021-10-20 13:27:19"", null, 13, ""CARDSTREAM""]:  SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '4911' for key 'payment_merchant_gateway_connections.UNIQ_1CEE44294FBDA576'}}",,,49,,,0.5
Error on Referrer creation for existing Resellers in CS,OBN1-5498,Bug,Done,P2,,10/20/2021 13:04,,OBN Portal Release 1.2.9,,,,,"*Preconditions:*

# Log in as Reseller Admin
# CS returns 500 error 

*Steps:*

# Navigate to Referrers page
# Create new Referrer
# Introduce CS credentials

*Expected result:*

The 500 error should be treated properly: retry or return validation error

*Actual result:*

!image-20211020-120421.png|width=1151,height=448!",,,49,,,0.5
EWD should be ignored for non-active Merchants,OBN1-5476,Bug,Done,P2,,10/19/2021 10:30,,OBN Portal Release 1.2.7,,,,,"*Preconditions:*

# Merchants is still Pending

*Steps:*

# EWD comes

*Expected result:*

At EWD merchants non-active should be skipped

*Actual result:*

!image-20211019-094634.png|width=810,height=275!",,,49,,,0.5
[Prod] Onboarded merchant cannot be found under Cardstream ,OBN1-5474,Bug,Done,P1 ,,10/19/2021 8:54,,OBN Portal Release 1.2.7,,,,,"Lincoln College was submitted as the first merchant last week.  The WF suggests that this has been onboarded with the gateway, but Adam cannot see it in CAS.  

It should be under Take Payments in Cardstream with a PbBA processor, but inactive for now",,,49,,,3
Settlement webhook error received for merchants under Reseller/Referrer without external API,OBN1-5447,Bug,Done,P1 ,,10/15/2021 14:42,,OBN 1.3,,,,,"*Preconditions:* 

# Merchant under Reseller or Referrer which uses UI

*Steps:* 

# Settlement time comes
# There are enough funds for settlement and payment to external bank account is performed

*Actual result:*

The webhook sending is put in messenger


!image-20211015-134551.png|width=770,height=63!

And error recorded in logs:

!image-20211015-134650.png|width=1219,height=35!",,,49,,,1
Refund fees should be treated properly in Reports,OBN1-5403,Bug,Done,P3,,10/11/2021 13:24,,OBN Portal Release 1.2.9,,,,,"*Preconditions:*

# There are refunds in payment_requests_to_refund
# Refund is linked to a RTP authorized X days ago

*Steps:*

# End of day comes

*Expected:*
In the reports parts, the *refund_fee_count* and *refund_fee_volume* should be taken from payment_requests_to_refund based on created_at

*Actual:*

Details are taken from RTP ( refunded_minor_units, refund_count)",,,48,,,0.5
Webhook - Wrong error response when time is out,OBN1-5367,Bug,Done,P4,,10/7/2021 10:03,,OBN Portal Release 1.2.5,,,,,"*Actual:*

When 500 error from Referrer on webhook sent, exception received

!image-20211011-133204.png|width=509,height=178!",,,48,,,0.5
My Merchants-Open Applications-Status of steps is displayed upper,OBN1-5327,Bug,Done,P4,,10/4/2021 13:11,,OBN 1.3.1,,,,,"*Preconditions:*

# Referrer accepts just MCC with id = 1

*Steps:*

# Merchant onboards under Referrer
# Merchant has MCC with id = 2
# Workflow stops and is under manual review
# Login as Reseller admin
# Go to My Merchants->Open Applications
# Check the steps

*Actual result:*

!Screenshot_911.png|width=1121,height=524!",,,53,,,1
"""New funds volume"" from reports should consider the difference between payments",OBN1-5258,Bug,Done,P4,,9/24/2021 15:53,,OBN Portal Release 1.2.5,,,,,"*Preconditions:* 

# There are transactions performed during current day
# The transaction records differences between asked and authorized values

!image-20210924-145913.png|width=310,height=234!



*Steps:*

# Run EWD job

*Expected result:* 

When new funds are recorded it should be: minor_units + difference_between_payment

!image-20210924-145951.png|width=399,height=188!

*Actual result:*

Difference is not recorded. It just sums all values",,,48,,,0.5
After splitting payment_requests_to_refund.refund_referrer_share_units is not populated,OBN1-5230,Bug,Done,P1 ,,9/21/2021 15:27,,OBN Portal Release 1.2.4,,,,,"*Steps:*

# Transaction is authorized
# Perform a Refund for the transaction

*Expected result:*

After splitting payment_requests_to_refund.refund_referrer_share_units is populated 

*Actual result:*

!Screenshot_795.png|width=661,height=517!

!Screenshot_796.png|width=1141,height=517!",,,47,,,1
"External documentation - ""Log in"" button should reappear when token expires",OBN1-5206,Bug,Done,P4,,9/17/2021 7:32,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# I’m on external documentation
# I have a valid token

*Steps:*

# Wait 15 minutes
# send a request

*Expected result:*

The token is expired and “Log in“ button becomes visible in the right up corner

*Actual result:*

Error received from backend. However, “Log in“ button is not available even after reloading page

!image-20210917-063420.png|width=838,height=386!",,,47,,,0.5
Re-align the column names on the Reports page,OBN1-5166,Bug,Done,P5,,9/14/2021 14:21,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# Use a smaller sreen

*Steps:*

# Navigate to Reports page
# Expand details from “*_New funds received since start of period_*“

*Expected result:*

Text should get smaller 

*Actual result:*

!image-20210914-132329.png|width=1128,height=330!",,,47,,,0.5
Reports not updated correctly when merchant has multiple outlets,OBN1-5164,Bug,Done,P1 ,,9/14/2021 13:23,,OBN Portal Release 1.2.5,,,,,"*Preconditions:*

# There are 2 Merchants
# One merchant has 2 outlets
# Each outlet has its own mpa

*Steps:*

# Create a transaction for one of the mpa's
# Run EWD command

*Actual result:*
The report parts are not generated correctly 

The report parts are not updates correctly (any values aren’t changed)

*Expected result:*

For each mpa should be generated a report part.

Values in the report parts should be updates correctly",,,48,,,1
EWD populated report part for 2 days ago,OBN1-5108,Bug,Done,P1 ,,9/3/2021 14:36,,OBN 1.3.1,,,,,"*Preconditions:*

# Is 16 PM hour (MD)
# Change in env file {{WORKING_DAY_END_HOUR=14}}
# Is 03.09

*Steps:*

# Transaction A was performed on 03.09
# End of working day comes

*Expected:*

Report part from 02.09 should be updated

*Actual:*

Report part from 01.09 is updated",,,47,,,1
Wrong error message for wrong attempts on authentication ,OBN1-5106,Bug,Done,P4,,9/3/2021 10:03,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# User has 6 wrong authentication attempts

*Steps:*

# Log in again with wrong credentials

*Expected result:*

A proper error should be displayed

*Actual result:*

!image-20210903-090403.png|width=342,height=86!",,,46,,,0.5
[Prod] Leaked password error not displayed on UI,OBN1-5101,Bug,Done,P4,,9/2/2021 12:19,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# User asked for reset password

*Steps:*

# Access the link
# Try to put “qwertY@123” password 

*Expected result:*

Error received from backend should be displayed in ui

*Actual result:*

!image-20210903-124539.png|width=903,height=562!",,,46,,,0.5
External documentation - list endpoint not correctly pinned ,OBN1-5096,Bug,Done,P4,,9/2/2021 11:12,,OBN Portal Release 1.2.4,,,,,"*Steps:*

# Go to external documentation
# Click on “Authentication“
# Refresh the page
# Use arrow and expand endpoint
# Use arrow and expand “Merchant Onboarding“
# Click on “MCC” endpoint

*Expected result:*

The MCC value should remain highlighted

*Actual result:*

The highlighting goes upper 

!CPT2109021326-1688x860.gif|width=1688,height=860!",,,46,,,0.5
Error on saving owners,OBN1-5076,Bug,Done,P1 ,,9/1/2021 12:00,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# Applicant has Partnership organisation type

*Steps:*

# Complete “About the Business“ step
# Introduce the ownership 100%
# Try to save the “About the Owners“

*Expected result:*

Owner should be successfully saved

*Actual result:*

Error received

!image-20210901-111127.png|width=877,height=524!",,S1,48,,,0.5
Edit commercial offer and workflow buttons shouldn't be available for Referrer users,OBN1-5072,Bug,Done,P4,,8/26/2021 13:31,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# Merchant signed-up under Referrer
# Commercial offer is ready

*Steps:*

# Log in as Referrer Admin
# Navigate to Open Applications

*Expected result:*

Edit commercial offer SHOULDN’T be editable for Referrer.

Access to “Reject/Continue“ buttons from workflow should be hidden for Referrer admin

*Actual result:*

Referrer has access to edit offer fields (but backend throws 403).

Referrer has access to Reject/Approve button (but backend throws 403).",,,45,,,
null value on outlet MCC when industry not selected ,OBN1-4923,Bug,Done,P4,,8/17/2021 14:56,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# Merchant successfully signed up

*Steps:*

# Navigate to “About its Payments“
# Don’t select anything in the merchant industry
# Go to Outlet and click on “Please confirm the outlet's Merchant Category Code“

*Expected result:*

An empty list should be displayed

*Actual result:*

!image-20210817-135740.png|width=810,height=685!",,,45,,,
All merchant Xero contacts are created under OBN contact group,OBN1-4884,Bug,Done,P1 ,,8/13/2021 15:21,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

# Merchant onboards under Referrer

*Steps:*

# Onboarding passes
# Record merchants to Xero job runs
# Assign merchant to contact group job runs

*Expected result:*

Merchant should be assigned under Referrer contact group

*Actual result:*

All the Merchants are recorded under Reseller contact group",,,46,,,0.5
Doctrine update entity issues,OBN1-4854,Bug,Done,P1 ,,8/12/2021 11:05,,OBN Portal Release 1.2.4,,,,,,,,44,,,1
[Prod] Menu is not collapsed in API doc,OBN1-4815,Bug,Done,P3,,8/10/2021 7:21,,OBN Portal Release 1.2.2,,,,,"*Steps:* 

# Expand ""Notifications""
# Expand ""Merchant Onboarding"" 
# Expand "" Reporting"" 
# Collapse ""Merchant Onboarding"" 

*Expected result:*
""Merchant Onboarding"" is collapsed

*Actual result:*
""Merchant Onboarding"" should be clicked twice to be collapsed

*Note\!* check all items under menu",,,44,,,0.5
Add proper description for Settlement Frequency field,OBN1-4798,Bug,Done,P1 ,,8/9/2021 14:06,,OBN Portal Release 1.2.2,,,,,"*Steps:*

# Navigate to external documentation
# Expand the “OBN commercial offer available“ 

*Expected result:*
Description of the “Settlement Frequency“ field should be displayed properly


*Actual result:*

!image-20210809-131307.png|width=793,height=131!",,,44,,,0.5
"Wrong email sent when error on step ""Present commercial offer for signing""",OBN1-4766,Bug,Done,P4,,8/4/2021 14:07,,,,,,,"*Steps:*

# Use “throw new DomainException('merchant-risk-group-assign-failure', 'Cannot assign default risk group for merchant');“ exception generation inside of the task

*Expected result:*
”Account configuration error - present commercial offer for signing” message should be sent

*Actual result:*

!image-20210804-130715.png|width=1071,height=334!

!image-20210804-130726.png|width=1207,height=702!",,,44,,,0
Send SalesDefaultAccountCode instead of purchaseAccountCode for Xero Merchant Contact,OBN1-4738,Bug,Done,P3,,8/2/2021 10:24,,OBN Portal Release 1.2.1,,,,,"*Steps:*

# Create a Merchant Contact in Xero

*Expected:*

On Merchant contact creation, SalesDefaultAccountCode field should be sent

*Actual result:*

The purchaseAccountCode field is sent instead",,,43,,,0.5
500 error on receiving Starling notification with duplicated fp_id,OBN1-4710,Bug,Done,P4,,7/27/2021 15:28,,OBN Portal Release 1.2.4,,,,,"*Preconditions:*

In the payment_requests_to_pay exists a record with fp_id = “string“

*Steps:*

# Send a POST request to “/payment/starling/notification/fps-inbound“ using fp_id = “string“

*Actual result:*

!image-20210727-144426.png|width=919,height=397!",,,44,,,1
Error on updating Referrer,OBN1-4692,Bug,Done,P1 ,,7/22/2021 13:49,,OBN Portal Release 1.2.3,,,,,"*Preconditions:*

# Referrer exists 

*Steps:*

# Log in as Reseller Admin
# Navigate to “My Referrers“ → “Active Referrers“
# Try to update a Referrer dashboard

*Expected result:*
Referrer should be successfully updated

*Actual result:*

!image-20210722-131112.png|width=1477,height=726!",,,43,,,1
Exploratory issues ,OBN1-4621,Bug,Done,P4,,7/15/2021 14:15,,OBN Portal Release 1.2.1,,,,,"# hyperlink redirect from My Referrer - should display the opened profile for Active Merchants/Open Applications
# My Referrer > Referrer Dashboard - remove the ""(subdomain)"" word from the link with Referrer cobranded URL
# Cobranding (or branding) the Reset button from ""Logo"" section is not working ",,,42,,,1
"Onboarding - Upload documents - Validation message - ""address"" word is duplicated",OBN1-4606,Bug,Done,P5,,7/14/2021 13:32,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Sign up a merchant

*Steps:*

# Log in as applicant
# Complete mandatory fields
# Leave “Business owner proof of residential address” field empty
# Click “Next“ button

*Expected result:*
Validation message “Business owner proof of residential address is required“ is displayed.

*Actual result:*

!Screenshot_186.png|width=785,height=487!",,,42,,,0.5
Referrer can be created with empty values for Medium and Low config values,OBN1-4604,Bug,Done,P4,,7/14/2021 12:00,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Log in as Reseller Admin

*Steps:*

# Navigate to “Create Referrer“ page
# Complete just “High“ risk values
# Leave Medium and Low risks tabs
# Submit the details
# !image-20210714-111326.png|width=645,height=461!

*Expected result:*

A validation error should be received. Referrer shouldn’t be saved

*Actual result:*

Referrer is successfully created.

!image-20210714-111308.png|width=731,height=534!",,,42,,,0.5
[Prod] Wrong BP total calculation for Merchant BP,OBN1-4600,Bug,Done,P3,,7/13/2021 17:42,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Log in on stage
# Analyze Merchant with id 62

*Steps:*

# Log In as Reseller admin
# Navigate to Merchants page
# Open BP of one Merchant (which is under Referrer)

*Actual result:*
The total should be displayed between Reseller and Referrer fees

*Expected result:*
Total should be 0.4

!image-20210713-164237.png|width=1485,height=630!

Note \! “My Merchants > Active Merchants > Billing Plan” and “My Merchants > Merchant Billing Plan”",,,42,,,0.5
Operation not allowed error when expanding approved merchant details,OBN1-4585,Bug,Done,P4,,7/12/2021 15:32,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# A merchant with status Approved exists
# Log in as Reseller Admin

*Steps:*

# Navigate to “My Merchants->Open Applications“ page
# Expand an approved merchant
# Check the display

*Expected result:*
Merchant details are displayed

*Actual result:*


!Screenshot_158.png|width=1151,height=538!",,,42,,,0.5
BP config default completed on Referrer creation,OBN1-4571,Bug,Done,P4,,7/9/2021 9:35,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Log in as Reseller Admin

*Steps:*

# Navigate tp “Active Referrers“ page
# Click on “Create Referrers“ button
# Complete all the field till “BP config“ 

*Expected result:*
BP Config fields should empty

*Actual result:*
Fields are pre-populated with 0 values",,,42,,,0.5
Change name to businessTradingName on Referrer creation,OBN1-4569,Bug,Done,P3,,7/8/2021 17:06,,OBN Portal Release 1.2.1,,,,,"*Steps:*

# Navigate to “Create Referrer“ page
# Complete all mandatory fields

*Expected result:*
The Referrer should be created

channge {{name}}to {{businessTradingName}}

*Actual result:*


!image-20210708-160811.png|width=739,height=118!",,,41,,,0.5
Referrer name comes empty on Active Referrers page,OBN1-4568,Bug,Done,P1 ,,7/8/2021 16:16,,OBN Portal Release 1.2.1,,,,,"*Steps:*

# Log in as Reseller Admin
# Make a GET request tp “/my-referrers/active-referrers” 

*Expected result:*
Referrer name should be returned

*Actual result:*

!image-20210708-151900.png|width=1003,height=567!",,,41,,,0.5
Soft delete is made instead of hard delete,OBN1-4521,Bug,Done,P4,,7/5/2021 12:25,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# User signed-up 2 days ago and didn’t confirm it

*Steps:*

# Run obn:delete-users:expired-pwd-token job

*Expected result:*
User, organisation and application should be hard deleted

*Actual result:*
The user is just soft deleted.
Organisation and application are not deleted at all.",,,42,,,3
[Prod] Wrong value for My Organisation > Settlement Bank Account,OBN1-4513,Bug,Done,P4,,7/2/2021 16:11,,OBN Portal Release 1.2.1,Prod,,,,"“My Organisation > Settlement Bank Account” – The value for Balance is 0.00 however it should be 0.016

*Expected result:*
Value from GET “{{payment/external-bank-account/balance}}“ should return amount from *_payment_accounts_* where type = “OBN_HOLDING“

P.S. - value displayed in UI should take into account the payment_merchants.debt_to_referrer_units

*Actual result:*
Value is returned from account with type=”OBN_EXTERNAL”, which is Bank Account of the Reseller",Production,,43,,,1
[Prod] Deducted fee value is not according to the commercial offer,OBN1-4511,Bug,Done,P4,,7/2/2021 16:09,,OBN Portal Release 1.2.1,Prod,,,,"Deducted fee value is not according to the commercial offer. The total value for sale is 0.40% (0.20% OBN + 0.20% Referrer). For a £8 transaction the fee should be 0.032 (8*0.40/100) however the deducted value from Activity table is 0.02. My assumption is that it is taken separately 0.016 for OBN and 0.016 for Referrer and because we store in minor units we store 0.01 for OBN and 0.01 for Referrer. 

Referrer fee - 0.016 *100 = 1.6 → 2 (deduct this value)

OBN fee - 0.016 *100 = 1.6 → 2 (deduct this value)

Total = 4

0.011*100=1.1 → 1 

round down until .4 (1.499 → 1)

round up from .5 (1.500 → 2)

Note\! Run regression for transaction splitting ",Production,,43,,,3
"[Prod] Application status is not set to ""Completed"" when all workflow steps passed",OBN1-4510,Bug,Done,P4,,7/2/2021 16:09,,OBN Portal Release 1.2.1,,,,,"For first onboarded merchant the workflow status is not updated to ""Completed"" when all workflow steps passed
The onboarded merchant cannot log into the portal",Production,,42,,,1
"Error on ""About the Business"" because of new URL format",OBN1-4502,Bug,Done,P2,,7/2/2021 12:48,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Sign-up an applicant with new URL format

*Steps:*

# Confirm the sign-up
# Log in and complete “About the Business“

*Actual result:*
The new format of the URL is not accepted on “About the Business“ page

!image-20210702-121313.png|width=1360,height=734!",,,41,,,0.5
"Error on getting workflows for Reseller with ""REFERRERS_FULL"" permissions",OBN1-4497,Bug,Done,P4,,7/2/2021 9:25,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Log in as Reseller standard with “REFERRERS_FULL“ permission

*Steps:*

# Navigate to “Active Referrers“
# Expand a Referrer
# Click to edit it

*Expected result:*

User should be able to edit the Referrer dashboard



*Actual result:*


!image-20210702-082913.png|width=1046,height=612!",,,41,,,1
MCC remains populated after creation of a Referrer,OBN1-4477,Bug,Done,P4,,6/30/2021 15:21,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# Log in as Reseller Admin
# Create a Referrer

*Steps:*

# Try to create another Referrer

*Actual result:*
The MCC is populated with values of previous Referrer.

!image-20210630-142455.png|width=677,height=289!



When I save the data, an error is received

!image-20210630-142635.png|width=651,height=253!",,,41,,,1
On Referrer creation address is not saved accordingly ,OBN1-4442,Bug,Done,P3,,6/28/2021 12:13,,OBN Portal Release 1.2.1,,,,,"On creation Referrer, address is not saved in user_organizations",,,41,,,2
Wrong authentication attempts are not reset after 30 minutes,OBN1-4418,Bug,Done,P4,,6/24/2021 16:00,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# User’s account was locked because of wrong attempts
# 30 min passed after account locking

*Steps:*

# Try to authenticate with wrong password

*Expected result:*
The counter should be reset and locked_at should become null

*Actual result:*
The counter continues to increment and locked_at remains unchanged",,S2,42,,,3
Issues on Refund from CS,OBN1-4416,Bug,Done,P1 ,,6/24/2021 13:08,,OBN 1.12,MVP,,,,"* NT should update the endpoint to “POST /payment/\{MERCHANTID}/zapp/refund” → fixed under [https://cardstream.atlassian.net/browse/TD-2382|https://cardstream.atlassian.net/browse/TD-2382|smart-link] 
* Gateway Transaction ID → _reference in our DB_ {color:#36b37e}_request_to_pay.reference_{color} _-_ {color:#36b37e}_NOW IS NULL or gateway_transaction_id (Obs. gateway_transaction_id is set only for Bambora)_ {color}_→ to be added details for PbBA; for PBBA we don't have now this field. Now we display the reference from PbBa_
** {color:#ff5630}waiting for CS to change the implementation and send the gateway transaction id in the Submit RTP for PbBa{color}",,,70,,,5
obn:delete-users:expired-pwd-token affects ALL the users from the system,OBN1-4360,Bug,Done,P1 ,,6/18/2021 13:28,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*
1. Merchant  with workflow completed

2. There is a new admin user which received sign-up-confirm email more than 2 days ago and he didn’t confirm it

3. There is an Reseller admin user with password reset more than 2 days ago and he didn’t access it

4. The *_obn:delete-users:expired-pwd-token_* job runs

*Expected result:*
The users WHICH ARE NOT linked to an applicant IN-Progress SHOULDN”T be considered by this job

*Actual result:*
They are considered",,,41,,,1
Sign-up confirm email shouldn't be sent to the user which did the sign up and is owner at the same time,OBN1-4327,Bug,Done,P2,,6/17/2021 9:51,,OBN Portal Release 1.2.1,,,,,"*Preconditions:*

# User ”[test@IS747KpcGwBECg5R.com|mailto:test@IS747KpcGwBECg5R.com]” applied for sign-up

*Steps:*

# Complete the About its Owners step
# Use ”[test@IS747KpcGwBECg5R.com|mailto:test@IS747KpcGwBECg5R.com]” as owner email
# Submit the onboarding details
# Workflow passed the “Activate Merchant“ workflow step

*Expected result:*
The Merchant should be active.
An email should be sent to ”[test@IS747KpcGwBECg5R.com|mailto:test@IS747KpcGwBECg5R.com]” email


!image-20210617-085414.png|width=565,height=314!

*Actual result:*
Also this email is sent and a reset password link is generated for the user which already confirmed the sign-up 

!image-20210617-085441.png|width=1041,height=453!",,S2,41,,,1
Workflow's phase enumeration is wrong when phases are shifted,OBN1-4326,Bug,Done,P5,,6/17/2021 9:31,,OBN Portal Release 1.2,,,,,"GET /workflow/\{uuid}

*Preconditions:*

# An workflow with shifted phases exists
# Log in as Reseller Admin

*Steps:*

# Go to “My Organisation”->”My Workflows” page
# Select the workflow
# Check the phase enumeration

*Expected result:*
The enumeration is consecutive.

*Actual result:*

!Screenshot_77.png|width=1129,height=525!",,,40,,,0.5
The domain validation doesn't pass for new URL format,OBN1-4289,Bug,Done,P3,,6/15/2021 9:51,,OBN Portal Release 1.2.1,,,,,"*Steps:*

# Navigate to “sign-up“ page
# Introduce “[www.obn.com|http://www.obn.com]“ Business URL
# Introduce “test@obn.com“

*Expected result*
The application should be successfully accepted

*Actual result:*
Application is rejected

!image-20210615-085454.png|width=757,height=260!",,,41,,,0.5
"[External API] Error thrown at “Total ownership % must add up to 100%.""",OBN1-4274,Bug,Done,P1 ,,6/14/2021 11:19,,OBN Portal Release 1.2,,,,,"“Total ownership % must add up to 100%."" No matter what value is added an error is thrown ",,,40,,,0.5
Starling notification issue,OBN1-4266,Bug,Done,P1 ,,6/11/2021 15:03,,OBN Portal Release 1.2,,,,,,,,39,,,0.5
Disabled steps are displayed ,OBN1-4207,Bug,Done,P4,,6/8/2021 15:15,,OBN 1.9,,,,,"*Preconditions:*

# Log in as Reseller Admin

*Steps:*

# Navigate to “My Organisation”->”My Workflows“ page
# Select an workflow
# Check if disable steps for that workflow are displayed

*Expected result:*
Only available steps are displayed.

*Actual result:*
All steps are displayed.

!Screenshot_39.png|width=323,height=230!

!Screenshot_38.png|width=885,height=540!",,,66,,,1
EOD(End of Working Day) shouldn't affect  Merchants without Holding Account,OBN1-4170,Bug,Done,P1 ,,6/4/2021 15:30,,OBN Portal Release 1.2,,,,,"*Preconditions:*
1. Merchant without holding Account 

*Steps:*

# End of working day comes and “{{obn:working-hour}}“ command runs

*Expected result:*
The cron job should consider just the Merchants with Holding Account

*Actual result:*
The job considers all the Merchants and throws error because Holding Account of the Merchant misses",,,39,,,1
Email not sent when Kompli goes to manual ,OBN1-4165,Bug,Done,P3,,6/4/2021 13:41,,OBN Portal Release 1.2,,,,,When Kompli case becomes “NEEDS_REVIEW“ an email should be sent to Reseller admins,,,39,,,1
Trading Address of the Referrer organisation should be populated because is used on the invoices,OBN1-4146,Bug,Done,P3,,6/3/2021 12:28,,OBN Portal Release 1.2,,,,,"*Steps:*

# Create a Referrer
# Provide Referrer’s address details

*Expected result:*

When Referrer is created, the address should be saved also in user_organizations.trading_address_id, because this value is used on the download of the invoice. Without this value populated a 500 is thrown 

*Actual result:*
After Referrer creation just payment_referrers.address_id is populated",,,40,,,3
[Onboarding] Company legal name tooltip is getting in the way,OBN1-4131,Bug,Done,P3,,6/2/2021 17:06,,OBN Portal Release 1.2.4,,,,,"In the lookup for companies, the ""Provide further characters..."" thing got in the way of being able to type text into the field

* check on small monitors",,,45,,,0.5
Settlement is not enabled for Referrer after creation ,OBN1-4066,Bug,Done,P2,,5/28/2021 13:54,,OBN Portal Release 1.2,,,,,"*Preconditions:*

# Logged as Reseller Admin

*Steps:*

# Create a Referrer

*Expected result:*
”payment_referrers.stlmt_next_at” should be the first day of next month

*Actual result:*
The value is NULL, so the settlement will never happen ",,,39,,,1
"Not all the fields are populated on ""About its Payments"" after completing the form",OBN1-4063,Bug,Done,P3,,5/28/2021 10:31,,OBN Portal Release 1.2,,,,,"*Steps:*

# Complete all the onboarding steps
# On “About its Payments“ created 2 outlets
# Being on “Review&Submit“ navigate back to “About its Payments“ page

*Expected:*

All completed details should be automatically pre-populated

*Actual result:*
”Mercahant industry” and acquirers fields are not completed

!image-20210528-093547.png|width=926,height=674!",,,39,,,1
"Error on creating multiple outlets on ""About its Payments"" page",OBN1-3960,Bug,Done,P2,,5/18/2021 17:19,,OBN Portal Release 1.1,MVP+1,,,,"*Steps:*

# Navigate to “About its Payments“ step
# complete data for one outlet
# Click on '+' button to create another outlet

*Actual result:*

Console error. Outlet is not created

!image-20210518-162118.png|width=1828,height=916!",,,38,,,1
Deductions with 0 amount shouldn't be created in the database,OBN1-3931,Bug,Done,P3,,5/18/2021 10:46,,OBN Portal Release 1.1,Billing,MVP+1,UI,,"*Preconditions:*

# Applicant with offer generated
# Log in as Reseller Admin

*Steps:*

# Navigate to “Commercial Offer“ screen
# Introduce 0 value for any of the commissions

*Expected result:*

Deductions with 0 amount shouldn’t be added in “payment_deductions” and “payment_referrer_deductions” .
If there is a deduction already with specific type and value and I want to add 0, then it should be totally deleted

*Actual result:*
The value with 0 amount is added and I’m not sure how splitting will work with 0 amount fees",,,38,,,1
Issue with soft delete,OBN1-3878,Bug,Done,P1 ,,5/14/2021 6:34,,OBN Portal Release 1.2.4,,,,,"Issue with soft delete

*Pages to retest:*

# My organisation → Manage users
# My Referrers → Active Referrers → Manage users
# My Merchants → Active Merchants → Manage users 

*Endpoints:*

# ​/branding​/colors
# ​/branding​/logos
# /payment/deductions/\{uuid}
# /payment/referrer/deductions/\{uuid}
# /users/delete/\{uuid}
# /roles/\{uuid}
# /workflow/step/\{uuid}
# /workflow/\{uuid}
# /workflow/workflow-phase/\{uuid}
# /qr-code/\{text}.\{extension}",,,39,,,5
Reject button misses until I refresh the page,OBN1-3817,Bug,Done,P4,,5/5/2021 13:26,,OBN Portal Release 1.1,MVP+1,,,,"*PRECONDITIONS:*

# The applicant exists
# I’m on “Open Applications” → “Applicant Dashboard“

*STEPS:*

# Submit the onboarding details
# The workflow starts and goes to manual for a step/phase
# Navigate to “Application Status“ tab

*EXPECTED RESULT:*
The *_Continue_* and *_Reject_* buttons should be displayed


*ACTUAL RESULT:*

!image-20210505-123655.png|width=809,height=408!

P.S. - Button appears just after refresh page. Cristi suggested to change isRejectable flag to status endpoint instead of /my-merchants/open-applications",,,37,,,2
Not all the data is deleted from database after application rejection from kompli,OBN1-3789,Bug,Done,P2,,4/29/2021 12:57,,OBN Portal Release 1.1,MVP+1,,,,"*Preconditions:*

# The application exists and it has a Kompli case

*Steps:*

1. Reject the Kompli case

*Expected result:*
All the data should be removed, except *_payment_merchant_applications_* and *_workflow_kompli_cases_*

*Actual result:*
The data remains in the database",,,36,,,1
"When I create another owner for Partnership, the existing one is duplicated",OBN1-3786,Bug,Done,P3,,4/29/2021 10:43,,OBN Portal Release 1.1,MVP+1,UI,,,"*Preconditions:*

# Partnership organisation type

*Steps:*

# Complete about it owners
# Navigate to next page
# Go back and click on '+' to add another owner

*Expected result:*

A new empty owner form should appear

*Actual result:*

The details of existing owner are duplicated


!image-20210429-095215.png|width=1403,height=432!",,,36,,,0.5
Issue on CS authentication on production,OBN1-3729,Bug,Done,P3,,4/23/2021 14:49,,OBN Portal Release 1.1,MVP+1,,,,"Email sent to admin Reseller:


!image-20210423-135330.png|width=1062,height=213!",,,36,,,1
Remove the footer of the email,OBN1-3668,Bug,Done,P4,,4/19/2021 10:51,,OBN Portal Release 1.1,MVP+1,,,,"*Preconditions:*

# Change CS credentials for one of the users of the Referrer

*Steps:*

# Try to do a connection with CS which requires Referrer user connection

*Expected result:*
The indicated part of the email should be removed

!image-20210419-095259.png|width=1251,height=515!",,,36,,,0.5
National insurance number should be optional,OBN1-3655,Bug,Done,P4,,4/16/2021 9:25,,OBN Portal Release 1.1,MVP+1,,,,"*Steps:*

# Navigate to About its Management
# Write something in “National insurance number“ field
# Delete the text
# Navigate to next page

*Expected result:*
The field is optional, the step should pass

*Actual result:*

!image-20210416-083016.png|width=1396,height=433!

*P.S. -* also, this field shouldn’t be editable on about its owners page

!image-20210416-083112.png|width=1107,height=715!",,,35,,,0.5
Wrong validation message ,OBN1-3631,Bug,Done,P5,,4/13/2021 10:32,,OBN Portal Release 1.2.1,,,,,"*Steps:*

# Navigate to “Create Referrer“ page
# Complete all mandatory fields, but using an existing email or domain
# Submit details
# Navigate to “Create Billing Plan“ and delete one of the referrer commissions

*Expected result:*

A suggestive error should be thrown

*Actual result:*


!image-20210413-095055.png|width=260,height=489!",,,42,,,0.5
About it Owners page doesn't display owners of the LLP,OBN1-3615,Bug,Done,P2,,4/12/2021 11:41,,,MVP,,,,"*Preconditions:*

# LLP organization
# Use “{{ORWINS-LLP (GROUP) LIMITED LIABILITY PARTNERSHIP}}“ name from Kompli

*Steps:*

# Complete About its Business
# Navigate to about its owners



*Expected result:*
The user attached should be displayed in the form

!image-20210412-104338.png|width=270,height=94!



*Actual result:*
The form is not displayed

!image-20210412-104219.png|width=1482,height=610!",,,35,,,0.5
On Refund Referrer fee is searched even for Merchants under OBN,OBN1-3594,Bug,Done,P1 ,,4/8/2021 6:08,,,MVP,,,,"*Preconditions:*

# Merchants without Referrer
# SUbmit RTP authorized

*Steps:*

# Submit a Refund

*Actual result:*
System searches for Referrer BP, even when Merchant doesn’t have Referrer

Argument 1 passed to App\\Repository\\Payment\\ReferrerDeductionRepository::findByPaymentType() must be an instance of App\\Entity\\Payment\\ReferrerBillingPlan, null given, called in /var/www/api/src/Service/Payment/RtrFeesCalculator.php on line 60",,,35,,,1
Outlet processing values are not populated after re-login,OBN1-3574,Bug,Done,P2,,4/5/2021 20:05,,,MVP,,,,"*Preconditions:*

# Apply for sign-up

*Steps:*

# Complete all the steps and logout without submitting
# Login again and navigate to “About its Payments“

*Expected result:*
Outlet processing values should be populated on UI

*Actual result:*
They are empty, even they received in from API

!image-20210405-190753.png|width=1078,height=508!

!image-20210405-190823.png|width=1390,height=516!",,,35,,,1
Data is not updated from one expanded dashboard to another,OBN1-3531,Bug,Done,P3,,3/29/2021 16:15,,,MVP,,,,"*Preconditions:*

# I’m on My Referrers or My Merchants page
# And the dashboard of one Merchant/Referrer is displayed

*Steps:*

# Click to expand another record

*Expected result:*

Data should be updated

*Actual result:*
The already loaded data is displayed

!image-20210329-152141.png|width=1075,height=418!",,,34,,,1
Error received on Refund,OBN1-3512,Bug,Done,P1 ,,3/26/2021 15:11,,,MVP,,,,"*Preconditions:*

# Transaction X exists
# {{ZappManageRefundAccountService}} - de-comment lines 44-45
# {{RtrProcessingHandler}} - to use an internal account as Refund destination 

!image-20210326-151727.png|width=744,height=389!



*Steps:*

# Send a “/payment/\{mpa_uui}/zapp/refund” request

*Expected result:*
The refund should be successfully performed

*Actual result:*


!image-20210326-151304.png|width=1174,height=655!",,,35,,,1
Performance issues during UI build deployment on test/stage environments,OBN1-3497,Bug,Done,P4,,3/25/2021 12:21,,OBN 1.11,Day1,Tech-debt,,,Improve the pipeline in UI/API-doc repos so that the deployment process (builder) won’t tear down the machine.,,,68,,,2
UI doesn't sent processors data on Create Referrer,OBN1-3457,Bug,Done,P1 ,,3/22/2021 16:15,,,MVP,Referrers,UI,,"*Preconditions:*

# Log in as Reseller

*Steps:*

# Navigate to Create Referrer
# Complete all the fields
# Save the details

*Expected result:*

A new Referrer should be created

*Actual result:*

Details about processors aren’t sent and 400 response received from backend

!image-20210322-161612.png|width=1322,height=735!",,,33,,,1
"Error on ""create account to zapp"" step on test env",OBN1-3350,Bug,Done,P4,,3/10/2021 14:51,,,MVP,,,,"*Preconditions:*

# Apply for sign-up
# Complete all onboarding steps

*Steps:*

# Submit the details

*Actual result:*

Workflow stops to “register mpa to Zapp”",,,,,,2
Errors after onboarding,OBN1-3344,Bug,Done,P3,,3/10/2021 14:06,,,MVP,,,,"*Preconditions:*

# Onboarding details were submitted 
# Workflow fails on any step

*Steps:*

# Log out and log in again

*Actual result:*

# When I click on “Onboarding” button the onboarding fields are displayed again

!image-20210310-140953.png|width=1105,height=570!

3. Access on “About its Payment”, “About its Management“, “About its Owners“ is available through URL after submitting details

*Pages with restricted access through URL to be defined*",,,35,,,1
Error on getting organisation details of Merchants without registered office address ,OBN1-3338,Bug,Done,P1 ,,3/9/2021 16:20,,,MVP,,,,"*Preconditions:*

# Merchant without Registered office address

*Steps:*

# Log in as Merchant Admin of this organisation
# Send a GET request to “*_/merchant/my-organisation_*“ 

*Expected result:*

The details should be successfully returned

*Actual result:*

!image-20210309-162316.png|width=1166,height=541!",,,33,,,1
In workflow emails for non-Limited companies shouldn't be sent the Legal Name,OBN1-3221,Bug,Done,P4,,2/19/2021 8:54,,,,,,,"*Preconditions:*

# Organisation type - Sole, Partnership, Charity 

*Steps:*

# Complete the onboarding 
# Use a non-supported MMC of the Referrer (MCC step - warning)
# The phase goes to manual

*Expected result:*

In the email should be excluded the Legal Name field


!image-20210219-085859.png|width=837,height=262!",,,32,,,1
Error on Merchant dashboard for Merchants without Referrer,OBN1-3219,Bug,Done,P1 ,,2/18/2021 15:09,,,MVP,,,,"*Preconditions:*

# Merchant A without Referrer

*Steps:*

# Get request for “/my-merchants/active-merchants/\{merchant_uuid}/dashboard“

*Expected:*

Details should be retrieved from DB

*Actual:*
500 error received

!image-20210218-151147.png|width=1052,height=290!",,,31,,,1
After onboarding completed merchantApplication shouldn't be sent on log in,OBN1-3205,Bug,Done,P1 ,,2/17/2021 16:43,,,MVP,,,,"*Preconditions:*

# Complete all onboarding steps
# Application is accepted

*Steps:*

# Applicants logs in

*Expected result:*

Details about organisation shouldn’t be sent anymore

*Actual result:*

Details about application is sent and because of that the “Submit” onboarding step is displayed

!image-20210217-165517.png|width=662,height=152!",,,31,,,1
"When applicant is the same as owner/manager, existing user should became admin",OBN1-3203,Bug,Done,P1 ,,2/17/2021 16:00,,,MVP,,,,"*Preconditions:*

# Sign up with user X

*Steps:*

# Add user X as manager/owner
# Submit the Onboarding details

*Expected result:*
Applicant’s existing user becomes admin.

*Actual result:*
System tries to create new user. 
500 error received

!image-20210217-160304.png|width=527,height=102!",,,31,,,1
Onboarding form IS NOT DISPLAYED ANYMORE,OBN1-3201,Bug,Done,P1 ,,2/17/2021 15:24,,,MVP,,,,"*Steps:*

# Complete sign-up
# Confirm sign-up
# Log in

*Expected:*

The onboarding steps should be displayed

*Actual:* 

Onboarding fields are not displayed",,,31,,,1
When workflow is completed the Merchant status should become 'Active',OBN1-3198,Bug,Done,P2,,2/17/2021 12:14,,,MVP,,,,"*Preconditions:*

# Sign-up
# Complete onboarding
# Workflow is successfully completed

*Steps:*

# Analyze the Merchant’s status in database

*Expected  result:*
Status should become ‘*_Active_*’

*Actual result:*
The status remains '*_Pending_*'",,,31,,,1
Error on Zapp registration,OBN1-3180,Bug,Done,P1 ,,2/12/2021 13:22,,,MVP,,,,"*Preconditions:*

# Complete all the onboarding steps

*Steps:*

# Submit the details

*Expected:*

the workflow should be triggered

*Actual:*

!image-20210212-132310.png|width=726,height=379!",,,31,,,1
"Error received on ""About its Payments"" save data",OBN1-3161,Bug,Done,P1 ,,2/10/2021 13:38,,,MVP,,,,"*Steps:*

# Complete all onboarding steps
# Save details for “About its Payments”

*Expected:*

The *payment_merchant_processor_accounts.safeguard_reserve_date_interval* and 

*payment_merchant_processor_accounts.stlmt_date_interval* should be NULLABLE 



*Actual result:*


!image-20210210-134348.png|width=1219,height=43!",,,31,,,1
User shoud be informed that details will be lost at logout,OBN1-3160,Bug,Done,P3,,2/10/2021 9:58,,,MVP,,,,"*Preconditions:*
A user is logged in the portal and filled some data

*Steps to reproduce:*

# Click on 'Log out' button

*Expected result:*
User is informed that data will be lost

*Actual result:*
User is logged out",,S3,31,,,1
Error after expand/collapse outlet form,OBN1-3146,Bug,Done,P3,,2/8/2021 15:40,,,MVP,,,,"*Preconditions:*

# Merchant applied for onboarding

*Steps:*

# Complete all the steps until “About its Payments”
# Add 2 outlets for the Merchant
# Collapse the Outlet forms
# Go to “Next” page

 *Expected result:*

The values should be successfully sent and saved in the database

*Actual result:*
An error received, because UI doesn’t sent the *_existingMonthlyProcessingCount_* and *_existingMonthlyProcessingVolume_*  values",,,31,,,1
Onboarding information disappears,OBN1-3072,Bug,Done,P4,,2/1/2021 14:45,,,MVP,,,,"Reproducible on test env

Steps to reproduce:

# Log into the portal as an applicant (Onboarding)
# Click on the 'Onboarding' menu icon

Expected:
Menu is expanded.

Actual:
A pop-up  informing that data will be lost is thrown and clicking on 'OK' button the information disappears ",,,31,,,1
The Referrer can't be created just with one processor BP,OBN1-2969,Bug,Done,P2,,1/26/2021 9:31,,,MVP,,,,"*Preconditions:*

# Log in as Reseller admin

*Steps:*

# Navigate to “*_My Referrers_*” page
# Complete all the steps
# Choose to add BP just for PBBA
# Click on “*_Submit_*” button

*Expected result:*
The Referrer should be successfully created

*Actual result:*
The button is not clickable. Any error isn’t received.",,,30,,,1
Fix referrers settlement minimum minorUnits,OBN1-2935,Bug,Done,P1 ,,1/25/2021 13:26,,,MVP,,,,"""Fix referrers settlement minimum minorUnits"" because these values are created from fixtures.

Solution to set minimum settlement amount a big value so that settlement won’t happen",,,30,,,1
Error on Referrer creation with wrong deductions structure,OBN1-2883,Bug,Done,P2,,1/19/2021 9:51,,OBN 1.28,,,,,"*Preconditions:*

# Log in as reseller admin

*Steps:*

# Use the body from the comments
# Send a [POST] request to *_“/user/referrer_*“ endpoint

*Expected result:*
A validation error should be returned

*Actual result:*


!image-20210119-095255.png|width=564,height=235!",,,85,,,1
"                                 """"transactionFeeBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"transactionFeePence"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"refundFeeBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"refundFeePence"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"rollingReserveBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"rollingReserveDays"""": 3",,,,,,,,,,,,,,,,,,,
"                                    """"settlementDays"""": 3",,,,,,,,,,,,,,,,,,,
                                },,,,,,,,,,,,,,,,,,,
                                \{,,,,,,,,,,,,,,,,,,,
"                                    """"deliveryType"""": """"LESS_30_DAYS""""",,,,,,,,,,,,,,,,,,,
"                                    """"riskGroup"""": """"HIGH""""",,,,,,,,,,,,,,,,,,,
"                                    """"transactionFeeBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"transactionFeePence"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"refundFeeBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"refundFeePence"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"rollingReserveBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"rollingReserveDays"""": 3",,,,,,,,,,,,,,,,,,,
"                                    """"settlementDays"""": 3",,,,,,,,,,,,,,,,,,,
                                },,,,,,,,,,,,,,,,,,,
                                \{,,,,,,,,,,,,,,,,,,,
"                                    """"businessTypeGroup"""": """"LTD_LLP""""",,,,,,,,,,,,,,,,,,,
"                                    """"deliveryType"""": """"MORE_30_DAYS""""",,,,,,,,,,,,,,,,,,,
"                                    """"riskGroup"""": """"HIGH""""",,,,,,,,,,,,,,,,,,,
"                                    """"transactionFeeBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"transactionFeePence"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"refundFeeBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"refundFeePence"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"rollingReserveBps"""": 300",,,,,,,,,,,,,,,,,,,
"                                    """"rollingReserveDays"""": 3",,,,,,,,,,,,,,,,,,,
"                                    """"settlementDays"""": 3",,,,,,,,,,,,,,,,,,,
                                },,,,,,,,,,,,,,,,,,,
                            ],,,,,,,,,,,,,,,,,,,
"                            """"processorType"""": """"PBBA""""",,,,,,,,,,,,,,,,,,,
"                            """"name"""": """"pKCV-OO0RmAcL_KuG45EW""""",,,,,,,,,,,,,,,,,,,
                        },,,,,,,,,,,,,,,,,,,
                    ],,,,,,,,,,,,,,,,,,,
"                    """"type"""": """"NET_REVENUE""""",,,,,,,,,,,,,,,,,,,
                },,,,,,,,,,,,,,,,,,,
            ],,,,,,,,,,,,,,,,,,,
"            """"chargebacks"""": \[",,,,,,,,,,,,,,,,,,,
                \{,,,,,,,,,,,,,,,,,,,
"                    """"uuid"""": """"1ceac9b1-e481-4c1b-8f10-e21f8a071e2d""""",,,,,,,,,,,,,,,,,,,
"                    """"resellerFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
"                    """"totalFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
                },,,,,,,,,,,,,,,,,,,
                \{,,,,,,,,,,,,,,,,,,,
"                    """"uuid"""": """"2ceac9b1-e481-4c1b-8f10-e21f8a071e2d""""",,,,,,,,,,,,,,,,,,,
"                    """"resellerFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
"                    """"totalFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
                },,,,,,,,,,,,,,,,,,,
                \{,,,,,,,,,,,,,,,,,,,
"                    """"uuid"""": """"3ceac9b1-e481-4c1b-8f10-e21f8a071e2d""""",,,,,,,,,,,,,,,,,,,
"                    """"resellerFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
"                    """"totalFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
                },,,,,,,,,,,,,,,,,,,
                \{,,,,,,,,,,,,,,,,,,,
"                    """"uuid"""": """"4ceac9b1-e481-4c1b-8f10-e21f8a071e2d""""",,,,,,,,,,,,,,,,,,,
"                    """"resellerFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
"                    """"totalFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
                },,,,,,,,,,,,,,,,,,,
                \{,,,,,,,,,,,,,,,,,,,
"                    """"uuid"""": """"5ceac9b1-e481-4c1b-8f10-e21f8a071e2d""""",,,,,,,,,,,,,,,,,,,
"                    """"resellerFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
"                    """"totalFeeAmount"""": 900",,,,,,,,,,,,,,,,,,,
                },,,,,,,,,,,,,,,,,,,
            ],,,,,,,,,,,,,,,,,,,
        },,,,,,,,,,,,,,,,,,,
    ],,,,,,,,,,,,,,,,,,,
},,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,
!image-20220217-123536.png|width=756,"height=620!""","13/Mar/23 2:31 PM;625570b2410206006e9667de;fixed on develop:

!image-20230313-143148.png|width=1526,height=482!",,OBN1-1217,Referrers,,,,,,,,,,,,,,
MCC input,OBN1-2782,Bug,Done,P4,,12/29/2020 10:25,,,MVP,,,,"*Steps:*

# Add Industry
# Select MCCs
# Change Industry

*Expected result:*
The changes should accordingly be applied

*Actual result:*
The aren’t applied properly",,,28,,,1
Manager isn't created in the database,OBN1-2768,Bug,Done,P1 ,,12/28/2020 10:00,,,API,MVP,Onboarding,,"*Preconditions:*

# User successfully signed up
# User confirmed the sign up

*Steps:*

# Submit details about the management

*Expected result*
The managers should be successfully created in “payment_merchant_officers” table and the uuid of the new created record should be returned


*Actual result:*
The manager isn’t created in the database. The response received:


!image-20201228-100335.png|width=1079,height=434!",,,28,,,1
When I update the officers email a new officer is created,OBN1-2680,Bug,Done,P3,,12/14/2020 17:52,,,,,,,"*Preconditions:*

# I completed “About its Management” or “About its Owners” steps
# The manager/owner exists in the database

*Steps:*

# Navigate to  “About its Management” or “About its Owners”  and update user’s email

*Expected result:*
The user should be updated or creating new one to delete the old one.

*Actual result:*
A new officer is created.",,,32,,,1
Merchant Onboarding - DateTime::__construct() error,OBN1-2626,Bug,Done,P1 ,,12/4/2020 15:05,,,MVP,,,,"in POST /merchant-onboarding/management, when birthdate is null, an error is returned: DateTime::__construct(), expects paramenter 1 to be string, null given

“Birthdate” field should be required.",,,26,,,1
Log out and session expiration,OBN1-2603,Bug,Done,P3,,11/26/2020 16:43,,,MVP,,,,"Steps to reproduce:
1. Log into OBN
2. Navigate to Create Referrer page
3. Complete a field
4. Press 'Log out' button
5. Press 'Cancel' button from the 'unsaved changes' pop-up

Actual Result:
User is logged out, however Create Referrer form is displayed. Please find attachment

Expected Result:
User is redirected to 'Log in' page

Note:

Reproducible also when session expires

!image-2020-11-26-18-43-25-816.png|width=200,height=183!

 ",,,25,,,
502 status code received when user uses a cardstream reseller ID <= 5 characters,OBN1-2587,Bug,Done,P4,,11/26/2020 10:23,,,MVP,,,,"*Steps:*

# log in as Reseller
# Fill all fields with valid data
# Use a value >= 5 characters for Cardstream Reseller ID (ex; 1233435)
# Send a \[PUT] request to “/user/referrer/\{refUuid}” endpoint

*Expected result:*

The 400 error is received.

*Actual result:*

!image-20201126-103224.png|width=1049,height=640!",,,,,,2
The RTP uuid isn't linked to Refund transaction,OBN1-2555,Bug,Done,P3,,11/24/2020 13:42,,,MVP,,,,"*Preconditions:*

# The RTP exists
# A Refund exists for this RTP

*Steps:*

# Sync the Cardstream transactions with OBN

*Expected result:*
The RTP and Refund transactions should be created in OBN.
The “*_payment_requests_to_refund.payment_uuid”_* should have the uuid of the RTP

*Actual result:*
The uuid of the RTP misses (even it exists in our database)",,,27,,,1
Fix localstack issue,OBN1-2510,Bug,Done,P1 ,,11/17/2020 14:57,,,MVP,,,,"Error executing ""PutObject"" on ""http://localstack:4572/test-bucket/4f6ed38a-84ce-4b60-aa7c-607adde0b133.jpg""; AWS HTTP error: cURL error 7: Failed to connect to localstack port 4572: Connection refused (see https://curl.haxx.se/libcurl/c/libcurl-errors.html)",,,25,,,3
Reconciliation errors,OBN1-2281,Bug,Done,P3,,10/28/2020 14:31,,,MVP,,,,"*Steps:*

# Navigate to Reports page

*Expected results:*
All the information displayed should correspond to the database

*Actual result:*

# Expanded value of start/end date differs from the total value
# The “see detail” at EOD isn’t clickable",,,OBN Portal Sprint 23,,,2
The link's from Reconciliation's graph on dashboard don't work as expected,OBN1-2125,Bug,Done,P4,,10/6/2020 10:30,,,MVP,,,,"*Preconditions:*

# User is logged in
# User is on the Dashboard

*Steps:*

# Click on the link of any of the Reconciliation parts from Dashboard’s graph

*Expected result:*

The user is redirected to the “Reconciliation” page and the Report’s details are displayed below the Report parts

*Actual result:*

The user is redirected to the “Reconciliation” page, but the details are not displayed.



*Note\! \[Dashboard] Reconciliation graph – for value = 0 no link is displayed for that section*",,,,,,
"""Reconciliation"" page isn't responsive ",OBN1-1833,Bug,Done,P4,,9/7/2020 15:51,,,MVP,UI,,,"*Preconditions:*

# Use a mobile device
# User has access to “Reports” page

*Steps:*

# Access “Dashboard” page
# Access “Reports” page

*Actual result:*

Dashboard

!image-20200907-145444.png|width=389,height=268!

Reports


!image-20200907-145545.png|width=382,height=650!

!image-20200907-145558.png|width=305,height=289!",,,OBN Portal Sprint 21,,,0.5
"Access to ""Reports"" is available through URL for users with restricted access",OBN1-1832,Bug,Done,P2,,9/7/2020 15:06,,,MVP,Reports,UI,,"*Preconditions:*

# User doesn’t have access to “Reports” page

*Steps:*

# Authenticate in the system
# Introduce “reports/reconciliation” path in the URL

*Expected result:*

The user should be redirected to Dashboard. Access to “Reports” page should be restricted

*Actual result:*
The page is displayed


!image-20200907-141821.png|width=1534,height=601!",,,OBN Portal Sprint 21,,,0.5
The outlets should be grouped by ID,OBN1-1831,Bug,Done,P3,,9/7/2020 14:51,,,MVP,,,,"*Preconditions:*

# Multiple Outlets exist with the same name

*Steps:*

# Navigate to “Reports” page
# Put the Outlet on 1-2 hierarchy place in the grouping criteria

*Expected result:*

Even they have the same name, outlets with different ids should be considered different outlets in the grouping 

*Actual result:*

The grouping is made by name",,,OBN Portal Sprint 21,,,0.5
"The ""Business Trading Name"" should be used as Merchant's name in the UI",OBN1-1826,Bug,Done,P3,,9/7/2020 13:07,,,API,MVP,Reports,,"*Preconditions:*

# Merchant exists in the database
# Log In as Reseller/Referrer

*Steps:*

# Navigate to “Reports” page
# Click on “See more” of one link

*Expected result:*

The ""Business Trading Name"" should be used as Merchant’s name

*Actual result:*

The “Company Legal Name” is used as Merchant’s name now.",,,OBN Portal Sprint 20,,,0.5
Error on accessing details about Reconciliations sections as REFERRER user,OBN1-1823,Bug,Done,P1 ,,9/7/2020 10:03,,,API,MVP,Reports,,"*Preconditions:*

# I’m Referrer user
# I have access to Reports
# My merchants has data for all the Reconciliation sections

*Steps:*

# Send a GET request to: 
1.1 /dashboard/report/details/fundsAtStartOfDay”
1.2 /dashboard/report/details/fundsAtEndOfDay
1.3 /dashboard/report/details/fundsReceived
1.4 /dashboard/report/details/refundsReceived
1.5 /dashboard/report/details/fundsSettled
1.6 /dashboard/report/details/feesDeducted

*Expected result:*
The body should contain the objects of all the data available

*Actual result:*


!image-20200907-123433.png|width=102,height=31!",,,OBN Portal Sprint 20,,,0.5
"The ""safeguard_start_of_day_volume"" value isn't correctly displayed when refunds were performed",OBN1-1733,Bug,Done,P1 ,,8/13/2020 13:00,,,MVP,,,,"*Preconditions:*

# Transactions was performed for a merchant
# Refund was made 

*Steps:*

# The EWD comes
# Check the “safeguard_start_of_day_volume” column in “payment_report_parts” table for the merchant

*Expected result:*

The value from “safeguard_start_of_day_volume” column should be the same as in “safeguarded_minor_units” column from “payment_merchants” table

*Actual result:*

The funds taken from Merchant Clearing account for refund and refund fees are are included in “safeguard_start_of_day_volume” column",,,OBN Portal Sprint 20,,,0.5
Block the save in browser the old 2FA codes,OBN1-1463,Bug,Done,P4,,7/10/2020 13:01,,,MVP,,,,"*Preconditions:*

# 2FA is enable

*Steps:*

# Use one of actions which asks 2FA (login, reset password, sign-up confirm)

*Expected:*

Previous 2FA codes user shouldn’t be saved in browser cache

*Actual result:*


!image-20200710-120407.png|width=574,height=520!",,,,,,
Error on Log In in 2 different browsers when 2FA enabled,OBN1-1461,Bug,Done,P2,,7/9/2020 13:48,,,MVP,,,,"*Preconditions:*

# The 2FA is enabled
# I’m logged in Chrome

*Steps:*

# Try to log in Firefox

*Actual result:*

A new token is generated in the database.
The 502 error response is send in UI

!image-20200709-125124.png|width=526,height=136!

*Expected result:*

I have to receive a success response with new token generated.
I have to be logged in the Firefox.",,,OBN Portal Sprint 16,,,0.5
Add in audit the attempt of authentication after 10 attempts are exceeded ,OBN1-1318,Bug,Done,P3,,6/25/2020 15:03,,,API,MVP,,,"*Preconditions:*

# The users exists in the database
# The “{{failed_login_attempts_counte”}} has the 10 value

*Steps:*

# Try to login again
# A new record should be added in the “user_audit” table

*Actual result:*

# After 10 attempts any Log In attempt isn’t recorded in audit table

*Expected result:*

# All the Log In attempt should be recorded",,,OBN Portal Sprint 15,,,1
"UI - User should be logged out when ""Invalid Token"" error ",OBN1-1303,Bug,Done,P2,,6/25/2020 9:55,,,MVP,UI,,,"*Precondition:*

# I’m logged on Chrome
# My token is still valid

*Steps:*

# Log In Firefox - new token is generated
# Try to perform any request in Chrome

*Actual result:*

“Invalid Token” error received and displayed

*Expected result:*

Anywhere in the system when this error is received, user should be logged out and asked for re-authentication",,,OBN Portal Sprint 15,,,1
"Double ""session timeout"" pop-up ",OBN1-1199,Bug,Done,P3,,6/12/2020 9:30,,,MVP,UI,,,"*Precondition:*

# Given I’m logged in
# Wait until “session timeout” pop-up appears

*Steps:*

# Click on log out
# Log In again
# Click on “Continue”

*Actual result:*

Two “session timeout” pop-ups are generated

*Expected result:*

Just one pop-up should be displayed",,,OBN Portal Sprint 13,,,0.5
The pages need to be responsive ,OBN1-1143,Bug,Done,P4,,6/10/2020 12:05,,,MVP,,,,"*Steps:*

# Navigate to OBN pages

*Actual result:*
Beneath 400 pixels the pages are trim 

_Forgot password_

!image-20200610-110814.png|width=358,height=637!

_Reset password_

!image-20200610-110838.png|width=352,height=634!

*Actual result:*

Once the page is narrowed the form need to be re-set the dimensions ",,,OBN Portal Sprint 15,,,1
"User is able to use the same password for ""oldPassword"" and ""newPassword""",OBN1-1135,Bug,Done,P3,,6/9/2020 16:41,,,API,MVP,Users,,"*Precondition:*

The user is authenticated

*Steps:*

# Introduce the users current password for “oldPassword”
# Introduce the same value for “newPassword”
# Introduce the same value for “newPasswordConfirm”
# Send POST request to “users/change-password” endpoint

*Expected result:*

The 400 status code is received. The ""Password must be different from the ones used in the past"" error detail is present in response.

*Actual result:*

The 200 status code is received. The “Your password was changed successfully"" is present in the response body.",,,OBN Portal Sprint 13,,,0.5
The Refund should fail when 4xx received from Starling and supply from Safeguard is needed ,OBN1-949,Bug,Done,P2,,5/14/2020 7:56,,,MVP,,,,"*Preconditions:*

# A Submit RTP record exists
# There aren’t enough funds in Clearing Account for Refund

*Steps:*

# Perform a refund
# 4xx error received from Starling

*Expected result:*

The refund should FAIL

*Actual result:*

Refund is in Pending and these error logs are recorded:

!image-20200514-065825.png|width=750,height=448!",,,OBN Portal Sprint 11,,,0.5
Undefined RR of transaction with not enough funds for Safeguard payment ,OBN1-869,Bug,Done,P2,,4/6/2020 12:35,,,MVP,,,,"*Precondition:*

# The fees are bigger than transaction amount

*Steps:*

# Try to perform a Refund that will use the RR of the transaction

*Expected result:*

The system should be able to detect the RR of the transaction even it is the debt to RR because of lack of funds

*Actual result:*

If the payment to Safeguard misses on splitting, on Refund can’t be determined the RR of the transaction",,,OBN Portal Sprint 9,,,2
RR of the transaction isn't indicated for the RTP when not enough funds for Safeguard fee,OBN1-860,Bug,Done,P1 ,,4/3/2020 10:57,,,MVP,,,,,"*Precondition:*

# Given the Submit RTP is 1000
# And the OBN fee is 500
# And the Safeguard fee is 300

*Steps:*

# Zapp and Starling notifications come

*Expected result:*

In “*_payment_merchants”_* table in “rr_minor_units” column should be 300 units, even there wasn’t performed the transfer to safeguard

*Actual result:*

The “_rr_minor_units”_ has “0” value

",,OBN Portal Sprint 9,,,1
"The Refund fails after ""end of working day""",OBN1-820,Bug,Done,P2,,3/27/2020 15:57,,,MVP,,,,"*Precondition:*

# The Refund is in Pending (with debt to Safeguard)

*Steps:*

# Perform “end of working day”

*Expected:*

The money are transferred back to Safeguard.

The Refund should remain in PENDING and bring money back to Clearing

*Actual Result:*

The money are transferred back to Safeguard.

The Refund fails because not enough money (even there are).



",,,OBN Portal Sprint 8,,,
Refund remains in Pending after settlement when not enough funds,OBN1-819,Bug,Done,P2,,3/27/2020 13:31,,,MVP,,,,"*Precondition:*

# The Refund with 2000 in Pending

*Steps:*

# Perform settlement - 1000 funds are settled, 500 are rolling reserve blocked in Clearing, 500 are transferred back to Safeguard to close debt

*Expected result:*

After retry, the Refund should FAIL

*Actual result:*
The Refund remains in Pending.

My SQL error log recorded

!image-20200327-133424.png|width=347,height=92!

",,,,,,
Error on creating multiple Refunds because of constraint violation in splitting table,OBN1-813,Bug,Done,P2,,3/26/2020 10:27,,,MVP,,,,"*Precondition:*

# Exists a Submit RTP successfully confirmed by Zapp and Starling
# Exists a refund already performed for the Submit RTP

*Steps:*

1.Perform an another Refund

*Actual result:*

An error is thrown because of constraint violation in splitting table

",,,,,,
The Refund should fail when 4xx comes from Zapp,OBN1-799,Bug,Done,P3,,3/25/2020 10:35,,,MVP,,,,"*Steps:*

# Create a Submit RTP
# Don’t confirm the transaction with BRN
# Simulate response from Zapp&Starling
# Submit a Refund

*Actual result:*

Zapp sends a 403 error. Transaction is put in Pending

!image-20200325-103754.png|width=745,height=446!

*Actual result:*

The Refund should fail (because 400 comes from Zapp)

",,,OBN Portal Sprint 8,,,
The retry for failed Refund doesn't work properly ,OBN1-714,Bug,Done,P3,,3/10/2020 15:34,,,MVP,,,,"*Precondition:*

# The Merchant exists in “*_payment_merchants_*” table
# In “*_payment_zapp_requests_to_pay_*” table exists a RTP confirmed by Zapp and Starling

*Steps:*

# Perform multiple consecutive Request to Refund transactions

*Expected result:*

The failed attempts should be resend by worker after a delay

*Actual result:*
The failed attempts remain in PENDING


!image-20200310-153859.png|width=940,height=63!



",,,,,,
"'uuid' for a deduction is changed when a PUT request with a new value in ""uuid"" key is sent",OBN1-691,Bug,Done,P3,,3/5/2020 14:18,,,MVP,,,,,,,OBN Portal Sprint 6,,,3
500 unexpected error on updating a Role,OBN1-639,Bug,Done,P3,,2/17/2020 13:06,,,MVP,,,,"*Preconditions:*

# Given the Role already exists in database

*Steps:*

# Try to update the Role (*We didn’t find yet the which and why Role exactly)*

*Actual result:*

The 500 error is received.
This bug needs debugging for investigations.

!image-20200217-130913.png|width=877,height=546!



*Reproduction case:*

It’s reproducing only when you try to update a role which is attached to the current logged in user.",,,OBN Portal Sprint 6,,,2
Permissions annotations update should affect just records added by annotations themselves ,OBN1-609,Bug,Done,P2,,2/10/2020 8:28,,,MVP,,,,"*Precondition:*

# The permission exists and it has assigned to OBN.Owner role
# Using API, this permission is added to OBN.Admin

*Steps:*

# Change the annotation of the permission to be for:  OBN.Manager

*Expected result:*

The record for OBN.Owner should be deleted and the record for OBN.Manager should be added

*Actual result:*

This annotation affects the OBN.Admin too, but it doesn’t have to. 



P.S. This API record still has to be affected by deleting this permission

",,,OBN Portal Sprint 4,,,
Permissions can't be deleted for an in-active user,OBN1-606,Bug,Done,P4,,2/6/2020 13:27,,,MVP,,,,"*Preconditions:*

# The permission “User/Role/create“ is assigned to an user
# The user is in-active

*Steps:*

# I send a delete request to users/\{user_uuid}/permissions 
# And I send in the body the uuid of the assigned permission

*Expected result:*

200 response should be sent to user

The permissions should be deleted for the user in “user_users“ table

*Actual result:*

The permission is still assigned to the in-active user",,,OBN Portal Sprint 11,,,
The deleted permissions might be assign to user,OBN1-564,Bug,Done,P2,,1/23/2020 10:25,,,MVP,,,,"*Preconditions:*

# The permission “*_User/Role/create_*“ is deleted
# The permission isn’t assign to user

*Steps:*

# I send a post request to users/\{user_uuid}/permissions
# And I send in the body the uuid of the deleted permission

*Expected result:*

# 200 response should be sent to user
# The permissions shouldn't be added to user in “_user_users_permissions_“ table

*Actual result:*

The permission is added to the user


!image-20200123-103010.png|width=985,height=81!



!image-20200123-103028.png|width=568,height=354!

",,,OBN Portal Sprint 4,,,
Error on sending non-string values ,OBN1-505,Bug,Done,P2,,1/10/2020 9:11,,,API,MVP,,,"*Preconditions:*

# Given the request requires body

*Steps:*

# I send not-string values in body

*Actual result:*

500 error is received and an unknown error displayed


!image-20200110-091253.png|width=932,height=334!



*Actual result:*

An explicit error should be displayed

",,,OBN Portal Sprint 11,,,0.5
MySQL volume,OBN1-490,Bug,Done,P1 ,,1/9/2020 9:52,,,MVP,,,,DB is not recreated and user for current DB can not be created,,,OBN Portal Sprint 3,,,
Wrong error message on update Role with in-existing uuid,OBN1-488,Bug,Done,P4,,1/6/2020 14:29,,,MVP,,,,"*Preconditions:*

# The role with “*_wrong_*“ uuid  doesn’t exist in “role” table

*Steps:*

# Send a \[PUT] /roles/\{uuid} 
# Send a correct request body

*Expected result:*

An explicit error should be displayed 

*Actual result:*

!image-20200106-143556.png|width=896,height=305!

",,,OBN Portal Sprint 11,,,2
Fix nginx 502 issue,OBN1-455,Bug,Done,P1 ,,1/3/2020 7:41,,,MVP,,,,,,,OBN Portal Sprint 3,,,
Users Authorization - User can't update any other characteristics without updating the name of the Role,OBN1-434,Bug,Done,P4,,12/26/2019 13:25,,,MVP,,,,"*Preconditions:*

# The Role exists

*Steps:*

# Make a request to *_/roles_* endpoint using the “uuid“ of the existing role
# Introduce a random description of the role

*Expected result:*

The response code is 200 and the role is updated. And the changes are saved in the database.

*Actual result:*

The response code is 400. Error message “Role name can not be blank“ (if user don’t send the name) or “This role name is already in use” (if user send the same name) is displayed.






",,,OBN Portal Sprint 2,,,
"Adjust logic for ""Capture Delay"" on PBBA",OBN1-253,Bug,Done,P3,,7/23/2019 15:46,,,,,,,"*Precondition:*

# Set the PBBA processor for the Merchant

*Steps:*

# Send a valid request with non-valid “Capture Delay” parameter

*Actual result:*

We get a Zapp error and this is displayed for user

!image-20190723-144612.png|width=623,height=374!

*Actual result:*

The  BRN should be sent successfully ",,,,,,
PBBA Hosted Plugin leftover logs,OBN1-245,Bug,Done,P4,,7/19/2019 16:09,,,,,,,"There are a number of P3::log messages leftover in /hosted/classes/plugins/pbba.php that need to be removed on lines 366, 372, 384. ",,,,,,
"Refund process - The refunded amount is updated, even the refund wasn't confirmed by Starling",OBN1-235,Bug,Done,P1 ,,3/1/2019 13:04,,OBN R.1,,,,,"*Steps:*

# Create a transaction using submitRTP request (use input from input example file)
# Confirm transaction using mobile app
# Update refunded_amount value from transaction table(set 1.00)
# Make a refund request (use input from refund input file)

*Expected result:*

# A successful response should be received from Starling

*Actual result:*

# An error is received, but the  refunded_amount value  is updated in database. The example of response error in the attachments. 
",,S1,OBN Sprint 3,,,
The validation for Amount and Currency should be performed only if SetlmtConfirmationDetails is present in request body,OBN1-183,Bug,Done,P3,,2/12/2019 13:08,,OBN R.1,,,,,"*Steps:*

# Zapp sends a Notify request to OBN
# The mandatory fields are present and are valid.
# The SetlmtConfirmationDetails block is missing 

*Expected result:*

A successful response should be sent to Zapp and a Notify request should be sent to Merchant.

*Actual result:*

The validation is performed for SetlmtAmount field and the error message “The payment amount must not be zero“ is sent to Zapp.",,S3,OBN Sprint 3,,,
JSON number type in TotalPaymentReqAmount in Merchant RTP,OBN1-167,Bug,Done,P2,,2/11/2019 14:36,,OBN R.1,negative,,,,"*Steps:*

# Send Merchant RTP with TotalPaymentReqAmount equals to a positive number JSON type with 2 digits after decimal point (see attach Request_Example.json).

*Expected result:*

OBN sends an json to Merchant that contains ""3002"" error and an explanation message: ”Invalid TotalPaymentReqAmount value, please provide a positive numeric string with 2 digits after decimal point (1.00)”.

*Actual result:*

OBN responds with error_code 500 and  debug information (see attach Response.json).",,S3,OBN Sprint 3,,,
Missing fields in Notify response sent to Merchant,OBN1-149,Bug,Done,P2,,2/4/2019 12:45,,OBN R.1,functional,,,,"*Steps:*
# Zapp sends a notification to OBN;
# The response is validated and send to Merchant;

*Expected result:*
The fields from expected result are reflected in attachments. The highlighted  fields are missing in actual request sent to Merchants.

*Actual result:*
The fields from actual result are reflected in attachments.",,S4,OBN Sprint 2,,,
"""Notify payment""- validation for mandatory fields.",OBN1-146,Bug,Done,P3,,2/1/2019 16:23,,OBN R.1,negative,,,,"*Scenario(example):*

# Zapp sends “notify payment“ with “MsgId” field longer than specified Max35Text.

*Expected result:*

  OBN sends to Zapp error code specifed in Zapp’s documentation with description.

*Actual result:*

 OBN returns to Zapp inner debug information (see the attachment Response_to_Zapp.html)

*Input example:*

see the attachment Input_Example.xml",,S3,OBN Sprint 2,,,
Add field name in the error response body,OBN1-144,Bug,Done,P3,,2/1/2019 8:56,,OBN R.1,,,,,"*Steps:*
# Merchant makes a request to OBN pltform;
# There is any error in DeliveryType filed;

*Expected result:*
The OBN should analyze the body and send an error message response to Merchant and indicate there the field name to be easily handle by Cardstream side.


Actual result:
The OBN sends the error response and some tips in the body, but the filed name is missing
_{
    ""pbbaErrorCode"": 302,
    ""pbbaErrorMessage"": ""Value \""aa\"" is invalid, please use one of: COLLST, DELTAD, DIGDEL, SERVICE, F2F, NONE""
}_",,S4,OBN Sprint 2,,,
TotalPaymentAmount field should accept values>0,OBN1-143,Bug,Done,P1 ,,2/1/2019 7:56,,OBN R.1,,,,,"*Steps:*

# Merchant makes a request to OBN pltform;
# The TotalPaymantAmount contains a value negative or 0

*Expected result:*
The OBN should analyze the body and send an error message response to Merchant if the amount value isn't positive.

*Actual result:*
The OBN sends the request to ZAPP and a 500 code response is received

*Request example:*
{
  ""DeviceInformation"":{
    ""DistDeviceType"": ""ATM"",
    ""IPAddress"": ""1.1.1.1"",
    ""DeviceOS"": ""WINMOB""
  },
  ""RTPSenderInfo"": {
    ""DetailMerchantInfo"": {
      ""MerchantInfo"": {
        ""MerchantId"": ""441b163d-253f-11e9-b771-0242ac170002""
      }
    }
  },
  ""RTPSummary"": {
    ""TxIdentification"": {
      ""TxDtTime"":""2018-05-30T17:12:37.878Z"", 
      ""OrderRef"": ""as"",
      ""CodeRequired"": ""BRN"" 
    },
    ""PaymtInfo"": {
      ""Currency"": ""GBP"",
      ""PaymtAmtInfo"": {""TotalPaymentReqAmount"": ""-15""}
    }
  },
  ""Delivery"": {
    ""DeliveryType"": ""DELTAD"",
    ""DeliveryAddressInfo"": {
      ""AddresseeName"": {
        ""Title"": ""MRS"",
        ""FirstName"": ""aa"",
        ""MiddleName"": ""aa"",
        ""LastName"": ""ceva""
      },
      ""DeliveryAddress"": {
        ""AddressLine1"": ""aa"",
        ""AddressLine2"": ""-1"",
        ""AddressLine3"": ""<script></script>"",
        ""AddressLine4"": ""£££"",
        ""AddressLine5"": ""§§"",
        ""PostCode"": ""aaaaaaaa1234567"",
        ""CountryCode"": ""MDA""
      },
      ""EmailAddress"": "" ""
    }
  },
  ""BrowserInfo"": {
  	""UserAgent"": ""asas"",
  	""TimeZone"": ""+03:00"",
  	""Screen"": ""{}{}"",
  	""ActiveHeaders"": ""11""
  },
  ""CookieDetls"": {
  	""CookieId"": ""укэât""
  },
  ""notificationUrl"": ""http://gogle.com""
}
 !image-2019-02-01-09-56-50-099.png|thumbnail! 
",,S2,OBN Sprint 2,,,
Error response on tab or enter value sending ,OBN1-142,Bug,Done,P1 ,,2/1/2019 7:14,,OBN R.1,,,,,"*Steps:*

# Merchant makes a request to OBN pltform;
# Any body field(text type) contains a tab or enter value

*Expected result:*
The OBN should analyze the body and send an error message response to Merchant if any field contains a tab value.

*Actual result:*
The OBN sends the request to ZAPP and a 400 code response is received

*Input example:*

\{
""DeviceInformation"":\{
""DistDeviceType"": ""ATM"",
""IPAddress"": ""1.1.1.1"",
""DeviceOS"": ""WINMOB""
\},
""RTPSenderInfo"": \{
""DetailMerchantInfo"": \{
""MerchantInfo"": \{
""MerchantId"": ""441b163d-253f-11e9-b771-0242ac170002""
\}
\}
\},
""RTPSummary"": \{
""TxIdentification"": \{
""TxDtTime"":""2018-05-30T17:12:37.878Z"",
""OrderRef"": ""as"",
""CodeRequired"": ""BRN""
\},
""PaymtInfo"": \{
""Currency"": ""GBP"",
""PaymtAmtInfo"": \{""TotalPaymentReqAmount"": ""0.1""\}
\}
\},
""Delivery"": \{
""DeliveryType"": ""DELTAD"",
""DeliveryAddressInfo"": \{
""AddresseeName"": \{
""Title"": ""MRS"",
""FirstName"": ""aa"",
""MiddleName"": ""aa"",
""LastName"": ""ceva""
\},
""DeliveryAddress"": \{
""AddressLine1"": ""aa"",
""AddressLine2"": ""\-1"",
""AddressLine3"": ""<script></script>"",
""AddressLine4"": ""£££"",
""AddressLine5"": ""§§"",
""PostCode"": ""aaaaaaaa1234567"",
""CountryCode"": ""MDA""
\},
""EmailAddress"": "" ""
\}
\},
""BrowserInfo"": \{
""UserAgent"": ""asas"",
""TimeZone"": ""\+03:00"",
""Screen"": "" "",
""ActiveHeaders"": ""11""
\},
""CookieDetls"": \{
""CookieId"": ""test""
\},
""notificationUrl"": ""[http://gogle.com""|http://gogle.com%22]
\}

!image-20190201-091112.png|thumbnail!",,S3,OBN Sprint 2,,,
